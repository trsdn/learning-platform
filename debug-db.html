<!DOCTYPE html>
<html>
<head>
  <title>Database Debug</title>
  <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
</head>
<body>
  <h1>IndexedDB Debug</h1>
  <pre id="output"></pre>

  <script>
    const output = document.getElementById('output');

    async function debugDB() {
      const db = new Dexie('LearningPlatformDB');
      db.version(1).stores({
        topics: 'id',
        learningPaths: 'id, topicId, difficulty, isActive',
        tasks: 'id, learningPathId, type',
        answerHistory: '++id, taskId, userId, timestamp',
        userProgress: 'id, userId, topicId',
        practiceSessions: 'id, userId, execution.status',
        spacedRepetition: 'id, taskId, userId, schedule.nextReview',
      });

      const topics = await db.topics.toArray();
      const paths = await db.learningPaths.toArray();
      const tasks = await db.tasks.toArray();

      output.textContent = `Topics: ${topics.length}\n`;
      output.textContent += `Learning Paths: ${paths.length}\n`;
      output.textContent += `Tasks: ${tasks.length}\n\n`;

      output.textContent += `=== Tasks by Learning Path ===\n`;
      for (const path of paths) {
        const pathTasks = tasks.filter(t => t.learningPathId === path.id);
        output.textContent += `\n${path.title} (${path.id}):\n`;
        output.textContent += `  taskIds array: ${path.taskIds?.length || 0}\n`;
        output.textContent += `  actual tasks in DB: ${pathTasks.length}\n`;
        pathTasks.forEach(t => {
          output.textContent += `    - ${t.id}\n`;
        });
      }
    }

    debugDB().catch(e => {
      output.textContent = 'Error: ' + e.message + '\n' + e.stack;
    });
  </script>
</body>
</html>