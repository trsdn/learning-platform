import{r as p,a as as,R as Fe}from"./react-DnQQq7lD.js";import{D as is}from"./storage-7oeF2ZJA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(c){if(c.ep)return;c.ep=!0;const o=a(c);fetch(c.href,o)}})();var Pt={exports:{}},rt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ns=p,rs=Symbol.for("react.element"),os=Symbol.for("react.fragment"),cs=Object.prototype.hasOwnProperty,ls=ns.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ds={key:!0,ref:!0,__self:!0,__source:!0};function Dt(s,e,a){var n,c={},o=null,l=null;a!==void 0&&(o=""+a),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(l=e.ref);for(n in e)cs.call(e,n)&&!ds.hasOwnProperty(n)&&(c[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)c[n]===void 0&&(c[n]=e[n]);return{$$typeof:rs,type:s,key:o,ref:l,props:c,_owner:ls.current}}rt.Fragment=os;rt.jsx=Dt;rt.jsxs=Dt;Pt.exports=rt;var t=Pt.exports,yt={},St=as;yt.createRoot=St.createRoot,yt.hydrateRoot=St.hydrateRoot;class us extends is{topics;learningPaths;tasks;answerHistory;userProgress;practiceSessions;spacedRepetition;constructor(){super("mindforge-academy-test"),this.version(1).stores({topics:"id, title, isActive, createdAt",learningPaths:"id, topicId, difficulty, isActive, createdAt",tasks:"id, learningPathId, type, *metadata.tags, metadata.difficulty, createdAt, hasAudio, language",answerHistory:"id, taskId, sessionId, timestamp, isCorrect",userProgress:"id, topicId, learningPathId, *milestones.lastActivity",practiceSessions:"id, execution.status, execution.startedAt, execution.completedAt, createdAt",spacedRepetition:"id, taskId, schedule.nextReview, algorithm.interval, createdAt"})}}const O=new us;async function _s(){const s=new Map,e=[],a=[],n={mathematik:["algebra-basics.json","geometry-basics.json","advanced-tasks.json","brueche-grundlagen.json"],biologie:["zellbiologie.json","genetik-basics.json"],spanisch:["spanisch-grundlagen.json","begruessung-vorstellung.json","familie-persoenliches.json","zahlen-farben-tiere.json","vokabeltest-karteikarten.json"],test:["all-task-types.json"]};for(const[c,o]of Object.entries(n)){if(!s.has(c)){const l=ps(c);s.set(c,l)}for(const l of o)try{const i=`/learning-platform/test/learning-paths/${c}/${l}`,f=await fetch(i);if(!f.ok){console.warn(`Failed to load ${i}: ${f.status}`);continue}const k=await f.json(),L=k.tasks.map(_=>_.id),C={...k.learningPath,taskIds:L,createdAt:k.learningPath.createdAt?new Date(k.learningPath.createdAt):new Date("2024-01-01"),updatedAt:k.learningPath.createdAt?new Date(k.learningPath.createdAt):new Date("2024-01-01")};e.push(C);const D=s.get(c);D.learningPathIds.includes(C.id)||D.learningPathIds.push(C.id);for(const _ of k.tasks){const V={..._,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")};a.push(V)}}catch(y){console.error(`Failed to load learning path ${c}/${l}:`,y)}}return{topics:Array.from(s.values()),learningPaths:e,tasks:a}}function ps(s){const a={test:{id:"test",title:"Test & Demo",description:"Demonstriert alle Aufgabentypen der Plattform",metadata:{estimatedHours:1,difficultyLevel:"beginner",prerequisites:[]}},mathematik:{id:"mathematik",title:"Mathematik",description:"Grundlagen der Mathematik: Algebra, Geometrie und mehr",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},biologie:{id:"biologie",title:"Biologie",description:"Einf√ºhrung in die Biologie: Zellen, Genetik und √ñkosysteme",metadata:{estimatedHours:35,difficultyLevel:"beginner",prerequisites:[]}},spanisch:{id:"spanisch",title:"Spanisch",description:"Lerne Spanisch: Vokabeln, Grammatik und Konversation",metadata:{estimatedHours:50,difficultyLevel:"beginner",prerequisites:[]}},chemie:{id:"chemie",title:"Chemie",description:"Grundlagen der Chemie: Atome, Molek√ºle und Reaktionen",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},physik:{id:"physik",title:"Physik",description:"Einf√ºhrung in die Physik: Kr√§fte, Energie und Bewegung",metadata:{estimatedHours:45,difficultyLevel:"intermediate",prerequisites:[]}}}[s]||{id:s,title:s.charAt(0).toUpperCase()+s.slice(1),description:`Lernmaterialien f√ºr ${s}`,metadata:{estimatedHours:30,difficultyLevel:"beginner",prerequisites:[]}};return{id:a.id,title:a.title,description:a.description,learningPathIds:[],isActive:!0,metadata:a.metadata,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}}async function At(s){console.log("üóëÔ∏è Clearing existing database...");const e=await s.topics.count(),a=await s.learningPaths.count(),n=await s.tasks.count();console.log(`Before clear: ${e} topics, ${a} paths, ${n} tasks`),await s.topics.clear(),await s.learningPaths.clear(),await s.tasks.clear();const c=await s.tasks.count();console.log(`After clear: ${c} tasks remaining`),console.log("üìÇ Loading learning paths from JSON files...");const o=await _s();if(o.topics.length===0)throw new Error("No learning paths found in JSON files!");console.log(`Saving to database: ${o.topics.length} topics, ${o.learningPaths.length} learning paths, ${o.tasks.length} tasks`),console.log("Topics:",o.topics.map(f=>f.id)),console.log("Learning paths:",o.learningPaths.map(f=>`${f.id} (${f.taskIds?.length||0} taskIds)`)),console.log("Tasks:",o.tasks.map(f=>`${f.id} (learningPathId: ${f.learningPathId})`));try{await s.topics.bulkAdd(o.topics),console.log("‚úì Topics saved")}catch{console.log("‚ö†Ô∏è Topics exist, using bulkPut to update..."),await s.topics.bulkPut(o.topics),console.log("‚úì Topics updated")}try{await s.learningPaths.bulkAdd(o.learningPaths),console.log("‚úì Learning paths saved")}catch{console.log("‚ö†Ô∏è Learning paths exist, using bulkPut to update..."),await s.learningPaths.bulkPut(o.learningPaths),console.log("‚úì Learning paths updated")}try{await s.tasks.bulkAdd(o.tasks),console.log("‚úì Tasks saved")}catch(f){console.error("‚ùå Error saving tasks with bulkAdd:",f.message),console.log("‚ö†Ô∏è Some tasks already exist, using bulkPut to update...");try{await s.tasks.bulkPut(o.tasks),console.log("‚úì Tasks updated with bulkPut")}catch(k){console.error("‚ùå Error with bulkPut:",k.message)}}console.log(`‚úÖ Loaded from JSON: ${o.topics.length} topics, ${o.learningPaths.length} learning paths, ${o.tasks.length} tasks`);const l=await s.topics.count(),y=await s.learningPaths.count(),i=await s.tasks.count();console.log(`‚úÖ Verified in DB: ${l} topics, ${y} learning paths, ${i} tasks`)}class Lt extends Error{constructor(e,a,n){super(e),this.code=a,this.context=n,this.name="LearningPlatformError"}}class Te extends Lt{constructor(e,a){super(e,"VALIDATION_ERROR",a),this.name="ValidationError"}}class Me extends Lt{constructor(e,a){super(`${e} with id ${a} not found`,"NOT_FOUND",{resource:e,id:a}),this.name="NotFoundError"}}class ce{id;configuration;execution;results;createdAt;updatedAt;constructor(e){ce.validate(e),this.id=e.id,this.configuration={...e.configuration,learningPathIds:[...e.configuration.learningPathIds]},this.execution={taskIds:[...e.execution.taskIds],completedCount:e.execution.completedCount,correctCount:e.execution.correctCount,status:e.execution.status,totalTimeSpent:e.execution.totalTimeSpent},e.execution.startedAt&&(this.execution.startedAt=new Date(e.execution.startedAt)),e.execution.completedAt&&(this.execution.completedAt=new Date(e.execution.completedAt)),this.results={...e.results,difficultyDistribution:{...e.results.difficultyDistribution},improvementAreas:[...e.results.improvementAreas]},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.configuration?.targetCount!==void 0&&(e.configuration.targetCount<5||e.configuration.targetCount>50))throw new Te("Target count must be between 5 and 50",{field:"targetCount",value:e.configuration.targetCount});if(e.execution?.status!==void 0){const a=["planned","active","paused","completed","abandoned"];if(!a.includes(e.execution.status))throw new Te("Invalid session status",{field:"status",value:e.execution.status,validValues:a})}}static create(e,a,n,c,o){const l={topicId:a,learningPathIds:n,targetCount:o.targetCount,includeReview:o.includeReview};return o.difficultyFilter&&(l.difficultyFilter=o.difficultyFilter),new ce({id:e,configuration:l,execution:{taskIds:c,completedCount:0,correctCount:0,status:"planned",totalTimeSpent:0},results:{accuracy:0,averageTime:0,difficultyDistribution:{},improvementAreas:[]}})}start(){if(this.execution.status!=="planned"&&this.execution.status!=="paused")throw new Error("Can only start planned or paused sessions");this.execution.status="active",this.execution.startedAt||(this.execution.startedAt=new Date),this.updatedAt=new Date}pause(){if(this.execution.status!=="active")throw new Error("Can only pause active sessions");this.execution.status="paused",this.updatedAt=new Date}resume(){if(this.execution.status!=="paused")throw new Error("Can only resume paused sessions");this.execution.status="active",this.updatedAt=new Date}recordAnswer(e,a){if(this.execution.status!=="active")throw new Error("Session must be active to record answers");this.execution.completedCount++,e&&this.execution.correctCount++,this.execution.totalTimeSpent+=a,this.updateResults(),this.updatedAt=new Date}complete(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="completed",this.execution.completedAt=new Date,this.updateResults(),this.updatedAt=new Date}abandon(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="abandoned",this.updatedAt=new Date}updateResults(){this.execution.completedCount>0&&(this.results.accuracy=this.execution.correctCount/this.execution.completedCount*100),this.execution.completedCount>0&&(this.results.averageTime=this.execution.totalTimeSpent/this.execution.completedCount)}getProgress(){return this.execution.completedCount/this.configuration.targetCount*100}isComplete(){return this.execution.completedCount>=this.configuration.targetCount}getRemainingCount(){return Math.max(0,this.configuration.targetCount-this.execution.completedCount)}toJSON(){const e={id:this.id,configuration:{...this.configuration,learningPathIds:[...this.configuration.learningPathIds]},execution:{...this.execution,taskIds:[...this.execution.taskIds]},results:{...this.results,difficultyDistribution:{...this.results.difficultyDistribution},improvementAreas:[...this.results.improvementAreas]},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.configuration.difficultyFilter&&(e.configuration.difficultyFilter=this.configuration.difficultyFilter),this.execution.startedAt&&(e.execution.startedAt=this.execution.startedAt),this.execution.completedAt&&(e.execution.completedAt=this.execution.completedAt),e}static fromJSON(e){return new ce(e)}}class ut{constructor(e,a,n){this.sessionRepository=e,this.taskRepository=a,this.spacedRepRepository=n}async createSession(e){const a=await this.selectTasksForSession(e),n=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c={targetCount:e.targetCount,includeReview:e.includeReview};e.difficultyFilter&&(c.difficultyFilter=e.difficultyFilter);const o=ce.create(n,e.topicId,e.learningPathIds,a,c);return await this.sessionRepository.create(o.toJSON())}async getSession(e){return await this.sessionRepository.getById(e)}async updateSession(e,a){await this.sessionRepository.update(e,a)}async completeSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Me("PracticeSession",e);const n=ce.fromJSON(a);return n.complete(),await this.sessionRepository.update(e,n.toJSON())}async pauseSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Me("PracticeSession",e);const n=ce.fromJSON(a);n.pause(),await this.sessionRepository.update(e,n.toJSON())}async resumeSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Me("PracticeSession",e);const n=ce.fromJSON(a);n.resume(),await this.sessionRepository.update(e,n.toJSON())}async abandonSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Me("PracticeSession",e);const n=ce.fromJSON(a);n.abandon(),await this.sessionRepository.update(e,n.toJSON())}async getActiveSessions(e){return await this.sessionRepository.getActive(e)}async getRecentSessions(e,a){return await this.sessionRepository.getRecent(e,a)}async recordSessionAnswer(e,a,n){const c=await this.sessionRepository.getById(e);if(!c)throw new Me("PracticeSession",e);const o=ce.fromJSON(c);o.execution.status==="planned"&&o.start(),o.recordAnswer(a,n),o.isComplete()&&o.complete(),await this.sessionRepository.update(e,o.toJSON())}async selectTasksForSession(e){const a=[];let n=e.targetCount;if(console.log(`Selecting tasks: targetCount=${e.targetCount}, learningPaths=${e.learningPathIds.join(",")}`),e.includeReview&&n>0){const c=await this.spacedRepRepository.getDue(new Date),o=c.slice(0,Math.min(c.length,Math.ceil(e.targetCount*.3))).map(l=>l.taskId);console.log(`Review tasks found: ${o.length}`),a.push(...o),n-=o.length}if(n>0){const c={learningPathIds:e.learningPathIds,excludeIds:a};e.difficultyFilter&&(c.difficulty=e.difficultyFilter),console.log(`Requesting ${n} new tasks with filters:`,c);const o=await this.taskRepository.getRandomTasks(n,c);console.log(`Got ${o.length} tasks:`,o.map(l=>l.id)),a.push(...o.map(l=>l.id))}return console.log(`Total selected tasks: ${a.length}`),a}}class Oe{id;taskId;algorithm;schedule;performance;metadata;createdAt;updatedAt;constructor(e){Oe.validate(e),this.id=e.id,this.taskId=e.taskId,this.algorithm={...e.algorithm},this.schedule={...e.schedule,nextReview:new Date(e.schedule.nextReview)},e.schedule.lastReviewed&&(this.schedule.lastReviewed=new Date(e.schedule.lastReviewed)),this.performance={...e.performance},this.metadata={...e.metadata,introduced:new Date(e.metadata.introduced)},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.algorithm?.efactor!==void 0&&(e.algorithm.efactor<1.3||e.algorithm.efactor>2.5))throw new Te("Efactor must be between 1.3 and 2.5",{field:"efactor",value:e.algorithm.efactor});if(e.algorithm?.interval!==void 0&&(e.algorithm.interval<0||e.algorithm.interval>365))throw new Te("Interval must be between 0 and 365 days",{field:"interval",value:e.algorithm.interval});if(e.performance?.lastGrade!==void 0&&(e.performance.lastGrade<0||e.performance.lastGrade>5))throw new Te("Grade must be between 0 and 5",{field:"lastGrade",value:e.performance.lastGrade});if(e.performance?.averageAccuracy!==void 0&&(e.performance.averageAccuracy<0||e.performance.averageAccuracy>100))throw new Te("Average accuracy must be between 0 and 100",{field:"averageAccuracy",value:e.performance.averageAccuracy})}static createNew(e,a){return new Oe({id:a,taskId:e,algorithm:{interval:1,repetition:0,efactor:2.5},schedule:{nextReview:new Date(Date.now()+24*60*60*1e3),totalReviews:0,consecutiveCorrect:0},performance:{averageAccuracy:0,averageTime:0,difficultyRating:3,lastGrade:0},metadata:{introduced:new Date,graduated:!1,lapseCount:0}})}recordAnswer(e,a){if(e<0||e>5)throw new Te("Grade must be between 0 and 5",{field:"grade",value:e});if(this.performance.lastGrade=e,this.updateAverageAccuracy(e>=3),this.updateAverageTime(a),this.schedule.totalReviews++,this.schedule.lastReviewed=new Date,e<3)this.algorithm.repetition=0,this.algorithm.interval=1,this.schedule.consecutiveCorrect=0,this.metadata.lapseCount++,this.metadata.graduated=!1;else{this.schedule.consecutiveCorrect++;const n=.1-(5-e)*(.08+(5-e)*.02);this.algorithm.efactor=Math.max(1.3,this.algorithm.efactor+n),this.algorithm.efactor=Math.min(2.5,this.algorithm.efactor),this.algorithm.repetition===0?this.algorithm.interval=1:this.algorithm.repetition===1?this.algorithm.interval=6:this.algorithm.interval=Math.round(this.algorithm.interval*this.algorithm.efactor),this.algorithm.interval=Math.min(365,this.algorithm.interval),this.algorithm.repetition++,this.algorithm.repetition>=2&&(this.metadata.graduated=!0)}this.schedule.nextReview=new Date(Date.now()+this.algorithm.interval*24*60*60*1e3),this.updatedAt=new Date}updateAverageAccuracy(e){const a=this.schedule.totalReviews,c=this.performance.averageAccuracy/100*(a-1)+(e?1:0);this.performance.averageAccuracy=c/a*100}updateAverageTime(e){const a=this.schedule.totalReviews,c=this.performance.averageTime*(a-1)+e;this.performance.averageTime=c/a}isDue(){return this.schedule.nextReview.getTime()<=Date.now()}daysUntilReview(){const e=this.schedule.nextReview.getTime()-Date.now();return Math.ceil(e/(24*60*60*1e3))}toJSON(){const e={id:this.id,taskId:this.taskId,algorithm:{...this.algorithm},schedule:{nextReview:this.schedule.nextReview,totalReviews:this.schedule.totalReviews,consecutiveCorrect:this.schedule.consecutiveCorrect},performance:{...this.performance},metadata:{introduced:this.metadata.introduced,graduated:this.metadata.graduated,lapseCount:this.metadata.lapseCount},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.schedule.lastReviewed&&(e.schedule.lastReviewed=this.schedule.lastReviewed),e}static fromJSON(e){return new Oe(e)}}class hs{constructor(e,a){this.spacedRepRepository=e,this.taskRepository=a}async getNextTasks(e,a){const o=(await this.spacedRepRepository.getDue(new Date)).sort((y,i)=>i.metadata.lapseCount!==y.metadata.lapseCount?i.metadata.lapseCount-y.metadata.lapseCount:y.schedule.nextReview.getTime()-i.schedule.nextReview.getTime()).slice(0,a),l=[];for(const y of o){const i=await this.taskRepository.getById(y.taskId);i&&l.push(i)}return l}async recordAnswer(e,a,n){if(n<0||n>5)throw new Error("Grade must be between 0 and 5");let c=await this.spacedRepRepository.getByTaskId(e);if(!c){const l=Oe.createNew(e,`sr-${e}-${Date.now()}`);c=await this.spacedRepRepository.create(l.toJSON())}const o=Oe.fromJSON(c);o.recordAnswer(n,0),await this.spacedRepRepository.update(c.id,o.toJSON())}async getRepetitionData(e){return await this.spacedRepRepository.getByTaskId(e)}async getTasksDue(e){const a=await this.spacedRepRepository.getDue(new Date),n=[];for(const c of a){const o=await this.taskRepository.getById(c.taskId);o&&n.push(o)}return n}async getReviewSchedule(e,a){const n=[],c=new Date;for(let o=0;o<a;o++){const l=new Date(c);l.setDate(l.getDate()+o),l.setHours(23,59,59,999);const y=await this.spacedRepRepository.getByNextReviewDate(l);let i=0;for(const f of y)i+=f.performance.averageTime||3e4;n.push({date:l,taskCount:y.length,estimatedTime:Math.round(i/1e3)})}return n}async rescheduleTask(e,a){const n=await this.spacedRepRepository.getByTaskId(e);if(!n)throw new Me("SpacedRepetitionItem",e);await this.spacedRepRepository.updateSchedule(n.id,{...n.schedule,nextReview:a})}async getStatistics(e){const a=await this.spacedRepRepository.getAll(),n=await this.spacedRepRepository.getDue(new Date),c=a.filter(y=>y.metadata.graduated).length,o=a.reduce((y,i)=>y+i.algorithm.interval,0),l=a.reduce((y,i)=>y+i.performance.averageAccuracy,0);return{totalItems:a.length,dueToday:n.length,graduated:c,averageInterval:a.length>0?o/a.length:0,averageAccuracy:a.length>0?l/a.length:0}}}class ms{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async search(e){const a=e.toLowerCase();return await this.table.filter(n=>n.title.toLowerCase().includes(a)).toArray()}async getByTitle(e){return null}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class fs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return await this.table.where("topicId").equals(e).toArray()}async getByDifficulty(e){return await this.table.where("difficulty").equals(e).toArray()}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async searchByTitle(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class gs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByLearningPathId(e){return await this.table.where("learningPathId").equals(e).toArray()}async getRandomTasks(e,a){console.log(`[TaskRepository] getRandomTasks called: count=${e}, filters=`,a);let n;if(a?.learningPathIds?(n=await this.table.where("learningPathId").anyOf(a.learningPathIds).toArray(),console.log(`[TaskRepository] Found ${n.length} tasks for learning paths:`,a.learningPathIds),console.log("[TaskRepository] Task IDs:",n.map(l=>l.id))):(n=await this.table.toArray(),console.log(`[TaskRepository] Found ${n.length} tasks (no filter)`)),a?.excludeIds){const l=n.length;n=n.filter(y=>!a.excludeIds.includes(y.id)),console.log(`[TaskRepository] After excluding IDs: ${l} -> ${n.length} tasks`)}const c=n.sort(()=>Math.random()-.5),o=[];if(c.length===0)return console.log("[TaskRepository] No tasks available!"),o;for(let l=0;l<e;l++){const y=c[l%c.length];y&&o.push(y)}return console.log(`[TaskRepository] Returning ${o.length} tasks (${c.length} unique, repeated to reach ${e})`),o}async getByLearningPathIds(e){return[]}async getByType(e){return[]}async getByDifficulty(e){return[]}async getByTags(e){return[]}async search(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class bs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return await this.table.where("taskId").equals(e).toArray()}async getBySessionId(e){return await this.table.where("sessionId").equals(e).toArray()}async getByUserId(e,a){return[]}async getByDateRange(e,a){return[]}async getCorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(a=>a.isCorrect).toArray()}async getIncorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(a=>!a.isCorrect).toArray()}async getAccuracyForPeriod(e,a,n){return 0}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class ys{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return(await this.table.where("topicId").equals(e).toArray())[0]||null}async getByLearningPathId(e){return(await this.table.where("learningPathId").equals(e).toArray())[0]||null}async getByUserId(e){return[]}async updateStatistics(e,a){}async incrementTaskCount(e,a){}async updateStreak(e,a){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class vs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(e){return await this.table.where("execution.status").anyOf(["planned","active","paused"]).toArray()}async getRecent(e,a){return await this.table.orderBy("createdAt").reverse().limit(a).toArray()}async getByStatus(e){return await this.table.where("execution.status").equals(e).toArray()}async getByUserId(e){return[]}async getByDateRange(e,a){return[]}async updateStatus(e,a){}async incrementProgress(e,a,n){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class ws{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return(await this.table.where("taskId").equals(e).toArray())[0]||null}async getDue(e){return await this.table.where("schedule.nextReview").belowOrEqual(e).toArray()}async getByNextReviewDate(e){return[]}async updateAlgorithmData(e,a){}async updateSchedule(e,a){}async updatePerformance(e,a){}async getReviewCalendar(e,a){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class vt{static topicRepo;static learningPathRepo;static taskRepo;static answerHistoryRepo;static userProgressRepo;static practiceSessionRepo;static spacedRepetitionRepo;static getTopicRepository(){return this.topicRepo||(this.topicRepo=new ms(O.topics)),this.topicRepo}static getLearningPathRepository(){return this.learningPathRepo||(this.learningPathRepo=new fs(O.learningPaths)),this.learningPathRepo}static getTaskRepository(){return this.taskRepo||(this.taskRepo=new gs(O.tasks)),this.taskRepo}static getAnswerHistoryRepository(){return this.answerHistoryRepo||(this.answerHistoryRepo=new bs(O.answerHistory)),this.answerHistoryRepo}static getUserProgressRepository(){return this.userProgressRepo||(this.userProgressRepo=new ys(O.userProgress)),this.userProgressRepo}static getPracticeSessionRepository(){return this.practiceSessionRepo||(this.practiceSessionRepo=new vs(O.practiceSessions)),this.practiceSessionRepo}static getSpacedRepetitionRepository(){return this.spacedRepetitionRepo||(this.spacedRepetitionRepo=new ws(O.spacedRepetition)),this.spacedRepetitionRepo}static reset(){this.topicRepo=null,this.learningPathRepo=null,this.taskRepo=null,this.answerHistoryRepo=null,this.userProgressRepo=null,this.practiceSessionRepo=null,this.spacedRepetitionRepo=null}}const tt=()=>vt.getTaskRepository(),_t=()=>vt.getPracticeSessionRepository(),st=()=>vt.getSpacedRepetitionRepository(),pt={audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null},xs=500,ks=2048,Ss=100;class As{audio=null;state={...pt};stateListeners=new Set;preloadedAudio=null;autoPlayTimer=null;lastPlayTime=0;async initialize(){this.setState({...pt})}async loadAudio(e,a,n){if(this.stop(),this.clearAutoPlayTimer(),!e.audioUrl)throw new Error("Task does not have an audio URL");if(!this.validateAudioUrl(e.audioUrl))throw new Error("Invalid audio URL");this.audio=new Audio(e.audioUrl),this.setState({audioUrl:e.audioUrl,status:"loading",currentTime:0,duration:0,autoPlayUnlocked:this.state.autoPlayUnlocked,preloadedNextUrl:this.state.preloadedNextUrl,error:null}),this.audio.addEventListener("loadedmetadata",()=>{this.audio&&this.setState({...this.state,duration:this.audio.duration,status:"stopped"})}),this.audio.addEventListener("timeupdate",()=>{this.audio&&this.state.status==="playing"&&this.setState({...this.state,currentTime:this.audio.currentTime})}),this.audio.addEventListener("ended",()=>{this.setState({...this.state,status:"stopped",currentTime:0})}),this.audio.addEventListener("error",o=>{this.setState({...this.state,status:"error",error:`Failed to load audio: ${o.message||"Unknown error"}`})}),this.audio.load(),n&&this.state.autoPlayUnlocked&&(this.autoPlayTimer=window.setTimeout(async()=>{try{await this.play()}catch(o){console.error("Auto-play failed:",o)}},xs))}async play(){if(!this.audio)throw new Error("No audio loaded");const e=Date.now();if(e-this.lastPlayTime<Ss){console.warn("Rate limit: Too many play() calls. Please wait.");return}this.lastPlayTime=e;try{await this.audio.play(),this.setState({...this.state,status:"playing"})}catch(n){throw n.name==="NotAllowedError"&&this.setState({...this.state,status:"error",error:"Auto-play blocked by browser. Please click to enable audio."}),n}}pause(){this.audio&&(this.audio.pause(),this.setState({...this.state,status:"paused",currentTime:this.audio.currentTime}))}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.setState({...this.state,status:"stopped",currentTime:0}))}async replay(){if(!this.audio)throw new Error("No audio loaded");this.audio.currentTime=0,await this.play()}async togglePlayPause(){this.state.status==="playing"?this.pause():(this.state.status==="paused"||this.state.status==="stopped")&&await this.play()}preloadNext(e){e.audioUrl&&(this.preloadedAudio=new Audio(e.audioUrl),this.preloadedAudio.preload="auto",this.setState({...this.state,preloadedNextUrl:e.audioUrl}))}async checkAutoPlayPermission(){return this.state.autoPlayUnlocked}async unlockAutoPlay(){return this.setState({...this.state,autoPlayUnlocked:!0}),!0}getPlaybackState(){return{...this.state}}onStateChange(e){return this.stateListeners.add(e),()=>{this.stateListeners.delete(e)}}dispose(){this.clearAutoPlayTimer(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null),this.preloadedAudio&&(this.preloadedAudio.src="",this.preloadedAudio=null),this.setState({...pt}),this.stateListeners.clear()}setState(e){this.state=e,this.stateListeners.forEach(a=>{a(e)})}clearAutoPlayTimer(){this.autoPlayTimer!==null&&(window.clearTimeout(this.autoPlayTimer),this.autoPlayTimer=null)}validateAudioUrl(e){return e.length>ks?(console.warn("Audio URL exceeds maximum length"),!1):e.startsWith("/audio/")||e.includes("/audio/")||e.startsWith("data:audio/")?!0:(console.warn("Audio URL must contain /audio/ or start with data:audio/",e),!1)}}function js(){return new As}function Ns(){const s=p.useRef(null),[e,a]=p.useState({audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null});return p.useEffect(()=>{const C=js();s.current=C,C.initialize().catch(_=>{console.error("Failed to initialize audio service:",_)});const D=C.onStateChange(_=>{a(_)});return()=>{C.stop(),D(),C.dispose(),s.current=null}},[]),{playbackState:e,loadAudio:async(C,D,_)=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.loadAudio(C,D,_)},play:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.play()},pause:()=>{s.current?.pause()},stop:()=>{s.current?.stop()},replay:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.replay()},togglePlayPause:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.togglePlayPause()},preloadNext:C=>{s.current?.preloadNext(C)},checkAutoPlayPermission:async()=>s.current?s.current.checkAutoPlayPermission():!1,unlockAutoPlay:async()=>s.current?s.current.unlockAutoPlay():!1}}const Ee={version:2,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1};function ht(s){const e=s;if(typeof e.autoPlayEnabled!="boolean")throw new Error("autoPlayEnabled must be boolean");if(!["non-German only","all languages","none"].includes(e.languageFilter))throw new Error(`Invalid languageFilter value: ${e.languageFilter}`);if(e.perTopicOverrides&&typeof e.perTopicOverrides!="object")throw new Error("perTopicOverrides must be object");if(typeof e.accessibilityMode!="boolean")throw new Error("accessibilityMode must be boolean");if(typeof e.version!="number"||e.version<1)throw new Error("version must be positive integer");return e}const Ye="audioSettings",Rs=500;class Cs{saveTimer=null;load(){try{const e=localStorage.getItem(Ye);if(!e)return{...Ee};const a=JSON.parse(e);return a.version!==Ee.version?this.migrate(a):ht(a)}catch(e){return console.error("Failed to load audio settings, using defaults:",e),{...Ee}}}save(e){try{ht(e),this.saveTimer!==null&&window.clearTimeout(this.saveTimer),typeof globalThis.describe=="function"&&typeof globalThis.it=="function"?localStorage.setItem(Ye,JSON.stringify(e)):this.saveTimer=window.setTimeout(()=>{localStorage.setItem(Ye,JSON.stringify(e)),this.saveTimer=null},Rs)}catch(a){throw console.error("Failed to save audio settings:",a),a}}update(e){const a=this.load(),n={...a,...e,version:e.version??a.version,perTopicOverrides:{...a.perTopicOverrides,...e.perTopicOverrides??{}}};this.save(n)}reset(){localStorage.removeItem(Ye)}exists(){return localStorage.getItem(Ye)!==null}migrate(e){const a={version:2,autoPlayEnabled:e.version===1?!0:e.autoPlayEnabled??Ee.autoPlayEnabled,languageFilter:e.languageFilter??Ee.languageFilter,perTopicOverrides:e.perTopicOverrides??{},accessibilityMode:e.accessibilityMode??Ee.accessibilityMode};try{return ht(a),this.save(a),a}catch(n){return console.error("Migration failed, using defaults:",n),{...Ee}}}}function Es(){return new Cs}function zt(){const s=p.useRef(null),[e,a]=p.useState(null),[n,c]=p.useState(!1);return p.useEffect(()=>{const y=Es();s.current=y;const i=y.load();a(i),c(!0)},[]),{settings:e||{version:1,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1},updateSettings:y=>{if(!s.current||!e){console.warn("Audio settings not loaded yet");return}s.current.update(y);const i=s.current.load();a(i)},resetSettings:()=>{if(!s.current){console.warn("Audio settings not loaded yet");return}s.current.reset();const y=s.current.load();a(y)},isLoaded:n}}function Ts(s,e){if(!s.hasAudio||!s.audioUrl||!e.autoPlayEnabled)return!1;const a=s.language||"German";switch(e.languageFilter){case"none":return!1;case"all languages":return!0;case"non-German only":return a!=="German";default:return!1}}const mt=new Map;async function Is(s){if(mt.has(s))return mt.get(s);try{const e=await fetch(`/learning-platform/test/templates/${s}.json`);if(!e.ok)return console.warn(`Template ${s} not found`),null;const a=await e.json();return mt.set(s,a),a}catch(e){return console.error(`Failed to load template ${s}:`,e),null}}async function Ps(s){return(await Is(s))?.audioConfig||null}function Bt(s){var e,a,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var c=s.length;for(e=0;e<c;e++)s[e]&&(a=Bt(s[e]))&&(n&&(n+=" "),n+=a)}else for(a in s)s[a]&&(n&&(n+=" "),n+=a);return n}function q(){for(var s,e,a=0,n="",c=arguments.length;a<c;a++)(s=arguments[a])&&(e=Bt(s))&&(n&&(n+=" "),n+=e);return n}const Ds="_pulse_1m38x_1",pe={"audio-button":"_audio-button_1m38x_4","audio-button--disabled":"_audio-button--disabled_1m38x_15","audio-button--small":"_audio-button--small_1m38x_24","audio-button--medium":"_audio-button--medium_1m38x_29","audio-button--large":"_audio-button--large_1m38x_34","audio-button--playing":"_audio-button--playing_1m38x_52","audio-button--active":"_audio-button--active_1m38x_59","audio-button__icon":"_audio-button__icon_1m38x_69","audio-button__icon--playing":"_audio-button__icon--playing_1m38x_73",pulse:Ds,"audio-button-inline":"_audio-button-inline_1m38x_88"},jt=({size:s})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:s,height:s},children:t.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),Ls=({size:s})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:s,height:s},children:t.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),zs=({text:s,audioUrl:e,className:a,disabled:n=!1,size:c="medium"})=>{const[o,l]=p.useState(!1),[y,i]=p.useState(null),f=p.useRef(null),k=!!e,L=async()=>{if(!(n||!k||!e)){i(null);try{f.current||(f.current=new Audio(e),f.current.addEventListener("ended",()=>l(!1)),f.current.addEventListener("error",()=>{i("Audio playback failed"),l(!1)})),f.current.currentTime=0,l(!0),await f.current.play()}catch(_){console.error("Failed to play audio:",_),i("Audio playback failed"),l(!1)}}},C={small:"16px",medium:"20px",large:"24px"},D=n||!k;return t.jsx("span",{onClick:D?void 0:L,className:q(pe["audio-button"],pe[`audio-button--${c}`],D&&pe["audio-button--disabled"],o&&pe["audio-button--playing"],!D&&!o&&pe["audio-button--active"],a),title:k?o?"Spielt ab...":`Aussprache abspielen: ${s}`:"Audio nicht verf√ºgbar","aria-label":`Spanische Aussprache f√ºr ${s} abspielen`,role:"button",tabIndex:D?-1:0,onKeyDown:_=>{!D&&(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),L())},children:o?t.jsx("div",{className:q(pe["audio-button__icon"],pe["audio-button__icon--playing"]),children:t.jsx(jt,{size:C[c]})}):!k||y?t.jsx("div",{className:pe["audio-button__icon"],children:t.jsx(Ls,{size:C[c]})}):t.jsx("div",{className:pe["audio-button__icon"],children:t.jsx(jt,{size:C[c]})})})},xe=p.memo(zs),Bs="_card_1cbjp_4",Le={card:Bs,"card--shadow":"_card--shadow_1cbjp_11","card--no-shadow":"_card--no-shadow_1cbjp_15","card--border":"_card--border_1cbjp_20","card--no-border":"_card--no-border_1cbjp_24","card--padding-small":"_card--padding-small_1cbjp_29","card--padding-medium":"_card--padding-medium_1cbjp_33","card--padding-large":"_card--padding-large_1cbjp_37"};function Ie({padding:s="medium",shadow:e=!0,border:a=!0,borderColor:n,backgroundColor:c,children:o,className:l,style:y,...i}){const f={...c&&{backgroundColor:c},...n&&{borderColor:n},...y};return t.jsx("div",{...i,style:f,className:q(Le.card,Le[`card--padding-${s}`],e?Le["card--shadow"]:Le["card--no-shadow"],a?Le["card--border"]:Le["card--no-border"],l),children:o})}const F={primary:{500:"#3b82f6"},success:{100:"#dcfce7",300:"#86efac",500:"#10b981"},error:{100:"#fee2e2",300:"#fca5a5",500:"#ef4444"},warning:{100:"#fef3c7",400:"#fbbf24",500:"#f59e0b"},info:{100:"#f3e8ff",300:"#d8b4fe",500:"#8b5cf6"}},K={feedback:{success:F.success[500],successLight:F.success[100],successBorder:F.success[300],error:F.error[500],errorLight:F.error[100],errorBorder:F.error[300],warning:F.warning[500],warningLight:F.warning[100],warningBorder:F.warning[400],info:F.info[500],infoLight:F.info[100],infoBorder:F.info[300]}},ke={"feedback-content":"_feedback-content_1oyn0_4","feedback-icon":"_feedback-icon_1oyn0_11","feedback-text":"_feedback-text_1oyn0_19","feedback-title":"_feedback-title_1oyn0_24","feedback-message":"_feedback-message_1oyn0_32","feedback-children":"_feedback-children_1oyn0_39","feedback-dismiss":"_feedback-dismiss_1oyn0_45","feedback--success":"_feedback--success_1oyn0_62","feedback--error":"_feedback--error_1oyn0_71","feedback--warning":"_feedback--warning_1oyn0_80","feedback--info":"_feedback--info_1oyn0_89"};function $s({variant:s,title:e,message:a,dismissible:n=!1,onDismiss:c,children:o,className:l,style:y,...i}){const f=Fe.useMemo(()=>Ms(s),[s]),k=Fe.useMemo(()=>Os(s),[s]);return t.jsx(Ie,{...i,padding:"medium",shadow:!1,border:!0,borderColor:f.border,backgroundColor:f.background,style:y,className:q(ke[`feedback--${s}`],l),role:s==="error"||s==="warning"?"alert":"status","aria-live":s==="error"||s==="warning"?"assertive":"polite","aria-atomic":"true",children:t.jsxs("div",{className:ke["feedback-content"],children:[t.jsx("div",{className:ke["feedback-icon"],"aria-hidden":"true",children:k}),t.jsxs("div",{className:ke["feedback-text"],children:[e&&t.jsx("h4",{className:ke["feedback-title"],children:e}),o?t.jsx("div",{className:ke["feedback-children"],children:o}):a&&t.jsx("p",{className:ke["feedback-message"],children:a})]}),n&&c&&t.jsx("button",{onClick:c,className:ke["feedback-dismiss"],"aria-label":`Dismiss ${s} message`,children:t.jsx("span",{"aria-hidden":"true",children:"‚úï"})})]})})}function Ms(s){switch(s){case"success":return{background:K.feedback.successLight,border:K.feedback.successBorder,text:K.feedback.success};case"error":return{background:K.feedback.errorLight,border:K.feedback.errorBorder,text:K.feedback.error};case"warning":return{background:K.feedback.warningLight,border:K.feedback.warningBorder,text:K.feedback.warning};case"info":return{background:K.feedback.infoLight,border:K.feedback.infoBorder,text:K.feedback.info};default:return{background:K.feedback.infoLight,border:K.feedback.infoBorder,text:K.feedback.info}}}function Os(s){switch(s){case"success":return"‚úì";case"error":return"‚úó";case"warning":return"‚ö†";case"info":return"‚Ñπ";default:return"‚Ñπ"}}const Fs="_input_1krva_4",he={"input-wrapper":"_input-wrapper_1krva_4","input-wrapper--full-width":"_input-wrapper--full-width_1krva_8",input:Fs,"input--full-width":"_input--full-width_1krva_27","input--error":"_input--error_1krva_40","input--success":"_input--success_1krva_46","input__helper-text--error":"_input__helper-text--error_1krva_72","input__helper-text--success":"_input__helper-text--success_1krva_76"};function Nt({value:s,onChange:e,error:a=!1,success:n=!1,helperText:c,fullWidth:o=!1,disabled:l=!1,className:y,style:i,id:f,...k}){const L=c?`${f||"input"}-helper`:void 0;return t.jsxs("div",{className:q(he["input-wrapper"],o&&he["input-wrapper--full-width"]),children:[t.jsx("input",{...k,id:f,type:"text",value:s,onChange:e,disabled:l,style:i,className:q(he.input,o&&he["input--full-width"],a&&he["input--error"],n&&he["input--success"],y),"aria-invalid":a?"true":"false","aria-describedby":L}),c&&t.jsx("div",{id:L,className:q(he.input__helper_text,a&&he["input__helper-text--error"],n&&he["input__helper-text--success"]),children:c})]})}const Us="_checkbox_uclkx_4",qs="_checkbox__checkmark_uclkx_83",Gs="_checkbox__label_uclkx_101",ae={"checkbox-container":"_checkbox-container_uclkx_4","checkbox-container--disabled":"_checkbox-container--disabled_uclkx_11","checkbox-wrapper":"_checkbox-wrapper_uclkx_16",checkbox:Us,"checkbox--with-label":"_checkbox--with-label_uclkx_35","checkbox--error":"_checkbox--error_uclkx_55","checkbox--success":"_checkbox--success_uclkx_66",checkbox__checkmark:qs,"checkbox__checkmark--visible":"_checkbox__checkmark--visible_uclkx_96",checkbox__label:Gs,"checkbox__label--disabled":"_checkbox__label--disabled_uclkx_107"};function Hs({checked:s,onChange:e,label:a,error:n=!1,success:c=!1,disabled:o=!1,className:l,style:y,id:i,...f}){const k=Fe.useId(),L=i||`checkbox-${k}`;return t.jsxs("label",{htmlFor:L,style:y,className:q(ae["checkbox-container"],o&&ae["checkbox-container--disabled"],l),children:[t.jsxs("div",{className:ae["checkbox-wrapper"],children:[t.jsx("input",{...f,type:"checkbox",id:L,checked:s,onChange:e,disabled:o,className:q(ae.checkbox,a&&ae["checkbox--with-label"],n&&ae["checkbox--error"],c&&ae["checkbox--success"]),"aria-checked":s,"aria-invalid":n}),t.jsx("div",{className:q(ae.checkbox__checkmark,s&&ae["checkbox__checkmark--visible"])})]}),a&&t.jsx("span",{className:q(ae.checkbox__label,o&&ae["checkbox__label--disabled"]),children:a})]})}const Ws="_select_1bjtk_4",at={select:Ws,"select--full-width":"_select--full-width_1bjtk_23","select--error":"_select--error_1bjtk_36","select--success":"_select--success_1bjtk_42"};function Vs({value:s,onChange:e,options:a,disabled:n=!1,placeholder:c,error:o=!1,success:l=!1,fullWidth:y=!1,className:i,style:f,id:k}){return t.jsxs("select",{id:k,value:s,onChange:L=>e(L.target.value),disabled:n,style:f,className:q(at.select,y&&at["select--full-width"],o&&at["select--error"],l&&at["select--success"],i),"aria-invalid":o?"true":"false",children:[c&&t.jsx("option",{value:"",disabled:!0,children:c}),a.map(L=>t.jsx("option",{value:L.value,disabled:L.disabled,children:L.label},L.value))]})}const me={"slider-container":"_slider-container_1ivuv_4","slider-track":"_slider-track_1ivuv_12","slider-fill":"_slider-fill_1ivuv_22","slider-fill--disabled":"_slider-fill--disabled_1ivuv_32","slider-input":"_slider-input_1ivuv_37","slider-thumb":"_slider-thumb_1ivuv_52","slider-thumb--disabled":"_slider-thumb--disabled_1ivuv_67","slider-value-display":"_slider-value-display_1ivuv_72","slider-value-display__current":"_slider-value-display__current_1ivuv_80"};function Js({value:s,onChange:e,min:a,max:n,step:c=1,disabled:o=!1,unit:l="",showValue:y=!0,className:i,style:f,id:k,"aria-label":L}){const C=(s-a)/(n-a)*100;return t.jsxs("div",{style:f,className:q(me["slider-container"],i),children:[t.jsxs("div",{className:me["slider-track"],children:[t.jsx("div",{className:q(me["slider-fill"],o&&me["slider-fill--disabled"]),style:{width:`${C}%`}}),t.jsx("div",{className:q(me["slider-thumb"],o&&me["slider-thumb--disabled"]),style:{left:`calc(${C}% - 12px)`}}),t.jsx("input",{type:"range",id:k,min:a,max:n,step:c,value:s,onChange:D=>e(Number(D.target.value)),disabled:o,className:me["slider-input"],"aria-label":L,"aria-valuenow":s,"aria-valuemin":a,"aria-valuemax":n,"aria-valuetext":`${s}${l}`})]}),y&&t.jsxs("div",{className:me["slider-value-display"],children:[t.jsxs("span",{children:[a,l]}),t.jsxs("span",{className:me["slider-value-display__current"],children:[s,l]}),t.jsxs("span",{children:[n,l]})]})]})}const r={"practice-session":"_practice-session_elovc_3","practice-session__header":"_practice-session__header_elovc_14","practice-session__header-top":"_practice-session__header-top_elovc_19","practice-session__header-left":"_practice-session__header-left_elovc_26","practice-session__title":"_practice-session__title_elovc_32","practice-session__task-counter":"_practice-session__task-counter_elovc_37","practice-session__task-id":"_practice-session__task-id_elovc_42","practice-session__cancel-btn":"_practice-session__cancel-btn_elovc_48","practice-session__progress-bar":"_practice-session__progress-bar_elovc_58","practice-session__progress-fill":"_practice-session__progress-fill_elovc_66","practice-session__question-area":"_practice-session__question-area_elovc_74","practice-session__question-header":"_practice-session__question-header_elovc_85","practice-session__question-text":"_practice-session__question-text_elovc_92","practice-session__mc-options":"_practice-session__mc-options_elovc_101","practice-session__mc-option":"_practice-session__mc-option_elovc_101","practice-session__mc-option--focused":"_practice-session__mc-option--focused_elovc_125","practice-session__mc-option--selected":"_practice-session__mc-option--selected_elovc_130","practice-session__mc-option--correct":"_practice-session__mc-option--correct_elovc_135","practice-session__mc-option--incorrect":"_practice-session__mc-option--incorrect_elovc_140","practice-session__mc-option--disabled":"_practice-session__mc-option--disabled_elovc_145","practice-session__cloze-container":"_practice-session__cloze-container_elovc_151","practice-session__cloze-text":"_practice-session__cloze-text_elovc_156","practice-session__cloze-input":"_practice-session__cloze-input_elovc_161","practice-session__cloze-feedback":"_practice-session__cloze-feedback_elovc_167","practice-session__cloze-feedback-title":"_practice-session__cloze-feedback-title_elovc_174","practice-session__cloze-answer":"_practice-session__cloze-answer_elovc_181","practice-session__cloze-answer--correct":"_practice-session__cloze-answer--correct_elovc_186","practice-session__cloze-answer--neutral":"_practice-session__cloze-answer--neutral_elovc_190","practice-session__cloze-answer-correct":"_practice-session__cloze-answer-correct_elovc_194","practice-session__cloze-alternatives":"_practice-session__cloze-alternatives_elovc_198","practice-session__tf-container":"_practice-session__tf-container_elovc_205","practice-session__tf-statement":"_practice-session__tf-statement_elovc_213","practice-session__tf-buttons":"_practice-session__tf-buttons_elovc_219","practice-session__tf-button":"_practice-session__tf-button_elovc_219","practice-session__tf-button--selected":"_practice-session__tf-button--selected_elovc_236","practice-session__tf-button--correct":"_practice-session__tf-button--correct_elovc_241","practice-session__tf-button--incorrect":"_practice-session__tf-button--incorrect_elovc_246","practice-session__tf-button--disabled":"_practice-session__tf-button--disabled_elovc_251","practice-session__ordering-container":"_practice-session__ordering-container_elovc_257","practice-session__ordering-instruction":"_practice-session__ordering-instruction_elovc_262","practice-session__ordering-items":"_practice-session__ordering-items_elovc_268","practice-session__ordering-item":"_practice-session__ordering-item_elovc_268","practice-session__ordering-item--correct":"_practice-session__ordering-item--correct_elovc_284","practice-session__ordering-item-number":"_practice-session__ordering-item-number_elovc_289","practice-session__ordering-item-text":"_practice-session__ordering-item-text_elovc_295","practice-session__ordering-word":"_practice-session__ordering-word_elovc_302","practice-session__ordering-hint":"_practice-session__ordering-hint_elovc_306","practice-session__ordering-controls":"_practice-session__ordering-controls_elovc_312","practice-session__ordering-btn":"_practice-session__ordering-btn_elovc_317","practice-session__ordering-feedback":"_practice-session__ordering-feedback_elovc_325","practice-session__ordering-feedback-title":"_practice-session__ordering-feedback-title_elovc_332","practice-session__ordering-feedback-item":"_practice-session__ordering-feedback-item_elovc_339","practice-session__matching-container":"_practice-session__matching-container_elovc_347","practice-session__matching-instruction":"_practice-session__matching-instruction_elovc_352","practice-session__matching-grid":"_practice-session__matching-grid_elovc_358","practice-session__matching-left-item":"_practice-session__matching-left-item_elovc_364","practice-session__matching-feedback":"_practice-session__matching-feedback_elovc_375","practice-session__matching-feedback-title":"_practice-session__matching-feedback-title_elovc_382","practice-session__matching-feedback-item":"_practice-session__matching-feedback-item_elovc_389","practice-session__ms-container":"_practice-session__ms-container_elovc_397","practice-session__ms-instruction":"_practice-session__ms-instruction_elovc_402","practice-session__ms-options":"_practice-session__ms-options_elovc_408","practice-session__ms-option":"_practice-session__ms-option_elovc_408","practice-session__ms-option--focused":"_practice-session__ms-option--focused_elovc_425","practice-session__ms-option--selected":"_practice-session__ms-option--selected_elovc_430","practice-session__ms-option--correct":"_practice-session__ms-option--correct_elovc_435","practice-session__ms-option--incorrect":"_practice-session__ms-option--incorrect_elovc_440","practice-session__ms-option-label":"_practice-session__ms-option-label_elovc_445","practice-session__ms-status-icon":"_practice-session__ms-status-icon_elovc_450","practice-session__ms-status-icon--correct":"_practice-session__ms-status-icon--correct_elovc_456","practice-session__ms-status-icon--incorrect":"_practice-session__ms-status-icon--incorrect_elovc_460","practice-session__slider-container":"_practice-session__slider-container_elovc_466","practice-session__slider-value-display":"_practice-session__slider-value-display_elovc_474","practice-session__slider-value":"_practice-session__slider-value_elovc_474","practice-session__slider-value--correct":"_practice-session__slider-value--correct_elovc_484","practice-session__slider-value--incorrect":"_practice-session__slider-value--incorrect_elovc_488","practice-session__slider-wrapper":"_practice-session__slider-wrapper_elovc_492","practice-session__slider-feedback":"_practice-session__slider-feedback_elovc_496","practice-session__slider-feedback-text":"_practice-session__slider-feedback-text_elovc_503","practice-session__slider-correct-value":"_practice-session__slider-correct-value_elovc_509","practice-session__slider-tolerance":"_practice-session__slider-tolerance_elovc_514","practice-session__scramble-container":"_practice-session__scramble-container_elovc_521","practice-session__scramble-display":"_practice-session__scramble-display_elovc_529","practice-session__scramble-label":"_practice-session__scramble-label_elovc_536","practice-session__scramble-word":"_practice-session__scramble-word_elovc_542","practice-session__scramble-length":"_practice-session__scramble-length_elovc_550","practice-session__scramble-input-label":"_practice-session__scramble-input-label_elovc_556","practice-session__scramble-input":"_practice-session__scramble-input_elovc_556","practice-session__scramble-input--correct":"_practice-session__scramble-input--correct_elovc_575","practice-session__scramble-input--incorrect":"_practice-session__scramble-input--incorrect_elovc_580","practice-session__scramble-feedback":"_practice-session__scramble-feedback_elovc_585","practice-session__scramble-feedback-label":"_practice-session__scramble-feedback-label_elovc_592","practice-session__scramble-feedback-word":"_practice-session__scramble-feedback-word_elovc_599","practice-session__flashcard-container":"_practice-session__flashcard-container_elovc_607","practice-session__flashcard":"_practice-session__flashcard_elovc_607","practice-session__flashcard-lang":"_practice-session__flashcard-lang_elovc_635","practice-session__flashcard-front":"_practice-session__flashcard-front_elovc_643","practice-session__flashcard-reveal-btn":"_practice-session__flashcard-reveal-btn_elovc_656","practice-session__flashcard-divider":"_practice-session__flashcard-divider_elovc_674","practice-session__flashcard-back":"_practice-session__flashcard-back_elovc_681","practice-session__flashcard-assessment":"_practice-session__flashcard-assessment_elovc_694","practice-session__flashcard-btn":"_practice-session__flashcard-btn_elovc_702","practice-session__flashcard-btn--unknown":"_practice-session__flashcard-btn--unknown_elovc_716","practice-session__flashcard-btn--known":"_practice-session__flashcard-btn--known_elovc_727","practice-session__flashcard-icon":"_practice-session__flashcard-icon_elovc_738","practice-session__flashcard-explanation":"_practice-session__flashcard-explanation_elovc_742","practice-session__text-input-container":"_practice-session__text-input-container_elovc_755","practice-session__text-input-wrapper":"_practice-session__text-input-wrapper_elovc_763","practice-session__text-input":"_practice-session__text-input_elovc_755","practice-session__text-input-feedback":"_practice-session__text-input-feedback_elovc_775","practice-session__hint-controls":"_practice-session__hint-controls_elovc_796","practice-session__hint-button":"_practice-session__hint-button_elovc_802","practice-session__hint":"_practice-session__hint_elovc_796","practice-session__shortcuts-overlay":"_practice-session__shortcuts-overlay_elovc_826","practice-session__shortcuts-content":"_practice-session__shortcuts-content_elovc_837","practice-session__shortcuts-groups":"_practice-session__shortcuts-groups_elovc_852","practice-session__shortcuts-group-title":"_practice-session__shortcuts-group-title_elovc_857","practice-session__shortcuts-list":"_practice-session__shortcuts-list_elovc_862","practice-session__shortcut-item":"_practice-session__shortcut-item_elovc_870","practice-session__shortcut-keys":"_practice-session__shortcut-keys_elovc_877","practice-session__shortcuts-close":"_practice-session__shortcuts-close_elovc_885","practice-session__feedback":"_practice-session__feedback_elovc_935","practice-session__footer":"_practice-session__footer_elovc_942","practice-session__actions":"_practice-session__actions_elovc_949","practice-session__btn-submit":"_practice-session__btn-submit_elovc_955","practice-session__btn-submit--enabled":"_practice-session__btn-submit--enabled_elovc_964","practice-session__btn-submit--disabled":"_practice-session__btn-submit--disabled_elovc_969","practice-session__btn-skip":"_practice-session__btn-skip_elovc_974","practice-session__btn-next":"_practice-session__btn-next_elovc_985","practice-session__stats":"_practice-session__stats_elovc_998","practice-session__stat":"_practice-session__stat_elovc_998","practice-session__stat-value":"_practice-session__stat-value_elovc_1011","practice-session__stat-value--completed":"_practice-session__stat-value--completed_elovc_1016","practice-session__stat-value--correct":"_practice-session__stat-value--correct_elovc_1020","practice-session__stat-value--accuracy":"_practice-session__stat-value--accuracy_elovc_1024","practice-session__stat-label":"_practice-session__stat-label_elovc_1028","practice-session__loading":"_practice-session__loading_elovc_1035"};function Ys({topicId:s,learningPathIds:e,targetCount:a=10,includeReview:n=!0,onComplete:c,onCancel:o}){const[l,y]=p.useState(null),[i,f]=p.useState(null),[k,L]=p.useState(0),[C,D]=p.useState(null),[_,V]=p.useState(!1),[P,J]=p.useState(!1),[Q,X]=p.useState(Date.now()),[Y,le]=p.useState([]),[je,fe]=p.useState([]),[ge,de]=p.useState(0),[m,S]=p.useState([]),[I,W]=p.useState(null),[T,Z]=p.useState([]),[te,qe]=p.useState({}),[Ke,Ze]=p.useState([]),[ue,Ge]=p.useState(new Set),[Ne,He]=p.useState(0),[ie,We]=p.useState(""),[_e,Ve]=p.useState(!1),[be,ye]=p.useState(null),[ne,Qe]=p.useState(""),[b,E]=p.useState(0),[M,$]=p.useState(!1),[H,re]=p.useState(!1),[U,Mt]=p.useState(null),{playbackState:Re,loadAudio:ot,togglePlayPause:wt,replay:Xe,stop:xt,preloadNext:Ot,unlockAutoPlay:Pe}=Ns(),{settings:De}=zt(),ct=p.useCallback(u=>{_||i?.type!=="multiple-select"||Ge(d=>{const h=new Set(d);return h.has(u)?h.delete(u):h.add(u),h})},[_,i]),Ft=p.useCallback(()=>{if(!i)return;const u=i.content,d=U?.buttons?.question?.field;if(i.audioUrl||d&&u?.[d]){try{Pe(),Xe()}catch(A){console.warn("Audio replay failed",A)}ot(i,De,!0).catch(A=>{console.warn("Audio reload failed",A)})}},[i,De,ot,Xe,Pe,U]),et=p.useCallback(()=>{if(_)return!1;if(i?.type==="multiple-choice")return C!==null;if(i?.type==="cloze-deletion")return m.every(u=>u.trim().length>0);if(i?.type==="true-false")return I!==null;if(i?.type==="ordering")return T.length>0;if(i?.type==="matching"){const u=i.content;return Object.keys(te).length===u.pairs.length}return i?.type==="multiple-select"?ue.size>0:i?.type==="slider"?!0:i?.type==="word-scramble"?ie.trim().length>0:i?.type==="flashcard"?be!==null:i?.type==="text-input"?ne.trim().length>0:!1},[_,i,C,m,I,T,te,ue,ie,be,ne]),Ce=p.useCallback(async u=>{if(!i||!l)return;Re.autoPlayUnlocked||Pe().catch(g=>console.warn("Failed to unlock auto-play:",g));let d=!1;if(i.type==="multiple-choice"){if(C===null)return;d=C===ge}else if(i.type==="cloze-deletion")d=i.content.blanks.every((R,ee)=>{const B=m[ee]?.trim().toLowerCase()||"",G=R.correctAnswer.toLowerCase(),we=R.alternatives?.map(Je=>Je.toLowerCase())||[];return B===G||we.includes(B)});else if(i.type==="true-false"){if(I===null)return;const g=i.content;d=I===g.correctAnswer}else if(i.type==="ordering"){const g=i.content;d=T.every((R,ee)=>{const B=g.items.indexOf(R);return g.correctOrder[ee]===B})}else if(i.type==="matching")d=i.content.pairs.every((R,ee)=>te[ee]===ee);else if(i.type==="multiple-select"){const g=i.content;if(ue.size===0)return;d=g.correctAnswers.length===ue.size&&g.correctAnswers.every(R=>ue.has(R))}else if(i.type==="slider"){const g=i.content,R=g.tolerance||0;d=Math.abs(Ne-g.correctValue)<=R}else if(i.type==="word-scramble"){if(!ie.trim())return;const g=i.content;d=ie.trim().toLowerCase()===g.correctWord.toLowerCase()}else if(i.type==="flashcard"){const g=u??be;if(g==null)return;d=g,ye(g)}else if(i.type==="text-input"){if(!ne.trim())return;const g=i.content,R=g.caseSensitive||!1,ee=R?ne.trim():ne.trim().toLowerCase(),B=R?g.correctAnswer:g.correctAnswer.toLowerCase(),G=(g.alternatives||[]).map(we=>R?we:we.toLowerCase());d=ee===B||G.includes(ee)}J(d),V(!0);const h=Math.round((Date.now()-Q)/1e3);await new ut(_t(),tt(),st()).recordSessionAnswer(l.id,d,h);const w=new hs(st(),tt()),x=d?4:2;await w.recordAnswer(i.id,d,x);const v=await O.practiceSessions.get(l.id);v&&y(v)},[i,l,Re.autoPlayUnlocked,Pe,C,ge,m,I,T,te,ue,Ne,ie,be,ne,Q]),lt=p.useCallback(async()=>{if(!l)return;if(l.execution.status==="completed"||l.execution.status==="abandoned"){c();return}await new ut(_t(),tt(),st()).completeSession(l.id),await new Promise(d=>setTimeout(d,100)),c()},[l,c]),ve=p.useCallback(()=>{V(!1),D(null),l&&k<l.execution.taskIds.length-1?L(k+1):lt()},[l,k,lt]);p.useEffect(()=>{es()},[]),p.useEffect(()=>{l&&l.execution.taskIds.length>0&&k===0&&kt()},[l]),p.useEffect(()=>{l&&l.execution.taskIds.length>0&&k>0&&kt()},[k]),p.useEffect(()=>{if(!i){E(0);return}if(i.type==="multiple-choice"){const u=Y.length;E(d=>u===0?0:Math.min(d,u-1))}else if(i.type==="multiple-select"){const u=i.content.options.length;E(d=>u===0?0:Math.min(d,u-1))}else E(0)},[i,Y]),p.useEffect(()=>{const u=d=>{if(!i)return;const h=document.activeElement,A=h?.tagName?.toLowerCase(),w=!!(h&&(A==="input"||A==="textarea"||h.isContentEditable)),x=d.key,v=i.type,g=()=>{i.content?.hint&&re(G=>!G)},R=B=>{if(v==="multiple-choice"){const G=Y.length;if(G===0)return;E(we=>{const Je=(we+B+G)%G;return D(Je),Je})}else if(v==="multiple-select"){const G=i.content.options;if(G.length===0)return;E(we=>(we+B+G.length)%G.length)}},ee=()=>{if(v==="flashcard"){_e?be!==null&&ve():Ve(!0);return}_?v!=="flashcard"&&ve():et()&&Ce()};if((x==="?"||x==="/"&&d.shiftKey)&&!d.metaKey&&!d.ctrlKey){d.preventDefault(),$(B=>!B);return}if(M){(x==="Escape"||x==="?"||x==="/"&&d.shiftKey)&&(d.preventDefault(),$(!1));return}if(/^[1-9]$/.test(x)&&!w){const B=Number(x)-1;if(v==="multiple-choice"&&B<Y.length)d.preventDefault(),E(B),D(B);else if(v==="multiple-select"){const G=i.content.options;B<G.length&&(d.preventDefault(),E(B),ct(B))}else v==="true-false"?x==="1"?(d.preventDefault(),W(!0)):x==="2"&&(d.preventDefault(),W(!1)):v==="flashcard"&&_e&&!_&&(x==="1"?(d.preventDefault(),ye(!1),Ce(!1),setTimeout(()=>ve(),300)):x==="2"&&(d.preventDefault(),ye(!0),Ce(!0),setTimeout(()=>ve(),300)));return}switch(x){case"Escape":d.preventDefault(),M?$(!1):H?re(!1):o();break;case"Enter":if(w)return;d.preventDefault(),ee();break;case" ":{if(w)return;v==="multiple-choice"?(d.preventDefault(),D(b)):v==="multiple-select"&&(d.preventDefault(),ct(b));break}case"ArrowUp":case"ArrowLeft":if(w)return;(v==="multiple-choice"||v==="multiple-select")&&(d.preventDefault(),R(-1));break;case"ArrowDown":case"ArrowRight":if(w)return;(v==="multiple-choice"||v==="multiple-select")&&(d.preventDefault(),R(1));break;case"r":case"R":if(w)return;d.preventDefault(),Ft();break;case"h":case"H":if(w)return;d.preventDefault(),g();break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[i,Y,b,_,_e,be,H,M,et,Ce,ve,C,I,ne]),p.useEffect(()=>{const u=d=>{if(!(d.target instanceof HTMLInputElement||d.target instanceof HTMLTextAreaElement)&&Re.audioUrl)switch(d.key.toLowerCase()){case" ":d.preventDefault(),wt().catch(console.error);break;case"r":d.preventDefault(),Xe().catch(console.error);break;case"s":d.preventDefault(),xt();break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[Re.audioUrl,wt,Xe,xt]),p.useEffect(()=>{_&&i&&Ts(i,De)&&(console.log("üîä Auto-play in feedback:",i.audioUrl),ot(i,De,!0).catch(u=>{console.warn("Auto-play in feedback failed:",u)}))},[_,i?.id,De.autoPlayEnabled,De.languageFilter]),p.useEffect(()=>{if(!i||!U||_)return;const u=U.autoPlay?.onLoad||[],d=i.content;(async()=>{for(const A of u){const w=d[A];if(!w)continue;const x=Array.isArray(w)?w[0]:w;if(x)try{await new Audio(`/learning-platform/test/audio/${x}`).play(),console.log(`‚úÖ Auto-played ${A}: ${x}`);break}catch(v){console.warn(`‚ö†Ô∏è Auto-play blocked for ${A}. User interaction required first.`,v),Re.autoPlayUnlocked||Pe().catch(g=>console.warn("Failed to unlock auto-play:",g))}}})()},[i?.id,U]),p.useEffect(()=>{_&&re(!1)},[_]),p.useEffect(()=>{if(!i||!U||!_||i.type==="flashcard"&&_e)return;const u=U.autoPlay?.onReveal||[],d=i.content,h=async()=>{for(const w of u){const x=[];if(w==="correctAnswerAudio"&&i.type==="multiple-choice")d.optionsAudio?.[d.correctAnswer]&&x.push(d.optionsAudio[d.correctAnswer]);else if(w==="correctAnswerAudio"&&i.type==="text-input")d.correctAnswerAudio&&x.push(d.correctAnswerAudio);else if(w==="itemsAudioInOrder"&&i.type==="ordering"){const v=d.itemsAudio,g=d.correctOrder;if(v&&g)for(const R of g)v[R]&&x.push(v[R])}else if(w==="blanksAudioInOrder"&&i.type==="cloze-deletion"){const v=d.blanks;if(v)for(const g of v)g.correctAnswerAudio&&x.push(g.correctAnswerAudio)}else if(w==="correctOptionsAudio"&&i.type==="multiple-select"){const v=d.optionsAudio,g=d.correctAnswers;if(v&&g)for(const R of g)v[R]&&x.push(v[R])}else if(w==="correctValueAudio"&&i.type==="slider")d.correctValueAudio&&x.push(d.correctValueAudio);else if(w==="correctWordAudio"&&i.type==="word-scramble")d.correctWordAudio&&x.push(d.correctWordAudio);else{const v=d[w];if(v){const g=Array.isArray(v)?v[0]:v;g&&x.push(g)}}if(x.length>0){for(const v of x)try{const g=new Audio(`/learning-platform/test/audio/${v}`);await g.play(),await new Promise(R=>{g.onended=R,setTimeout(R,5e3)}),console.log(`‚úÖ Auto-played on reveal ${w}: ${v}`)}catch(g){console.warn(`‚ö†Ô∏è Auto-play on reveal blocked for ${v}.`,g);break}break}}},A=setTimeout(()=>{h()},100);return()=>clearTimeout(A)},[_,i?.id,U,_e]);function Ut(){return i?i.type==="multiple-choice"?qt():i.type==="cloze-deletion"?Gt():i.type==="true-false"?Ht():i.type==="ordering"?Wt():i.type==="matching"?Vt():i.type==="multiple-select"?Jt():i.type==="slider"?Yt():i.type==="word-scramble"?Kt():i.type==="flashcard"?Zt():i.type==="text-input"?Qt():null:null}function qt(){if(!i||i.type!=="multiple-choice")return null;const u=i.content;return t.jsx("div",{className:r["practice-session__mc-options"],children:Y.map((d,h)=>{const A=!_&&b===h,w=[r["practice-session__mc-option"],_&&h===ge&&r["practice-session__mc-option--correct"],_&&h===C&&!P&&r["practice-session__mc-option--incorrect"],!_&&C===h&&r["practice-session__mc-option--selected"],A&&r["practice-session__mc-option--focused"],_&&r["practice-session__mc-option--disabled"]].filter(Boolean).join(" "),x=je[h],v=u.optionsAudio&&x!==void 0&&u.optionsAudio[x]?`/learning-platform/test/audio/${u.optionsAudio[x]}`:null;return t.jsxs("button",{onClick:()=>{_||(E(h),D(h))},disabled:_,className:w,onMouseEnter:()=>E(h),children:[t.jsx("span",{children:d}),v&&t.jsx(xe,{text:d,audioUrl:v,size:"small"})]},h)})})}function Gt(){if(!i||i.type!=="cloze-deletion")return null;const u=i.content,d=u.text.split(/\{\{blank\}\}/g);return t.jsxs("div",{className:r["practice-session__cloze-container"],children:[t.jsx("div",{className:r["practice-session__cloze-text"],children:d.map((h,A)=>t.jsxs("span",{children:[h,A<u.blanks.length&&(()=>{const w=m[A]?.trim().toLowerCase()||"",x=w===u.blanks[A].correctAnswer.toLowerCase()||u.blanks[A].alternatives?.map(g=>g.toLowerCase()).includes(w),v=m[A]?.trim()!=="";return t.jsx(Nt,{value:m[A]||"",onChange:g=>{const R=[...m];R[A]=g.target.value,S(R)},disabled:_,error:!!(_&&v&&!x),success:!!(_&&x),className:r["practice-session__cloze-input"]})})()]},A))}),_&&t.jsxs("div",{className:r["practice-session__cloze-feedback"],children:[t.jsx("div",{className:r["practice-session__cloze-feedback-title"],children:"Richtige Antworten:"}),u.blanks.map((h,A)=>{const w=m[A]?.trim().toLowerCase()||"",v=w===h.correctAnswer.toLowerCase()||h.alternatives?.map(g=>g.toLowerCase()).includes(w)?r["practice-session__cloze-answer--correct"]:r["practice-session__cloze-answer--neutral"];return t.jsxs("div",{className:`${r["practice-session__cloze-answer"]} ${v}`,children:["L√ºcke ",A+1,": ",t.jsx("strong",{className:r["practice-session__cloze-answer-correct"],children:h.correctAnswer}),h.alternatives&&h.alternatives.length>0&&t.jsxs("span",{className:r["practice-session__cloze-alternatives"],children:[" ","(auch richtig: ",h.alternatives.join(", "),")"]})]},A)})]})]})}function Ht(){if(!i||i.type!=="true-false")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__tf-container"],children:[t.jsx("div",{className:r["practice-session__tf-statement"],children:u.statement}),t.jsx("div",{className:r["practice-session__tf-buttons"],children:[!0,!1].map(d=>{const h=[r["practice-session__tf-button"],_&&d===u.correctAnswer&&r["practice-session__tf-button--correct"],_&&d===I&&!P&&r["practice-session__tf-button--incorrect"],!_&&I===d&&r["practice-session__tf-button--selected"],_&&r["practice-session__tf-button--disabled"]].filter(Boolean).join(" ");return t.jsx("button",{onClick:()=>!_&&W(d),disabled:_,className:h,children:d?"Richtig":"Falsch"},d.toString())})})]})}function Wt(){if(!i||i.type!=="ordering")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__ordering-container"],children:[t.jsx("div",{className:r["practice-session__ordering-instruction"],children:"Ordne die Elemente in die richtige Reihenfolge"}),t.jsx("div",{className:r["practice-session__ordering-items"],children:T.map((d,h)=>{const A=u.items.indexOf(d),w=_&&u.correctOrder[h]===A,x=_?u.correctOrder.indexOf(A):-1,v=[r["practice-session__ordering-item"],_&&w&&r["practice-session__ordering-item--correct"]].filter(Boolean).join(" "),g=u.itemsAudio&&u.itemsAudio[A]?`/learning-platform/test/audio/${u.itemsAudio[A]}`:null;return t.jsxs("div",{className:v,children:[t.jsxs("div",{className:r["practice-session__ordering-item-number"],children:[h+1,"."]}),t.jsxs("div",{className:r["practice-session__ordering-item-text"],children:[t.jsx("span",{className:r["practice-session__ordering-word"],children:d}),g&&t.jsx(xe,{text:d,audioUrl:g,size:"small"}),_&&!w&&t.jsxs("span",{className:r["practice-session__ordering-hint"],children:["‚Üí Position ",x+1]})]}),!_&&t.jsxs("div",{className:r["practice-session__ordering-controls"],children:[h>0&&t.jsx("button",{onClick:()=>{const R=[...T];[R[h],R[h-1]]=[R[h-1],R[h]],Z(R)},className:r["practice-session__ordering-btn"],children:"‚Üë"}),h<T.length-1&&t.jsx("button",{onClick:()=>{const R=[...T];[R[h],R[h+1]]=[R[h+1],R[h]],Z(R)},className:r["practice-session__ordering-btn"],children:"‚Üì"})]})]},h)})}),_&&!P&&t.jsxs("div",{className:r["practice-session__ordering-feedback"],children:[t.jsx("div",{className:r["practice-session__ordering-feedback-title"],children:"Richtige Reihenfolge:"}),u.correctOrder.map((d,h)=>t.jsxs("div",{className:r["practice-session__ordering-feedback-item"],children:[h+1,". ",t.jsx("strong",{children:u.items[d]})]},h))]})]})}function Vt(){if(!i||i.type!=="matching")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__matching-container"],children:[t.jsx("div",{className:r["practice-session__matching-instruction"],children:"Ordne die passenden Paare zu"}),t.jsx("div",{className:r["practice-session__matching-grid"],children:u.pairs.map((d,h)=>{const A=_&&te[h]===h,w=te[h]!==void 0&&te[h]!==null,x=u.leftAudio&&u.leftAudio[h]?`/learning-platform/test/audio/${u.leftAudio[h]}`:null;return t.jsxs(Fe.Fragment,{children:[t.jsxs("div",{className:r["practice-session__matching-left-item"],children:[t.jsx("span",{children:d.left}),x&&t.jsx(xe,{text:d.left,audioUrl:x,size:"small"})]}),t.jsx(Vs,{value:te[h]?.toString()??"",onChange:v=>{const g=parseInt(v);qe({...te,[h]:g})},options:Ke.map(v=>({value:v.toString(),label:u.pairs[v].right})),disabled:_,placeholder:"W√§hle...",error:_&&w&&!A,success:_&&A,fullWidth:!0})]},h)})}),_&&!P&&t.jsxs("div",{className:r["practice-session__matching-feedback"],children:[t.jsx("div",{className:r["practice-session__matching-feedback-title"],children:"Richtige Zuordnungen:"}),u.pairs.map((d,h)=>t.jsxs("div",{className:r["practice-session__matching-feedback-item"],children:[t.jsx("strong",{children:d.left})," ‚Üí ",t.jsx("strong",{children:d.right})]},h))]})]})}function Jt(){if(!i||i.type!=="multiple-select")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__ms-container"],children:[t.jsx("div",{className:r["practice-session__ms-instruction"],children:"W√§hle alle zutreffenden Antworten"}),t.jsx("div",{className:r["practice-session__ms-options"],children:u.options.map((d,h)=>{const A=ue.has(h),w=u.correctAnswers.includes(h),x=!_&&b===h;let v="";_&&(w?v=A?"‚úì":"‚óã":A&&!w&&(v="‚úó"));const g=[r["practice-session__ms-option"],x&&r["practice-session__ms-option--focused"],_&&w&&r["practice-session__ms-option--correct"],_&&A&&!w&&r["practice-session__ms-option--incorrect"],!_&&A&&r["practice-session__ms-option--selected"]].filter(Boolean).join(" "),R=w?r["practice-session__ms-status-icon--correct"]:r["practice-session__ms-status-icon--incorrect"];return t.jsxs("div",{className:g,onMouseEnter:()=>E(h),children:[t.jsx(Hs,{checked:A,onChange:()=>{ct(h),E(h)},disabled:_,label:t.jsx("span",{className:r["practice-session__ms-option-label"],children:d}),error:_&&A&&!w,success:_&&w&&A,style:{flex:1}}),_&&v&&t.jsx("span",{className:`${r["practice-session__ms-status-icon"]} ${R}`,children:v})]},h)})})]})}function Yt(){if(!i||i.type!=="slider")return null;const u=i.content,d=u.step||1,h=u.tolerance||0,A=Math.abs(Ne-u.correctValue)<=h,w=_?A?r["practice-session__slider-value--correct"]:r["practice-session__slider-value--incorrect"]:"";return t.jsxs("div",{className:r["practice-session__slider-container"],children:[t.jsx("div",{className:r["practice-session__slider-value-display"],children:t.jsxs("div",{className:`${r["practice-session__slider-value"]} ${w}`,children:[Ne,u.unit||""]})}),t.jsx("div",{className:r["practice-session__slider-wrapper"],children:t.jsx(Js,{value:Ne,onChange:He,min:u.min,max:u.max,step:d,disabled:_,unit:u.unit||"",showValue:!1})}),_&&t.jsx("div",{className:r["practice-session__slider-feedback"],children:t.jsxs("div",{className:r["practice-session__slider-feedback-text"],children:["Richtige Antwort: ",t.jsxs("strong",{className:r["practice-session__slider-correct-value"],children:[u.correctValue,u.unit||""]}),h>0&&t.jsxs("span",{className:r["practice-session__slider-tolerance"],children:[" ","(¬±",h,")"]})]})})]})}function Kt(){if(!i||i.type!=="word-scramble")return null;const u=i.content,d=ie.trim().toLowerCase()===u.correctWord.toLowerCase(),h=ie.trim()!=="",A=_?d?r["practice-session__scramble-input--correct"]:h?r["practice-session__scramble-input--incorrect"]:"":"";return t.jsxs("div",{className:r["practice-session__scramble-container"],children:[t.jsxs("div",{className:r["practice-session__scramble-display"],children:[t.jsx("div",{className:r["practice-session__scramble-label"],children:"Buchstabensalat:"}),t.jsx("div",{className:r["practice-session__scramble-word"],children:u.scrambledWord}),u.showLength&&t.jsxs("div",{className:r["practice-session__scramble-length"],children:["(",u.correctWord.length," Buchstaben)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:r["practice-session__scramble-input-label"],children:"Deine L√∂sung:"}),t.jsx("input",{type:"text",value:ie,onChange:w=>We(w.target.value),disabled:_,placeholder:"Entschl√ºssle das Wort...",className:`${r["practice-session__scramble-input"]} ${A}`})]}),_&&!P&&t.jsxs("div",{className:r["practice-session__scramble-feedback"],children:[t.jsx("div",{className:r["practice-session__scramble-feedback-label"],children:"Richtige L√∂sung:"}),t.jsx("div",{className:r["practice-session__scramble-feedback-word"],children:u.correctWord})]})]})}function Zt(){if(!i||i.type!=="flashcard")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__flashcard-container"],children:[t.jsxs("div",{className:r["practice-session__flashcard"],children:[t.jsx("div",{className:r["practice-session__flashcard-lang"],children:u.frontLanguage==="de"?"Deutsch":u.frontLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:r["practice-session__flashcard-front"],children:[t.jsx("div",{children:u.front}),U?.buttons?.front?.show&&u[U.buttons.front.field]&&t.jsx(xe,{text:u.front,audioUrl:`/learning-platform/test/audio/${u[U.buttons.front.field]}`,size:"large"})]}),_e?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:r["practice-session__flashcard-divider"]}),t.jsx("div",{className:r["practice-session__flashcard-lang"],children:u.backLanguage==="de"?"Deutsch":u.backLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:r["practice-session__flashcard-back"],children:[t.jsx("div",{children:u.back}),U?.buttons?.back?.show&&u[U.buttons.back.field]&&t.jsx(xe,{text:u.back,audioUrl:`/learning-platform/test/audio/${u[U.buttons.back.field]}`,size:"large"})]})]}):t.jsx("button",{onClick:async()=>{if(Ve(!0),U&&Re.autoPlayUnlocked){const d=U.autoPlay?.onReveal||[];for(const h of d)if(u[h])try{await new Audio(`/learning-platform/test/audio/${u[h]}`).play();break}catch(A){console.warn(`Failed to auto-play ${h} on reveal:`,A)}}},disabled:_,className:r["practice-session__flashcard-reveal-btn"],children:"Ergebnis anzeigen"})]}),_e&&!_&&t.jsxs("div",{className:r["practice-session__flashcard-assessment"],children:[t.jsxs("button",{onClick:()=>{ye(!1),Ce(!1),setTimeout(()=>{ve()},300)},className:`${r["practice-session__flashcard-btn"]} ${r["practice-session__flashcard-btn--unknown"]}`,children:[t.jsx("span",{className:r["practice-session__flashcard-icon"],children:"‚úó"}),t.jsx("span",{children:"Nicht gewusst"})]}),t.jsxs("button",{onClick:()=>{ye(!0),Ce(!0),setTimeout(()=>{ve()},300)},className:`${r["practice-session__flashcard-btn"]} ${r["practice-session__flashcard-btn--known"]}`,children:[t.jsx("span",{className:r["practice-session__flashcard-icon"],children:"‚úì"}),t.jsx("span",{children:"Gewusst"})]})]}),_&&u.explanation&&t.jsxs("div",{className:r["practice-session__flashcard-explanation"],children:[t.jsx("strong",{children:"Hinweis:"})," ",u.explanation]})]})}function Qt(){if(!i||i.type!=="text-input")return null;const u=i.content,d=u.correctAnswerAudio?`/learning-platform/test/audio/${u.correctAnswerAudio}`:i.audioUrl;return t.jsx("div",{className:r["practice-session__text-input-container"],children:t.jsxs("div",{className:r["practice-session__text-input-wrapper"],children:[t.jsx(Nt,{value:ne,onChange:h=>Qe(h.target.value),disabled:_,placeholder:"Deine Antwort...",error:_&&!P,success:_&&P,fullWidth:!0,className:r["practice-session__text-input"]}),_&&!P&&t.jsxs("div",{className:r["practice-session__text-input-feedback"],children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Richtige Antwort:"})," ",u.correctAnswer]}),d&&t.jsx(xe,{text:u.correctAnswer,audioUrl:d,size:"small"})]})]})})}if(!l||!i)return t.jsx("div",{className:r["practice-session__loading"],children:t.jsx("p",{children:"Wird geladen..."})});const Xt=(k+1)/l.execution.taskIds.length*100,dt=i.content?.hint;async function es(){const d=await new ut(_t(),tt(),st()).createSession({topicId:s,learningPathIds:e,targetCount:a,includeReview:n});y(d)}async function kt(){if(!l||k>=l.execution.taskIds.length)return;const u=l.execution.taskIds[k];if(!u)return;const d=await O.tasks.get(u);if(!d)return;f(d),X(Date.now());const h=await Ps(d.templateId);Mt(h);const A=k+1;if(A<l.execution.taskIds.length){const w=l.execution.taskIds[A];w&&O.tasks.get(w).then(x=>{x&&x.audioUrl&&Ot(x)}).catch(x=>{console.warn("Failed to preload next task audio:",x)})}if(D(null),W(null),S([]),Z([]),qe({}),Ze([]),Ge(new Set),He(0),We(""),Ve(!1),ye(null),Qe(""),E(0),$(!1),re(!1),d.type==="multiple-choice"){const w=d.content,x=[...w.options],v=w.correctAnswer,g=x.map((B,G)=>G);for(let B=g.length-1;B>0;B--){const G=Math.floor(Math.random()*(B+1));[g[B],g[G]]=[g[G],g[B]]}const R=g.map(B=>x[B]),ee=g.findIndex(B=>B===v);le(R),fe(g),de(ee)}else if(d.type==="cloze-deletion"){const w=d.content;S(new Array(w.blanks.length).fill(""))}else if(d.type==="ordering"){const x=[...d.content.items].sort(()=>Math.random()-.5);Z(x)}else if(d.type==="matching"){const x=d.content.pairs.map((v,g)=>g);for(let v=x.length-1;v>0;v--){const g=Math.floor(Math.random()*(v+1));[x[v],x[g]]=[x[g],x[v]]}Ze(x),qe({})}else if(d.type==="multiple-select")Ge(new Set);else if(d.type==="slider"){const w=d.content;He(Math.floor((w.min+w.max)/2))}else d.type==="word-scramble"&&We("")}function ts(){l&&(V(!1),D(null),k<l.execution.taskIds.length-1&&L(k+1))}const ss=()=>{Re.autoPlayUnlocked||Pe().catch(u=>console.warn("Failed to unlock auto-play on click:",u))};return t.jsxs("div",{className:r["practice-session"],onClick:ss,children:[t.jsxs("div",{className:r["practice-session__header"],children:[t.jsxs("div",{className:r["practice-session__header-top"],children:[t.jsxs("div",{className:r["practice-session__header-left"],children:[t.jsx("h2",{className:r["practice-session__title"],children:"√úbungssitzung"}),t.jsxs("span",{className:r["practice-session__task-counter"],children:[k+1,"/",l.execution.taskIds.length]}),t.jsxs("span",{className:r["practice-session__task-id"],children:["ID: ",i.id]})]}),t.jsx("button",{onClick:o,className:r["practice-session__cancel-btn"],children:"Abbrechen"})]}),t.jsx("div",{className:r["practice-session__progress-bar"],children:t.jsx("div",{className:r["practice-session__progress-fill"],style:{width:`${Xt}%`}})})]}),t.jsxs("div",{className:r["practice-session__question-area"],children:[(i.type==="multiple-choice"||i.type==="ordering"||i.type==="matching"||i.type==="multiple-select"||i.type==="slider"||i.type==="word-scramble"||i.type==="text-input")&&t.jsxs("div",{className:r["practice-session__question-header"],children:[t.jsx("h3",{className:r["practice-session__question-text"],children:i.content.question}),U?.buttons?.question?.show&&i.content[U.buttons.question.field]&&t.jsx(xe,{text:i.content.question,audioUrl:`/learning-platform/test/audio/${i.content[U.buttons.question.field]}`,size:"small"})]}),dt&&!_&&t.jsx("div",{className:r["practice-session__hint-controls"],children:t.jsxs("button",{type:"button",className:r["practice-session__hint-button"],onClick:()=>re(u=>!u),children:[H?"Hinweis verbergen":"Hinweis anzeigen"," (H)"]})}),dt&&H&&!_&&t.jsxs("div",{className:r["practice-session__hint"],children:["üí° ",t.jsx("strong",{children:"Hinweis:"})," ",dt]}),Ut()]}),_&&t.jsx("div",{className:r["practice-session__feedback"],children:t.jsxs($s,{variant:P?"success":"error",title:P?"Richtig!":"Nicht ganz richtig",children:[i.content.explanation&&t.jsx("p",{style:{margin:0},children:i.content.explanation}),i.audioUrl&&i.type==="multiple-choice"&&t.jsxs("div",{style:{marginTop:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"Aussprache:"}),t.jsx(xe,{text:i.content.options[i.content.correctAnswer],audioUrl:i.audioUrl,size:"small"})]})]})}),t.jsxs("div",{className:r["practice-session__footer"],children:[t.jsx("div",{className:r["practice-session__actions"],children:_?i?.type!=="flashcard"&&t.jsx("button",{onClick:ve,className:r["practice-session__btn-next"],children:k<l.execution.taskIds.length-1?"N√§chste Aufgabe ‚Üí":"Sitzung beenden"}):t.jsxs(t.Fragment,{children:[i?.type!=="flashcard"&&t.jsx("button",{onClick:()=>Ce(),disabled:!et(),className:et()?`${r["practice-session__btn-submit"]} ${r["practice-session__btn-submit--enabled"]}`:`${r["practice-session__btn-submit"]} ${r["practice-session__btn-submit--disabled"]}`,children:"Antwort √ºberpr√ºfen"}),t.jsx("button",{onClick:k<l.execution.taskIds.length-1?ts:lt,className:r["practice-session__btn-skip"],children:k<l.execution.taskIds.length-1?"√úberspringen ‚Üí":"Sitzung beenden"})]})}),t.jsxs("div",{className:r["practice-session__stats"],children:[t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsx("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--completed"]}`,children:l.execution.completedCount}),t.jsx("div",{className:r["practice-session__stat-label"],children:"beantwortet"})]}),t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsx("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--correct"]}`,children:l.execution.correctCount}),t.jsx("div",{className:r["practice-session__stat-label"],children:"richtig"})]}),t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsxs("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--accuracy"]}`,children:[l.execution.completedCount>0?Math.round(l.execution.correctCount/l.execution.completedCount*100):0,"%"]}),t.jsx("div",{className:r["practice-session__stat-label"],children:"genau"})]})]})]}),M&&t.jsx("div",{className:r["practice-session__shortcuts-overlay"],role:"dialog","aria-modal":"true","aria-labelledby":"practice-shortcuts-title",children:t.jsxs("div",{className:r["practice-session__shortcuts-content"],children:[t.jsx("h2",{id:"practice-shortcuts-title",children:"Tastaturk√ºrzel"}),t.jsxs("div",{className:r["practice-session__shortcuts-groups"],children:[t.jsxs("div",{children:[t.jsx("div",{className:r["practice-session__shortcuts-group-title"],children:"Navigation"}),t.jsxs("ul",{className:r["practice-session__shortcuts-list"],children:[t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Escape"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Esc"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Zur n√§chsten/vorherigen Option"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"‚Üê ‚Üë ‚Üí ‚Üì"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Option w√§hlen / Checkbox umschalten"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Leertaste"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Option direkt w√§hlen"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"1‚Äì9"})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:r["practice-session__shortcuts-group-title"],children:"Aktionen"}),t.jsxs("ul",{className:r["practice-session__shortcuts-list"],children:[t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Antwort √ºberpr√ºfen / weiter"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Enter"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Frage erneut abspielen"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"R"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Hinweis anzeigen (falls vorhanden)"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"H"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Hilfe umschalten"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"?"})]})]})]})]}),t.jsx("div",{className:r["practice-session__shortcuts-close"],children:t.jsx("button",{type:"button",onClick:()=>$(!1),children:"Schlie√üen (Esc)"})})]})})]})}const ze={"stat-card__container":"_stat-card__container_jhf3g_4","stat-card__header":"_stat-card__header_jhf3g_11","stat-card__title":"_stat-card__title_jhf3g_18","stat-card__icon":"_stat-card__icon_jhf3g_28","stat-card__value":"_stat-card__value_jhf3g_35","stat-card__subtitle":"_stat-card__subtitle_jhf3g_43"};function Ae({title:s,value:e,subtitle:a,color:n=F.primary[500],icon:c,className:o,style:l,...y}){return t.jsx(Ie,{...y,padding:"medium",shadow:!0,border:!0,style:{borderLeft:`4px solid ${n}`,...l},className:o,children:t.jsxs("div",{className:ze["stat-card__container"],children:[t.jsxs("div",{className:ze["stat-card__header"],children:[t.jsx("h3",{className:ze["stat-card__title"],children:s}),c&&t.jsx("div",{className:ze["stat-card__icon"],style:{color:n},children:c})]}),t.jsx("div",{className:ze["stat-card__value"],children:e}),a&&t.jsx("div",{className:ze["stat-card__subtitle"],children:a})]})})}const Ks="_button_1pgvq_4",Zs="_button__icon_1pgvq_115",Qs="_button__spinner_1pgvq_130",Xs="_spin_1pgvq_1",Se={button:Ks,"button--loading":"_button--loading_1pgvq_21","button--full-width":"_button--full-width_1pgvq_27","button--primary":"_button--primary_1pgvq_32","button--secondary":"_button--secondary_1pgvq_47","button--ghost":"_button--ghost_1pgvq_62","button--danger":"_button--danger_1pgvq_79","button--small":"_button--small_1pgvq_94","button--medium":"_button--medium_1pgvq_101","button--large":"_button--large_1pgvq_108",button__icon:Zs,button__spinner:Qs,spin:Xs};function nt({variant:s="primary",size:e="medium",loading:a=!1,fullWidth:n=!1,disabled:c=!1,startIcon:o,endIcon:l,children:y,className:i,...f}){return t.jsx("button",{...f,disabled:c||a,className:q(Se.button,Se[`button--${s}`],Se[`button--${e}`],a&&Se["button--loading"],n&&Se["button--full-width"],i),children:a?t.jsxs(t.Fragment,{children:[t.jsx(ea,{size:e}),y]}):t.jsxs(t.Fragment,{children:[o&&t.jsx("span",{className:Se.button__icon,children:o}),y,l&&t.jsx("span",{className:Se.button__icon,children:l})]})})}function ea({size:s}){const e=s==="small"?"12px":s==="large"?"18px":"16px";return t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:Se.button__spinner,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:"31.4 31.4",opacity:"0.25"}),t.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}const se={"session-results":"_session-results_p4d1d_4","session-results__header":"_session-results__header_p4d1d_12","session-results__emoji":"_session-results__emoji_p4d1d_16","session-results__title":"_session-results__title_p4d1d_21","session-results__rating":"_session-results__rating_p4d1d_25","session-results__stats":"_session-results__stats_p4d1d_32","session-results__time-card":"_session-results__time-card_p4d1d_40","session-results__time-text":"_session-results__time-text_p4d1d_45","session-results__progress-card":"_session-results__progress-card_p4d1d_51","session-results__progress-title":"_session-results__progress-title_p4d1d_55","session-results__progress-text":"_session-results__progress-text_p4d1d_59","session-results__actions":"_session-results__actions_p4d1d_82"};function ta({session:s,onClose:e,onStartNew:a}){const n=s.results.accuracy,c=Math.round(s.results.averageTime);let o="",l="";n>=90?(o="Ausgezeichnet!",l="var(--color-success)"):n>=75?(o="Sehr gut!",l="var(--color-primary)"):n>=60?(o="Gut gemacht!",l="var(--color-warning)"):(o="Weiter √ºben!",l="var(--color-error)");function y(i){const f=Math.floor(i/60),k=i%60;return f>0?`${f}:${k.toString().padStart(2,"0")} min`:`${k} sek`}return t.jsxs("div",{className:se["session-results"],children:[t.jsxs("div",{className:se["session-results__header"],children:[t.jsx("div",{className:se["session-results__emoji"],children:"üéâ"}),t.jsx("h1",{className:se["session-results__title"],children:"Sitzung abgeschlossen!"}),t.jsx("p",{className:se["session-results__rating"],style:{color:l},children:o})]}),t.jsxs("div",{className:se["session-results__stats"],children:[t.jsx(Ae,{title:"Aufgaben bearbeitet",value:s.execution.completedCount,color:"var(--color-primary)"}),t.jsx(Ae,{title:"Richtige Antworten",value:s.execution.correctCount,color:"var(--color-success)"}),t.jsx(Ae,{title:"Genauigkeit",value:`${Math.round(n)}%`,color:l}),t.jsx(Ae,{title:"√ò Zeit pro Aufgabe",value:y(c),color:"var(--color-warning)"})]}),t.jsx(Ie,{padding:"medium",className:se["session-results__time-card"],children:t.jsxs("p",{className:se["session-results__time-text"],children:[t.jsx("strong",{children:"Gesamtzeit:"})," ",y(s.execution.totalTimeSpent)]})}),t.jsxs(Ie,{padding:"large",className:se["session-results__progress-card"],children:[t.jsx("h3",{className:se["session-results__progress-title"],children:"üìà Dein Fortschritt"}),t.jsxs("p",{className:se["session-results__progress-text"],children:[n>=90&&"Hervorragende Leistung! Du beherrschst dieses Thema sehr gut.",n>=75&&n<90&&"Sehr gute Arbeit! Du machst gro√üe Fortschritte.",n>=60&&n<75&&"Gute Arbeit! Weiter so, du verbesserst dich stetig.",n<60&&"Bleib dran! √úbung macht den Meister. Die n√§chste Sitzung wird noch besser!"]})]}),t.jsxs("div",{className:se["session-results__actions"],children:[t.jsx(nt,{onClick:a,variant:"primary",children:"Neue Sitzung starten"}),t.jsx(nt,{onClick:e,variant:"secondary",children:"Zur√ºck zur √úbersicht"})]})]})}const Be={"mastery-bar":"_mastery-bar_csvhg_4","mastery-bar__header":"_mastery-bar__header_csvhg_9","mastery-bar__label":"_mastery-bar__label_csvhg_16","mastery-bar__count":"_mastery-bar__count_csvhg_22","mastery-bar__track":"_mastery-bar__track_csvhg_28","mastery-bar__fill":"_mastery-bar__fill_csvhg_36"};function ft({label:s,count:e,color:a,max:n}){const c=n&&n>0?e/n*100:e>0?100:0;return t.jsxs("div",{className:Be["mastery-bar"],children:[t.jsxs("div",{className:Be["mastery-bar__header"],children:[t.jsx("span",{className:Be["mastery-bar__label"],children:s}),t.jsx("span",{className:Be["mastery-bar__count"],children:e})]}),t.jsx("div",{className:Be["mastery-bar__track"],children:t.jsx("div",{className:Be["mastery-bar__fill"],style:{background:a,width:`${c}%`}})})]})}const sa="_dashboard_1oze0_4",aa="_dashboard__empty_1oze0_12",ia="_dashboard__header_1oze0_22",na="_dashboard__title_1oze0_26",ra="_dashboard__subtitle_1oze0_30",oa="_dashboard__metrics_1oze0_36",z={dashboard:sa,dashboard__empty:aa,"dashboard__back-button":"_dashboard__back-button_1oze0_17",dashboard__header:ia,dashboard__title:na,dashboard__subtitle:ra,dashboard__metrics:oa,"dashboard__mastery-card":"_dashboard__mastery-card_1oze0_44","dashboard__mastery-title":"_dashboard__mastery-title_1oze0_48","dashboard__mastery-bars":"_dashboard__mastery-bars_1oze0_52","dashboard__topic-card":"_dashboard__topic-card_1oze0_59","dashboard__topic-title":"_dashboard__topic-title_1oze0_63","dashboard__topic-grid":"_dashboard__topic-grid_1oze0_67","dashboard__topic-item":"_dashboard__topic-item_1oze0_75","dashboard__topic-header":"_dashboard__topic-header_1oze0_79","dashboard__topic-name":"_dashboard__topic-name_1oze0_85","dashboard__topic-meta":"_dashboard__topic-meta_1oze0_89","dashboard__topic-bar-container":"_dashboard__topic-bar-container_1oze0_94","dashboard__topic-bar-fill":"_dashboard__topic-bar-fill_1oze0_101","dashboard__topic-stats":"_dashboard__topic-stats_1oze0_106","dashboard__sessions-title":"_dashboard__sessions-title_1oze0_113","dashboard__sessions-list":"_dashboard__sessions-list_1oze0_117","dashboard__session-item":"_dashboard__session-item_1oze0_125","dashboard__session-left":"_dashboard__session-left_1oze0_134","dashboard__session-topic":"_dashboard__session-topic_1oze0_138","dashboard__session-date":"_dashboard__session-date_1oze0_142","dashboard__session-right":"_dashboard__session-right_1oze0_147","dashboard__session-accuracy":"_dashboard__session-accuracy_1oze0_151","dashboard__session-stats":"_dashboard__session-stats_1oze0_155"};function ca({onClose:s}){const[e,a]=p.useState(null),[n,c]=p.useState(!0);p.useEffect(()=>{o()},[]);async function o(){try{const i=await O.practiceSessions.toArray(),f=i.filter(m=>m.execution.status==="completed"),k=await O.topics.toArray(),L=new Map(k.map(m=>[m.id,m])),C=await O.spacedRepetition.toArray(),D=f.reduce((m,S)=>m+(S.execution?.completedCount||0),0),_=f.reduce((m,S)=>m+(S.execution?.correctCount||0),0),V=D>0?_/D*100:0,P=f.reduce((m,S)=>S.execution.startedAt&&S.execution.completedAt?m+(new Date(S.execution.completedAt).getTime()-new Date(S.execution.startedAt).getTime())/1e3:m,0),J=f.length>0?P/f.length:0,Q=new Map;for(const m of f){const S=m.configuration.topicId;Q.has(S)||Q.set(S,{sessions:0,correct:0,total:0});const I=Q.get(S);I.sessions++,I.correct+=m.execution?.correctCount||0,I.total+=m.execution?.completedCount||0}const X=Array.from(Q.entries()).map(([m,S])=>({topicId:m,topicName:L.get(m)?.title||m,sessionsCompleted:S.sessions,accuracy:S.total>0?S.correct/S.total*100:0,tasksReviewed:S.total})),Y=new Date,le=C.filter(m=>m.algorithm.efactor>=2.5).length,je=C.filter(m=>m.algorithm.efactor<2.5&&m.algorithm.repetition>0).length,fe=C.filter(m=>m.algorithm.repetition===0).length,ge=C.filter(m=>new Date(m.schedule.nextReview)<=Y).length,de=f.sort((m,S)=>{const I=m.execution.completedAt?new Date(m.execution.completedAt).getTime():0;return(S.execution.completedAt?new Date(S.execution.completedAt).getTime():0)-I}).slice(0,5);a({totalSessions:i.length,completedSessions:f.length,totalQuestions:D,correctAnswers:_,accuracyRate:V,averageSessionTime:J,currentStreak:0,totalStudyTime:P,topicProgress:X,recentSessions:de,upcomingReviews:ge,masteryLevels:{mastered:le,learning:je,new:fe}})}catch(i){console.error("Failed to load dashboard stats:",i)}finally{c(!1)}}function l(i){const f=Math.floor(i/3600),k=Math.floor(i%3600/60);return f>0?`${f}h ${k}m`:`${k}m`}function y(i){return(typeof i=="string"?new Date(i):i).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}return n?t.jsxs("div",{className:z.dashboard__empty,style:{textAlign:"center"},children:[t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Lade Statistiken..."})]}):e?t.jsxs("div",{className:z.dashboard,children:[t.jsxs("div",{className:z.dashboard__header,children:[t.jsx(nt,{variant:"secondary",onClick:s,className:z["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{className:z.dashboard__title,children:"üìä Lern-Dashboard"}),t.jsx("p",{className:z.dashboard__subtitle,children:"Deine Fortschritte und Statistiken im √úberblick"})]}),t.jsxs("div",{className:z.dashboard__metrics,children:[t.jsx(Ae,{title:"Gesamt Sitzungen",value:e.completedSessions.toString(),subtitle:`von ${e.totalSessions} gestartet`,color:F.primary[500]}),t.jsx(Ae,{title:"Genauigkeit",value:`${Math.round(e.accuracyRate)}%`,subtitle:`${e.correctAnswers}/${e.totalQuestions} richtig`,color:F.success[500]}),t.jsx(Ae,{title:"Lernzeit",value:l(e.totalStudyTime),subtitle:`√ò ${l(e.averageSessionTime)} pro Sitzung`,color:F.warning[500]}),t.jsx(Ae,{title:"Anstehende Wiederholungen",value:e.upcomingReviews.toString(),subtitle:"bereit zum √úben",color:F.info[500]})]}),t.jsxs(Ie,{padding:"medium",className:z["dashboard__mastery-card"],children:[t.jsx("h2",{className:z["dashboard__mastery-title"],children:"üéØ Beherrschungsniveau"}),t.jsxs("div",{className:z["dashboard__mastery-bars"],children:[t.jsx(ft,{label:"Gemeistert",count:e.masteryLevels.mastered,color:F.success[500]}),t.jsx(ft,{label:"In Arbeit",count:e.masteryLevels.learning,color:F.warning[500]}),t.jsx(ft,{label:"Neu",count:e.masteryLevels.new,color:F.primary[500]})]})]}),e.topicProgress.length>0&&t.jsxs(Ie,{padding:"medium",className:z["dashboard__topic-card"],children:[t.jsx("h2",{className:z["dashboard__topic-title"],children:"üìö Fortschritt nach Thema"}),t.jsx("div",{className:z["dashboard__topic-grid"],children:e.topicProgress.map(i=>t.jsxs("div",{className:z["dashboard__topic-item"],children:[t.jsxs("div",{className:z["dashboard__topic-header"],children:[t.jsx("span",{className:z["dashboard__topic-name"],children:i.topicName}),t.jsxs("span",{className:z["dashboard__topic-meta"],children:[i.sessionsCompleted," Sitzungen ‚Ä¢ ",Math.round(i.accuracy),"% genau"]})]}),t.jsx("div",{className:z["dashboard__topic-bar-container"],children:t.jsx("div",{className:z["dashboard__topic-bar-fill"],style:{background:i.accuracy>=75?F.success[500]:i.accuracy>=50?F.warning[500]:F.error[500],width:`${i.accuracy}%`}})}),t.jsxs("div",{className:z["dashboard__topic-stats"],children:[i.tasksReviewed," Aufgaben bearbeitet"]})]},i.topicId))})]}),e.recentSessions.length>0&&t.jsxs(Ie,{padding:"medium",children:[t.jsx("h2",{className:z["dashboard__sessions-title"],children:"üïê Letzte Sitzungen"}),t.jsx("div",{className:z["dashboard__sessions-list"],children:e.recentSessions.map(i=>t.jsxs("div",{className:z["dashboard__session-item"],children:[t.jsxs("div",{className:z["dashboard__session-left"],children:[t.jsx("div",{className:z["dashboard__session-topic"],children:i.configuration.topicId}),t.jsx("div",{className:z["dashboard__session-date"],children:i.execution.completedAt&&y(i.execution.completedAt)})]}),t.jsxs("div",{className:z["dashboard__session-right"],children:[t.jsxs("div",{className:z["dashboard__session-accuracy"],style:{color:i.results.accuracy>=75?F.success[500]:F.warning[500]},children:[Math.round(i.results.accuracy),"%"]}),t.jsxs("div",{className:z["dashboard__session-stats"],children:[i.execution.correctCount,"/",i.execution.completedCount]})]})]},i.id))})]})]}):t.jsxs("div",{className:z.dashboard__empty,children:[t.jsx(nt,{variant:"secondary",onClick:s,className:z["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Keine Daten verf√ºgbar."})]})}const la=({topic:s,onSelect:e,className:a,disabled:n=!1,"data-testid":c})=>{const[o,l]=Fe.useState(!1),y={padding:"2rem",background:"var(--color-bg-secondary)",borderRadius:"12px",cursor:n?"not-allowed":"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"2px solid transparent",borderColor:o?"var(--color-primary)":"transparent",transform:o&&!n?"translateY(-4px)":"translateY(0)",boxShadow:o&&!n?"var(--shadow-lg)":"none",opacity:n?.5:1},i=`Thema ${s.name} √∂ffnen - ${s.description}`;return t.jsxs("button",{type:"button",onClick:()=>e(s.id),className:a,"data-testid":c,style:y,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),disabled:n,"aria-label":i,children:[s.icon&&t.jsx("span",{"aria-hidden":"true",style:{fontSize:"48px",display:"block",marginBottom:"16px"},children:s.icon}),t.jsx("h3",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px",color:"var(--color-text-primary)"},children:s.name}),t.jsx("p",{style:{fontSize:"14px",color:"var(--color-text-secondary)",lineHeight:1.5,margin:0},children:s.description})]})};function $t(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone??"Europe/Berlin"}catch{return"Europe/Berlin"}}const N={version:1,theme:{mode:"system",fontScale:"medium",animationsEnabled:!0,reducedMotion:!1},audio:{autoPlayEnabled:!0,autoPlayRepeats:1,autoPlayDelayMs:1e3,soundEffectsEnabled:!0,soundEffectsVolume:.8,successChimeEnabled:!0,playbackRate:1},learning:{algorithm:"fsrs",dailyGoal:20,sessionSize:10,repeatDifficultTasks:!0,randomizeOrder:!0},notifications:{dailyReminderEnabled:!1,dailyReminderTime:"18:00",dailyReminderMessage:"Zeit zum Lernen! üìö",streakWarningEnabled:!0,weeklyReportEnabled:!1},interaction:{vibrationsEnabled:!0,vibrationOnCorrect:!0,vibrationOnIncorrect:!0,vibrationOnSessionComplete:!1,confettiEnabled:!0,confettiStyle:"standard",confettiIntensity:"medium",wakeLockEnabled:!0,keyboardShortcutsEnabled:!0},ai:{explanationsEnabled:!1,explanationDepth:"medium",includeExamples:!0,showLearningTips:!0,trainingOptIn:!1,dailyUsageLimit:20,usageToday:0},privacy:{dataStorageMode:"local",analyticsEnabled:!1,errorReportsEnabled:!1,betaFeaturesEnabled:!1},language:{interfaceLanguage:"de",timezone:$t(),dateFormat:"DD.MM.YYYY"},database:{lastUpdatedAt:null,storageUsageBytes:null},lastSavedAt:null};function Ue(s,e,a){return Number.isNaN(s)?e:Math.min(a,Math.max(e,s))}function da(s){return s==="light"||s==="dark"||s==="system"}function ua(s){return s==="small"||s==="medium"||s==="large"||s==="x-large"}function _a(s){return s===.5||s===.75||s===1||s===1.25||s===1.5}function pa(s){return s==="sm-2"||s==="fsrs"||s==="neural"}function ha(s){return s==="standard"||s==="firework"||s==="emoji"}function ma(s){return s==="light"||s==="medium"||s==="strong"}function fa(s){return s==="short"||s==="medium"||s==="detailed"}function ga(s){return s==="local"||s==="cloud"}function ba(s){return s==="de"||s==="en"||s==="es"}function ya(s){return s==="DD.MM.YYYY"||s==="MM/DD/YYYY"||s==="YYYY-MM-DD"}function va(s){return{mode:da(s?.mode)?s.mode:N.theme.mode,fontScale:ua(s?.fontScale)?s.fontScale:N.theme.fontScale,animationsEnabled:!!(s?.animationsEnabled??N.theme.animationsEnabled),reducedMotion:!!(s?.reducedMotion??N.theme.reducedMotion)}}function wa(s){const e=s?.autoPlayRepeats,a=e===2||e===3?e:1,n=Ue(Number(s?.autoPlayDelayMs??N.audio.autoPlayDelayMs),0,5e3),c=Ue(Number(s?.soundEffectsVolume??N.audio.soundEffectsVolume),0,1);return{autoPlayEnabled:!!(s?.autoPlayEnabled??N.audio.autoPlayEnabled),autoPlayRepeats:a,autoPlayDelayMs:n,soundEffectsEnabled:!!(s?.soundEffectsEnabled??N.audio.soundEffectsEnabled),soundEffectsVolume:c,successChimeEnabled:!!(s?.successChimeEnabled??N.audio.successChimeEnabled),playbackRate:_a(s?.playbackRate)?s.playbackRate:N.audio.playbackRate}}function xa(s){const e=Ue(Number(s?.dailyGoal??N.learning.dailyGoal),1,200),a=Ue(Number(s?.sessionSize??N.learning.sessionSize),1,100);return{algorithm:pa(s?.algorithm)?s.algorithm:N.learning.algorithm,dailyGoal:e,sessionSize:a,repeatDifficultTasks:!!(s?.repeatDifficultTasks??N.learning.repeatDifficultTasks),randomizeOrder:!!(s?.randomizeOrder??N.learning.randomizeOrder)}}function ka(s){const e=typeof s?.dailyReminderTime=="string"&&/^\d{2}:\d{2}$/.test(s.dailyReminderTime)?s.dailyReminderTime:N.notifications.dailyReminderTime,a=typeof s?.dailyReminderMessage=="string"&&s.dailyReminderMessage.length<=120?s.dailyReminderMessage:N.notifications.dailyReminderMessage;return{dailyReminderEnabled:!!(s?.dailyReminderEnabled??N.notifications.dailyReminderEnabled),dailyReminderTime:e,dailyReminderMessage:a,streakWarningEnabled:!!(s?.streakWarningEnabled??N.notifications.streakWarningEnabled),weeklyReportEnabled:!!(s?.weeklyReportEnabled??N.notifications.weeklyReportEnabled)}}function Sa(s){return{vibrationsEnabled:!!(s?.vibrationsEnabled??N.interaction.vibrationsEnabled),vibrationOnCorrect:!!(s?.vibrationOnCorrect??N.interaction.vibrationOnCorrect),vibrationOnIncorrect:!!(s?.vibrationOnIncorrect??N.interaction.vibrationOnIncorrect),vibrationOnSessionComplete:!!(s?.vibrationOnSessionComplete??N.interaction.vibrationOnSessionComplete),confettiEnabled:!!(s?.confettiEnabled??N.interaction.confettiEnabled),confettiStyle:ha(s?.confettiStyle)?s.confettiStyle:N.interaction.confettiStyle,confettiIntensity:ma(s?.confettiIntensity)?s.confettiIntensity:N.interaction.confettiIntensity,wakeLockEnabled:!!(s?.wakeLockEnabled??N.interaction.wakeLockEnabled),keyboardShortcutsEnabled:!!(s?.keyboardShortcutsEnabled??N.interaction.keyboardShortcutsEnabled)}}function Aa(s){const e=Ue(Number(s?.dailyUsageLimit??N.ai.dailyUsageLimit),0,9999),a=Ue(Number(s?.usageToday??N.ai.usageToday),0,e);return{explanationsEnabled:!!(s?.explanationsEnabled??N.ai.explanationsEnabled),explanationDepth:fa(s?.explanationDepth)?s.explanationDepth:N.ai.explanationDepth,includeExamples:!!(s?.includeExamples??N.ai.includeExamples),showLearningTips:!!(s?.showLearningTips??N.ai.showLearningTips),trainingOptIn:!!(s?.trainingOptIn??N.ai.trainingOptIn),dailyUsageLimit:e,usageToday:a}}function ja(s){return{dataStorageMode:ga(s?.dataStorageMode)?s.dataStorageMode:N.privacy.dataStorageMode,analyticsEnabled:!!(s?.analyticsEnabled??N.privacy.analyticsEnabled),errorReportsEnabled:!!(s?.errorReportsEnabled??N.privacy.errorReportsEnabled),betaFeaturesEnabled:!!(s?.betaFeaturesEnabled??N.privacy.betaFeaturesEnabled)}}function Na(s){return{interfaceLanguage:ba(s?.interfaceLanguage)?s.interfaceLanguage:N.language.interfaceLanguage,timezone:typeof s?.timezone=="string"&&s.timezone.length>0?s.timezone:$t(),dateFormat:ya(s?.dateFormat)?s.dateFormat:N.language.dateFormat}}function Ra(s){const e=typeof s?.lastUpdatedAt=="string"||s?.lastUpdatedAt===null?s.lastUpdatedAt:N.database.lastUpdatedAt,a=typeof s?.storageUsageBytes=="number"||s?.storageUsageBytes===null?s.storageUsageBytes:N.database.storageUsageBytes;return{lastUpdatedAt:e,storageUsageBytes:a}}function it(s){if(!s||typeof s!="object")return{...N};const e=s,a=typeof e.version=="number"?e.version:N.version,n=typeof e.lastSavedAt=="string"||e.lastSavedAt===null?e.lastSavedAt:N.lastSavedAt;return{version:a,theme:va(e.theme),audio:wa(e.audio),learning:xa(e.learning),notifications:ka(e.notifications),interaction:Sa(e.interaction),ai:Aa(e.ai),privacy:ja(e.privacy),language:Na(e.language),database:Ra(e.database),lastSavedAt:n}}const Rt="mindforge.app-settings.v1";function Ca(s){return s==="system"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":s}function Ea(s){if(typeof document>"u")return;const e={small:"15px",medium:"16px",large:"18px","x-large":"20px"};document.documentElement.style.fontSize=e[s]}function Ta(s){typeof document>"u"||document.documentElement.classList.toggle("reduced-motion",s)}function Ct(s){if(typeof document>"u")return;const e=Ca(s);document.documentElement.setAttribute("data-theme",e)}class Ia{currentSettings={...N};mediaQuery=null;constructor(){typeof window<"u"&&window.matchMedia&&(this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.mediaQuery.addEventListener("change",this.handleSystemThemeChange))}load(){try{const e=localStorage.getItem(Rt);if(!e)return this.applySettings(N),this.currentSettings={...N},this.emitUpdate(),this.currentSettings;const a=it(JSON.parse(e));return this.currentSettings=a,this.applySettings(a),this.emitUpdate(),a}catch(e){return console.warn("[Settings] Failed to load settings, resetting to defaults.",e),this.currentSettings={...N},this.persist(this.currentSettings),this.applySettings(this.currentSettings),this.emitUpdate(),this.currentSettings}}save(e){const a={...e,lastSavedAt:new Date().toISOString()};return this.currentSettings=a,this.persist(a),this.applySettings(a),this.emitUpdate(),a}update(e){const a=e(this.currentSettings);return this.save(it(a))}reset(){const e={...N,lastSavedAt:new Date().toISOString()};return this.currentSettings=e,this.persist(e),this.applySettings(e),this.emitUpdate(),e}export(){const e={exportedAt:new Date().toISOString(),settings:this.currentSettings};return JSON.stringify(e,null,2)}import(e){try{const a=JSON.parse(e),n=a?.settings??a,c=it(n);return this.save(c)}catch(a){throw console.error("[Settings] Failed to import settings",a),new Error("Ung√ºltige Einstellungsdatei.")}}async estimateStorageUsage(){if(navigator.storage?.estimate)try{const e=await navigator.storage.estimate();return{usage:e.usage??null,quota:e.quota??null}}catch(e){console.warn("[Settings] Failed to estimate storage usage",e)}return{usage:null,quota:null}}persist(e){localStorage.setItem(Rt,JSON.stringify(e))}applySettings(e){Ct(e.theme.mode),Ea(e.theme.fontScale),Ta(e.theme.reducedMotion||!e.theme.animationsEnabled)}handleSystemThemeChange=()=>{this.currentSettings.theme.mode==="system"&&(Ct("system"),this.emitUpdate())};emitUpdate(){if(typeof window>"u")return;const e={settings:this.currentSettings};window.dispatchEvent(new CustomEvent("app:settings:updated",{detail:e}))}dispose(){this.mediaQuery&&this.mediaQuery.removeEventListener("change",this.handleSystemThemeChange)}getSettings(){return this.currentSettings}}const oe=new Ia,Pa=2e3;function Da(){const[s,e]=p.useState(null),[a,n]=p.useState(!0),[c,o]=p.useState("idle"),[l,y]=p.useState(null),i=p.useRef(null),f=p.useRef(null);p.useEffect(()=>{const P=oe.load();return f.current=P,e(P),n(!1),oe.estimateStorageUsage().then(J=>{y(J)}),()=>{i.current&&window.clearTimeout(i.current)}},[]);const k=p.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>{o("idle"),i.current=null},Pa)},[]),L=p.useCallback(P=>{if(!f.current)return;o("saving");const J=typeof P=="function"?P(f.current):{...f.current,...P},Q=it(J),X=oe.save(Q);f.current=X,e(X),o("saved"),k()},[k]),C=p.useCallback(()=>{o("saving");const P=oe.reset();f.current=P,e(P),o("saved"),k()},[k]),D=p.useCallback(()=>oe.export(),[]),_=p.useCallback(P=>{o("saving");const J=oe.import(P);f.current=J,e(J),o("saved"),k()},[k]),V=p.useCallback(async()=>{const P=await oe.estimateStorageUsage();y(P)},[]);return{settings:s,loading:a,saveState:c,updateSettings:L,resetSettings:C,exportSettings:D,importSettingsFromText:_,storageEstimate:l,refreshStorageEstimate:V}}const La="_settingsPage_3a882_1",za="_settingsHeader_3a882_34",Ba="_settingsTitle_3a882_42",$a="_saveIndicator_3a882_53",Ma="_searchBar_3a882_62",Oa="_searchInput_3a882_67",Fa="_searchIcon_3a882_85",Ua="_presets_3a882_94",qa="_presetButton_3a882_101",Ga="_sections_3a882_117",Ha="_section_3a882_117",Wa="_sectionHeader_3a882_130",Va="_sectionHeaderIcon_3a882_152",Ja="_sectionCaret_3a882_156",Ya="_sectionContent_3a882_165",Ka="_settingGroup_3a882_171",Za="_settingItem_3a882_177",Qa="_settingLabel_3a882_183",Xa="_settingDescription_3a882_190",ei="_radioGroup_3a882_202",ti="_toggleGroup_3a882_203",si="_radioOption_3a882_217",ai="_buttonRow_3a882_246",ii="_dangerButton_3a882_253",ni="_infoCard_3a882_258",ri="_infoGrid_3a882_269",oi="_linkButton_3a882_280",ci="_footerActions_3a882_289",li="_resetButton_3a882_297",di="_closeButton_3a882_298",j={settingsPage:La,settingsHeader:za,settingsTitle:Ba,saveIndicator:$a,"saveIndicator--saved":"_saveIndicator--saved_3a882_58",searchBar:Ma,searchInput:Oa,searchIcon:Fa,presets:Ua,presetButton:qa,sections:Ga,section:Ha,sectionHeader:Wa,sectionHeaderIcon:Va,sectionCaret:Ja,"sectionCaret--collapsed":"_sectionCaret--collapsed_3a882_161",sectionContent:Ya,settingGroup:Ka,settingItem:Za,settingLabel:Qa,settingDescription:Xa,radioGroup:ei,toggleGroup:ti,radioOption:si,"radioOption--active":"_radioOption--active_3a882_231",buttonRow:ai,dangerButton:ii,infoCard:ni,infoGrid:ri,linkButton:oi,footerActions:ci,resetButton:li,closeButton:di};function Et(s){if(s==null)return"‚Äì";if(s===0)return"0 B";const e=["B","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(1024));return`${(s/Math.pow(1024,a)).toFixed(1)} ${e[a]}`}function Tt(s){if(!s)return"Nie";try{const e=new Date(s);return new Intl.DateTimeFormat("de-DE",{dateStyle:"medium",timeStyle:"short"}).format(e)}catch{return s??""}}const It=[{id:"performance",label:"‚ö° Performance-Modus",apply:s=>({...s,theme:{...s.theme,animationsEnabled:!1,mode:"dark"},audio:{...s.audio,autoPlayEnabled:!1}})},{id:"accessibility",label:"‚ôø Barrierefreiheit",apply:s=>({...s,theme:{...s.theme,fontScale:"x-large",reducedMotion:!0,animationsEnabled:!1,mode:"light"}})},{id:"power-saver",label:"üîã Energiesparen",apply:s=>({...s,audio:{...s.audio,autoPlayEnabled:!1},theme:{...s.theme,animationsEnabled:!1}})}];function ui({onClose:s}){const{settings:e,loading:a,saveState:n,updateSettings:c,resetSettings:o,exportSettings:l,importSettingsFromText:y,storageEstimate:i,refreshStorageEstimate:f}=Da(),{settings:k,updateSettings:L}=zt(),[C,D]=p.useState(""),_=p.useRef(null),[V,P]=p.useState(null),J=m=>{c(S=>({...S,theme:{...S.theme,mode:m}}))},Q=m=>{c(S=>({...S,theme:{...S.theme,fontScale:m}}))},X=m=>{if(c(S=>({...S,audio:{...S.audio,...m}})),k){const S={};m.autoPlayEnabled!==void 0&&(S.autoPlayEnabled=m.autoPlayEnabled),Object.keys(S).length>0&&L(S)}},Y=p.useCallback(m=>{c(S=>({...S,database:{...S.database,...m}}))},[c]);if(p.useEffect(()=>{const m=S=>{const I=S.detail;I?.lastUpdatedAt&&Y({lastUpdatedAt:I.lastUpdatedAt}),typeof I?.storageUsageBytes=="number"&&Y({storageUsageBytes:I.storageUsageBytes}),f()};return window.addEventListener("app:database:updated",m),()=>{window.removeEventListener("app:database:updated",m)}},[Y,f]),a||!e)return t.jsx("div",{className:j.settingsPage,children:t.jsx("p",{children:"Lade Einstellungen..."})});const le=m=>{const S=It.find(I=>I.id===m);S&&c(()=>S.apply(e))},je=()=>{const m=l(),S=new Blob([m],{type:"application/json"}),I=URL.createObjectURL(S),W=document.createElement("a");W.href=I,W.download=`mindforge-settings-${new Date().toISOString().slice(0,10)}.json`,W.click(),URL.revokeObjectURL(I)},fe=m=>{const S=m.target.files?.[0];if(!S)return;const I=new FileReader;I.onload=()=>{try{const W=typeof I.result=="string"?I.result:"";y(W),P(null)}catch(W){console.error(W),P("Import fehlgeschlagen. Bitte g√ºltige JSON-Datei ausw√§hlen.")}},I.onerror=()=>{P("Datei konnte nicht gelesen werden.")},I.readAsText(S),m.target.value=""},de=(()=>{const m={id:"database",icon:"üì¶",title:"Datenbank & Speicherung",keywords:["datenbank","speicherung","backup","import","export","speicher"],content:t.jsxs("div",{className:j.settingGroup,children:[t.jsxs("div",{className:j.buttonRow,children:[t.jsx("button",{type:"button",onClick:()=>{confirm("Datenbank neu laden? Lernpfade werden aktualisiert.")&&window.dispatchEvent(new CustomEvent("app:database:reseed"))},children:"üîÑ Datenbank Aktualisieren"}),t.jsx("button",{type:"button",className:q(j.dangerButton),onClick:()=>{confirm("‚ö†Ô∏è Alle Daten l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden!")&&window.dispatchEvent(new CustomEvent("app:database:reset"))},children:"üóëÔ∏è Alle Daten L√∂schen"}),t.jsx("button",{type:"button",onClick:je,children:"üì• Daten Exportieren"}),t.jsx("button",{type:"button",onClick:()=>{_.current?.click()},children:"üì§ Daten Importieren"}),t.jsx("input",{ref:_,type:"file",accept:"application/json",style:{display:"none"},onChange:fe})]}),V&&t.jsx("div",{className:j.infoCard,style:{borderColor:"#f97316",color:"#b45309"},children:V}),t.jsxs("div",{className:j.infoCard,children:[t.jsxs("div",{className:j.infoGrid,children:[t.jsxs("div",{children:["üíæ Speichernutzung: ",Et(i?.usage??null)," / ",Et(i?.quota??null)]}),t.jsxs("div",{children:["üìÖ Letztes Update: ",Tt(e.database.lastUpdatedAt)]})]}),t.jsx("button",{type:"button",onClick:()=>{f()},children:"Speichernutzung aktualisieren"})]})]})},S={id:"theme",icon:"üé®",title:"Darstellung & Theme",keywords:["theme","dark","light","schrift","font","animation"],content:t.jsxs("div",{className:j.settingGroup,children:[t.jsxs("div",{className:j.settingItem,children:[t.jsx("div",{className:j.settingLabel,children:"Theme"}),t.jsx("div",{className:j.radioGroup,children:["light","dark","system"].map(T=>t.jsxs("label",{className:q(j.radioOption,e.theme.mode===T&&j["radioOption--active"]),children:[t.jsx("input",{type:"radio",checked:e.theme.mode===T,onChange:()=>J(T)}),T==="light"?"Hell":T==="dark"?"Dunkel":"System"]},T))})]}),t.jsxs("div",{className:j.settingItem,children:[t.jsx("div",{className:j.settingLabel,children:"Schriftgr√∂√üe"}),t.jsx("div",{className:j.radioGroup,children:["small","medium","large","x-large"].map(T=>t.jsxs("label",{className:q(j.radioOption,e.theme.fontScale===T&&j["radioOption--active"]),children:[t.jsx("input",{type:"radio",checked:e.theme.fontScale===T,onChange:()=>Q(T)}),T==="small"?"Klein":T==="medium"?"Mittel":T==="large"?"Gro√ü":"Sehr gro√ü"]},T))})]}),t.jsxs("div",{className:j.toggleGroup,children:[t.jsxs("label",{className:j.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.theme.animationsEnabled,onChange:T=>c(Z=>({...Z,theme:{...Z.theme,animationsEnabled:T.target.checked}}))}),"Animationen aktivieren"]}),t.jsxs("label",{className:j.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.theme.reducedMotion,onChange:T=>c(Z=>({...Z,theme:{...Z.theme,reducedMotion:T.target.checked}}))}),"Reduzierte Bewegungen"]})]})]})},I={id:"audio",icon:"üîä",title:"Audio",keywords:["audio","autoplay","sound"],content:t.jsxs("div",{className:j.settingGroup,children:[t.jsxs("label",{className:j.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.audio.autoPlayEnabled,onChange:T=>X({autoPlayEnabled:T.target.checked})}),"Audio automatisch abspielen (Spanisch)"]}),t.jsx("p",{className:j.settingDescription,children:"Steuert, ob Vokabelkarten automatisch die spanische Aussprache wiedergeben."})]})},W={id:"info",icon:"‚ÑπÔ∏è",title:"Info & Support",keywords:["hilfe","faq","bug","feature","support"],content:t.jsxs("div",{className:j.settingGroup,children:[t.jsxs("div",{className:j.infoCard,children:[t.jsx("div",{children:"Version: 1.0.0"}),t.jsxs("div",{children:["Letzte Aktualisierung: ",new Intl.DateTimeFormat("de-DE").format(new Date)]})]}),t.jsxs("div",{className:j.buttonRow,children:[t.jsx("a",{className:j.linkButton,href:"https://github.com/trsdn/learning-platform#readme",target:"_blank",rel:"noreferrer",children:"üìñ Dokumentation"}),t.jsx("a",{className:j.linkButton,href:"https://github.com/trsdn/learning-platform/issues/new",target:"_blank",rel:"noreferrer",children:"üêõ Bug melden"}),t.jsx("a",{className:j.linkButton,href:"https://github.com/trsdn/learning-platform/issues/new",target:"_blank",rel:"noreferrer",children:"üí° Feature vorschlagen"}),t.jsx("a",{className:j.linkButton,href:"https://github.com/trsdn/learning-platform/discussions",target:"_blank",rel:"noreferrer",children:"‚ùì Hilfe & FAQ"})]}),t.jsx("div",{className:j.settingDescription,children:"Entwickelt von @trsdn ¬∑ Open Source auf GitHub"})]})};return[m,S,I,W]})().filter(m=>C?`${m.title} ${m.keywords.join(" ")}`.toLowerCase().includes(C.toLowerCase()):!0);return t.jsxs("div",{className:j.settingsPage,children:[t.jsxs("header",{className:j.settingsHeader,children:[t.jsxs("div",{className:j.settingsTitle,children:[t.jsx("h1",{children:"‚öôÔ∏è Einstellungen"}),t.jsxs("div",{className:q(j.saveIndicator,n==="saved"&&j["saveIndicator--saved"]),children:[n==="saving"&&"Speichere...",n==="saved"&&"Gespeichert ‚úì",n==="idle"&&e.lastSavedAt&&`Zuletzt gespeichert: ${Tt(e.lastSavedAt)}`]})]}),t.jsx("button",{className:j.closeButton,type:"button",onClick:s,children:"Schlie√üen"})]}),t.jsxs("div",{className:j.searchBar,children:[t.jsx("span",{className:j.searchIcon,children:"üîç"}),t.jsx("input",{className:j.searchInput,type:"search",placeholder:"Einstellungen durchsuchen...",value:C,onChange:m=>D(m.target.value)})]}),t.jsx("div",{className:j.presets,children:It.map(m=>t.jsx("button",{type:"button",className:j.presetButton,onClick:()=>le(m.id),children:m.label},m.id))}),t.jsx("div",{className:j.sections,children:de.map(m=>t.jsx(_i,{icon:m.icon,title:m.title,children:m.content},m.id))}),t.jsxs("footer",{className:j.footerActions,children:[t.jsx("button",{className:j.resetButton,type:"button",onClick:o,children:"Auf Standardwerte zur√ºcksetzen"}),t.jsx("button",{className:j.closeButton,type:"button",onClick:s,children:"Fertig"})]})]})}function _i({icon:s,title:e,children:a}){const[n,c]=p.useState(!0);return t.jsxs("section",{className:j.section,children:[t.jsxs("button",{type:"button",className:j.sectionHeader,onClick:()=>c(o=>!o),"aria-expanded":n,children:[t.jsxs("h2",{children:[t.jsx("span",{className:j.sectionHeaderIcon,children:s}),e]}),t.jsx("span",{className:q(j.sectionCaret,!n&&j["sectionCaret--collapsed"]),children:"‚ñº"})]}),n&&t.jsx("div",{className:j.sectionContent,children:a})]})}const gt="mindforge.website.auth",$e="mindforge.website.attempts",pi=1e3,hi=5,bt=3e5;async function mi(s){if(!s||s.length===0)throw new Error("Passwort darf nicht leer sein.");if(s.length>pi)throw new Error("Passwort ist zu lang.");const a=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function fi(s,e){return await mi(s)===e.toLowerCase()}class gi{isAuthenticated(){try{return localStorage.getItem(gt)==="authenticated"}catch(e){return console.warn("[WebsiteAuth] Failed to check authentication status",e),!1}}setAuthenticated(){try{localStorage.setItem(gt,"authenticated")}catch(e){throw console.error("[WebsiteAuth] Failed to set authentication",e),new Error("Authentifizierung konnte nicht gespeichert werden.")}}clearAuthentication(){try{localStorage.removeItem(gt),localStorage.removeItem($e)}catch(e){console.warn("[WebsiteAuth] Failed to clear authentication",e)}}async authenticate(e,a){this.checkRateLimit();const n=await fi(e,a);return n?(this.setAuthenticated(),this.clearAttempts()):this.recordFailedAttempt(),n}checkRateLimit(){try{const e=localStorage.getItem($e);if(!e)return;const a=JSON.parse(e),c=Date.now()-a.lastAttempt;if(a.count>=hi&&c<bt){const o=Math.ceil((bt-c)/6e4);throw new Error(`Zu viele fehlgeschlagene Versuche. Bitte versuchen Sie es in ${o} Minute(n) erneut.`)}c>=bt&&localStorage.removeItem($e)}catch(e){if(e instanceof Error&&e.message.includes("Zu viele"))throw e;console.warn("[WebsiteAuth] Failed to check rate limit",e)}}recordFailedAttempt(){try{const e=localStorage.getItem($e),a=e?JSON.parse(e):{count:0,lastAttempt:0};a.count+=1,a.lastAttempt=Date.now(),localStorage.setItem($e,JSON.stringify(a))}catch(e){console.warn("[WebsiteAuth] Failed to record failed attempt",e)}}clearAttempts(){try{localStorage.removeItem($e)}catch(e){console.warn("[WebsiteAuth] Failed to clear attempts",e)}}}const bi=new gi;typeof window<"u"&&oe.load();function yi(){const[s,e]=p.useState(!1),[a,n]=p.useState(""),[c,o]=p.useState(!1),[l,y]=p.useState([]),[i,f]=p.useState(null),[k,L]=p.useState([]),[C,D]=p.useState({}),[_,V]=p.useState(null),[P,J]=p.useState(!0),[Q,X]=p.useState(!1),[Y,le]=p.useState(null),[je,fe]=p.useState(!1),[ge,de]=p.useState(!1),[m,S]=p.useState({targetCount:10,includeReview:!0}),[I,W]=p.useState(!1),[T,Z]=p.useState("system"),te=p.useRef(!1);p.useEffect(()=>{const b=bi.isAuthenticated();e(b)},[]),p.useEffect(()=>{te.current||(te.current=!0,Ze())},[]),p.useEffect(()=>{const b=M=>{be(!0).catch($=>console.error("Reseed event failed",$))},E=M=>{ye().catch($=>console.error("Reset event failed",$))};return window.addEventListener("app:database:reseed",b),window.addEventListener("app:database:reset",E),()=>{window.removeEventListener("app:database:reseed",b),window.removeEventListener("app:database:reset",E)}},[]),p.useEffect(()=>{const b=E=>{const M=E.detail;M?.settings?.theme?.mode&&Z(M.settings.theme.mode)};return window.addEventListener("app:settings:updated",b),Z(oe.getSettings().theme.mode),()=>{window.removeEventListener("app:settings:updated",b)}},[]);const qe=()=>{const b=["system","light","dark"],E=b.indexOf(T),M=b[(E+1)%b.length]??"system",$=oe.update(H=>({...H,theme:{...H.theme,mode:M}}));Z($.theme.mode)},Ke=T==="system"?"System":T==="light"?"Hell":"Dunkel";async function Ze(){try{const b=document.querySelector('meta[name="deployment-version"]')?.getAttribute("content"),E=document.querySelector('meta[name="deployment-version"]')?.getAttribute("data-build-time");console.log("üöÄ Deployment Version:",b,"Build Time:",E);const M="2",$=localStorage.getItem("dbVersion"),H=await O.topics.count(),re=await O.tasks.count();console.log(`Database status: ${H} topics, ${re} tasks, version: ${$}`),H===0||re===0||$!==M?(console.log($!==M?`Database version mismatch (${$} -> ${M}), re-seeding...`:"Database empty or incomplete, seeding..."),await At(O),localStorage.setItem("dbVersion",M)):console.log("Database already seeded, skipping seed");const U=await O.topics.toArray();y(U),J(!1)}catch(b){console.error("Failed to initialize app:",b),console.error("Error details:",{name:b?.name,message:b?.message,failures:b?.failures,stack:b?.stack}),J(!1)}}async function ue(b){f(b);const E=await O.learningPaths.where("topicId").equals(b.id).toArray();console.log(`Loading learning paths for topic ${b.id}:`,E),E.sort(($,H)=>new Date(H.createdAt).getTime()-new Date($.createdAt).getTime());const M={};for(const $ of E){const H=await O.tasks.where("learningPathId").equals($.id).toArray();M[$.id]=H.length,console.log(`Learning path "${$.title}" (${$.id}): ${H.length} tasks in DB, taskIds array length: ${$.taskIds?.length||0}`),console.log("Task IDs:",H.map(re=>re.id))}D(M),L(E)}function Ge(b){V(b),de(!0)}function Ne(){de(!1),X(!0)}function He(){de(!1),V(null)}async function ie(){if(X(!1),_&&i){const b=await O.practiceSessions.where("execution.status").equals("completed").reverse().limit(1).toArray();b.length>0&&b[0]&&le(b[0])}}function We(){X(!1),V(null)}function _e(){le(null)}function Ve(){le(null),_&&X(!0)}if(P)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center"},children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{children:"Wird geladen..."})]});if(je)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ca,{onClose:()=>fe(!1)})});if(I)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ui,{onClose:()=>W(!1)})});if(Y)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ta,{session:Y,onClose:_e,onStartNew:Ve})});if(ge&&_&&i)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("button",{onClick:He,style:{padding:"0.5rem 1rem",background:"var(--color-bg-tertiary)",color:"var(--color-text-primary)",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Sitzung konfigurieren"}),t.jsx("p",{style:{color:"var(--color-text-secondary)",marginBottom:"2rem"},children:_.title}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.5rem"},children:"Anzahl der Fragen"}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[5,10,15,20].map(b=>t.jsx("button",{onClick:()=>S({...m,targetCount:b}),style:{padding:"0.75rem 1.5rem",background:m.targetCount===b?"var(--color-primary)":"var(--color-bg-secondary)",color:m.targetCount===b?"var(--color-text-inverse)":"var(--color-text-primary)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:b},b))})]}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:m.includeReview,onChange:b=>S({...m,includeReview:b.target.checked}),style:{marginRight:"0.5rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),t.jsx("span",{children:"Wiederholungsfragen einbeziehen"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)",marginTop:"0.5rem",marginLeft:"1.75rem"},children:"Fragen, die du bereits beantwortet hast und die zur Wiederholung f√§llig sind"})]}),t.jsx("button",{onClick:Ne,style:{padding:"1rem 2rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"500",width:"100%"},children:"Sitzung starten ‚Üí"})]});if(Q&&_&&i)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(Ys,{topicId:i.id,learningPathIds:[_.id],targetCount:m.targetCount,includeReview:m.includeReview,onComplete:ie,onCancel:We})});if(i)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsx("button",{onClick:()=>f(null),style:{padding:"0.5rem 1rem",background:"var(--color-bg-tertiary)",color:"var(--color-text-primary)",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck zu Themen"}),t.jsxs("h1",{children:["üìö ",i.title]}),t.jsx("h2",{style:{marginTop:"2rem",marginBottom:"1rem"},children:"Lernpfade"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1rem"},children:k.map(b=>t.jsxs("div",{style:{padding:"1.5rem",background:"var(--color-bg-primary)",border:"2px solid var(--color-bg-tertiary)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:E=>{E.currentTarget.style.borderColor="var(--color-primary)",E.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:E=>{E.currentTarget.style.borderColor="var(--color-bg-tertiary)",E.currentTarget.style.transform="translateY(0)"},children:[t.jsx("h3",{style:{marginBottom:"0.5rem"},children:b.title}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",marginBottom:"1rem"},children:b.description}),t.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[t.jsx("span",{style:{marginRight:"1rem"},children:b.difficulty==="easy"?"üü¢ Leicht":b.difficulty==="medium"?"üü° Mittel":"üî¥ Schwer"}),t.jsxs("span",{children:[C[b.id]||b.taskIds?.length||0," Aufgaben"]})]}),t.jsx("button",{onClick:()=>Ge(b),style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Lernpfad starten ‚Üí"})]},b.id))})]});async function be(b=!0){try{await O.topics.clear(),await O.learningPaths.clear(),await O.tasks.clear(),await At(O);const E=await O.topics.toArray();y(E);let M;if(navigator.storage?.estimate)try{M=(await navigator.storage.estimate()).usage??void 0}catch(H){console.warn("Storage estimate failed",H)}const $={lastUpdatedAt:new Date().toISOString(),storageUsageBytes:M};window.dispatchEvent(new CustomEvent("app:database:updated",{detail:$})),b&&alert("‚úÖ Datenbank erfolgreich aktualisiert!")}catch(E){console.error("Reseed failed:",E),b&&alert("‚ùå Fehler beim Aktualisieren der Datenbank")}}async function ye(){try{await O.delete(),localStorage.removeItem("dbVersion"),localStorage.removeItem("mindforge.app-settings.v1"),localStorage.removeItem("audioSettings"),window.location.reload()}catch(b){console.error("Reset failed:",b),alert("‚ùå Fehler beim L√∂schen der Daten")}}function ne(b){const E=b.id==="test"?"üéØ":b.id==="mathematik"?"üî¢":b.id==="spanisch"?"üá™üá∏":"üß¨",M=b.id==="test"?"#fef3c7":b.id==="mathematik"?"#dbeafe":b.id==="spanisch"?"#fef3c7":"#dcfce7";return{id:b.id,name:b.title,description:`${b.learningPathIds.length} Lernpfade`,icon:E,color:M}}const Qe=document.querySelector('meta[name="deployment-version"]')?.getAttribute("content")||"unknown";return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{style:{fontSize:"1.1rem",color:"var(--color-text-secondary)",marginTop:"0.5rem"},children:"Erweitere dein Wissen, eine Frage nach der anderen"}),t.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--color-text-tertiary, #999)",marginTop:"0.25rem"},children:["v",Qe]})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsxs("button",{onClick:qe,title:`Theme wechseln (aktuell: ${Ke})`,style:{padding:"0.75rem 1.5rem",background:"var(--color-primary, #667eea)",color:"#ffffff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:["üåì ",Ke]}),t.jsx("button",{onClick:()=>fe(!0),style:{padding:"0.75rem 1.5rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Dashboard"}),t.jsx("button",{onClick:()=>W(!0),style:{padding:"0.75rem 1.5rem",background:"var(--color-info)",color:"var(--color-text-inverse)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"‚öôÔ∏è Einstellungen"})]})]}),t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Themen ausw√§hlen"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1.5rem"},children:l.map(b=>t.jsx(la,{topic:ne(b),onSelect:E=>{const M=l.find($=>$.id===E);M&&ue(M)},"data-testid":`topic-card-${b.id}`},b.id))})]})}yt.createRoot(document.getElementById("root")).render(t.jsx(Fe.StrictMode,{children:t.jsx(yi,{})}));
//# sourceMappingURL=index-DoENcIgS.js.map
