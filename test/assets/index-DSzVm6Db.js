import{r as p,a as es,R as Le}from"./react-DnQQq7lD.js";import{D as ts}from"./storage-7oeF2ZJA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(c){if(c.ep)return;c.ep=!0;const o=a(c);fetch(c.href,o)}})();var Et={exports:{}},tt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ss=p,as=Symbol.for("react.element"),is=Symbol.for("react.fragment"),ns=Object.prototype.hasOwnProperty,rs=ss.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,os={key:!0,ref:!0,__self:!0,__source:!0};function Tt(s,e,a){var n,c={},o=null,l=null;a!==void 0&&(o=""+a),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(l=e.ref);for(n in e)ns.call(e,n)&&!os.hasOwnProperty(n)&&(c[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)c[n]===void 0&&(c[n]=e[n]);return{$$typeof:as,type:s,key:o,ref:l,props:c,_owner:rs.current}}tt.Fragment=is;tt.jsx=Tt;tt.jsxs=Tt;Et.exports=tt;var t=Et.exports,ht={},xt=es;ht.createRoot=xt.createRoot,ht.hydrateRoot=xt.hydrateRoot;class cs extends ts{topics;learningPaths;tasks;answerHistory;userProgress;practiceSessions;spacedRepetition;constructor(){super("mindforge-academy-test"),this.version(1).stores({topics:"id, title, isActive, createdAt",learningPaths:"id, topicId, difficulty, isActive, createdAt",tasks:"id, learningPathId, type, *metadata.tags, metadata.difficulty, createdAt, hasAudio, language",answerHistory:"id, taskId, sessionId, timestamp, isCorrect",userProgress:"id, topicId, learningPathId, *milestones.lastActivity",practiceSessions:"id, execution.status, execution.startedAt, execution.completedAt, createdAt",spacedRepetition:"id, taskId, schedule.nextReview, algorithm.interval, createdAt"})}}const M=new cs;async function ls(){const s=new Map,e=[],a=[],n={mathematik:["algebra-basics.json","geometry-basics.json","advanced-tasks.json","brueche-grundlagen.json"],biologie:["zellbiologie.json","genetik-basics.json"],spanisch:["spanisch-grundlagen.json","begruessung-vorstellung.json","familie-persoenliches.json","zahlen-farben-tiere.json","vokabeltest-karteikarten.json"],test:["all-task-types.json"]};for(const[c,o]of Object.entries(n)){if(!s.has(c)){const l=ds(c);s.set(c,l)}for(const l of o)try{const i=`/learning-platform/test/learning-paths/${c}/${l}`,g=await fetch(i);if(!g.ok){console.warn(`Failed to load ${i}: ${g.status}`);continue}const x=await g.json(),L=x.tasks.map(_=>_.id),C={...x.learningPath,taskIds:L,createdAt:x.learningPath.createdAt?new Date(x.learningPath.createdAt):new Date("2024-01-01"),updatedAt:x.learningPath.createdAt?new Date(x.learningPath.createdAt):new Date("2024-01-01")};e.push(C);const E=s.get(c);E.learningPathIds.includes(C.id)||E.learningPathIds.push(C.id);for(const _ of x.tasks){const W={..._,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")};a.push(W)}}catch(y){console.error(`Failed to load learning path ${c}/${l}:`,y)}}return{topics:Array.from(s.values()),learningPaths:e,tasks:a}}function ds(s){const a={test:{id:"test",title:"Test & Demo",description:"Demonstriert alle Aufgabentypen der Plattform",metadata:{estimatedHours:1,difficultyLevel:"beginner",prerequisites:[]}},mathematik:{id:"mathematik",title:"Mathematik",description:"Grundlagen der Mathematik: Algebra, Geometrie und mehr",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},biologie:{id:"biologie",title:"Biologie",description:"Einf√ºhrung in die Biologie: Zellen, Genetik und √ñkosysteme",metadata:{estimatedHours:35,difficultyLevel:"beginner",prerequisites:[]}},spanisch:{id:"spanisch",title:"Spanisch",description:"Lerne Spanisch: Vokabeln, Grammatik und Konversation",metadata:{estimatedHours:50,difficultyLevel:"beginner",prerequisites:[]}},chemie:{id:"chemie",title:"Chemie",description:"Grundlagen der Chemie: Atome, Molek√ºle und Reaktionen",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},physik:{id:"physik",title:"Physik",description:"Einf√ºhrung in die Physik: Kr√§fte, Energie und Bewegung",metadata:{estimatedHours:45,difficultyLevel:"intermediate",prerequisites:[]}}}[s]||{id:s,title:s.charAt(0).toUpperCase()+s.slice(1),description:`Lernmaterialien f√ºr ${s}`,metadata:{estimatedHours:30,difficultyLevel:"beginner",prerequisites:[]}};return{id:a.id,title:a.title,description:a.description,learningPathIds:[],isActive:!0,metadata:a.metadata,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}}async function wt(s){console.log("üóëÔ∏è Clearing existing database...");const e=await s.topics.count(),a=await s.learningPaths.count(),n=await s.tasks.count();console.log(`Before clear: ${e} topics, ${a} paths, ${n} tasks`),await s.topics.clear(),await s.learningPaths.clear(),await s.tasks.clear();const c=await s.tasks.count();console.log(`After clear: ${c} tasks remaining`),console.log("üìÇ Loading learning paths from JSON files...");const o=await ls();if(o.topics.length===0)throw new Error("No learning paths found in JSON files!");console.log(`Saving to database: ${o.topics.length} topics, ${o.learningPaths.length} learning paths, ${o.tasks.length} tasks`),console.log("Topics:",o.topics.map(g=>g.id)),console.log("Learning paths:",o.learningPaths.map(g=>`${g.id} (${g.taskIds?.length||0} taskIds)`)),console.log("Tasks:",o.tasks.map(g=>`${g.id} (learningPathId: ${g.learningPathId})`));try{await s.topics.bulkAdd(o.topics),console.log("‚úì Topics saved")}catch{console.log("‚ö†Ô∏è Topics exist, using bulkPut to update..."),await s.topics.bulkPut(o.topics),console.log("‚úì Topics updated")}try{await s.learningPaths.bulkAdd(o.learningPaths),console.log("‚úì Learning paths saved")}catch{console.log("‚ö†Ô∏è Learning paths exist, using bulkPut to update..."),await s.learningPaths.bulkPut(o.learningPaths),console.log("‚úì Learning paths updated")}try{await s.tasks.bulkAdd(o.tasks),console.log("‚úì Tasks saved")}catch(g){console.error("‚ùå Error saving tasks with bulkAdd:",g.message),console.log("‚ö†Ô∏è Some tasks already exist, using bulkPut to update...");try{await s.tasks.bulkPut(o.tasks),console.log("‚úì Tasks updated with bulkPut")}catch(x){console.error("‚ùå Error with bulkPut:",x.message)}}console.log(`‚úÖ Loaded from JSON: ${o.topics.length} topics, ${o.learningPaths.length} learning paths, ${o.tasks.length} tasks`);const l=await s.topics.count(),y=await s.learningPaths.count(),i=await s.tasks.count();console.log(`‚úÖ Verified in DB: ${l} topics, ${y} learning paths, ${i} tasks`)}class It extends Error{constructor(e,a,n){super(e),this.code=a,this.context=n,this.name="LearningPlatformError"}}class Ae extends It{constructor(e,a){super(e,"VALIDATION_ERROR",a),this.name="ValidationError"}}class Pe extends It{constructor(e,a){super(`${e} with id ${a} not found`,"NOT_FOUND",{resource:e,id:a}),this.name="NotFoundError"}}class ce{id;configuration;execution;results;createdAt;updatedAt;constructor(e){ce.validate(e),this.id=e.id,this.configuration={...e.configuration,learningPathIds:[...e.configuration.learningPathIds]},this.execution={taskIds:[...e.execution.taskIds],completedCount:e.execution.completedCount,correctCount:e.execution.correctCount,status:e.execution.status,totalTimeSpent:e.execution.totalTimeSpent},e.execution.startedAt&&(this.execution.startedAt=new Date(e.execution.startedAt)),e.execution.completedAt&&(this.execution.completedAt=new Date(e.execution.completedAt)),this.results={...e.results,difficultyDistribution:{...e.results.difficultyDistribution},improvementAreas:[...e.results.improvementAreas]},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.configuration?.targetCount!==void 0&&(e.configuration.targetCount<5||e.configuration.targetCount>50))throw new Ae("Target count must be between 5 and 50",{field:"targetCount",value:e.configuration.targetCount});if(e.execution?.status!==void 0){const a=["planned","active","paused","completed","abandoned"];if(!a.includes(e.execution.status))throw new Ae("Invalid session status",{field:"status",value:e.execution.status,validValues:a})}}static create(e,a,n,c,o){const l={topicId:a,learningPathIds:n,targetCount:o.targetCount,includeReview:o.includeReview};return o.difficultyFilter&&(l.difficultyFilter=o.difficultyFilter),new ce({id:e,configuration:l,execution:{taskIds:c,completedCount:0,correctCount:0,status:"planned",totalTimeSpent:0},results:{accuracy:0,averageTime:0,difficultyDistribution:{},improvementAreas:[]}})}start(){if(this.execution.status!=="planned"&&this.execution.status!=="paused")throw new Error("Can only start planned or paused sessions");this.execution.status="active",this.execution.startedAt||(this.execution.startedAt=new Date),this.updatedAt=new Date}pause(){if(this.execution.status!=="active")throw new Error("Can only pause active sessions");this.execution.status="paused",this.updatedAt=new Date}resume(){if(this.execution.status!=="paused")throw new Error("Can only resume paused sessions");this.execution.status="active",this.updatedAt=new Date}recordAnswer(e,a){if(this.execution.status!=="active")throw new Error("Session must be active to record answers");this.execution.completedCount++,e&&this.execution.correctCount++,this.execution.totalTimeSpent+=a,this.updateResults(),this.updatedAt=new Date}complete(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="completed",this.execution.completedAt=new Date,this.updateResults(),this.updatedAt=new Date}abandon(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="abandoned",this.updatedAt=new Date}updateResults(){this.execution.completedCount>0&&(this.results.accuracy=this.execution.correctCount/this.execution.completedCount*100),this.execution.completedCount>0&&(this.results.averageTime=this.execution.totalTimeSpent/this.execution.completedCount)}getProgress(){return this.execution.completedCount/this.configuration.targetCount*100}isComplete(){return this.execution.completedCount>=this.configuration.targetCount}getRemainingCount(){return Math.max(0,this.configuration.targetCount-this.execution.completedCount)}toJSON(){const e={id:this.id,configuration:{...this.configuration,learningPathIds:[...this.configuration.learningPathIds]},execution:{...this.execution,taskIds:[...this.execution.taskIds]},results:{...this.results,difficultyDistribution:{...this.results.difficultyDistribution},improvementAreas:[...this.results.improvementAreas]},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.configuration.difficultyFilter&&(e.configuration.difficultyFilter=this.configuration.difficultyFilter),this.execution.startedAt&&(e.execution.startedAt=this.execution.startedAt),this.execution.completedAt&&(e.execution.completedAt=this.execution.completedAt),e}static fromJSON(e){return new ce(e)}}class ct{constructor(e,a,n){this.sessionRepository=e,this.taskRepository=a,this.spacedRepRepository=n}async createSession(e){const a=await this.selectTasksForSession(e),n=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c={targetCount:e.targetCount,includeReview:e.includeReview};e.difficultyFilter&&(c.difficultyFilter=e.difficultyFilter);const o=ce.create(n,e.topicId,e.learningPathIds,a,c);return await this.sessionRepository.create(o.toJSON())}async getSession(e){return await this.sessionRepository.getById(e)}async updateSession(e,a){await this.sessionRepository.update(e,a)}async completeSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Pe("PracticeSession",e);const n=ce.fromJSON(a);return n.complete(),await this.sessionRepository.update(e,n.toJSON())}async pauseSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Pe("PracticeSession",e);const n=ce.fromJSON(a);n.pause(),await this.sessionRepository.update(e,n.toJSON())}async resumeSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Pe("PracticeSession",e);const n=ce.fromJSON(a);n.resume(),await this.sessionRepository.update(e,n.toJSON())}async abandonSession(e){const a=await this.sessionRepository.getById(e);if(!a)throw new Pe("PracticeSession",e);const n=ce.fromJSON(a);n.abandon(),await this.sessionRepository.update(e,n.toJSON())}async getActiveSessions(e){return await this.sessionRepository.getActive(e)}async getRecentSessions(e,a){return await this.sessionRepository.getRecent(e,a)}async recordSessionAnswer(e,a,n){const c=await this.sessionRepository.getById(e);if(!c)throw new Pe("PracticeSession",e);const o=ce.fromJSON(c);o.execution.status==="planned"&&o.start(),o.recordAnswer(a,n),o.isComplete()&&o.complete(),await this.sessionRepository.update(e,o.toJSON())}async selectTasksForSession(e){const a=[];let n=e.targetCount;if(console.log(`Selecting tasks: targetCount=${e.targetCount}, learningPaths=${e.learningPathIds.join(",")}`),e.includeReview&&n>0){const c=await this.spacedRepRepository.getDue(new Date),o=c.slice(0,Math.min(c.length,Math.ceil(e.targetCount*.3))).map(l=>l.taskId);console.log(`Review tasks found: ${o.length}`),a.push(...o),n-=o.length}if(n>0){const c={learningPathIds:e.learningPathIds,excludeIds:a};e.difficultyFilter&&(c.difficulty=e.difficultyFilter),console.log(`Requesting ${n} new tasks with filters:`,c);const o=await this.taskRepository.getRandomTasks(n,c);console.log(`Got ${o.length} tasks:`,o.map(l=>l.id)),a.push(...o.map(l=>l.id))}return console.log(`Total selected tasks: ${a.length}`),a}}class De{id;taskId;algorithm;schedule;performance;metadata;createdAt;updatedAt;constructor(e){De.validate(e),this.id=e.id,this.taskId=e.taskId,this.algorithm={...e.algorithm},this.schedule={...e.schedule,nextReview:new Date(e.schedule.nextReview)},e.schedule.lastReviewed&&(this.schedule.lastReviewed=new Date(e.schedule.lastReviewed)),this.performance={...e.performance},this.metadata={...e.metadata,introduced:new Date(e.metadata.introduced)},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.algorithm?.efactor!==void 0&&(e.algorithm.efactor<1.3||e.algorithm.efactor>2.5))throw new Ae("Efactor must be between 1.3 and 2.5",{field:"efactor",value:e.algorithm.efactor});if(e.algorithm?.interval!==void 0&&(e.algorithm.interval<0||e.algorithm.interval>365))throw new Ae("Interval must be between 0 and 365 days",{field:"interval",value:e.algorithm.interval});if(e.performance?.lastGrade!==void 0&&(e.performance.lastGrade<0||e.performance.lastGrade>5))throw new Ae("Grade must be between 0 and 5",{field:"lastGrade",value:e.performance.lastGrade});if(e.performance?.averageAccuracy!==void 0&&(e.performance.averageAccuracy<0||e.performance.averageAccuracy>100))throw new Ae("Average accuracy must be between 0 and 100",{field:"averageAccuracy",value:e.performance.averageAccuracy})}static createNew(e,a){return new De({id:a,taskId:e,algorithm:{interval:1,repetition:0,efactor:2.5},schedule:{nextReview:new Date(Date.now()+24*60*60*1e3),totalReviews:0,consecutiveCorrect:0},performance:{averageAccuracy:0,averageTime:0,difficultyRating:3,lastGrade:0},metadata:{introduced:new Date,graduated:!1,lapseCount:0}})}recordAnswer(e,a){if(e<0||e>5)throw new Ae("Grade must be between 0 and 5",{field:"grade",value:e});if(this.performance.lastGrade=e,this.updateAverageAccuracy(e>=3),this.updateAverageTime(a),this.schedule.totalReviews++,this.schedule.lastReviewed=new Date,e<3)this.algorithm.repetition=0,this.algorithm.interval=1,this.schedule.consecutiveCorrect=0,this.metadata.lapseCount++,this.metadata.graduated=!1;else{this.schedule.consecutiveCorrect++;const n=.1-(5-e)*(.08+(5-e)*.02);this.algorithm.efactor=Math.max(1.3,this.algorithm.efactor+n),this.algorithm.efactor=Math.min(2.5,this.algorithm.efactor),this.algorithm.repetition===0?this.algorithm.interval=1:this.algorithm.repetition===1?this.algorithm.interval=6:this.algorithm.interval=Math.round(this.algorithm.interval*this.algorithm.efactor),this.algorithm.interval=Math.min(365,this.algorithm.interval),this.algorithm.repetition++,this.algorithm.repetition>=2&&(this.metadata.graduated=!0)}this.schedule.nextReview=new Date(Date.now()+this.algorithm.interval*24*60*60*1e3),this.updatedAt=new Date}updateAverageAccuracy(e){const a=this.schedule.totalReviews,c=this.performance.averageAccuracy/100*(a-1)+(e?1:0);this.performance.averageAccuracy=c/a*100}updateAverageTime(e){const a=this.schedule.totalReviews,c=this.performance.averageTime*(a-1)+e;this.performance.averageTime=c/a}isDue(){return this.schedule.nextReview.getTime()<=Date.now()}daysUntilReview(){const e=this.schedule.nextReview.getTime()-Date.now();return Math.ceil(e/(24*60*60*1e3))}toJSON(){const e={id:this.id,taskId:this.taskId,algorithm:{...this.algorithm},schedule:{nextReview:this.schedule.nextReview,totalReviews:this.schedule.totalReviews,consecutiveCorrect:this.schedule.consecutiveCorrect},performance:{...this.performance},metadata:{introduced:this.metadata.introduced,graduated:this.metadata.graduated,lapseCount:this.metadata.lapseCount},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.schedule.lastReviewed&&(e.schedule.lastReviewed=this.schedule.lastReviewed),e}static fromJSON(e){return new De(e)}}class us{constructor(e,a){this.spacedRepRepository=e,this.taskRepository=a}async getNextTasks(e,a){const o=(await this.spacedRepRepository.getDue(new Date)).sort((y,i)=>i.metadata.lapseCount!==y.metadata.lapseCount?i.metadata.lapseCount-y.metadata.lapseCount:y.schedule.nextReview.getTime()-i.schedule.nextReview.getTime()).slice(0,a),l=[];for(const y of o){const i=await this.taskRepository.getById(y.taskId);i&&l.push(i)}return l}async recordAnswer(e,a,n){if(n<0||n>5)throw new Error("Grade must be between 0 and 5");let c=await this.spacedRepRepository.getByTaskId(e);if(!c){const l=De.createNew(e,`sr-${e}-${Date.now()}`);c=await this.spacedRepRepository.create(l.toJSON())}const o=De.fromJSON(c);o.recordAnswer(n,0),await this.spacedRepRepository.update(c.id,o.toJSON())}async getRepetitionData(e){return await this.spacedRepRepository.getByTaskId(e)}async getTasksDue(e){const a=await this.spacedRepRepository.getDue(new Date),n=[];for(const c of a){const o=await this.taskRepository.getById(c.taskId);o&&n.push(o)}return n}async getReviewSchedule(e,a){const n=[],c=new Date;for(let o=0;o<a;o++){const l=new Date(c);l.setDate(l.getDate()+o),l.setHours(23,59,59,999);const y=await this.spacedRepRepository.getByNextReviewDate(l);let i=0;for(const g of y)i+=g.performance.averageTime||3e4;n.push({date:l,taskCount:y.length,estimatedTime:Math.round(i/1e3)})}return n}async rescheduleTask(e,a){const n=await this.spacedRepRepository.getByTaskId(e);if(!n)throw new Pe("SpacedRepetitionItem",e);await this.spacedRepRepository.updateSchedule(n.id,{...n.schedule,nextReview:a})}async getStatistics(e){const a=await this.spacedRepRepository.getAll(),n=await this.spacedRepRepository.getDue(new Date),c=a.filter(y=>y.metadata.graduated).length,o=a.reduce((y,i)=>y+i.algorithm.interval,0),l=a.reduce((y,i)=>y+i.performance.averageAccuracy,0);return{totalItems:a.length,dueToday:n.length,graduated:c,averageInterval:a.length>0?o/a.length:0,averageAccuracy:a.length>0?l/a.length:0}}}class _s{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async search(e){const a=e.toLowerCase();return await this.table.filter(n=>n.title.toLowerCase().includes(a)).toArray()}async getByTitle(e){return null}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class ps{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return await this.table.where("topicId").equals(e).toArray()}async getByDifficulty(e){return await this.table.where("difficulty").equals(e).toArray()}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async searchByTitle(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class hs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByLearningPathId(e){return await this.table.where("learningPathId").equals(e).toArray()}async getRandomTasks(e,a){console.log(`[TaskRepository] getRandomTasks called: count=${e}, filters=`,a);let n;if(a?.learningPathIds?(n=await this.table.where("learningPathId").anyOf(a.learningPathIds).toArray(),console.log(`[TaskRepository] Found ${n.length} tasks for learning paths:`,a.learningPathIds),console.log("[TaskRepository] Task IDs:",n.map(l=>l.id))):(n=await this.table.toArray(),console.log(`[TaskRepository] Found ${n.length} tasks (no filter)`)),a?.excludeIds){const l=n.length;n=n.filter(y=>!a.excludeIds.includes(y.id)),console.log(`[TaskRepository] After excluding IDs: ${l} -> ${n.length} tasks`)}const c=n.sort(()=>Math.random()-.5),o=[];if(c.length===0)return console.log("[TaskRepository] No tasks available!"),o;for(let l=0;l<e;l++){const y=c[l%c.length];y&&o.push(y)}return console.log(`[TaskRepository] Returning ${o.length} tasks (${c.length} unique, repeated to reach ${e})`),o}async getByLearningPathIds(e){return[]}async getByType(e){return[]}async getByDifficulty(e){return[]}async getByTags(e){return[]}async search(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class ms{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return await this.table.where("taskId").equals(e).toArray()}async getBySessionId(e){return await this.table.where("sessionId").equals(e).toArray()}async getByUserId(e,a){return[]}async getByDateRange(e,a){return[]}async getCorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(a=>a.isCorrect).toArray()}async getIncorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(a=>!a.isCorrect).toArray()}async getAccuracyForPeriod(e,a,n){return 0}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class gs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return(await this.table.where("topicId").equals(e).toArray())[0]||null}async getByLearningPathId(e){return(await this.table.where("learningPathId").equals(e).toArray())[0]||null}async getByUserId(e){return[]}async updateStatistics(e,a){}async incrementTaskCount(e,a){}async updateStreak(e,a){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class fs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(e){return await this.table.where("execution.status").anyOf(["planned","active","paused"]).toArray()}async getRecent(e,a){return await this.table.orderBy("createdAt").reverse().limit(a).toArray()}async getByStatus(e){return await this.table.where("execution.status").equals(e).toArray()}async getByUserId(e){return[]}async getByDateRange(e,a){return[]}async updateStatus(e,a){}async incrementProgress(e,a,n){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class bs{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,a){return await this.table.update(e,a),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return(await this.table.where("taskId").equals(e).toArray())[0]||null}async getDue(e){return await this.table.where("schedule.nextReview").belowOrEqual(e).toArray()}async getByNextReviewDate(e){return[]}async updateAlgorithmData(e,a){}async updateSchedule(e,a){}async updatePerformance(e,a){}async getReviewCalendar(e,a){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class mt{static topicRepo;static learningPathRepo;static taskRepo;static answerHistoryRepo;static userProgressRepo;static practiceSessionRepo;static spacedRepetitionRepo;static getTopicRepository(){return this.topicRepo||(this.topicRepo=new _s(M.topics)),this.topicRepo}static getLearningPathRepository(){return this.learningPathRepo||(this.learningPathRepo=new ps(M.learningPaths)),this.learningPathRepo}static getTaskRepository(){return this.taskRepo||(this.taskRepo=new hs(M.tasks)),this.taskRepo}static getAnswerHistoryRepository(){return this.answerHistoryRepo||(this.answerHistoryRepo=new ms(M.answerHistory)),this.answerHistoryRepo}static getUserProgressRepository(){return this.userProgressRepo||(this.userProgressRepo=new gs(M.userProgress)),this.userProgressRepo}static getPracticeSessionRepository(){return this.practiceSessionRepo||(this.practiceSessionRepo=new fs(M.practiceSessions)),this.practiceSessionRepo}static getSpacedRepetitionRepository(){return this.spacedRepetitionRepo||(this.spacedRepetitionRepo=new bs(M.spacedRepetition)),this.spacedRepetitionRepo}static reset(){this.topicRepo=null,this.learningPathRepo=null,this.taskRepo=null,this.answerHistoryRepo=null,this.userProgressRepo=null,this.practiceSessionRepo=null,this.spacedRepetitionRepo=null}}const Ke=()=>mt.getTaskRepository(),lt=()=>mt.getPracticeSessionRepository(),Qe=()=>mt.getSpacedRepetitionRepository(),dt={audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null},ys=500,vs=2048,xs=100;class ws{audio=null;state={...dt};stateListeners=new Set;preloadedAudio=null;autoPlayTimer=null;lastPlayTime=0;async initialize(){this.setState({...dt})}async loadAudio(e,a,n){if(this.stop(),this.clearAutoPlayTimer(),!e.audioUrl)throw new Error("Task does not have an audio URL");if(!this.validateAudioUrl(e.audioUrl))throw new Error("Invalid audio URL");this.audio=new Audio(e.audioUrl),this.setState({audioUrl:e.audioUrl,status:"loading",currentTime:0,duration:0,autoPlayUnlocked:this.state.autoPlayUnlocked,preloadedNextUrl:this.state.preloadedNextUrl,error:null}),this.audio.addEventListener("loadedmetadata",()=>{this.audio&&this.setState({...this.state,duration:this.audio.duration,status:"stopped"})}),this.audio.addEventListener("timeupdate",()=>{this.audio&&this.state.status==="playing"&&this.setState({...this.state,currentTime:this.audio.currentTime})}),this.audio.addEventListener("ended",()=>{this.setState({...this.state,status:"stopped",currentTime:0})}),this.audio.addEventListener("error",o=>{this.setState({...this.state,status:"error",error:`Failed to load audio: ${o.message||"Unknown error"}`})}),this.audio.load(),n&&this.state.autoPlayUnlocked&&(this.autoPlayTimer=window.setTimeout(async()=>{try{await this.play()}catch(o){console.error("Auto-play failed:",o)}},ys))}async play(){if(!this.audio)throw new Error("No audio loaded");const e=Date.now();if(e-this.lastPlayTime<xs){console.warn("Rate limit: Too many play() calls. Please wait.");return}this.lastPlayTime=e;try{await this.audio.play(),this.setState({...this.state,status:"playing"})}catch(n){throw n.name==="NotAllowedError"&&this.setState({...this.state,status:"error",error:"Auto-play blocked by browser. Please click to enable audio."}),n}}pause(){this.audio&&(this.audio.pause(),this.setState({...this.state,status:"paused",currentTime:this.audio.currentTime}))}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.setState({...this.state,status:"stopped",currentTime:0}))}async replay(){if(!this.audio)throw new Error("No audio loaded");this.audio.currentTime=0,await this.play()}async togglePlayPause(){this.state.status==="playing"?this.pause():(this.state.status==="paused"||this.state.status==="stopped")&&await this.play()}preloadNext(e){e.audioUrl&&(this.preloadedAudio=new Audio(e.audioUrl),this.preloadedAudio.preload="auto",this.setState({...this.state,preloadedNextUrl:e.audioUrl}))}async checkAutoPlayPermission(){return this.state.autoPlayUnlocked}async unlockAutoPlay(){return this.setState({...this.state,autoPlayUnlocked:!0}),!0}getPlaybackState(){return{...this.state}}onStateChange(e){return this.stateListeners.add(e),()=>{this.stateListeners.delete(e)}}dispose(){this.clearAutoPlayTimer(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null),this.preloadedAudio&&(this.preloadedAudio.src="",this.preloadedAudio=null),this.setState({...dt}),this.stateListeners.clear()}setState(e){this.state=e,this.stateListeners.forEach(a=>{a(e)})}clearAutoPlayTimer(){this.autoPlayTimer!==null&&(window.clearTimeout(this.autoPlayTimer),this.autoPlayTimer=null)}validateAudioUrl(e){return e.length>vs?(console.warn("Audio URL exceeds maximum length"),!1):e.startsWith("/audio/")||e.includes("/audio/")||e.startsWith("data:audio/")?!0:(console.warn("Audio URL must contain /audio/ or start with data:audio/",e),!1)}}function ks(){return new ws}function Ss(){const s=p.useRef(null),[e,a]=p.useState({audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null});return p.useEffect(()=>{const C=ks();s.current=C,C.initialize().catch(_=>{console.error("Failed to initialize audio service:",_)});const E=C.onStateChange(_=>{a(_)});return()=>{C.stop(),E(),C.dispose(),s.current=null}},[]),{playbackState:e,loadAudio:async(C,E,_)=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.loadAudio(C,E,_)},play:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.play()},pause:()=>{s.current?.pause()},stop:()=>{s.current?.stop()},replay:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.replay()},togglePlayPause:async()=>{if(!s.current)throw new Error("Audio service not initialized");await s.current.togglePlayPause()},preloadNext:C=>{s.current?.preloadNext(C)},checkAutoPlayPermission:async()=>s.current?s.current.checkAutoPlayPermission():!1,unlockAutoPlay:async()=>s.current?s.current.unlockAutoPlay():!1}}const je={version:2,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1};function ut(s){const e=s;if(typeof e.autoPlayEnabled!="boolean")throw new Error("autoPlayEnabled must be boolean");if(!["non-German only","all languages","none"].includes(e.languageFilter))throw new Error(`Invalid languageFilter value: ${e.languageFilter}`);if(e.perTopicOverrides&&typeof e.perTopicOverrides!="object")throw new Error("perTopicOverrides must be object");if(typeof e.accessibilityMode!="boolean")throw new Error("accessibilityMode must be boolean");if(typeof e.version!="number"||e.version<1)throw new Error("version must be positive integer");return e}const Ge="audioSettings",js=500;class As{saveTimer=null;load(){try{const e=localStorage.getItem(Ge);if(!e)return{...je};const a=JSON.parse(e);return a.version!==je.version?this.migrate(a):ut(a)}catch(e){return console.error("Failed to load audio settings, using defaults:",e),{...je}}}save(e){try{ut(e),this.saveTimer!==null&&window.clearTimeout(this.saveTimer),typeof globalThis.describe=="function"&&typeof globalThis.it=="function"?localStorage.setItem(Ge,JSON.stringify(e)):this.saveTimer=window.setTimeout(()=>{localStorage.setItem(Ge,JSON.stringify(e)),this.saveTimer=null},js)}catch(a){throw console.error("Failed to save audio settings:",a),a}}update(e){const a=this.load(),n={...a,...e,version:e.version??a.version,perTopicOverrides:{...a.perTopicOverrides,...e.perTopicOverrides??{}}};this.save(n)}reset(){localStorage.removeItem(Ge)}exists(){return localStorage.getItem(Ge)!==null}migrate(e){const a={version:2,autoPlayEnabled:e.version===1?!0:e.autoPlayEnabled??je.autoPlayEnabled,languageFilter:e.languageFilter??je.languageFilter,perTopicOverrides:e.perTopicOverrides??{},accessibilityMode:e.accessibilityMode??je.accessibilityMode};try{return ut(a),this.save(a),a}catch(n){return console.error("Migration failed, using defaults:",n),{...je}}}}function Ns(){return new As}function Pt(){const s=p.useRef(null),[e,a]=p.useState(null),[n,c]=p.useState(!1);return p.useEffect(()=>{const y=Ns();s.current=y;const i=y.load();a(i),c(!0)},[]),{settings:e||{version:1,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1},updateSettings:y=>{if(!s.current||!e){console.warn("Audio settings not loaded yet");return}s.current.update(y);const i=s.current.load();a(i)},resetSettings:()=>{if(!s.current){console.warn("Audio settings not loaded yet");return}s.current.reset();const y=s.current.load();a(y)},isLoaded:n}}function Rs(s,e){if(!s.hasAudio||!s.audioUrl||!e.autoPlayEnabled)return!1;const a=s.language||"German";switch(e.languageFilter){case"none":return!1;case"all languages":return!0;case"non-German only":return a!=="German";default:return!1}}const _t=new Map;async function Cs(s){if(_t.has(s))return _t.get(s);try{const e=await fetch(`/learning-platform/templates/${s}.json`);if(!e.ok)return console.warn(`Template ${s} not found`),null;const a=await e.json();return _t.set(s,a),a}catch(e){return console.error(`Failed to load template ${s}:`,e),null}}async function Es(s){return(await Cs(s))?.audioConfig||null}function Dt(s){var e,a,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var c=s.length;for(e=0;e<c;e++)s[e]&&(a=Dt(s[e]))&&(n&&(n+=" "),n+=a)}else for(a in s)s[a]&&(n&&(n+=" "),n+=a);return n}function U(){for(var s,e,a=0,n="",c=arguments.length;a<c;a++)(s=arguments[a])&&(e=Dt(s))&&(n&&(n+=" "),n+=e);return n}const Ts="_pulse_1m38x_1",_e={"audio-button":"_audio-button_1m38x_4","audio-button--disabled":"_audio-button--disabled_1m38x_15","audio-button--small":"_audio-button--small_1m38x_24","audio-button--medium":"_audio-button--medium_1m38x_29","audio-button--large":"_audio-button--large_1m38x_34","audio-button--playing":"_audio-button--playing_1m38x_52","audio-button--active":"_audio-button--active_1m38x_59","audio-button__icon":"_audio-button__icon_1m38x_69","audio-button__icon--playing":"_audio-button__icon--playing_1m38x_73",pulse:Ts,"audio-button-inline":"_audio-button-inline_1m38x_88"},kt=({size:s})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:s,height:s},children:t.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),Is=({size:s})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:s,height:s},children:t.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),Ps=({text:s,audioUrl:e,className:a,disabled:n=!1,size:c="medium"})=>{const[o,l]=p.useState(!1),[y,i]=p.useState(null),g=p.useRef(null),x=!!e,L=async()=>{if(!(n||!x||!e)){i(null);try{g.current||(g.current=new Audio(e),g.current.addEventListener("ended",()=>l(!1)),g.current.addEventListener("error",()=>{i("Audio playback failed"),l(!1)})),g.current.currentTime=0,l(!0),await g.current.play()}catch(_){console.error("Failed to play audio:",_),i("Audio playback failed"),l(!1)}}},C={small:"16px",medium:"20px",large:"24px"},E=n||!x;return t.jsx("span",{onClick:E?void 0:L,className:U(_e["audio-button"],_e[`audio-button--${c}`],E&&_e["audio-button--disabled"],o&&_e["audio-button--playing"],!E&&!o&&_e["audio-button--active"],a),title:x?o?"Spielt ab...":`Aussprache abspielen: ${s}`:"Audio nicht verf√ºgbar","aria-label":`Spanische Aussprache f√ºr ${s} abspielen`,role:"button",tabIndex:E?-1:0,onKeyDown:_=>{!E&&(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),L())},children:o?t.jsx("div",{className:U(_e["audio-button__icon"],_e["audio-button__icon--playing"]),children:t.jsx(kt,{size:C[c]})}):!x||y?t.jsx("div",{className:_e["audio-button__icon"],children:t.jsx(Is,{size:C[c]})}):t.jsx("div",{className:_e["audio-button__icon"],children:t.jsx(kt,{size:C[c]})})})},be=p.memo(Ps),Ds="_card_1cbjp_4",Ee={card:Ds,"card--shadow":"_card--shadow_1cbjp_11","card--no-shadow":"_card--no-shadow_1cbjp_15","card--border":"_card--border_1cbjp_20","card--no-border":"_card--no-border_1cbjp_24","card--padding-small":"_card--padding-small_1cbjp_29","card--padding-medium":"_card--padding-medium_1cbjp_33","card--padding-large":"_card--padding-large_1cbjp_37"};function Ne({padding:s="medium",shadow:e=!0,border:a=!0,borderColor:n,backgroundColor:c,children:o,className:l,style:y,...i}){const g={...c&&{backgroundColor:c},...n&&{borderColor:n},...y};return t.jsx("div",{...i,style:g,className:U(Ee.card,Ee[`card--padding-${s}`],e?Ee["card--shadow"]:Ee["card--no-shadow"],a?Ee["card--border"]:Ee["card--no-border"],l),children:o})}const O={primary:{500:"#3b82f6"},success:{100:"#dcfce7",300:"#86efac",500:"#10b981"},error:{100:"#fee2e2",300:"#fca5a5",500:"#ef4444"},warning:{100:"#fef3c7",400:"#fbbf24",500:"#f59e0b"},info:{100:"#f3e8ff",300:"#d8b4fe",500:"#8b5cf6"}},K={feedback:{success:O.success[500],successLight:O.success[100],successBorder:O.success[300],error:O.error[500],errorLight:O.error[100],errorBorder:O.error[300],warning:O.warning[500],warningLight:O.warning[100],warningBorder:O.warning[400],info:O.info[500],infoLight:O.info[100],infoBorder:O.info[300]}},ye={"feedback-content":"_feedback-content_1oyn0_4","feedback-icon":"_feedback-icon_1oyn0_11","feedback-text":"_feedback-text_1oyn0_19","feedback-title":"_feedback-title_1oyn0_24","feedback-message":"_feedback-message_1oyn0_32","feedback-children":"_feedback-children_1oyn0_39","feedback-dismiss":"_feedback-dismiss_1oyn0_45","feedback--success":"_feedback--success_1oyn0_62","feedback--error":"_feedback--error_1oyn0_71","feedback--warning":"_feedback--warning_1oyn0_80","feedback--info":"_feedback--info_1oyn0_89"};function Ls({variant:s,title:e,message:a,dismissible:n=!1,onDismiss:c,children:o,className:l,style:y,...i}){const g=Le.useMemo(()=>zs(s),[s]),x=Le.useMemo(()=>Bs(s),[s]);return t.jsx(Ne,{...i,padding:"medium",shadow:!1,border:!0,borderColor:g.border,backgroundColor:g.background,style:y,className:U(ye[`feedback--${s}`],l),role:s==="error"||s==="warning"?"alert":"status","aria-live":s==="error"||s==="warning"?"assertive":"polite","aria-atomic":"true",children:t.jsxs("div",{className:ye["feedback-content"],children:[t.jsx("div",{className:ye["feedback-icon"],"aria-hidden":"true",children:x}),t.jsxs("div",{className:ye["feedback-text"],children:[e&&t.jsx("h4",{className:ye["feedback-title"],children:e}),o?t.jsx("div",{className:ye["feedback-children"],children:o}):a&&t.jsx("p",{className:ye["feedback-message"],children:a})]}),n&&c&&t.jsx("button",{onClick:c,className:ye["feedback-dismiss"],"aria-label":`Dismiss ${s} message`,children:t.jsx("span",{"aria-hidden":"true",children:"‚úï"})})]})})}function zs(s){switch(s){case"success":return{background:K.feedback.successLight,border:K.feedback.successBorder,text:K.feedback.success};case"error":return{background:K.feedback.errorLight,border:K.feedback.errorBorder,text:K.feedback.error};case"warning":return{background:K.feedback.warningLight,border:K.feedback.warningBorder,text:K.feedback.warning};case"info":return{background:K.feedback.infoLight,border:K.feedback.infoBorder,text:K.feedback.info};default:return{background:K.feedback.infoLight,border:K.feedback.infoBorder,text:K.feedback.info}}}function Bs(s){switch(s){case"success":return"‚úì";case"error":return"‚úó";case"warning":return"‚ö†";case"info":return"‚Ñπ";default:return"‚Ñπ"}}const $s="_input_1krva_4",pe={"input-wrapper":"_input-wrapper_1krva_4","input-wrapper--full-width":"_input-wrapper--full-width_1krva_8",input:$s,"input--full-width":"_input--full-width_1krva_27","input--error":"_input--error_1krva_40","input--success":"_input--success_1krva_46","input__helper-text--error":"_input__helper-text--error_1krva_72","input__helper-text--success":"_input__helper-text--success_1krva_76"};function St({value:s,onChange:e,error:a=!1,success:n=!1,helperText:c,fullWidth:o=!1,disabled:l=!1,className:y,style:i,id:g,...x}){const L=c?`${g||"input"}-helper`:void 0;return t.jsxs("div",{className:U(pe["input-wrapper"],o&&pe["input-wrapper--full-width"]),children:[t.jsx("input",{...x,id:g,type:"text",value:s,onChange:e,disabled:l,style:i,className:U(pe.input,o&&pe["input--full-width"],a&&pe["input--error"],n&&pe["input--success"],y),"aria-invalid":a?"true":"false","aria-describedby":L}),c&&t.jsx("div",{id:L,className:U(pe.input__helper_text,a&&pe["input__helper-text--error"],n&&pe["input__helper-text--success"]),children:c})]})}const Ms="_checkbox_uclkx_4",Os="_checkbox__checkmark_uclkx_83",Fs="_checkbox__label_uclkx_101",ie={"checkbox-container":"_checkbox-container_uclkx_4","checkbox-container--disabled":"_checkbox-container--disabled_uclkx_11","checkbox-wrapper":"_checkbox-wrapper_uclkx_16",checkbox:Ms,"checkbox--with-label":"_checkbox--with-label_uclkx_35","checkbox--error":"_checkbox--error_uclkx_55","checkbox--success":"_checkbox--success_uclkx_66",checkbox__checkmark:Os,"checkbox__checkmark--visible":"_checkbox__checkmark--visible_uclkx_96",checkbox__label:Fs,"checkbox__label--disabled":"_checkbox__label--disabled_uclkx_107"};function Us({checked:s,onChange:e,label:a,error:n=!1,success:c=!1,disabled:o=!1,className:l,style:y,id:i,...g}){const x=Le.useId(),L=i||`checkbox-${x}`;return t.jsxs("label",{htmlFor:L,style:y,className:U(ie["checkbox-container"],o&&ie["checkbox-container--disabled"],l),children:[t.jsxs("div",{className:ie["checkbox-wrapper"],children:[t.jsx("input",{...g,type:"checkbox",id:L,checked:s,onChange:e,disabled:o,className:U(ie.checkbox,a&&ie["checkbox--with-label"],n&&ie["checkbox--error"],c&&ie["checkbox--success"]),"aria-checked":s,"aria-invalid":n}),t.jsx("div",{className:U(ie.checkbox__checkmark,s&&ie["checkbox__checkmark--visible"])})]}),a&&t.jsx("span",{className:U(ie.checkbox__label,o&&ie["checkbox__label--disabled"]),children:a})]})}const qs="_select_1bjtk_4",Ze={select:qs,"select--full-width":"_select--full-width_1bjtk_23","select--error":"_select--error_1bjtk_36","select--success":"_select--success_1bjtk_42"};function Gs({value:s,onChange:e,options:a,disabled:n=!1,placeholder:c,error:o=!1,success:l=!1,fullWidth:y=!1,className:i,style:g,id:x}){return t.jsxs("select",{id:x,value:s,onChange:L=>e(L.target.value),disabled:n,style:g,className:U(Ze.select,y&&Ze["select--full-width"],o&&Ze["select--error"],l&&Ze["select--success"],i),"aria-invalid":o?"true":"false",children:[c&&t.jsx("option",{value:"",disabled:!0,children:c}),a.map(L=>t.jsx("option",{value:L.value,disabled:L.disabled,children:L.label},L.value))]})}const he={"slider-container":"_slider-container_1ivuv_4","slider-track":"_slider-track_1ivuv_12","slider-fill":"_slider-fill_1ivuv_22","slider-fill--disabled":"_slider-fill--disabled_1ivuv_32","slider-input":"_slider-input_1ivuv_37","slider-thumb":"_slider-thumb_1ivuv_52","slider-thumb--disabled":"_slider-thumb--disabled_1ivuv_67","slider-value-display":"_slider-value-display_1ivuv_72","slider-value-display__current":"_slider-value-display__current_1ivuv_80"};function Hs({value:s,onChange:e,min:a,max:n,step:c=1,disabled:o=!1,unit:l="",showValue:y=!0,className:i,style:g,id:x,"aria-label":L}){const C=(s-a)/(n-a)*100;return t.jsxs("div",{style:g,className:U(he["slider-container"],i),children:[t.jsxs("div",{className:he["slider-track"],children:[t.jsx("div",{className:U(he["slider-fill"],o&&he["slider-fill--disabled"]),style:{width:`${C}%`}}),t.jsx("div",{className:U(he["slider-thumb"],o&&he["slider-thumb--disabled"]),style:{left:`calc(${C}% - 12px)`}}),t.jsx("input",{type:"range",id:x,min:a,max:n,step:c,value:s,onChange:E=>e(Number(E.target.value)),disabled:o,className:he["slider-input"],"aria-label":L,"aria-valuenow":s,"aria-valuemin":a,"aria-valuemax":n,"aria-valuetext":`${s}${l}`})]}),y&&t.jsxs("div",{className:he["slider-value-display"],children:[t.jsxs("span",{children:[a,l]}),t.jsxs("span",{className:he["slider-value-display__current"],children:[s,l]}),t.jsxs("span",{children:[n,l]})]})]})}const r={"practice-session":"_practice-session_elovc_3","practice-session__header":"_practice-session__header_elovc_14","practice-session__header-top":"_practice-session__header-top_elovc_19","practice-session__header-left":"_practice-session__header-left_elovc_26","practice-session__title":"_practice-session__title_elovc_32","practice-session__task-counter":"_practice-session__task-counter_elovc_37","practice-session__task-id":"_practice-session__task-id_elovc_42","practice-session__cancel-btn":"_practice-session__cancel-btn_elovc_48","practice-session__progress-bar":"_practice-session__progress-bar_elovc_58","practice-session__progress-fill":"_practice-session__progress-fill_elovc_66","practice-session__question-area":"_practice-session__question-area_elovc_74","practice-session__question-header":"_practice-session__question-header_elovc_85","practice-session__question-text":"_practice-session__question-text_elovc_92","practice-session__mc-options":"_practice-session__mc-options_elovc_101","practice-session__mc-option":"_practice-session__mc-option_elovc_101","practice-session__mc-option--focused":"_practice-session__mc-option--focused_elovc_125","practice-session__mc-option--selected":"_practice-session__mc-option--selected_elovc_130","practice-session__mc-option--correct":"_practice-session__mc-option--correct_elovc_135","practice-session__mc-option--incorrect":"_practice-session__mc-option--incorrect_elovc_140","practice-session__mc-option--disabled":"_practice-session__mc-option--disabled_elovc_145","practice-session__cloze-container":"_practice-session__cloze-container_elovc_151","practice-session__cloze-text":"_practice-session__cloze-text_elovc_156","practice-session__cloze-input":"_practice-session__cloze-input_elovc_161","practice-session__cloze-feedback":"_practice-session__cloze-feedback_elovc_167","practice-session__cloze-feedback-title":"_practice-session__cloze-feedback-title_elovc_174","practice-session__cloze-answer":"_practice-session__cloze-answer_elovc_181","practice-session__cloze-answer--correct":"_practice-session__cloze-answer--correct_elovc_186","practice-session__cloze-answer--neutral":"_practice-session__cloze-answer--neutral_elovc_190","practice-session__cloze-answer-correct":"_practice-session__cloze-answer-correct_elovc_194","practice-session__cloze-alternatives":"_practice-session__cloze-alternatives_elovc_198","practice-session__tf-container":"_practice-session__tf-container_elovc_205","practice-session__tf-statement":"_practice-session__tf-statement_elovc_213","practice-session__tf-buttons":"_practice-session__tf-buttons_elovc_219","practice-session__tf-button":"_practice-session__tf-button_elovc_219","practice-session__tf-button--selected":"_practice-session__tf-button--selected_elovc_236","practice-session__tf-button--correct":"_practice-session__tf-button--correct_elovc_241","practice-session__tf-button--incorrect":"_practice-session__tf-button--incorrect_elovc_246","practice-session__tf-button--disabled":"_practice-session__tf-button--disabled_elovc_251","practice-session__ordering-container":"_practice-session__ordering-container_elovc_257","practice-session__ordering-instruction":"_practice-session__ordering-instruction_elovc_262","practice-session__ordering-items":"_practice-session__ordering-items_elovc_268","practice-session__ordering-item":"_practice-session__ordering-item_elovc_268","practice-session__ordering-item--correct":"_practice-session__ordering-item--correct_elovc_284","practice-session__ordering-item-number":"_practice-session__ordering-item-number_elovc_289","practice-session__ordering-item-text":"_practice-session__ordering-item-text_elovc_295","practice-session__ordering-word":"_practice-session__ordering-word_elovc_302","practice-session__ordering-hint":"_practice-session__ordering-hint_elovc_306","practice-session__ordering-controls":"_practice-session__ordering-controls_elovc_312","practice-session__ordering-btn":"_practice-session__ordering-btn_elovc_317","practice-session__ordering-feedback":"_practice-session__ordering-feedback_elovc_325","practice-session__ordering-feedback-title":"_practice-session__ordering-feedback-title_elovc_332","practice-session__ordering-feedback-item":"_practice-session__ordering-feedback-item_elovc_339","practice-session__matching-container":"_practice-session__matching-container_elovc_347","practice-session__matching-instruction":"_practice-session__matching-instruction_elovc_352","practice-session__matching-grid":"_practice-session__matching-grid_elovc_358","practice-session__matching-left-item":"_practice-session__matching-left-item_elovc_364","practice-session__matching-feedback":"_practice-session__matching-feedback_elovc_375","practice-session__matching-feedback-title":"_practice-session__matching-feedback-title_elovc_382","practice-session__matching-feedback-item":"_practice-session__matching-feedback-item_elovc_389","practice-session__ms-container":"_practice-session__ms-container_elovc_397","practice-session__ms-instruction":"_practice-session__ms-instruction_elovc_402","practice-session__ms-options":"_practice-session__ms-options_elovc_408","practice-session__ms-option":"_practice-session__ms-option_elovc_408","practice-session__ms-option--focused":"_practice-session__ms-option--focused_elovc_425","practice-session__ms-option--selected":"_practice-session__ms-option--selected_elovc_430","practice-session__ms-option--correct":"_practice-session__ms-option--correct_elovc_435","practice-session__ms-option--incorrect":"_practice-session__ms-option--incorrect_elovc_440","practice-session__ms-option-label":"_practice-session__ms-option-label_elovc_445","practice-session__ms-status-icon":"_practice-session__ms-status-icon_elovc_450","practice-session__ms-status-icon--correct":"_practice-session__ms-status-icon--correct_elovc_456","practice-session__ms-status-icon--incorrect":"_practice-session__ms-status-icon--incorrect_elovc_460","practice-session__slider-container":"_practice-session__slider-container_elovc_466","practice-session__slider-value-display":"_practice-session__slider-value-display_elovc_474","practice-session__slider-value":"_practice-session__slider-value_elovc_474","practice-session__slider-value--correct":"_practice-session__slider-value--correct_elovc_484","practice-session__slider-value--incorrect":"_practice-session__slider-value--incorrect_elovc_488","practice-session__slider-wrapper":"_practice-session__slider-wrapper_elovc_492","practice-session__slider-feedback":"_practice-session__slider-feedback_elovc_496","practice-session__slider-feedback-text":"_practice-session__slider-feedback-text_elovc_503","practice-session__slider-correct-value":"_practice-session__slider-correct-value_elovc_509","practice-session__slider-tolerance":"_practice-session__slider-tolerance_elovc_514","practice-session__scramble-container":"_practice-session__scramble-container_elovc_521","practice-session__scramble-display":"_practice-session__scramble-display_elovc_529","practice-session__scramble-label":"_practice-session__scramble-label_elovc_536","practice-session__scramble-word":"_practice-session__scramble-word_elovc_542","practice-session__scramble-length":"_practice-session__scramble-length_elovc_550","practice-session__scramble-input-label":"_practice-session__scramble-input-label_elovc_556","practice-session__scramble-input":"_practice-session__scramble-input_elovc_556","practice-session__scramble-input--correct":"_practice-session__scramble-input--correct_elovc_575","practice-session__scramble-input--incorrect":"_practice-session__scramble-input--incorrect_elovc_580","practice-session__scramble-feedback":"_practice-session__scramble-feedback_elovc_585","practice-session__scramble-feedback-label":"_practice-session__scramble-feedback-label_elovc_592","practice-session__scramble-feedback-word":"_practice-session__scramble-feedback-word_elovc_599","practice-session__flashcard-container":"_practice-session__flashcard-container_elovc_607","practice-session__flashcard":"_practice-session__flashcard_elovc_607","practice-session__flashcard-lang":"_practice-session__flashcard-lang_elovc_635","practice-session__flashcard-front":"_practice-session__flashcard-front_elovc_643","practice-session__flashcard-reveal-btn":"_practice-session__flashcard-reveal-btn_elovc_656","practice-session__flashcard-divider":"_practice-session__flashcard-divider_elovc_674","practice-session__flashcard-back":"_practice-session__flashcard-back_elovc_681","practice-session__flashcard-assessment":"_practice-session__flashcard-assessment_elovc_694","practice-session__flashcard-btn":"_practice-session__flashcard-btn_elovc_702","practice-session__flashcard-btn--unknown":"_practice-session__flashcard-btn--unknown_elovc_716","practice-session__flashcard-btn--known":"_practice-session__flashcard-btn--known_elovc_727","practice-session__flashcard-icon":"_practice-session__flashcard-icon_elovc_738","practice-session__flashcard-explanation":"_practice-session__flashcard-explanation_elovc_742","practice-session__text-input-container":"_practice-session__text-input-container_elovc_755","practice-session__text-input-wrapper":"_practice-session__text-input-wrapper_elovc_763","practice-session__text-input":"_practice-session__text-input_elovc_755","practice-session__text-input-feedback":"_practice-session__text-input-feedback_elovc_775","practice-session__hint-controls":"_practice-session__hint-controls_elovc_796","practice-session__hint-button":"_practice-session__hint-button_elovc_802","practice-session__hint":"_practice-session__hint_elovc_796","practice-session__shortcuts-overlay":"_practice-session__shortcuts-overlay_elovc_826","practice-session__shortcuts-content":"_practice-session__shortcuts-content_elovc_837","practice-session__shortcuts-groups":"_practice-session__shortcuts-groups_elovc_852","practice-session__shortcuts-group-title":"_practice-session__shortcuts-group-title_elovc_857","practice-session__shortcuts-list":"_practice-session__shortcuts-list_elovc_862","practice-session__shortcut-item":"_practice-session__shortcut-item_elovc_870","practice-session__shortcut-keys":"_practice-session__shortcut-keys_elovc_877","practice-session__shortcuts-close":"_practice-session__shortcuts-close_elovc_885","practice-session__feedback":"_practice-session__feedback_elovc_935","practice-session__footer":"_practice-session__footer_elovc_942","practice-session__actions":"_practice-session__actions_elovc_949","practice-session__btn-submit":"_practice-session__btn-submit_elovc_955","practice-session__btn-submit--enabled":"_practice-session__btn-submit--enabled_elovc_964","practice-session__btn-submit--disabled":"_practice-session__btn-submit--disabled_elovc_969","practice-session__btn-skip":"_practice-session__btn-skip_elovc_974","practice-session__btn-next":"_practice-session__btn-next_elovc_985","practice-session__stats":"_practice-session__stats_elovc_998","practice-session__stat":"_practice-session__stat_elovc_998","practice-session__stat-value":"_practice-session__stat-value_elovc_1011","practice-session__stat-value--completed":"_practice-session__stat-value--completed_elovc_1016","practice-session__stat-value--correct":"_practice-session__stat-value--correct_elovc_1020","practice-session__stat-value--accuracy":"_practice-session__stat-value--accuracy_elovc_1024","practice-session__stat-label":"_practice-session__stat-label_elovc_1028","practice-session__loading":"_practice-session__loading_elovc_1035"};function Vs({topicId:s,learningPathIds:e,targetCount:a=10,includeReview:n=!0,onComplete:c,onCancel:o}){const[l,y]=p.useState(null),[i,g]=p.useState(null),[x,L]=p.useState(0),[C,E]=p.useState(null),[_,W]=p.useState(!1),[P,J]=p.useState(!1),[Q,ee]=p.useState(Date.now()),[q,me]=p.useState([]),[we,ge]=p.useState([]),[ne,le]=p.useState(0),[m,S]=p.useState([]),[I,Y]=p.useState(null),[D,te]=p.useState([]),[ae,Be]=p.useState({}),[st,He]=p.useState([]),[de,$e]=p.useState(new Set),[ke,Me]=p.useState(0),[re,b]=p.useState(""),[T,F]=p.useState(!1),[$,V]=p.useState(null),[ue,gt]=p.useState(""),[Oe,Z]=p.useState(0),[ft,Ve]=p.useState(!1),[We,Fe]=p.useState(!1),[H,zt]=p.useState(null),{playbackState:Se,loadAudio:at,togglePlayPause:bt,replay:Je,stop:yt,preloadNext:Bt,unlockAutoPlay:Re}=Ss(),{settings:Ce}=Pt(),it=p.useCallback(u=>{_||i?.type!=="multiple-select"||$e(d=>{const h=new Set(d);return h.has(u)?h.delete(u):h.add(u),h})},[_,i]),$t=p.useCallback(()=>{if(!i)return;const u=i.content,d=H?.buttons?.question?.field;if(i.audioUrl||d&&u?.[d]){try{Re(),Je()}catch(j){console.warn("Audio replay failed",j)}at(i,Ce,!0).catch(j=>{console.warn("Audio reload failed",j)})}},[i,Ce,at,Je,Re,H]),nt=p.useCallback(()=>{if(_)return!1;if(i?.type==="multiple-choice")return C!==null;if(i?.type==="cloze-deletion")return m.every(u=>u.trim().length>0);if(i?.type==="true-false")return I!==null;if(i?.type==="ordering")return D.length>0;if(i?.type==="matching"){const u=i.content;return Object.keys(ae).length===u.pairs.length}return i?.type==="multiple-select"?de.size>0:i?.type==="slider"?!0:i?.type==="word-scramble"?re.trim().length>0:i?.type==="flashcard"?$!==null:i?.type==="text-input"?ue.trim().length>0:!1},[_,i,C,m,I,D,ae,de,re,$,ue]),Ye=p.useCallback(async u=>{if(!i||!l)return;Se.autoPlayUnlocked||Re().catch(f=>console.warn("Failed to unlock auto-play:",f));let d=!1;if(i.type==="multiple-choice"){if(C===null)return;d=C===ne}else if(i.type==="cloze-deletion")d=i.content.blanks.every((R,X)=>{const B=m[X]?.trim().toLowerCase()||"",G=R.correctAnswer.toLowerCase(),fe=R.alternatives?.map(qe=>qe.toLowerCase())||[];return B===G||fe.includes(B)});else if(i.type==="true-false"){if(I===null)return;const f=i.content;d=I===f.correctAnswer}else if(i.type==="ordering"){const f=i.content;d=D.every((R,X)=>{const B=f.items.indexOf(R);return f.correctOrder[X]===B})}else if(i.type==="matching")d=i.content.pairs.every((R,X)=>ae[X]===X);else if(i.type==="multiple-select"){const f=i.content;if(de.size===0)return;d=f.correctAnswers.length===de.size&&f.correctAnswers.every(R=>de.has(R))}else if(i.type==="slider"){const f=i.content,R=f.tolerance||0;d=Math.abs(ke-f.correctValue)<=R}else if(i.type==="word-scramble"){if(!re.trim())return;const f=i.content;d=re.trim().toLowerCase()===f.correctWord.toLowerCase()}else if(i.type==="flashcard"){const f=u??$;if(f==null)return;d=f,V(f)}else if(i.type==="text-input"){if(!ue.trim())return;const f=i.content,R=f.caseSensitive||!1,X=R?ue.trim():ue.trim().toLowerCase(),B=R?f.correctAnswer:f.correctAnswer.toLowerCase(),G=(f.alternatives||[]).map(fe=>R?fe:fe.toLowerCase());d=X===B||G.includes(X)}J(d),W(!0);const h=Math.round((Date.now()-Q)/1e3);await new ct(lt(),Ke(),Qe()).recordSessionAnswer(l.id,d,h);const w=new us(Qe(),Ke()),k=d?4:2;await w.recordAnswer(i.id,d,k);const v=await M.practiceSessions.get(l.id);v&&y(v)},[i,l,Se.autoPlayUnlocked,Re,C,ne,m,I,D,ae,de,ke,re,$,ue,Q]),rt=p.useCallback(async()=>{if(!l)return;await new ct(lt(),Ke(),Qe()).completeSession(l.id),await new Promise(d=>setTimeout(d,100)),c()},[l,c]),Ue=p.useCallback(()=>{W(!1),E(null),l&&x<l.execution.taskIds.length-1?L(x+1):rt()},[l,x,rt]);p.useEffect(()=>{Mt()},[]),p.useEffect(()=>{l&&l.execution.taskIds.length>0&&x===0&&vt()},[l]),p.useEffect(()=>{l&&l.execution.taskIds.length>0&&x>0&&vt()},[x]),p.useEffect(()=>{if(!i){Z(0);return}if(i.type==="multiple-choice"){const u=q.length;Z(d=>u===0?0:Math.min(d,u-1))}else if(i.type==="multiple-select"){const u=i.content.options.length;Z(d=>u===0?0:Math.min(d,u-1))}else Z(0)},[i,q]),p.useEffect(()=>{const u=d=>{if(!i)return;const h=document.activeElement,j=h?.tagName?.toLowerCase(),w=!!(h&&(j==="input"||j==="textarea"||h.isContentEditable)),k=d.key,v=i.type,f=()=>{i.content?.hint&&Fe(G=>!G)},R=B=>{if(v==="multiple-choice"){const G=q.length;if(G===0)return;Z(fe=>{const qe=(fe+B+G)%G;return E(qe),qe})}else if(v==="multiple-select"){const G=i.content.options;if(G.length===0)return;Z(fe=>(fe+B+G.length)%G.length)}},X=()=>{if(v==="flashcard"){T?$!==null&&Ue():F(!0);return}_?v!=="flashcard"&&Ue():nt()&&Ye()};if((k==="?"||k==="/"&&d.shiftKey)&&!d.metaKey&&!d.ctrlKey){d.preventDefault(),Ve(B=>!B);return}if(ft){(k==="Escape"||k==="?"||k==="/"&&d.shiftKey)&&(d.preventDefault(),Ve(!1));return}if(/^[1-9]$/.test(k)&&!w){const B=Number(k)-1;if(v==="multiple-choice"&&B<q.length)d.preventDefault(),Z(B),E(B);else if(v==="multiple-select"){const G=i.content.options;B<G.length&&(d.preventDefault(),Z(B),it(B))}return}switch(k){case"Escape":d.preventDefault(),We?Fe(!1):o();break;case"Enter":d.preventDefault(),X();break;case" ":{if(w)return;v==="multiple-choice"?(d.preventDefault(),E(Oe)):v==="multiple-select"&&(d.preventDefault(),it(Oe));break}case"ArrowUp":case"ArrowLeft":if(w)return;(v==="multiple-choice"||v==="multiple-select")&&(d.preventDefault(),R(-1));break;case"ArrowDown":case"ArrowRight":if(w)return;(v==="multiple-choice"||v==="multiple-select")&&(d.preventDefault(),R(1));break;case"r":case"R":if(w)return;d.preventDefault(),$t();break;case"h":case"H":if(w)return;d.preventDefault(),f();break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[i,q,Oe,_,T,$,We]);async function Mt(){const d=await new ct(lt(),Ke(),Qe()).createSession({topicId:s,learningPathIds:e,targetCount:a,includeReview:n});y(d)}async function vt(){if(!l||x>=l.execution.taskIds.length)return;const u=l.execution.taskIds[x];if(!u)return;const d=await M.tasks.get(u);if(!d)return;g(d),ee(Date.now());const h=await Es(d.templateId);zt(h);const j=x+1;if(j<l.execution.taskIds.length){const w=l.execution.taskIds[j];w&&M.tasks.get(w).then(k=>{k&&k.audioUrl&&Bt(k)}).catch(k=>{console.warn("Failed to preload next task audio:",k)})}if(E(null),Y(null),S([]),te([]),Be({}),He([]),$e(new Set),Me(0),b(""),F(!1),V(null),gt(""),Z(0),Ve(!1),Fe(!1),d.type==="multiple-choice"){const w=d.content,k=[...w.options],v=w.correctAnswer,f=k.map((B,G)=>G);for(let B=f.length-1;B>0;B--){const G=Math.floor(Math.random()*(B+1));[f[B],f[G]]=[f[G],f[B]]}const R=f.map(B=>k[B]),X=f.findIndex(B=>B===v);me(R),ge(f),le(X)}else if(d.type==="cloze-deletion"){const w=d.content;S(new Array(w.blanks.length).fill(""))}else if(d.type==="ordering"){const k=[...d.content.items].sort(()=>Math.random()-.5);te(k)}else if(d.type==="matching"){const k=d.content.pairs.map((v,f)=>f);for(let v=k.length-1;v>0;v--){const f=Math.floor(Math.random()*(v+1));[k[v],k[f]]=[k[f],k[v]]}He(k),Be({})}else if(d.type==="multiple-select")$e(new Set);else if(d.type==="slider"){const w=d.content;Me(Math.floor((w.min+w.max)/2))}else d.type==="word-scramble"&&b("")}function Ot(){l&&(W(!1),E(null),x<l.execution.taskIds.length-1&&L(x+1))}p.useEffect(()=>{const u=d=>{if(!(d.target instanceof HTMLInputElement||d.target instanceof HTMLTextAreaElement)&&Se.audioUrl)switch(d.key.toLowerCase()){case" ":d.preventDefault(),bt().catch(console.error);break;case"r":d.preventDefault(),Je().catch(console.error);break;case"s":d.preventDefault(),yt();break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[Se.audioUrl,bt,Je,yt]),p.useEffect(()=>{_&&i&&Rs(i,Ce)&&(console.log("üîä Auto-play in feedback:",i.audioUrl),at(i,Ce,!0).catch(u=>{console.warn("Auto-play in feedback failed:",u)}))},[_,i?.id,Ce.autoPlayEnabled,Ce.languageFilter]),p.useEffect(()=>{if(!i||!H||_)return;const u=H.autoPlay?.onLoad||[],d=i.content;(async()=>{for(const j of u){const w=d[j];if(!w)continue;const k=Array.isArray(w)?w[0]:w;if(k)try{await new Audio(`/learning-platform/test/audio/${k}`).play(),console.log(`‚úÖ Auto-played ${j}: ${k}`);break}catch(v){console.warn(`‚ö†Ô∏è Auto-play blocked for ${j}. User interaction required first.`,v),Se.autoPlayUnlocked||Re().catch(f=>console.warn("Failed to unlock auto-play:",f))}}})()},[i?.id,H]),p.useEffect(()=>{if(!i||!H||!_)return;const u=H.autoPlay?.onReveal||[],d=i.content,h=async()=>{for(const w of u){const k=[];if(w==="correctAnswerAudio"&&i.type==="multiple-choice")d.optionsAudio?.[d.correctAnswer]&&k.push(d.optionsAudio[d.correctAnswer]);else if(w==="correctAnswerAudio"&&i.type==="text-input")d.correctAnswerAudio&&k.push(d.correctAnswerAudio);else if(w==="itemsAudioInOrder"&&i.type==="ordering"){const v=d.itemsAudio,f=d.correctOrder;if(v&&f)for(const R of f)v[R]&&k.push(v[R])}else if(w==="blanksAudioInOrder"&&i.type==="cloze-deletion"){const v=d.blanks;if(v)for(const f of v)f.correctAnswerAudio&&k.push(f.correctAnswerAudio)}else if(w==="correctOptionsAudio"&&i.type==="multiple-select"){const v=d.optionsAudio,f=d.correctAnswers;if(v&&f)for(const R of f)v[R]&&k.push(v[R])}else if(w==="correctValueAudio"&&i.type==="slider")d.correctValueAudio&&k.push(d.correctValueAudio);else if(w==="correctWordAudio"&&i.type==="word-scramble")d.correctWordAudio&&k.push(d.correctWordAudio);else{const v=d[w];if(v){const f=Array.isArray(v)?v[0]:v;f&&k.push(f)}}if(k.length>0){for(const v of k)try{const f=new Audio(`/learning-platform/test/audio/${v}`);await f.play(),await new Promise(R=>{f.onended=R,setTimeout(R,5e3)}),console.log(`‚úÖ Auto-played on reveal ${w}: ${v}`)}catch(f){console.warn(`‚ö†Ô∏è Auto-play on reveal blocked for ${v}.`,f);break}break}}},j=setTimeout(()=>{h()},100);return()=>clearTimeout(j)},[_,i?.id,H]);function Ft(){return i?i.type==="multiple-choice"?Ut():i.type==="cloze-deletion"?qt():i.type==="true-false"?Gt():i.type==="ordering"?Ht():i.type==="matching"?Vt():i.type==="multiple-select"?Wt():i.type==="slider"?Jt():i.type==="word-scramble"?Yt():i.type==="flashcard"?Kt():i.type==="text-input"?Qt():null:null}function Ut(){if(!i||i.type!=="multiple-choice")return null;const u=i.content;return t.jsx("div",{className:r["practice-session__mc-options"],children:q.map((d,h)=>{const j=!_&&Oe===h,w=[r["practice-session__mc-option"],_&&h===ne&&r["practice-session__mc-option--correct"],_&&h===C&&!P&&r["practice-session__mc-option--incorrect"],!_&&C===h&&r["practice-session__mc-option--selected"],j&&r["practice-session__mc-option--focused"],_&&r["practice-session__mc-option--disabled"]].filter(Boolean).join(" "),k=we[h],v=u.optionsAudio&&k!==void 0&&u.optionsAudio[k]?`/learning-platform/test/audio/${u.optionsAudio[k]}`:null;return t.jsxs("button",{onClick:()=>{_||(Z(h),E(h))},disabled:_,className:w,onMouseEnter:()=>Z(h),children:[t.jsx("span",{children:d}),v&&t.jsx(be,{text:d,audioUrl:v,size:"small"})]},h)})})}function qt(){if(!i||i.type!=="cloze-deletion")return null;const u=i.content,d=u.text.split(/\{\{blank\}\}/g);return t.jsxs("div",{className:r["practice-session__cloze-container"],children:[t.jsx("div",{className:r["practice-session__cloze-text"],children:d.map((h,j)=>t.jsxs("span",{children:[h,j<u.blanks.length&&(()=>{const w=m[j]?.trim().toLowerCase()||"",k=w===u.blanks[j].correctAnswer.toLowerCase()||u.blanks[j].alternatives?.map(f=>f.toLowerCase()).includes(w),v=m[j]?.trim()!=="";return t.jsx(St,{value:m[j]||"",onChange:f=>{const R=[...m];R[j]=f.target.value,S(R)},disabled:_,error:!!(_&&v&&!k),success:!!(_&&k),className:r["practice-session__cloze-input"]})})()]},j))}),_&&t.jsxs("div",{className:r["practice-session__cloze-feedback"],children:[t.jsx("div",{className:r["practice-session__cloze-feedback-title"],children:"Richtige Antworten:"}),u.blanks.map((h,j)=>{const w=m[j]?.trim().toLowerCase()||"",v=w===h.correctAnswer.toLowerCase()||h.alternatives?.map(f=>f.toLowerCase()).includes(w)?r["practice-session__cloze-answer--correct"]:r["practice-session__cloze-answer--neutral"];return t.jsxs("div",{className:`${r["practice-session__cloze-answer"]} ${v}`,children:["L√ºcke ",j+1,": ",t.jsx("strong",{className:r["practice-session__cloze-answer-correct"],children:h.correctAnswer}),h.alternatives&&h.alternatives.length>0&&t.jsxs("span",{className:r["practice-session__cloze-alternatives"],children:[" ","(auch richtig: ",h.alternatives.join(", "),")"]})]},j)})]})]})}function Gt(){if(!i||i.type!=="true-false")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__tf-container"],children:[t.jsx("div",{className:r["practice-session__tf-statement"],children:u.statement}),t.jsx("div",{className:r["practice-session__tf-buttons"],children:[!0,!1].map(d=>{const h=[r["practice-session__tf-button"],_&&d===u.correctAnswer&&r["practice-session__tf-button--correct"],_&&d===I&&!P&&r["practice-session__tf-button--incorrect"],!_&&I===d&&r["practice-session__tf-button--selected"],_&&r["practice-session__tf-button--disabled"]].filter(Boolean).join(" ");return t.jsx("button",{onClick:()=>!_&&Y(d),disabled:_,className:h,children:d?"Richtig":"Falsch"},d.toString())})})]})}function Ht(){if(!i||i.type!=="ordering")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__ordering-container"],children:[t.jsx("div",{className:r["practice-session__ordering-instruction"],children:"Ordne die Elemente in die richtige Reihenfolge"}),t.jsx("div",{className:r["practice-session__ordering-items"],children:D.map((d,h)=>{const j=u.items.indexOf(d),w=_&&u.correctOrder[h]===j,k=_?u.correctOrder.indexOf(j):-1,v=[r["practice-session__ordering-item"],_&&w&&r["practice-session__ordering-item--correct"]].filter(Boolean).join(" "),f=u.itemsAudio&&u.itemsAudio[j]?`/learning-platform/test/audio/${u.itemsAudio[j]}`:null;return t.jsxs("div",{className:v,children:[t.jsxs("div",{className:r["practice-session__ordering-item-number"],children:[h+1,"."]}),t.jsxs("div",{className:r["practice-session__ordering-item-text"],children:[t.jsx("span",{className:r["practice-session__ordering-word"],children:d}),f&&t.jsx(be,{text:d,audioUrl:f,size:"small"}),_&&!w&&t.jsxs("span",{className:r["practice-session__ordering-hint"],children:["‚Üí Position ",k+1]})]}),!_&&t.jsxs("div",{className:r["practice-session__ordering-controls"],children:[h>0&&t.jsx("button",{onClick:()=>{const R=[...D];[R[h],R[h-1]]=[R[h-1],R[h]],te(R)},className:r["practice-session__ordering-btn"],children:"‚Üë"}),h<D.length-1&&t.jsx("button",{onClick:()=>{const R=[...D];[R[h],R[h+1]]=[R[h+1],R[h]],te(R)},className:r["practice-session__ordering-btn"],children:"‚Üì"})]})]},h)})}),_&&!P&&t.jsxs("div",{className:r["practice-session__ordering-feedback"],children:[t.jsx("div",{className:r["practice-session__ordering-feedback-title"],children:"Richtige Reihenfolge:"}),u.correctOrder.map((d,h)=>t.jsxs("div",{className:r["practice-session__ordering-feedback-item"],children:[h+1,". ",t.jsx("strong",{children:u.items[d]})]},h))]})]})}function Vt(){if(!i||i.type!=="matching")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__matching-container"],children:[t.jsx("div",{className:r["practice-session__matching-instruction"],children:"Ordne die passenden Paare zu"}),t.jsx("div",{className:r["practice-session__matching-grid"],children:u.pairs.map((d,h)=>{const j=_&&ae[h]===h,w=ae[h]!==void 0&&ae[h]!==null,k=u.leftAudio&&u.leftAudio[h]?`/learning-platform/test/audio/${u.leftAudio[h]}`:null;return t.jsxs(Le.Fragment,{children:[t.jsxs("div",{className:r["practice-session__matching-left-item"],children:[t.jsx("span",{children:d.left}),k&&t.jsx(be,{text:d.left,audioUrl:k,size:"small"})]}),t.jsx(Gs,{value:ae[h]?.toString()??"",onChange:v=>{const f=parseInt(v);Be({...ae,[h]:f})},options:st.map(v=>({value:v.toString(),label:u.pairs[v].right})),disabled:_,placeholder:"W√§hle...",error:_&&w&&!j,success:_&&j,fullWidth:!0})]},h)})}),_&&!P&&t.jsxs("div",{className:r["practice-session__matching-feedback"],children:[t.jsx("div",{className:r["practice-session__matching-feedback-title"],children:"Richtige Zuordnungen:"}),u.pairs.map((d,h)=>t.jsxs("div",{className:r["practice-session__matching-feedback-item"],children:[t.jsx("strong",{children:d.left})," ‚Üí ",t.jsx("strong",{children:d.right})]},h))]})]})}function Wt(){if(!i||i.type!=="multiple-select")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__ms-container"],children:[t.jsx("div",{className:r["practice-session__ms-instruction"],children:"W√§hle alle zutreffenden Antworten"}),t.jsx("div",{className:r["practice-session__ms-options"],children:u.options.map((d,h)=>{const j=de.has(h),w=u.correctAnswers.includes(h),k=!_&&Oe===h;let v="";_&&(w?v=j?"‚úì":"‚óã":j&&!w&&(v="‚úó"));const f=[r["practice-session__ms-option"],k&&r["practice-session__ms-option--focused"],_&&w&&r["practice-session__ms-option--correct"],_&&j&&!w&&r["practice-session__ms-option--incorrect"],!_&&j&&r["practice-session__ms-option--selected"]].filter(Boolean).join(" "),R=w?r["practice-session__ms-status-icon--correct"]:r["practice-session__ms-status-icon--incorrect"];return t.jsxs("div",{className:f,onMouseEnter:()=>Z(h),children:[t.jsx(Us,{checked:j,onChange:()=>{it(h),Z(h)},disabled:_,label:t.jsx("span",{className:r["practice-session__ms-option-label"],children:d}),error:_&&j&&!w,success:_&&w&&j,style:{flex:1}}),_&&v&&t.jsx("span",{className:`${r["practice-session__ms-status-icon"]} ${R}`,children:v})]},h)})})]})}function Jt(){if(!i||i.type!=="slider")return null;const u=i.content,d=u.step||1,h=u.tolerance||0,j=Math.abs(ke-u.correctValue)<=h,w=_?j?r["practice-session__slider-value--correct"]:r["practice-session__slider-value--incorrect"]:"";return t.jsxs("div",{className:r["practice-session__slider-container"],children:[t.jsx("div",{className:r["practice-session__slider-value-display"],children:t.jsxs("div",{className:`${r["practice-session__slider-value"]} ${w}`,children:[ke,u.unit||""]})}),t.jsx("div",{className:r["practice-session__slider-wrapper"],children:t.jsx(Hs,{value:ke,onChange:Me,min:u.min,max:u.max,step:d,disabled:_,unit:u.unit||"",showValue:!1})}),_&&t.jsx("div",{className:r["practice-session__slider-feedback"],children:t.jsxs("div",{className:r["practice-session__slider-feedback-text"],children:["Richtige Antwort: ",t.jsxs("strong",{className:r["practice-session__slider-correct-value"],children:[u.correctValue,u.unit||""]}),h>0&&t.jsxs("span",{className:r["practice-session__slider-tolerance"],children:[" ","(¬±",h,")"]})]})})]})}function Yt(){if(!i||i.type!=="word-scramble")return null;const u=i.content,d=re.trim().toLowerCase()===u.correctWord.toLowerCase(),h=re.trim()!=="",j=_?d?r["practice-session__scramble-input--correct"]:h?r["practice-session__scramble-input--incorrect"]:"":"";return t.jsxs("div",{className:r["practice-session__scramble-container"],children:[t.jsxs("div",{className:r["practice-session__scramble-display"],children:[t.jsx("div",{className:r["practice-session__scramble-label"],children:"Buchstabensalat:"}),t.jsx("div",{className:r["practice-session__scramble-word"],children:u.scrambledWord}),u.showLength&&t.jsxs("div",{className:r["practice-session__scramble-length"],children:["(",u.correctWord.length," Buchstaben)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:r["practice-session__scramble-input-label"],children:"Deine L√∂sung:"}),t.jsx("input",{type:"text",value:re,onChange:w=>b(w.target.value),disabled:_,placeholder:"Entschl√ºssle das Wort...",className:`${r["practice-session__scramble-input"]} ${j}`})]}),_&&!P&&t.jsxs("div",{className:r["practice-session__scramble-feedback"],children:[t.jsx("div",{className:r["practice-session__scramble-feedback-label"],children:"Richtige L√∂sung:"}),t.jsx("div",{className:r["practice-session__scramble-feedback-word"],children:u.correctWord})]})]})}function Kt(){if(!i||i.type!=="flashcard")return null;const u=i.content;return t.jsxs("div",{className:r["practice-session__flashcard-container"],children:[t.jsxs("div",{className:r["practice-session__flashcard"],children:[t.jsx("div",{className:r["practice-session__flashcard-lang"],children:u.frontLanguage==="de"?"Deutsch":u.frontLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:r["practice-session__flashcard-front"],children:[t.jsx("div",{children:u.front}),H?.buttons?.front?.show&&u[H.buttons.front.field]&&t.jsx(be,{text:u.front,audioUrl:`/learning-platform/test/audio/${u[H.buttons.front.field]}`,size:"large"})]}),T?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:r["practice-session__flashcard-divider"]}),t.jsx("div",{className:r["practice-session__flashcard-lang"],children:u.backLanguage==="de"?"Deutsch":u.backLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:r["practice-session__flashcard-back"],children:[t.jsx("div",{children:u.back}),H?.buttons?.back?.show&&u[H.buttons.back.field]&&t.jsx(be,{text:u.back,audioUrl:`/learning-platform/test/audio/${u[H.buttons.back.field]}`,size:"large"})]})]}):t.jsx("button",{onClick:async()=>{if(F(!0),H&&Se.autoPlayUnlocked){const d=H.autoPlay?.onReveal||[];for(const h of d)if(u[h])try{await new Audio(`/learning-platform/test/audio/${u[h]}`).play();break}catch(j){console.warn(`Failed to auto-play ${h} on reveal:`,j)}}},disabled:_,className:r["practice-session__flashcard-reveal-btn"],children:"Ergebnis anzeigen"})]}),T&&!_&&t.jsxs("div",{className:r["practice-session__flashcard-assessment"],children:[t.jsxs("button",{onClick:()=>{V(!1),Ye(!1),setTimeout(()=>{Ue()},300)},className:`${r["practice-session__flashcard-btn"]} ${r["practice-session__flashcard-btn--unknown"]}`,children:[t.jsx("span",{className:r["practice-session__flashcard-icon"],children:"‚úó"}),t.jsx("span",{children:"Nicht gewusst"})]}),t.jsxs("button",{onClick:()=>{V(!0),Ye(!0),setTimeout(()=>{Ue()},300)},className:`${r["practice-session__flashcard-btn"]} ${r["practice-session__flashcard-btn--known"]}`,children:[t.jsx("span",{className:r["practice-session__flashcard-icon"],children:"‚úì"}),t.jsx("span",{children:"Gewusst"})]})]}),_&&u.explanation&&t.jsxs("div",{className:r["practice-session__flashcard-explanation"],children:[t.jsx("strong",{children:"Hinweis:"})," ",u.explanation]})]})}function Qt(){if(!i||i.type!=="text-input")return null;const u=i.content,d=u.correctAnswerAudio?`/learning-platform/test/audio/${u.correctAnswerAudio}`:i.audioUrl;return t.jsx("div",{className:r["practice-session__text-input-container"],children:t.jsxs("div",{className:r["practice-session__text-input-wrapper"],children:[t.jsx(St,{value:ue,onChange:h=>gt(h.target.value),disabled:_,placeholder:"Deine Antwort...",error:_&&!P,success:_&&P,fullWidth:!0,className:r["practice-session__text-input"]}),_&&!P&&t.jsxs("div",{className:r["practice-session__text-input-feedback"],children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Richtige Antwort:"})," ",u.correctAnswer]}),d&&t.jsx(be,{text:u.correctAnswer,audioUrl:d,size:"small"})]})]})})}if(!l||!i)return t.jsx("div",{className:r["practice-session__loading"],children:t.jsx("p",{children:"Wird geladen..."})});const Zt=(x+1)/l.execution.taskIds.length*100,ot=i.content?.hint;p.useEffect(()=>{_&&Fe(!1)},[_]);const Xt=()=>{Se.autoPlayUnlocked||Re().catch(u=>console.warn("Failed to unlock auto-play on click:",u))};return t.jsxs("div",{className:r["practice-session"],onClick:Xt,children:[t.jsxs("div",{className:r["practice-session__header"],children:[t.jsxs("div",{className:r["practice-session__header-top"],children:[t.jsxs("div",{className:r["practice-session__header-left"],children:[t.jsx("h2",{className:r["practice-session__title"],children:"√úbungssitzung"}),t.jsxs("span",{className:r["practice-session__task-counter"],children:[x+1,"/",l.execution.taskIds.length]}),t.jsxs("span",{className:r["practice-session__task-id"],children:["ID: ",i.id]})]}),t.jsx("button",{onClick:o,className:r["practice-session__cancel-btn"],children:"Abbrechen"})]}),t.jsx("div",{className:r["practice-session__progress-bar"],children:t.jsx("div",{className:r["practice-session__progress-fill"],style:{width:`${Zt}%`}})})]}),t.jsxs("div",{className:r["practice-session__question-area"],children:[(i.type==="multiple-choice"||i.type==="ordering"||i.type==="matching"||i.type==="multiple-select"||i.type==="slider"||i.type==="word-scramble"||i.type==="text-input")&&t.jsxs("div",{className:r["practice-session__question-header"],children:[t.jsx("h3",{className:r["practice-session__question-text"],children:i.content.question}),H?.buttons?.question?.show&&i.content[H.buttons.question.field]&&t.jsx(be,{text:i.content.question,audioUrl:`/learning-platform/test/audio/${i.content[H.buttons.question.field]}`,size:"small"})]}),ot&&!_&&t.jsx("div",{className:r["practice-session__hint-controls"],children:t.jsxs("button",{type:"button",className:r["practice-session__hint-button"],onClick:()=>Fe(u=>!u),children:[We?"Hinweis verbergen":"Hinweis anzeigen"," (H)"]})}),ot&&We&&!_&&t.jsxs("div",{className:r["practice-session__hint"],children:["üí° ",t.jsx("strong",{children:"Hinweis:"})," ",ot]}),Ft()]}),_&&t.jsx("div",{className:r["practice-session__feedback"],children:t.jsxs(Ls,{variant:P?"success":"error",title:P?"Richtig!":"Nicht ganz richtig",children:[i.content.explanation&&t.jsx("p",{style:{margin:0},children:i.content.explanation}),i.audioUrl&&i.type==="multiple-choice"&&t.jsxs("div",{style:{marginTop:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"Aussprache:"}),t.jsx(be,{text:i.content.options[i.content.correctAnswer],audioUrl:i.audioUrl,size:"small"})]})]})}),t.jsxs("div",{className:r["practice-session__footer"],children:[t.jsx("div",{className:r["practice-session__actions"],children:_?i?.type!=="flashcard"&&t.jsx("button",{onClick:Ue,className:r["practice-session__btn-next"],children:x<l.execution.taskIds.length-1?"N√§chste Aufgabe ‚Üí":"Sitzung beenden"}):t.jsxs(t.Fragment,{children:[i?.type!=="flashcard"&&t.jsx("button",{onClick:()=>Ye(),disabled:!nt(),className:nt()?`${r["practice-session__btn-submit"]} ${r["practice-session__btn-submit--enabled"]}`:`${r["practice-session__btn-submit"]} ${r["practice-session__btn-submit--disabled"]}`,children:"Antwort √ºberpr√ºfen"}),t.jsx("button",{onClick:x<l.execution.taskIds.length-1?Ot:rt,className:r["practice-session__btn-skip"],children:x<l.execution.taskIds.length-1?"√úberspringen ‚Üí":"Sitzung beenden"})]})}),t.jsxs("div",{className:r["practice-session__stats"],children:[t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsx("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--completed"]}`,children:l.execution.completedCount}),t.jsx("div",{className:r["practice-session__stat-label"],children:"beantwortet"})]}),t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsx("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--correct"]}`,children:l.execution.correctCount}),t.jsx("div",{className:r["practice-session__stat-label"],children:"richtig"})]}),t.jsxs("div",{className:r["practice-session__stat"],children:[t.jsxs("div",{className:`${r["practice-session__stat-value"]} ${r["practice-session__stat-value--accuracy"]}`,children:[l.execution.completedCount>0?Math.round(l.execution.correctCount/l.execution.completedCount*100):0,"%"]}),t.jsx("div",{className:r["practice-session__stat-label"],children:"genau"})]})]})]}),ft&&t.jsx("div",{className:r["practice-session__shortcuts-overlay"],role:"dialog","aria-modal":"true","aria-labelledby":"practice-shortcuts-title",children:t.jsxs("div",{className:r["practice-session__shortcuts-content"],children:[t.jsx("h2",{id:"practice-shortcuts-title",children:"Tastaturk√ºrzel"}),t.jsxs("div",{className:r["practice-session__shortcuts-groups"],children:[t.jsxs("div",{children:[t.jsx("div",{className:r["practice-session__shortcuts-group-title"],children:"Navigation"}),t.jsxs("ul",{className:r["practice-session__shortcuts-list"],children:[t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Escape"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Esc"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Zur n√§chsten/vorherigen Option"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"‚Üê ‚Üë ‚Üí ‚Üì"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Option w√§hlen / Checkbox umschalten"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Leertaste"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Option direkt w√§hlen"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"1‚Äì9"})]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:r["practice-session__shortcuts-group-title"],children:"Aktionen"}),t.jsxs("ul",{className:r["practice-session__shortcuts-list"],children:[t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Antwort √ºberpr√ºfen / weiter"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"Enter"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Frage erneut abspielen"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"R"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Hinweis anzeigen (falls vorhanden)"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"H"})]}),t.jsxs("li",{className:r["practice-session__shortcut-item"],children:[t.jsx("span",{children:"Hilfe umschalten"}),t.jsx("span",{className:r["practice-session__shortcut-keys"],children:"?"})]})]})]})]}),t.jsx("div",{className:r["practice-session__shortcuts-close"],children:t.jsx("button",{type:"button",onClick:()=>Ve(!1),children:"Schlie√üen (Esc)"})})]})})]})}const Te={"stat-card__container":"_stat-card__container_jhf3g_4","stat-card__header":"_stat-card__header_jhf3g_11","stat-card__title":"_stat-card__title_jhf3g_18","stat-card__icon":"_stat-card__icon_jhf3g_28","stat-card__value":"_stat-card__value_jhf3g_35","stat-card__subtitle":"_stat-card__subtitle_jhf3g_43"};function xe({title:s,value:e,subtitle:a,color:n=O.primary[500],icon:c,className:o,style:l,...y}){return t.jsx(Ne,{...y,padding:"medium",shadow:!0,border:!0,style:{borderLeft:`4px solid ${n}`,...l},className:o,children:t.jsxs("div",{className:Te["stat-card__container"],children:[t.jsxs("div",{className:Te["stat-card__header"],children:[t.jsx("h3",{className:Te["stat-card__title"],children:s}),c&&t.jsx("div",{className:Te["stat-card__icon"],style:{color:n},children:c})]}),t.jsx("div",{className:Te["stat-card__value"],children:e}),a&&t.jsx("div",{className:Te["stat-card__subtitle"],children:a})]})})}const Ws="_button_1pgvq_4",Js="_button__icon_1pgvq_115",Ys="_button__spinner_1pgvq_130",Ks="_spin_1pgvq_1",ve={button:Ws,"button--loading":"_button--loading_1pgvq_21","button--full-width":"_button--full-width_1pgvq_27","button--primary":"_button--primary_1pgvq_32","button--secondary":"_button--secondary_1pgvq_47","button--ghost":"_button--ghost_1pgvq_62","button--danger":"_button--danger_1pgvq_79","button--small":"_button--small_1pgvq_94","button--medium":"_button--medium_1pgvq_101","button--large":"_button--large_1pgvq_108",button__icon:Js,button__spinner:Ys,spin:Ks};function et({variant:s="primary",size:e="medium",loading:a=!1,fullWidth:n=!1,disabled:c=!1,startIcon:o,endIcon:l,children:y,className:i,...g}){return t.jsx("button",{...g,disabled:c||a,className:U(ve.button,ve[`button--${s}`],ve[`button--${e}`],a&&ve["button--loading"],n&&ve["button--full-width"],i),children:a?t.jsxs(t.Fragment,{children:[t.jsx(Qs,{size:e}),y]}):t.jsxs(t.Fragment,{children:[o&&t.jsx("span",{className:ve.button__icon,children:o}),y,l&&t.jsx("span",{className:ve.button__icon,children:l})]})})}function Qs({size:s}){const e=s==="small"?"12px":s==="large"?"18px":"16px";return t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:ve.button__spinner,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:"31.4 31.4",opacity:"0.25"}),t.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}const se={"session-results":"_session-results_p4d1d_4","session-results__header":"_session-results__header_p4d1d_12","session-results__emoji":"_session-results__emoji_p4d1d_16","session-results__title":"_session-results__title_p4d1d_21","session-results__rating":"_session-results__rating_p4d1d_25","session-results__stats":"_session-results__stats_p4d1d_32","session-results__time-card":"_session-results__time-card_p4d1d_40","session-results__time-text":"_session-results__time-text_p4d1d_45","session-results__progress-card":"_session-results__progress-card_p4d1d_51","session-results__progress-title":"_session-results__progress-title_p4d1d_55","session-results__progress-text":"_session-results__progress-text_p4d1d_59","session-results__actions":"_session-results__actions_p4d1d_82"};function Zs({session:s,onClose:e,onStartNew:a}){const n=s.results.accuracy,c=Math.round(s.results.averageTime);let o="",l="";n>=90?(o="Ausgezeichnet!",l="var(--color-success)"):n>=75?(o="Sehr gut!",l="var(--color-primary)"):n>=60?(o="Gut gemacht!",l="var(--color-warning)"):(o="Weiter √ºben!",l="var(--color-error)");function y(i){const g=Math.floor(i/60),x=i%60;return g>0?`${g}:${x.toString().padStart(2,"0")} min`:`${x} sek`}return t.jsxs("div",{className:se["session-results"],children:[t.jsxs("div",{className:se["session-results__header"],children:[t.jsx("div",{className:se["session-results__emoji"],children:"üéâ"}),t.jsx("h1",{className:se["session-results__title"],children:"Sitzung abgeschlossen!"}),t.jsx("p",{className:se["session-results__rating"],style:{color:l},children:o})]}),t.jsxs("div",{className:se["session-results__stats"],children:[t.jsx(xe,{title:"Aufgaben bearbeitet",value:s.execution.completedCount,color:"var(--color-primary)"}),t.jsx(xe,{title:"Richtige Antworten",value:s.execution.correctCount,color:"var(--color-success)"}),t.jsx(xe,{title:"Genauigkeit",value:`${Math.round(n)}%`,color:l}),t.jsx(xe,{title:"√ò Zeit pro Aufgabe",value:y(c),color:"var(--color-warning)"})]}),t.jsx(Ne,{padding:"medium",className:se["session-results__time-card"],children:t.jsxs("p",{className:se["session-results__time-text"],children:[t.jsx("strong",{children:"Gesamtzeit:"})," ",y(s.execution.totalTimeSpent)]})}),t.jsxs(Ne,{padding:"large",className:se["session-results__progress-card"],children:[t.jsx("h3",{className:se["session-results__progress-title"],children:"üìà Dein Fortschritt"}),t.jsxs("p",{className:se["session-results__progress-text"],children:[n>=90&&"Hervorragende Leistung! Du beherrschst dieses Thema sehr gut.",n>=75&&n<90&&"Sehr gute Arbeit! Du machst gro√üe Fortschritte.",n>=60&&n<75&&"Gute Arbeit! Weiter so, du verbesserst dich stetig.",n<60&&"Bleib dran! √úbung macht den Meister. Die n√§chste Sitzung wird noch besser!"]})]}),t.jsxs("div",{className:se["session-results__actions"],children:[t.jsx(et,{onClick:a,variant:"primary",children:"Neue Sitzung starten"}),t.jsx(et,{onClick:e,variant:"secondary",children:"Zur√ºck zur √úbersicht"})]})]})}const Ie={"mastery-bar":"_mastery-bar_csvhg_4","mastery-bar__header":"_mastery-bar__header_csvhg_9","mastery-bar__label":"_mastery-bar__label_csvhg_16","mastery-bar__count":"_mastery-bar__count_csvhg_22","mastery-bar__track":"_mastery-bar__track_csvhg_28","mastery-bar__fill":"_mastery-bar__fill_csvhg_36"};function pt({label:s,count:e,color:a,max:n}){const c=n&&n>0?e/n*100:e>0?100:0;return t.jsxs("div",{className:Ie["mastery-bar"],children:[t.jsxs("div",{className:Ie["mastery-bar__header"],children:[t.jsx("span",{className:Ie["mastery-bar__label"],children:s}),t.jsx("span",{className:Ie["mastery-bar__count"],children:e})]}),t.jsx("div",{className:Ie["mastery-bar__track"],children:t.jsx("div",{className:Ie["mastery-bar__fill"],style:{background:a,width:`${c}%`}})})]})}const Xs="_dashboard_1oze0_4",ea="_dashboard__empty_1oze0_12",ta="_dashboard__header_1oze0_22",sa="_dashboard__title_1oze0_26",aa="_dashboard__subtitle_1oze0_30",ia="_dashboard__metrics_1oze0_36",z={dashboard:Xs,dashboard__empty:ea,"dashboard__back-button":"_dashboard__back-button_1oze0_17",dashboard__header:ta,dashboard__title:sa,dashboard__subtitle:aa,dashboard__metrics:ia,"dashboard__mastery-card":"_dashboard__mastery-card_1oze0_44","dashboard__mastery-title":"_dashboard__mastery-title_1oze0_48","dashboard__mastery-bars":"_dashboard__mastery-bars_1oze0_52","dashboard__topic-card":"_dashboard__topic-card_1oze0_59","dashboard__topic-title":"_dashboard__topic-title_1oze0_63","dashboard__topic-grid":"_dashboard__topic-grid_1oze0_67","dashboard__topic-item":"_dashboard__topic-item_1oze0_75","dashboard__topic-header":"_dashboard__topic-header_1oze0_79","dashboard__topic-name":"_dashboard__topic-name_1oze0_85","dashboard__topic-meta":"_dashboard__topic-meta_1oze0_89","dashboard__topic-bar-container":"_dashboard__topic-bar-container_1oze0_94","dashboard__topic-bar-fill":"_dashboard__topic-bar-fill_1oze0_101","dashboard__topic-stats":"_dashboard__topic-stats_1oze0_106","dashboard__sessions-title":"_dashboard__sessions-title_1oze0_113","dashboard__sessions-list":"_dashboard__sessions-list_1oze0_117","dashboard__session-item":"_dashboard__session-item_1oze0_125","dashboard__session-left":"_dashboard__session-left_1oze0_134","dashboard__session-topic":"_dashboard__session-topic_1oze0_138","dashboard__session-date":"_dashboard__session-date_1oze0_142","dashboard__session-right":"_dashboard__session-right_1oze0_147","dashboard__session-accuracy":"_dashboard__session-accuracy_1oze0_151","dashboard__session-stats":"_dashboard__session-stats_1oze0_155"};function na({onClose:s}){const[e,a]=p.useState(null),[n,c]=p.useState(!0);p.useEffect(()=>{o()},[]);async function o(){try{const i=await M.practiceSessions.toArray(),g=i.filter(m=>m.execution.status==="completed"),x=await M.topics.toArray(),L=new Map(x.map(m=>[m.id,m])),C=await M.spacedRepetition.toArray(),E=g.reduce((m,S)=>m+(S.execution?.completedCount||0),0),_=g.reduce((m,S)=>m+(S.execution?.correctCount||0),0),W=E>0?_/E*100:0,P=g.reduce((m,S)=>S.execution.startedAt&&S.execution.completedAt?m+(new Date(S.execution.completedAt).getTime()-new Date(S.execution.startedAt).getTime())/1e3:m,0),J=g.length>0?P/g.length:0,Q=new Map;for(const m of g){const S=m.configuration.topicId;Q.has(S)||Q.set(S,{sessions:0,correct:0,total:0});const I=Q.get(S);I.sessions++,I.correct+=m.execution?.correctCount||0,I.total+=m.execution?.completedCount||0}const ee=Array.from(Q.entries()).map(([m,S])=>({topicId:m,topicName:L.get(m)?.title||m,sessionsCompleted:S.sessions,accuracy:S.total>0?S.correct/S.total*100:0,tasksReviewed:S.total})),q=new Date,me=C.filter(m=>m.algorithm.efactor>=2.5).length,we=C.filter(m=>m.algorithm.efactor<2.5&&m.algorithm.repetition>0).length,ge=C.filter(m=>m.algorithm.repetition===0).length,ne=C.filter(m=>new Date(m.schedule.nextReview)<=q).length,le=g.sort((m,S)=>{const I=m.execution.completedAt?new Date(m.execution.completedAt).getTime():0;return(S.execution.completedAt?new Date(S.execution.completedAt).getTime():0)-I}).slice(0,5);a({totalSessions:i.length,completedSessions:g.length,totalQuestions:E,correctAnswers:_,accuracyRate:W,averageSessionTime:J,currentStreak:0,totalStudyTime:P,topicProgress:ee,recentSessions:le,upcomingReviews:ne,masteryLevels:{mastered:me,learning:we,new:ge}})}catch(i){console.error("Failed to load dashboard stats:",i)}finally{c(!1)}}function l(i){const g=Math.floor(i/3600),x=Math.floor(i%3600/60);return g>0?`${g}h ${x}m`:`${x}m`}function y(i){return(typeof i=="string"?new Date(i):i).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}return n?t.jsxs("div",{className:z.dashboard__empty,style:{textAlign:"center"},children:[t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Lade Statistiken..."})]}):e?t.jsxs("div",{className:z.dashboard,children:[t.jsxs("div",{className:z.dashboard__header,children:[t.jsx(et,{variant:"secondary",onClick:s,className:z["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{className:z.dashboard__title,children:"üìä Lern-Dashboard"}),t.jsx("p",{className:z.dashboard__subtitle,children:"Deine Fortschritte und Statistiken im √úberblick"})]}),t.jsxs("div",{className:z.dashboard__metrics,children:[t.jsx(xe,{title:"Gesamt Sitzungen",value:e.completedSessions.toString(),subtitle:`von ${e.totalSessions} gestartet`,color:O.primary[500]}),t.jsx(xe,{title:"Genauigkeit",value:`${Math.round(e.accuracyRate)}%`,subtitle:`${e.correctAnswers}/${e.totalQuestions} richtig`,color:O.success[500]}),t.jsx(xe,{title:"Lernzeit",value:l(e.totalStudyTime),subtitle:`√ò ${l(e.averageSessionTime)} pro Sitzung`,color:O.warning[500]}),t.jsx(xe,{title:"Anstehende Wiederholungen",value:e.upcomingReviews.toString(),subtitle:"bereit zum √úben",color:O.info[500]})]}),t.jsxs(Ne,{padding:"medium",className:z["dashboard__mastery-card"],children:[t.jsx("h2",{className:z["dashboard__mastery-title"],children:"üéØ Beherrschungsniveau"}),t.jsxs("div",{className:z["dashboard__mastery-bars"],children:[t.jsx(pt,{label:"Gemeistert",count:e.masteryLevels.mastered,color:O.success[500]}),t.jsx(pt,{label:"In Arbeit",count:e.masteryLevels.learning,color:O.warning[500]}),t.jsx(pt,{label:"Neu",count:e.masteryLevels.new,color:O.primary[500]})]})]}),e.topicProgress.length>0&&t.jsxs(Ne,{padding:"medium",className:z["dashboard__topic-card"],children:[t.jsx("h2",{className:z["dashboard__topic-title"],children:"üìö Fortschritt nach Thema"}),t.jsx("div",{className:z["dashboard__topic-grid"],children:e.topicProgress.map(i=>t.jsxs("div",{className:z["dashboard__topic-item"],children:[t.jsxs("div",{className:z["dashboard__topic-header"],children:[t.jsx("span",{className:z["dashboard__topic-name"],children:i.topicName}),t.jsxs("span",{className:z["dashboard__topic-meta"],children:[i.sessionsCompleted," Sitzungen ‚Ä¢ ",Math.round(i.accuracy),"% genau"]})]}),t.jsx("div",{className:z["dashboard__topic-bar-container"],children:t.jsx("div",{className:z["dashboard__topic-bar-fill"],style:{background:i.accuracy>=75?O.success[500]:i.accuracy>=50?O.warning[500]:O.error[500],width:`${i.accuracy}%`}})}),t.jsxs("div",{className:z["dashboard__topic-stats"],children:[i.tasksReviewed," Aufgaben bearbeitet"]})]},i.topicId))})]}),e.recentSessions.length>0&&t.jsxs(Ne,{padding:"medium",children:[t.jsx("h2",{className:z["dashboard__sessions-title"],children:"üïê Letzte Sitzungen"}),t.jsx("div",{className:z["dashboard__sessions-list"],children:e.recentSessions.map(i=>t.jsxs("div",{className:z["dashboard__session-item"],children:[t.jsxs("div",{className:z["dashboard__session-left"],children:[t.jsx("div",{className:z["dashboard__session-topic"],children:i.configuration.topicId}),t.jsx("div",{className:z["dashboard__session-date"],children:i.execution.completedAt&&y(i.execution.completedAt)})]}),t.jsxs("div",{className:z["dashboard__session-right"],children:[t.jsxs("div",{className:z["dashboard__session-accuracy"],style:{color:i.results.accuracy>=75?O.success[500]:O.warning[500]},children:[Math.round(i.results.accuracy),"%"]}),t.jsxs("div",{className:z["dashboard__session-stats"],children:[i.execution.correctCount,"/",i.execution.completedCount]})]})]},i.id))})]})]}):t.jsxs("div",{className:z.dashboard__empty,children:[t.jsx(et,{variant:"secondary",onClick:s,className:z["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Keine Daten verf√ºgbar."})]})}const ra=({topic:s,onSelect:e,className:a,disabled:n=!1,"data-testid":c})=>{const[o,l]=Le.useState(!1),y={padding:"2rem",background:"var(--color-bg-secondary)",borderRadius:"12px",cursor:n?"not-allowed":"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"2px solid transparent",borderColor:o?"var(--color-primary)":"transparent",transform:o&&!n?"translateY(-4px)":"translateY(0)",boxShadow:o&&!n?"var(--shadow-lg)":"none",opacity:n?.5:1},i=`Thema ${s.name} √∂ffnen - ${s.description}`;return t.jsxs("button",{type:"button",onClick:()=>e(s.id),className:a,"data-testid":c,style:y,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),disabled:n,"aria-label":i,children:[s.icon&&t.jsx("span",{"aria-hidden":"true",style:{fontSize:"48px",display:"block",marginBottom:"16px"},children:s.icon}),t.jsx("h3",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px",color:"var(--color-text-primary)"},children:s.name}),t.jsx("p",{style:{fontSize:"14px",color:"var(--color-text-secondary)",lineHeight:1.5,margin:0},children:s.description})]})};function Lt(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone??"Europe/Berlin"}catch{return"Europe/Berlin"}}const N={version:1,theme:{mode:"system",fontScale:"medium",animationsEnabled:!0,reducedMotion:!1},audio:{autoPlayEnabled:!0,autoPlayRepeats:1,autoPlayDelayMs:1e3,soundEffectsEnabled:!0,soundEffectsVolume:.8,successChimeEnabled:!0,playbackRate:1},learning:{algorithm:"fsrs",dailyGoal:20,sessionSize:10,repeatDifficultTasks:!0,randomizeOrder:!0},notifications:{dailyReminderEnabled:!1,dailyReminderTime:"18:00",dailyReminderMessage:"Zeit zum Lernen! üìö",streakWarningEnabled:!0,weeklyReportEnabled:!1},interaction:{vibrationsEnabled:!0,vibrationOnCorrect:!0,vibrationOnIncorrect:!0,vibrationOnSessionComplete:!1,confettiEnabled:!0,confettiStyle:"standard",confettiIntensity:"medium",wakeLockEnabled:!0,keyboardShortcutsEnabled:!0},ai:{explanationsEnabled:!1,explanationDepth:"medium",includeExamples:!0,showLearningTips:!0,trainingOptIn:!1,dailyUsageLimit:20,usageToday:0},privacy:{dataStorageMode:"local",analyticsEnabled:!1,errorReportsEnabled:!1,betaFeaturesEnabled:!1},language:{interfaceLanguage:"de",timezone:Lt(),dateFormat:"DD.MM.YYYY"},database:{lastUpdatedAt:null,storageUsageBytes:null},lastSavedAt:null};function ze(s,e,a){return Number.isNaN(s)?e:Math.min(a,Math.max(e,s))}function oa(s){return s==="light"||s==="dark"||s==="system"}function ca(s){return s==="small"||s==="medium"||s==="large"||s==="x-large"}function la(s){return s===.5||s===.75||s===1||s===1.25||s===1.5}function da(s){return s==="sm-2"||s==="fsrs"||s==="neural"}function ua(s){return s==="standard"||s==="firework"||s==="emoji"}function _a(s){return s==="light"||s==="medium"||s==="strong"}function pa(s){return s==="short"||s==="medium"||s==="detailed"}function ha(s){return s==="local"||s==="cloud"}function ma(s){return s==="de"||s==="en"||s==="es"}function ga(s){return s==="DD.MM.YYYY"||s==="MM/DD/YYYY"||s==="YYYY-MM-DD"}function fa(s){return{mode:oa(s?.mode)?s.mode:N.theme.mode,fontScale:ca(s?.fontScale)?s.fontScale:N.theme.fontScale,animationsEnabled:!!(s?.animationsEnabled??N.theme.animationsEnabled),reducedMotion:!!(s?.reducedMotion??N.theme.reducedMotion)}}function ba(s){const e=s?.autoPlayRepeats,a=e===2||e===3?e:1,n=ze(Number(s?.autoPlayDelayMs??N.audio.autoPlayDelayMs),0,5e3),c=ze(Number(s?.soundEffectsVolume??N.audio.soundEffectsVolume),0,1);return{autoPlayEnabled:!!(s?.autoPlayEnabled??N.audio.autoPlayEnabled),autoPlayRepeats:a,autoPlayDelayMs:n,soundEffectsEnabled:!!(s?.soundEffectsEnabled??N.audio.soundEffectsEnabled),soundEffectsVolume:c,successChimeEnabled:!!(s?.successChimeEnabled??N.audio.successChimeEnabled),playbackRate:la(s?.playbackRate)?s.playbackRate:N.audio.playbackRate}}function ya(s){const e=ze(Number(s?.dailyGoal??N.learning.dailyGoal),1,200),a=ze(Number(s?.sessionSize??N.learning.sessionSize),1,100);return{algorithm:da(s?.algorithm)?s.algorithm:N.learning.algorithm,dailyGoal:e,sessionSize:a,repeatDifficultTasks:!!(s?.repeatDifficultTasks??N.learning.repeatDifficultTasks),randomizeOrder:!!(s?.randomizeOrder??N.learning.randomizeOrder)}}function va(s){const e=typeof s?.dailyReminderTime=="string"&&/^\d{2}:\d{2}$/.test(s.dailyReminderTime)?s.dailyReminderTime:N.notifications.dailyReminderTime,a=typeof s?.dailyReminderMessage=="string"&&s.dailyReminderMessage.length<=120?s.dailyReminderMessage:N.notifications.dailyReminderMessage;return{dailyReminderEnabled:!!(s?.dailyReminderEnabled??N.notifications.dailyReminderEnabled),dailyReminderTime:e,dailyReminderMessage:a,streakWarningEnabled:!!(s?.streakWarningEnabled??N.notifications.streakWarningEnabled),weeklyReportEnabled:!!(s?.weeklyReportEnabled??N.notifications.weeklyReportEnabled)}}function xa(s){return{vibrationsEnabled:!!(s?.vibrationsEnabled??N.interaction.vibrationsEnabled),vibrationOnCorrect:!!(s?.vibrationOnCorrect??N.interaction.vibrationOnCorrect),vibrationOnIncorrect:!!(s?.vibrationOnIncorrect??N.interaction.vibrationOnIncorrect),vibrationOnSessionComplete:!!(s?.vibrationOnSessionComplete??N.interaction.vibrationOnSessionComplete),confettiEnabled:!!(s?.confettiEnabled??N.interaction.confettiEnabled),confettiStyle:ua(s?.confettiStyle)?s.confettiStyle:N.interaction.confettiStyle,confettiIntensity:_a(s?.confettiIntensity)?s.confettiIntensity:N.interaction.confettiIntensity,wakeLockEnabled:!!(s?.wakeLockEnabled??N.interaction.wakeLockEnabled),keyboardShortcutsEnabled:!!(s?.keyboardShortcutsEnabled??N.interaction.keyboardShortcutsEnabled)}}function wa(s){const e=ze(Number(s?.dailyUsageLimit??N.ai.dailyUsageLimit),0,9999),a=ze(Number(s?.usageToday??N.ai.usageToday),0,e);return{explanationsEnabled:!!(s?.explanationsEnabled??N.ai.explanationsEnabled),explanationDepth:pa(s?.explanationDepth)?s.explanationDepth:N.ai.explanationDepth,includeExamples:!!(s?.includeExamples??N.ai.includeExamples),showLearningTips:!!(s?.showLearningTips??N.ai.showLearningTips),trainingOptIn:!!(s?.trainingOptIn??N.ai.trainingOptIn),dailyUsageLimit:e,usageToday:a}}function ka(s){return{dataStorageMode:ha(s?.dataStorageMode)?s.dataStorageMode:N.privacy.dataStorageMode,analyticsEnabled:!!(s?.analyticsEnabled??N.privacy.analyticsEnabled),errorReportsEnabled:!!(s?.errorReportsEnabled??N.privacy.errorReportsEnabled),betaFeaturesEnabled:!!(s?.betaFeaturesEnabled??N.privacy.betaFeaturesEnabled)}}function Sa(s){return{interfaceLanguage:ma(s?.interfaceLanguage)?s.interfaceLanguage:N.language.interfaceLanguage,timezone:typeof s?.timezone=="string"&&s.timezone.length>0?s.timezone:Lt(),dateFormat:ga(s?.dateFormat)?s.dateFormat:N.language.dateFormat}}function ja(s){const e=typeof s?.lastUpdatedAt=="string"||s?.lastUpdatedAt===null?s.lastUpdatedAt:N.database.lastUpdatedAt,a=typeof s?.storageUsageBytes=="number"||s?.storageUsageBytes===null?s.storageUsageBytes:N.database.storageUsageBytes;return{lastUpdatedAt:e,storageUsageBytes:a}}function Xe(s){if(!s||typeof s!="object")return{...N};const e=s,a=typeof e.version=="number"?e.version:N.version,n=typeof e.lastSavedAt=="string"||e.lastSavedAt===null?e.lastSavedAt:N.lastSavedAt;return{version:a,theme:fa(e.theme),audio:ba(e.audio),learning:ya(e.learning),notifications:va(e.notifications),interaction:xa(e.interaction),ai:wa(e.ai),privacy:ka(e.privacy),language:Sa(e.language),database:ja(e.database),lastSavedAt:n}}const jt="mindforge.app-settings.v1";function Aa(s){return s==="system"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":s}function Na(s){if(typeof document>"u")return;const e={small:"15px",medium:"16px",large:"18px","x-large":"20px"};document.documentElement.style.fontSize=e[s]}function Ra(s){typeof document>"u"||document.documentElement.classList.toggle("reduced-motion",s)}function At(s){if(typeof document>"u")return;const e=Aa(s);document.documentElement.setAttribute("data-theme",e)}class Ca{currentSettings={...N};mediaQuery=null;constructor(){typeof window<"u"&&window.matchMedia&&(this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.mediaQuery.addEventListener("change",this.handleSystemThemeChange))}load(){try{const e=localStorage.getItem(jt);if(!e)return this.applySettings(N),this.currentSettings={...N},this.emitUpdate(),this.currentSettings;const a=Xe(JSON.parse(e));return this.currentSettings=a,this.applySettings(a),this.emitUpdate(),a}catch(e){return console.warn("[Settings] Failed to load settings, resetting to defaults.",e),this.currentSettings={...N},this.persist(this.currentSettings),this.applySettings(this.currentSettings),this.emitUpdate(),this.currentSettings}}save(e){const a={...e,lastSavedAt:new Date().toISOString()};return this.currentSettings=a,this.persist(a),this.applySettings(a),this.emitUpdate(),a}update(e){const a=e(this.currentSettings);return this.save(Xe(a))}reset(){const e={...N,lastSavedAt:new Date().toISOString()};return this.currentSettings=e,this.persist(e),this.applySettings(e),this.emitUpdate(),e}export(){const e={exportedAt:new Date().toISOString(),settings:this.currentSettings};return JSON.stringify(e,null,2)}import(e){try{const a=JSON.parse(e),n=a?.settings??a,c=Xe(n);return this.save(c)}catch(a){throw console.error("[Settings] Failed to import settings",a),new Error("Ung√ºltige Einstellungsdatei.")}}async estimateStorageUsage(){if(navigator.storage?.estimate)try{const e=await navigator.storage.estimate();return{usage:e.usage??null,quota:e.quota??null}}catch(e){console.warn("[Settings] Failed to estimate storage usage",e)}return{usage:null,quota:null}}persist(e){localStorage.setItem(jt,JSON.stringify(e))}applySettings(e){At(e.theme.mode),Na(e.theme.fontScale),Ra(e.theme.reducedMotion||!e.theme.animationsEnabled)}handleSystemThemeChange=()=>{this.currentSettings.theme.mode==="system"&&(At("system"),this.emitUpdate())};emitUpdate(){if(typeof window>"u")return;const e={settings:this.currentSettings};window.dispatchEvent(new CustomEvent("app:settings:updated",{detail:e}))}dispose(){this.mediaQuery&&this.mediaQuery.removeEventListener("change",this.handleSystemThemeChange)}getSettings(){return this.currentSettings}}const oe=new Ca,Ea=2e3;function Ta(){const[s,e]=p.useState(null),[a,n]=p.useState(!0),[c,o]=p.useState("idle"),[l,y]=p.useState(null),i=p.useRef(null),g=p.useRef(null);p.useEffect(()=>{const P=oe.load();return g.current=P,e(P),n(!1),oe.estimateStorageUsage().then(J=>{y(J)}),()=>{i.current&&window.clearTimeout(i.current)}},[]);const x=p.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>{o("idle"),i.current=null},Ea)},[]),L=p.useCallback(P=>{if(!g.current)return;o("saving");const J=typeof P=="function"?P(g.current):{...g.current,...P},Q=Xe(J),ee=oe.save(Q);g.current=ee,e(ee),o("saved"),x()},[x]),C=p.useCallback(()=>{o("saving");const P=oe.reset();g.current=P,e(P),o("saved"),x()},[x]),E=p.useCallback(()=>oe.export(),[]),_=p.useCallback(P=>{o("saving");const J=oe.import(P);g.current=J,e(J),o("saved"),x()},[x]),W=p.useCallback(async()=>{const P=await oe.estimateStorageUsage();y(P)},[]);return{settings:s,loading:a,saveState:c,updateSettings:L,resetSettings:C,exportSettings:E,importSettingsFromText:_,storageEstimate:l,refreshStorageEstimate:W}}const Ia="_settingsPage_x6a51_1",Pa="_settingsHeader_x6a51_8",Da="_settingsTitle_x6a51_16",La="_saveIndicator_x6a51_27",za="_searchBar_x6a51_36",Ba="_searchInput_x6a51_41",$a="_searchIcon_x6a51_58",Ma="_presets_x6a51_67",Oa="_presetButton_x6a51_74",Fa="_sections_x6a51_89",Ua="_section_x6a51_89",qa="_sectionHeader_x6a51_102",Ga="_sectionHeaderIcon_x6a51_119",Ha="_sectionCaret_x6a51_123",Va="_sectionContent_x6a51_132",Wa="_settingGroup_x6a51_138",Ja="_settingItem_x6a51_143",Ya="_settingLabel_x6a51_149",Ka="_settingDescription_x6a51_156",Qa="_radioGroup_x6a51_168",Za="_toggleGroup_x6a51_169",Xa="_radioOption_x6a51_175",ei="_buttonRow_x6a51_202",ti="_dangerButton_x6a51_208",si="_infoCard_x6a51_213",ai="_infoGrid_x6a51_221",ii="_linkButton_x6a51_232",ni="_footerActions_x6a51_241",ri="_resetButton_x6a51_249",oi="_closeButton_x6a51_250",A={settingsPage:Ia,settingsHeader:Pa,settingsTitle:Da,saveIndicator:La,"saveIndicator--saved":"_saveIndicator--saved_x6a51_32",searchBar:za,searchInput:Ba,searchIcon:$a,presets:Ma,presetButton:Oa,sections:Fa,section:Ua,sectionHeader:qa,sectionHeaderIcon:Ga,sectionCaret:Ha,"sectionCaret--collapsed":"_sectionCaret--collapsed_x6a51_128",sectionContent:Va,settingGroup:Wa,settingItem:Ja,settingLabel:Ya,settingDescription:Ka,radioGroup:Qa,toggleGroup:Za,radioOption:Xa,"radioOption--active":"_radioOption--active_x6a51_187",buttonRow:ei,dangerButton:ti,infoCard:si,infoGrid:ai,linkButton:ii,footerActions:ni,resetButton:ri,closeButton:oi};function Nt(s){if(s==null)return"‚Äì";if(s===0)return"0 B";const e=["B","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(1024));return`${(s/Math.pow(1024,a)).toFixed(1)} ${e[a]}`}function Rt(s){if(!s)return"Nie";try{const e=new Date(s);return new Intl.DateTimeFormat("de-DE",{dateStyle:"medium",timeStyle:"short"}).format(e)}catch{return s??""}}const Ct=[{id:"performance",label:"‚ö° Performance-Modus",apply:s=>({...s,theme:{...s.theme,animationsEnabled:!1,mode:"dark"},audio:{...s.audio,autoPlayEnabled:!1}})},{id:"accessibility",label:"‚ôø Barrierefreiheit",apply:s=>({...s,theme:{...s.theme,fontScale:"x-large",reducedMotion:!0,animationsEnabled:!1,mode:"light"}})},{id:"power-saver",label:"üîã Energiesparen",apply:s=>({...s,audio:{...s.audio,autoPlayEnabled:!1},theme:{...s.theme,animationsEnabled:!1}})}];function ci({onClose:s}){const{settings:e,loading:a,saveState:n,updateSettings:c,resetSettings:o,exportSettings:l,importSettingsFromText:y,storageEstimate:i,refreshStorageEstimate:g}=Ta(),{settings:x,updateSettings:L}=Pt(),[C,E]=p.useState(""),_=p.useRef(null),[W,P]=p.useState(null),J=m=>{c(S=>({...S,theme:{...S.theme,mode:m}}))},Q=m=>{c(S=>({...S,theme:{...S.theme,fontScale:m}}))},ee=m=>{if(c(S=>({...S,audio:{...S.audio,...m}})),x){const S={};m.autoPlayEnabled!==void 0&&(S.autoPlayEnabled=m.autoPlayEnabled),Object.keys(S).length>0&&L(S)}},q=p.useCallback(m=>{c(S=>({...S,database:{...S.database,...m}}))},[c]);if(p.useEffect(()=>{const m=S=>{const I=S.detail;I?.lastUpdatedAt&&q({lastUpdatedAt:I.lastUpdatedAt}),typeof I?.storageUsageBytes=="number"&&q({storageUsageBytes:I.storageUsageBytes}),g()};return window.addEventListener("app:database:updated",m),()=>{window.removeEventListener("app:database:updated",m)}},[q,g]),a||!e)return t.jsx("div",{className:A.settingsPage,children:t.jsx("p",{children:"Lade Einstellungen..."})});const me=m=>{const S=Ct.find(I=>I.id===m);S&&c(()=>S.apply(e))},we=()=>{const m=l(),S=new Blob([m],{type:"application/json"}),I=URL.createObjectURL(S),Y=document.createElement("a");Y.href=I,Y.download=`mindforge-settings-${new Date().toISOString().slice(0,10)}.json`,Y.click(),URL.revokeObjectURL(I)},ge=m=>{const S=m.target.files?.[0];if(!S)return;const I=new FileReader;I.onload=()=>{try{const Y=typeof I.result=="string"?I.result:"";y(Y),P(null)}catch(Y){console.error(Y),P("Import fehlgeschlagen. Bitte g√ºltige JSON-Datei ausw√§hlen.")}},I.onerror=()=>{P("Datei konnte nicht gelesen werden.")},I.readAsText(S),m.target.value=""},le=(()=>{const m={id:"database",icon:"üì¶",title:"Datenbank & Speicherung",keywords:["datenbank","speicherung","backup","import","export","speicher"],content:t.jsxs("div",{className:A.settingGroup,children:[t.jsxs("div",{className:A.buttonRow,children:[t.jsx("button",{type:"button",onClick:()=>{confirm("Datenbank neu laden? Lernpfade werden aktualisiert.")&&window.dispatchEvent(new CustomEvent("app:database:reseed"))},children:"üîÑ Datenbank Aktualisieren"}),t.jsx("button",{type:"button",className:U(A.dangerButton),onClick:()=>{confirm("‚ö†Ô∏è Alle Daten l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden!")&&window.dispatchEvent(new CustomEvent("app:database:reset"))},children:"üóëÔ∏è Alle Daten L√∂schen"}),t.jsx("button",{type:"button",onClick:we,children:"üì• Daten Exportieren"}),t.jsx("button",{type:"button",onClick:()=>{_.current?.click()},children:"üì§ Daten Importieren"}),t.jsx("input",{ref:_,type:"file",accept:"application/json",style:{display:"none"},onChange:ge})]}),W&&t.jsx("div",{className:A.infoCard,style:{borderColor:"#f97316",color:"#b45309"},children:W}),t.jsxs("div",{className:A.infoCard,children:[t.jsxs("div",{className:A.infoGrid,children:[t.jsxs("div",{children:["üíæ Speichernutzung: ",Nt(i?.usage??null)," / ",Nt(i?.quota??null)]}),t.jsxs("div",{children:["üìÖ Letztes Update: ",Rt(e.database.lastUpdatedAt)]})]}),t.jsx("button",{type:"button",style:{marginTop:"0.75rem"},onClick:()=>{g()},children:"Speichernutzung aktualisieren"})]})]})},S={id:"theme",icon:"üé®",title:"Darstellung & Theme",keywords:["theme","dark","light","schrift","font","animation"],content:t.jsxs("div",{className:A.settingGroup,children:[t.jsxs("div",{className:A.settingItem,children:[t.jsx("div",{className:A.settingLabel,children:"Theme"}),t.jsx("div",{className:A.radioGroup,children:["light","dark","system"].map(D=>t.jsxs("label",{className:U(A.radioOption,e.theme.mode===D&&A["radioOption--active"]),children:[t.jsx("input",{type:"radio",checked:e.theme.mode===D,onChange:()=>J(D)}),D==="light"?"Hell":D==="dark"?"Dunkel":"System"]},D))})]}),t.jsxs("div",{className:A.settingItem,children:[t.jsx("div",{className:A.settingLabel,children:"Schriftgr√∂√üe"}),t.jsx("div",{className:A.radioGroup,children:["small","medium","large","x-large"].map(D=>t.jsxs("label",{className:U(A.radioOption,e.theme.fontScale===D&&A["radioOption--active"]),children:[t.jsx("input",{type:"radio",checked:e.theme.fontScale===D,onChange:()=>Q(D)}),D==="small"?"Klein":D==="medium"?"Mittel":D==="large"?"Gro√ü":"Sehr gro√ü"]},D))})]}),t.jsxs("div",{className:A.toggleGroup,children:[t.jsxs("label",{className:A.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.theme.animationsEnabled,onChange:D=>c(te=>({...te,theme:{...te.theme,animationsEnabled:D.target.checked}}))}),"Animationen aktivieren"]}),t.jsxs("label",{className:A.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.theme.reducedMotion,onChange:D=>c(te=>({...te,theme:{...te.theme,reducedMotion:D.target.checked}}))}),"Reduzierte Bewegungen"]})]})]})},I={id:"audio",icon:"üîä",title:"Audio",keywords:["audio","autoplay","sound"],content:t.jsxs("div",{className:A.settingGroup,children:[t.jsxs("label",{className:A.radioOption,children:[t.jsx("input",{type:"checkbox",checked:e.audio.autoPlayEnabled,onChange:D=>ee({autoPlayEnabled:D.target.checked})}),"Audio automatisch abspielen (Spanisch)"]}),t.jsx("p",{className:A.settingDescription,children:"Steuert, ob Vokabelkarten automatisch die spanische Aussprache wiedergeben."})]})},Y={id:"info",icon:"‚ÑπÔ∏è",title:"Info & Support",keywords:["hilfe","faq","bug","feature","support"],content:t.jsxs("div",{className:A.settingGroup,children:[t.jsxs("div",{className:A.infoCard,children:[t.jsx("div",{children:"Version: 1.0.0"}),t.jsxs("div",{children:["Letzte Aktualisierung: ",new Intl.DateTimeFormat("de-DE").format(new Date)]})]}),t.jsxs("div",{className:A.buttonRow,children:[t.jsx("a",{className:A.linkButton,href:"https://github.com/trsdn/learning-platform#readme",target:"_blank",rel:"noreferrer",children:"üìñ Dokumentation"}),t.jsx("a",{className:A.linkButton,href:"https://github.com/trsdn/learning-platform/issues/new",target:"_blank",rel:"noreferrer",children:"üêõ Bug melden"}),t.jsx("a",{className:A.linkButton,href:"https://github.com/trsdn/learning-platform/issues/new",target:"_blank",rel:"noreferrer",children:"üí° Feature vorschlagen"}),t.jsx("a",{className:A.linkButton,href:"https://github.com/trsdn/learning-platform/discussions",target:"_blank",rel:"noreferrer",children:"‚ùì Hilfe & FAQ"})]}),t.jsx("div",{className:A.settingDescription,children:"Entwickelt von @trsdn ¬∑ Open Source auf GitHub"})]})};return[m,S,I,Y]})().filter(m=>C?`${m.title} ${m.keywords.join(" ")}`.toLowerCase().includes(C.toLowerCase()):!0);return t.jsxs("div",{className:A.settingsPage,children:[t.jsxs("header",{className:A.settingsHeader,children:[t.jsxs("div",{className:A.settingsTitle,children:[t.jsx("h1",{children:"‚öôÔ∏è Einstellungen"}),t.jsxs("div",{className:U(A.saveIndicator,n==="saved"&&A["saveIndicator--saved"]),children:[n==="saving"&&"Speichere...",n==="saved"&&"Gespeichert ‚úì",n==="idle"&&e.lastSavedAt&&`Zuletzt gespeichert: ${Rt(e.lastSavedAt)}`]})]}),t.jsx("button",{className:A.closeButton,type:"button",onClick:s,children:"Schlie√üen"})]}),t.jsxs("div",{className:A.searchBar,children:[t.jsx("span",{className:A.searchIcon,children:"üîç"}),t.jsx("input",{className:A.searchInput,type:"search",placeholder:"Einstellungen durchsuchen...",value:C,onChange:m=>E(m.target.value)})]}),t.jsx("div",{className:A.presets,children:Ct.map(m=>t.jsx("button",{type:"button",className:A.presetButton,onClick:()=>me(m.id),children:m.label},m.id))}),t.jsx("div",{className:A.sections,children:le.map(m=>t.jsx(li,{icon:m.icon,title:m.title,children:m.content},m.id))}),t.jsxs("footer",{className:A.footerActions,children:[t.jsx("button",{className:A.resetButton,type:"button",onClick:o,children:"Auf Standardwerte zur√ºcksetzen"}),t.jsx("button",{className:A.closeButton,type:"button",onClick:s,children:"Fertig"})]})]})}function li({icon:s,title:e,children:a}){const[n,c]=p.useState(!0);return t.jsxs("section",{className:A.section,children:[t.jsxs("button",{type:"button",className:A.sectionHeader,onClick:()=>c(o=>!o),"aria-expanded":n,children:[t.jsxs("h2",{children:[t.jsx("span",{className:A.sectionHeaderIcon,children:s}),e]}),t.jsx("span",{className:U(A.sectionCaret,!n&&A["sectionCaret--collapsed"]),children:"‚ñº"})]}),n&&t.jsx("div",{className:A.sectionContent,children:a})]})}typeof window<"u"&&oe.load();function di(){const[s,e]=p.useState([]),[a,n]=p.useState(null),[c,o]=p.useState([]),[l,y]=p.useState({}),[i,g]=p.useState(null),[x,L]=p.useState(!0),[C,E]=p.useState(!1),[_,W]=p.useState(null),[P,J]=p.useState(!1),[Q,ee]=p.useState(!1),[q,me]=p.useState({targetCount:10,includeReview:!0}),[we,ge]=p.useState(!1),[ne,le]=p.useState("system"),m=p.useRef(!1);p.useEffect(()=>{m.current||(m.current=!0,Y())},[]),p.useEffect(()=>{const b=F=>{ke(!0).catch($=>console.error("Reseed event failed",$))},T=F=>{Me().catch($=>console.error("Reset event failed",$))};return window.addEventListener("app:database:reseed",b),window.addEventListener("app:database:reset",T),()=>{window.removeEventListener("app:database:reseed",b),window.removeEventListener("app:database:reset",T)}},[]),p.useEffect(()=>{const b=T=>{const F=T.detail;F?.settings?.theme?.mode&&le(F.settings.theme.mode)};return window.addEventListener("app:settings:updated",b),le(oe.getSettings().theme.mode),()=>{window.removeEventListener("app:settings:updated",b)}},[]);const S=()=>{const b=["system","light","dark"],T=b.indexOf(ne),F=b[(T+1)%b.length]??"system",$=oe.update(V=>({...V,theme:{...V.theme,mode:F}}));le($.theme.mode)},I=ne==="system"?"System":ne==="light"?"Hell":"Dunkel";async function Y(){try{const b="2",T=localStorage.getItem("dbVersion"),F=await M.topics.count(),$=await M.tasks.count();console.log(`Database status: ${F} topics, ${$} tasks, version: ${T}`),F===0||$===0||T!==b?(console.log(T!==b?`Database version mismatch (${T} -> ${b}), re-seeding...`:"Database empty or incomplete, seeding..."),await wt(M),localStorage.setItem("dbVersion",b)):console.log("Database already seeded, skipping seed");const V=await M.topics.toArray();e(V),L(!1)}catch(b){console.error("Failed to initialize app:",b),console.error("Error details:",{name:b?.name,message:b?.message,failures:b?.failures,stack:b?.stack}),L(!1)}}async function D(b){n(b);const T=await M.learningPaths.where("topicId").equals(b.id).toArray();console.log(`Loading learning paths for topic ${b.id}:`,T),T.sort(($,V)=>new Date(V.createdAt).getTime()-new Date($.createdAt).getTime());const F={};for(const $ of T){const V=await M.tasks.where("learningPathId").equals($.id).toArray();F[$.id]=V.length,console.log(`Learning path "${$.title}" (${$.id}): ${V.length} tasks in DB, taskIds array length: ${$.taskIds?.length||0}`),console.log("Task IDs:",V.map(ue=>ue.id))}y(F),o(T)}function te(b){g(b),ee(!0)}function ae(){ee(!1),E(!0)}function Be(){ee(!1),g(null)}async function st(){if(E(!1),i&&a){const b=await M.practiceSessions.where("execution.status").equals("completed").reverse().limit(1).toArray();b.length>0&&b[0]&&W(b[0])}}function He(){E(!1),g(null)}function de(){W(null)}function $e(){W(null),i&&E(!0)}if(x)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center"},children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{children:"Wird geladen..."})]});if(P)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(na,{onClose:()=>J(!1)})});if(we)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ci,{onClose:()=>ge(!1)})});if(_)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(Zs,{session:_,onClose:de,onStartNew:$e})});if(Q&&i&&a)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("button",{onClick:Be,style:{padding:"0.5rem 1rem",background:"var(--color-bg-tertiary)",color:"var(--color-text-primary)",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Sitzung konfigurieren"}),t.jsx("p",{style:{color:"var(--color-text-secondary)",marginBottom:"2rem"},children:i.title}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.5rem"},children:"Anzahl der Fragen"}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[5,10,15,20].map(b=>t.jsx("button",{onClick:()=>me({...q,targetCount:b}),style:{padding:"0.75rem 1.5rem",background:q.targetCount===b?"var(--color-primary)":"var(--color-bg-secondary)",color:q.targetCount===b?"var(--color-text-inverse)":"var(--color-text-primary)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:b},b))})]}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:q.includeReview,onChange:b=>me({...q,includeReview:b.target.checked}),style:{marginRight:"0.5rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),t.jsx("span",{children:"Wiederholungsfragen einbeziehen"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)",marginTop:"0.5rem",marginLeft:"1.75rem"},children:"Fragen, die du bereits beantwortet hast und die zur Wiederholung f√§llig sind"})]}),t.jsx("button",{onClick:ae,style:{padding:"1rem 2rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"500",width:"100%"},children:"Sitzung starten ‚Üí"})]});if(C&&i&&a)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(Vs,{topicId:a.id,learningPathIds:[i.id],targetCount:q.targetCount,includeReview:q.includeReview,onComplete:st,onCancel:He})});if(a)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsx("button",{onClick:()=>n(null),style:{padding:"0.5rem 1rem",background:"var(--color-bg-tertiary)",color:"var(--color-text-primary)",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck zu Themen"}),t.jsxs("h1",{children:["üìö ",a.title]}),t.jsx("h2",{style:{marginTop:"2rem",marginBottom:"1rem"},children:"Lernpfade"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1rem"},children:c.map(b=>t.jsxs("div",{style:{padding:"1.5rem",background:"var(--color-bg-primary)",border:"2px solid var(--color-bg-tertiary)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.borderColor="var(--color-primary)",T.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:T=>{T.currentTarget.style.borderColor="var(--color-bg-tertiary)",T.currentTarget.style.transform="translateY(0)"},children:[t.jsx("h3",{style:{marginBottom:"0.5rem"},children:b.title}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",marginBottom:"1rem"},children:b.description}),t.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[t.jsx("span",{style:{marginRight:"1rem"},children:b.difficulty==="easy"?"üü¢ Leicht":b.difficulty==="medium"?"üü° Mittel":"üî¥ Schwer"}),t.jsxs("span",{children:[l[b.id]||b.taskIds?.length||0," Aufgaben"]})]}),t.jsx("button",{onClick:()=>te(b),style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Lernpfad starten ‚Üí"})]},b.id))})]});async function ke(b=!0){try{await M.topics.clear(),await M.learningPaths.clear(),await M.tasks.clear(),await wt(M);const T=await M.topics.toArray();e(T);let F;if(navigator.storage?.estimate)try{F=(await navigator.storage.estimate()).usage??void 0}catch(V){console.warn("Storage estimate failed",V)}const $={lastUpdatedAt:new Date().toISOString(),storageUsageBytes:F};window.dispatchEvent(new CustomEvent("app:database:updated",{detail:$})),b&&alert("‚úÖ Datenbank erfolgreich aktualisiert!")}catch(T){console.error("Reseed failed:",T),b&&alert("‚ùå Fehler beim Aktualisieren der Datenbank")}}async function Me(){try{await M.delete(),localStorage.removeItem("dbVersion"),localStorage.removeItem("mindforge.app-settings.v1"),localStorage.removeItem("audioSettings"),window.location.reload()}catch(b){console.error("Reset failed:",b),alert("‚ùå Fehler beim L√∂schen der Daten")}}function re(b){const T=b.id==="test"?"üéØ":b.id==="mathematik"?"üî¢":b.id==="spanisch"?"üá™üá∏":"üß¨",F=b.id==="test"?"#fef3c7":b.id==="mathematik"?"#dbeafe":b.id==="spanisch"?"#fef3c7":"#dcfce7";return{id:b.id,name:b.title,description:`${b.learningPathIds.length} Lernpfade`,icon:T,color:F}}return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{style:{fontSize:"1.1rem",color:"var(--color-text-secondary)",marginTop:"0.5rem"},children:"Erweitere dein Wissen, eine Frage nach der anderen"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsxs("button",{onClick:S,title:`Theme wechseln (aktuell: ${I})`,style:{padding:"0.75rem 1.5rem",background:"var(--color-primary, #667eea)",color:"#ffffff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:["üåì ",I]}),t.jsx("button",{onClick:()=>J(!0),style:{padding:"0.75rem 1.5rem",background:"var(--color-primary)",color:"var(--color-text-inverse)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Dashboard"}),t.jsx("button",{onClick:()=>ge(!0),style:{padding:"0.75rem 1.5rem",background:"var(--color-info)",color:"var(--color-text-inverse)",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"‚öôÔ∏è Einstellungen"})]})]}),t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Themen ausw√§hlen"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1.5rem"},children:s.map(b=>t.jsx(ra,{topic:re(b),onSelect:T=>{const F=s.find($=>$.id===T);F&&D(F)},"data-testid":`topic-card-${b.id}`},b.id))})]})}ht.createRoot(document.getElementById("root")).render(t.jsx(Le.StrictMode,{children:t.jsx(di,{})}));
//# sourceMappingURL=index-DSzVm6Db.js.map
