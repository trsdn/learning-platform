import{r as f,a as Nt,R as fe}from"./react-DnQQq7lD.js";import{D as Rt}from"./storage-7oeF2ZJA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}})();var at={exports:{}},Pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=f,Tt=Symbol.for("react.element"),It=Symbol.for("react.fragment"),Pt=Object.prototype.hasOwnProperty,Dt=Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lt={key:!0,ref:!0,__self:!0,__source:!0};function rt(a,e,s){var r,l={},c=null,o=null;s!==void 0&&(c=""+s),e.key!==void 0&&(c=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Pt.call(e,r)&&!Lt.hasOwnProperty(r)&&(l[r]=e[r]);if(a&&a.defaultProps)for(r in e=a.defaultProps,e)l[r]===void 0&&(l[r]=e[r]);return{$$typeof:Tt,type:a,key:c,ref:o,props:l,_owner:Dt.current}}Pe.Fragment=It;Pe.jsx=rt;Pe.jsxs=rt;at.exports=Pe;var t=at.exports,qe={},et=Nt;qe.createRoot=et.createRoot,qe.hydrateRoot=et.hydrateRoot;class $t extends Rt{topics;learningPaths;tasks;answerHistory;userProgress;practiceSessions;spacedRepetition;constructor(){super("mindforge-academy-test"),this.version(1).stores({topics:"id, title, isActive, createdAt",learningPaths:"id, topicId, difficulty, isActive, createdAt",tasks:"id, learningPathId, type, *metadata.tags, metadata.difficulty, createdAt, hasAudio, language",answerHistory:"id, taskId, sessionId, timestamp, isCorrect",userProgress:"id, topicId, learningPathId, *milestones.lastActivity",practiceSessions:"id, execution.status, execution.startedAt, execution.completedAt, createdAt",spacedRepetition:"id, taskId, schedule.nextReview, algorithm.interval, createdAt"})}}const I=new $t;async function zt(){const a=new Map,e=[],s=[],r={mathematik:["algebra-basics.json","geometry-basics.json","advanced-tasks.json","brueche-grundlagen.json"],biologie:["zellbiologie.json","genetik-basics.json"],spanisch:["spanisch-grundlagen.json","begruessung-vorstellung.json","familie-persoenliches.json","zahlen-farben-tiere.json","vokabeltest-karteikarten.json"],test:["all-task-types.json"]};for(const[l,c]of Object.entries(r)){if(!a.has(l)){const o=Et(l);a.set(l,o)}for(const o of c)try{const i=`/learning-platform/test/learning-paths/${l}/${o}`,h=await fetch(i);if(!h.ok){console.warn(`Failed to load ${i}: ${h.status}`);continue}const b=await h.json(),R=b.tasks.map(u=>u.id),j={...b.learningPath,taskIds:R,createdAt:b.learningPath.createdAt?new Date(b.learningPath.createdAt):new Date("2024-01-01"),updatedAt:b.learningPath.createdAt?new Date(b.learningPath.createdAt):new Date("2024-01-01")};e.push(j);const C=a.get(l);C.learningPathIds.includes(j.id)||C.learningPathIds.push(j.id);for(const u of b.tasks){const q={...u,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")};s.push(q)}}catch(p){console.error(`Failed to load learning path ${l}/${o}:`,p)}}return{topics:Array.from(a.values()),learningPaths:e,tasks:s}}function Et(a){const s={test:{id:"test",title:"Test & Demo",description:"Demonstriert alle Aufgabentypen der Plattform",metadata:{estimatedHours:1,difficultyLevel:"beginner",prerequisites:[]}},mathematik:{id:"mathematik",title:"Mathematik",description:"Grundlagen der Mathematik: Algebra, Geometrie und mehr",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},biologie:{id:"biologie",title:"Biologie",description:"Einf√ºhrung in die Biologie: Zellen, Genetik und √ñkosysteme",metadata:{estimatedHours:35,difficultyLevel:"beginner",prerequisites:[]}},spanisch:{id:"spanisch",title:"Spanisch",description:"Lerne Spanisch: Vokabeln, Grammatik und Konversation",metadata:{estimatedHours:50,difficultyLevel:"beginner",prerequisites:[]}},chemie:{id:"chemie",title:"Chemie",description:"Grundlagen der Chemie: Atome, Molek√ºle und Reaktionen",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},physik:{id:"physik",title:"Physik",description:"Einf√ºhrung in die Physik: Kr√§fte, Energie und Bewegung",metadata:{estimatedHours:45,difficultyLevel:"intermediate",prerequisites:[]}}}[a]||{id:a,title:a.charAt(0).toUpperCase()+a.slice(1),description:`Lernmaterialien f√ºr ${a}`,metadata:{estimatedHours:30,difficultyLevel:"beginner",prerequisites:[]}};return{id:s.id,title:s.title,description:s.description,learningPathIds:[],isActive:!0,metadata:s.metadata,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}}async function tt(a){console.log("üóëÔ∏è Clearing existing database...");const e=await a.topics.count(),s=await a.learningPaths.count(),r=await a.tasks.count();console.log(`Before clear: ${e} topics, ${s} paths, ${r} tasks`),await a.topics.clear(),await a.learningPaths.clear(),await a.tasks.clear();const l=await a.tasks.count();console.log(`After clear: ${l} tasks remaining`),console.log("üìÇ Loading learning paths from JSON files...");const c=await zt();if(c.topics.length===0)throw new Error("No learning paths found in JSON files!");console.log(`Saving to database: ${c.topics.length} topics, ${c.learningPaths.length} learning paths, ${c.tasks.length} tasks`),console.log("Topics:",c.topics.map(h=>h.id)),console.log("Learning paths:",c.learningPaths.map(h=>`${h.id} (${h.taskIds?.length||0} taskIds)`)),console.log("Tasks:",c.tasks.map(h=>`${h.id} (learningPathId: ${h.learningPathId})`));try{await a.topics.bulkAdd(c.topics),console.log("‚úì Topics saved")}catch{console.log("‚ö†Ô∏è Topics exist, using bulkPut to update..."),await a.topics.bulkPut(c.topics),console.log("‚úì Topics updated")}try{await a.learningPaths.bulkAdd(c.learningPaths),console.log("‚úì Learning paths saved")}catch{console.log("‚ö†Ô∏è Learning paths exist, using bulkPut to update..."),await a.learningPaths.bulkPut(c.learningPaths),console.log("‚úì Learning paths updated")}try{await a.tasks.bulkAdd(c.tasks),console.log("‚úì Tasks saved")}catch(h){console.error("‚ùå Error saving tasks with bulkAdd:",h.message),console.log("‚ö†Ô∏è Some tasks already exist, using bulkPut to update...");try{await a.tasks.bulkPut(c.tasks),console.log("‚úì Tasks updated with bulkPut")}catch(b){console.error("‚ùå Error with bulkPut:",b.message)}}console.log(`‚úÖ Loaded from JSON: ${c.topics.length} topics, ${c.learningPaths.length} learning paths, ${c.tasks.length} tasks`);const o=await a.topics.count(),p=await a.learningPaths.count(),i=await a.tasks.count();console.log(`‚úÖ Verified in DB: ${o} topics, ${p} learning paths, ${i} tasks`)}class nt extends Error{constructor(e,s,r){super(e),this.code=s,this.context=r,this.name="LearningPlatformError"}}class oe extends nt{constructor(e,s){super(e,"VALIDATION_ERROR",s),this.name="ValidationError"}}class me extends nt{constructor(e,s){super(`${e} with id ${s} not found`,"NOT_FOUND",{resource:e,id:s}),this.name="NotFoundError"}}class J{id;configuration;execution;results;createdAt;updatedAt;constructor(e){J.validate(e),this.id=e.id,this.configuration={...e.configuration,learningPathIds:[...e.configuration.learningPathIds]},this.execution={taskIds:[...e.execution.taskIds],completedCount:e.execution.completedCount,correctCount:e.execution.correctCount,status:e.execution.status,totalTimeSpent:e.execution.totalTimeSpent},e.execution.startedAt&&(this.execution.startedAt=new Date(e.execution.startedAt)),e.execution.completedAt&&(this.execution.completedAt=new Date(e.execution.completedAt)),this.results={...e.results,difficultyDistribution:{...e.results.difficultyDistribution},improvementAreas:[...e.results.improvementAreas]},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.configuration?.targetCount!==void 0&&(e.configuration.targetCount<5||e.configuration.targetCount>50))throw new oe("Target count must be between 5 and 50",{field:"targetCount",value:e.configuration.targetCount});if(e.execution?.status!==void 0){const s=["planned","active","paused","completed","abandoned"];if(!s.includes(e.execution.status))throw new oe("Invalid session status",{field:"status",value:e.execution.status,validValues:s})}}static create(e,s,r,l,c){const o={topicId:s,learningPathIds:r,targetCount:c.targetCount,includeReview:c.includeReview};return c.difficultyFilter&&(o.difficultyFilter=c.difficultyFilter),new J({id:e,configuration:o,execution:{taskIds:l,completedCount:0,correctCount:0,status:"planned",totalTimeSpent:0},results:{accuracy:0,averageTime:0,difficultyDistribution:{},improvementAreas:[]}})}start(){if(this.execution.status!=="planned"&&this.execution.status!=="paused")throw new Error("Can only start planned or paused sessions");this.execution.status="active",this.execution.startedAt||(this.execution.startedAt=new Date),this.updatedAt=new Date}pause(){if(this.execution.status!=="active")throw new Error("Can only pause active sessions");this.execution.status="paused",this.updatedAt=new Date}resume(){if(this.execution.status!=="paused")throw new Error("Can only resume paused sessions");this.execution.status="active",this.updatedAt=new Date}recordAnswer(e,s){if(this.execution.status!=="active")throw new Error("Session must be active to record answers");this.execution.completedCount++,e&&this.execution.correctCount++,this.execution.totalTimeSpent+=s,this.updateResults(),this.updatedAt=new Date}complete(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="completed",this.execution.completedAt=new Date,this.updateResults(),this.updatedAt=new Date}abandon(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="abandoned",this.updatedAt=new Date}updateResults(){this.execution.completedCount>0&&(this.results.accuracy=this.execution.correctCount/this.execution.completedCount*100),this.execution.completedCount>0&&(this.results.averageTime=this.execution.totalTimeSpent/this.execution.completedCount)}getProgress(){return this.execution.completedCount/this.configuration.targetCount*100}isComplete(){return this.execution.completedCount>=this.configuration.targetCount}getRemainingCount(){return Math.max(0,this.configuration.targetCount-this.execution.completedCount)}toJSON(){const e={id:this.id,configuration:{...this.configuration,learningPathIds:[...this.configuration.learningPathIds]},execution:{...this.execution,taskIds:[...this.execution.taskIds]},results:{...this.results,difficultyDistribution:{...this.results.difficultyDistribution},improvementAreas:[...this.results.improvementAreas]},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.configuration.difficultyFilter&&(e.configuration.difficultyFilter=this.configuration.difficultyFilter),this.execution.startedAt&&(e.execution.startedAt=this.execution.startedAt),this.execution.completedAt&&(e.execution.completedAt=this.execution.completedAt),e}static fromJSON(e){return new J(e)}}class Me{constructor(e,s,r){this.sessionRepository=e,this.taskRepository=s,this.spacedRepRepository=r}async createSession(e){const s=await this.selectTasksForSession(e),r=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={targetCount:e.targetCount,includeReview:e.includeReview};e.difficultyFilter&&(l.difficultyFilter=e.difficultyFilter);const c=J.create(r,e.topicId,e.learningPathIds,s,l);return await this.sessionRepository.create(c.toJSON())}async getSession(e){return await this.sessionRepository.getById(e)}async updateSession(e,s){await this.sessionRepository.update(e,s)}async completeSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new me("PracticeSession",e);const r=J.fromJSON(s);return r.complete(),await this.sessionRepository.update(e,r.toJSON())}async pauseSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new me("PracticeSession",e);const r=J.fromJSON(s);r.pause(),await this.sessionRepository.update(e,r.toJSON())}async resumeSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new me("PracticeSession",e);const r=J.fromJSON(s);r.resume(),await this.sessionRepository.update(e,r.toJSON())}async abandonSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new me("PracticeSession",e);const r=J.fromJSON(s);r.abandon(),await this.sessionRepository.update(e,r.toJSON())}async getActiveSessions(e){return await this.sessionRepository.getActive(e)}async getRecentSessions(e,s){return await this.sessionRepository.getRecent(e,s)}async recordSessionAnswer(e,s,r){const l=await this.sessionRepository.getById(e);if(!l)throw new me("PracticeSession",e);const c=J.fromJSON(l);c.execution.status==="planned"&&c.start(),c.recordAnswer(s,r),c.isComplete()&&c.complete(),await this.sessionRepository.update(e,c.toJSON())}async selectTasksForSession(e){const s=[];let r=e.targetCount;if(console.log(`Selecting tasks: targetCount=${e.targetCount}, learningPaths=${e.learningPathIds.join(",")}`),e.includeReview&&r>0){const l=await this.spacedRepRepository.getDue(new Date),c=l.slice(0,Math.min(l.length,Math.ceil(e.targetCount*.3))).map(o=>o.taskId);console.log(`Review tasks found: ${c.length}`),s.push(...c),r-=c.length}if(r>0){const l={learningPathIds:e.learningPathIds,excludeIds:s};e.difficultyFilter&&(l.difficulty=e.difficultyFilter),console.log(`Requesting ${r} new tasks with filters:`,l);const c=await this.taskRepository.getRandomTasks(r,l);console.log(`Got ${c.length} tasks:`,c.map(o=>o.id)),s.push(...c.map(o=>o.id))}return console.log(`Total selected tasks: ${s.length}`),s}}class ge{id;taskId;algorithm;schedule;performance;metadata;createdAt;updatedAt;constructor(e){ge.validate(e),this.id=e.id,this.taskId=e.taskId,this.algorithm={...e.algorithm},this.schedule={...e.schedule,nextReview:new Date(e.schedule.nextReview)},e.schedule.lastReviewed&&(this.schedule.lastReviewed=new Date(e.schedule.lastReviewed)),this.performance={...e.performance},this.metadata={...e.metadata,introduced:new Date(e.metadata.introduced)},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.algorithm?.efactor!==void 0&&(e.algorithm.efactor<1.3||e.algorithm.efactor>2.5))throw new oe("Efactor must be between 1.3 and 2.5",{field:"efactor",value:e.algorithm.efactor});if(e.algorithm?.interval!==void 0&&(e.algorithm.interval<0||e.algorithm.interval>365))throw new oe("Interval must be between 0 and 365 days",{field:"interval",value:e.algorithm.interval});if(e.performance?.lastGrade!==void 0&&(e.performance.lastGrade<0||e.performance.lastGrade>5))throw new oe("Grade must be between 0 and 5",{field:"lastGrade",value:e.performance.lastGrade});if(e.performance?.averageAccuracy!==void 0&&(e.performance.averageAccuracy<0||e.performance.averageAccuracy>100))throw new oe("Average accuracy must be between 0 and 100",{field:"averageAccuracy",value:e.performance.averageAccuracy})}static createNew(e,s){return new ge({id:s,taskId:e,algorithm:{interval:1,repetition:0,efactor:2.5},schedule:{nextReview:new Date(Date.now()+24*60*60*1e3),totalReviews:0,consecutiveCorrect:0},performance:{averageAccuracy:0,averageTime:0,difficultyRating:3,lastGrade:0},metadata:{introduced:new Date,graduated:!1,lapseCount:0}})}recordAnswer(e,s){if(e<0||e>5)throw new oe("Grade must be between 0 and 5",{field:"grade",value:e});if(this.performance.lastGrade=e,this.updateAverageAccuracy(e>=3),this.updateAverageTime(s),this.schedule.totalReviews++,this.schedule.lastReviewed=new Date,e<3)this.algorithm.repetition=0,this.algorithm.interval=1,this.schedule.consecutiveCorrect=0,this.metadata.lapseCount++,this.metadata.graduated=!1;else{this.schedule.consecutiveCorrect++;const r=.1-(5-e)*(.08+(5-e)*.02);this.algorithm.efactor=Math.max(1.3,this.algorithm.efactor+r),this.algorithm.efactor=Math.min(2.5,this.algorithm.efactor),this.algorithm.repetition===0?this.algorithm.interval=1:this.algorithm.repetition===1?this.algorithm.interval=6:this.algorithm.interval=Math.round(this.algorithm.interval*this.algorithm.efactor),this.algorithm.interval=Math.min(365,this.algorithm.interval),this.algorithm.repetition++,this.algorithm.repetition>=2&&(this.metadata.graduated=!0)}this.schedule.nextReview=new Date(Date.now()+this.algorithm.interval*24*60*60*1e3),this.updatedAt=new Date}updateAverageAccuracy(e){const s=this.schedule.totalReviews,l=this.performance.averageAccuracy/100*(s-1)+(e?1:0);this.performance.averageAccuracy=l/s*100}updateAverageTime(e){const s=this.schedule.totalReviews,l=this.performance.averageTime*(s-1)+e;this.performance.averageTime=l/s}isDue(){return this.schedule.nextReview.getTime()<=Date.now()}daysUntilReview(){const e=this.schedule.nextReview.getTime()-Date.now();return Math.ceil(e/(24*60*60*1e3))}toJSON(){const e={id:this.id,taskId:this.taskId,algorithm:{...this.algorithm},schedule:{nextReview:this.schedule.nextReview,totalReviews:this.schedule.totalReviews,consecutiveCorrect:this.schedule.consecutiveCorrect},performance:{...this.performance},metadata:{introduced:this.metadata.introduced,graduated:this.metadata.graduated,lapseCount:this.metadata.lapseCount},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.schedule.lastReviewed&&(e.schedule.lastReviewed=this.schedule.lastReviewed),e}static fromJSON(e){return new ge(e)}}class Mt{constructor(e,s){this.spacedRepRepository=e,this.taskRepository=s}async getNextTasks(e,s){const c=(await this.spacedRepRepository.getDue(new Date)).sort((p,i)=>i.metadata.lapseCount!==p.metadata.lapseCount?i.metadata.lapseCount-p.metadata.lapseCount:p.schedule.nextReview.getTime()-i.schedule.nextReview.getTime()).slice(0,s),o=[];for(const p of c){const i=await this.taskRepository.getById(p.taskId);i&&o.push(i)}return o}async recordAnswer(e,s,r){if(r<0||r>5)throw new Error("Grade must be between 0 and 5");let l=await this.spacedRepRepository.getByTaskId(e);if(!l){const o=ge.createNew(e,`sr-${e}-${Date.now()}`);l=await this.spacedRepRepository.create(o.toJSON())}const c=ge.fromJSON(l);c.recordAnswer(r,0),await this.spacedRepRepository.update(l.id,c.toJSON())}async getRepetitionData(e){return await this.spacedRepRepository.getByTaskId(e)}async getTasksDue(e){const s=await this.spacedRepRepository.getDue(new Date),r=[];for(const l of s){const c=await this.taskRepository.getById(l.taskId);c&&r.push(c)}return r}async getReviewSchedule(e,s){const r=[],l=new Date;for(let c=0;c<s;c++){const o=new Date(l);o.setDate(o.getDate()+c),o.setHours(23,59,59,999);const p=await this.spacedRepRepository.getByNextReviewDate(o);let i=0;for(const h of p)i+=h.performance.averageTime||3e4;r.push({date:o,taskCount:p.length,estimatedTime:Math.round(i/1e3)})}return r}async rescheduleTask(e,s){const r=await this.spacedRepRepository.getByTaskId(e);if(!r)throw new me("SpacedRepetitionItem",e);await this.spacedRepRepository.updateSchedule(r.id,{...r.schedule,nextReview:s})}async getStatistics(e){const s=await this.spacedRepRepository.getAll(),r=await this.spacedRepRepository.getDue(new Date),l=s.filter(p=>p.metadata.graduated).length,c=s.reduce((p,i)=>p+i.algorithm.interval,0),o=s.reduce((p,i)=>p+i.performance.averageAccuracy,0);return{totalItems:s.length,dueToday:r.length,graduated:l,averageInterval:s.length>0?c/s.length:0,averageAccuracy:s.length>0?o/s.length:0}}}class Bt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async search(e){const s=e.toLowerCase();return await this.table.filter(r=>r.title.toLowerCase().includes(s)).toArray()}async getByTitle(e){return null}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Ft{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return await this.table.where("topicId").equals(e).toArray()}async getByDifficulty(e){return await this.table.where("difficulty").equals(e).toArray()}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async searchByTitle(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Ot{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByLearningPathId(e){return await this.table.where("learningPathId").equals(e).toArray()}async getRandomTasks(e,s){console.log(`[TaskRepository] getRandomTasks called: count=${e}, filters=`,s);let r;if(s?.learningPathIds?(r=await this.table.where("learningPathId").anyOf(s.learningPathIds).toArray(),console.log(`[TaskRepository] Found ${r.length} tasks for learning paths:`,s.learningPathIds),console.log("[TaskRepository] Task IDs:",r.map(o=>o.id))):(r=await this.table.toArray(),console.log(`[TaskRepository] Found ${r.length} tasks (no filter)`)),s?.excludeIds){const o=r.length;r=r.filter(p=>!s.excludeIds.includes(p.id)),console.log(`[TaskRepository] After excluding IDs: ${o} -> ${r.length} tasks`)}const l=r.sort(()=>Math.random()-.5),c=[];if(l.length===0)return console.log("[TaskRepository] No tasks available!"),c;for(let o=0;o<e;o++){const p=l[o%l.length];p&&c.push(p)}return console.log(`[TaskRepository] Returning ${c.length} tasks (${l.length} unique, repeated to reach ${e})`),c}async getByLearningPathIds(e){return[]}async getByType(e){return[]}async getByDifficulty(e){return[]}async getByTags(e){return[]}async search(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Ut{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return await this.table.where("taskId").equals(e).toArray()}async getBySessionId(e){return await this.table.where("sessionId").equals(e).toArray()}async getByUserId(e,s){return[]}async getByDateRange(e,s){return[]}async getCorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(s=>s.isCorrect).toArray()}async getIncorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(s=>!s.isCorrect).toArray()}async getAccuracyForPeriod(e,s,r){return 0}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class qt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return(await this.table.where("topicId").equals(e).toArray())[0]||null}async getByLearningPathId(e){return(await this.table.where("learningPathId").equals(e).toArray())[0]||null}async getByUserId(e){return[]}async updateStatistics(e,s){}async incrementTaskCount(e,s){}async updateStreak(e,s){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Gt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(e){return await this.table.where("execution.status").anyOf(["planned","active","paused"]).toArray()}async getRecent(e,s){return await this.table.orderBy("createdAt").reverse().limit(s).toArray()}async getByStatus(e){return await this.table.where("execution.status").equals(e).toArray()}async getByUserId(e){return[]}async getByDateRange(e,s){return[]}async updateStatus(e,s){}async incrementProgress(e,s,r){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Wt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return(await this.table.where("taskId").equals(e).toArray())[0]||null}async getDue(e){return await this.table.where("schedule.nextReview").belowOrEqual(e).toArray()}async getByNextReviewDate(e){return[]}async updateAlgorithmData(e,s){}async updateSchedule(e,s){}async updatePerformance(e,s){}async getReviewCalendar(e,s){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class Ge{static topicRepo;static learningPathRepo;static taskRepo;static answerHistoryRepo;static userProgressRepo;static practiceSessionRepo;static spacedRepetitionRepo;static getTopicRepository(){return this.topicRepo||(this.topicRepo=new Bt(I.topics)),this.topicRepo}static getLearningPathRepository(){return this.learningPathRepo||(this.learningPathRepo=new Ft(I.learningPaths)),this.learningPathRepo}static getTaskRepository(){return this.taskRepo||(this.taskRepo=new Ot(I.tasks)),this.taskRepo}static getAnswerHistoryRepository(){return this.answerHistoryRepo||(this.answerHistoryRepo=new Ut(I.answerHistory)),this.answerHistoryRepo}static getUserProgressRepository(){return this.userProgressRepo||(this.userProgressRepo=new qt(I.userProgress)),this.userProgressRepo}static getPracticeSessionRepository(){return this.practiceSessionRepo||(this.practiceSessionRepo=new Gt(I.practiceSessions)),this.practiceSessionRepo}static getSpacedRepetitionRepository(){return this.spacedRepetitionRepo||(this.spacedRepetitionRepo=new Wt(I.spacedRepetition)),this.spacedRepetitionRepo}static reset(){this.topicRepo=null,this.learningPathRepo=null,this.taskRepo=null,this.answerHistoryRepo=null,this.userProgressRepo=null,this.practiceSessionRepo=null,this.spacedRepetitionRepo=null}}const Ne=()=>Ge.getTaskRepository(),Be=()=>Ge.getPracticeSessionRepository(),Re=()=>Ge.getSpacedRepetitionRepository(),Fe={audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null},Ht=500,Jt=2048,Vt=100;class Yt{audio=null;state={...Fe};stateListeners=new Set;preloadedAudio=null;autoPlayTimer=null;lastPlayTime=0;async initialize(){this.setState({...Fe})}async loadAudio(e,s,r){if(this.stop(),this.clearAutoPlayTimer(),!e.audioUrl)throw new Error("Task does not have an audio URL");if(!this.validateAudioUrl(e.audioUrl))throw new Error("Invalid audio URL");this.audio=new Audio(e.audioUrl),this.setState({audioUrl:e.audioUrl,status:"loading",currentTime:0,duration:0,autoPlayUnlocked:this.state.autoPlayUnlocked,preloadedNextUrl:this.state.preloadedNextUrl,error:null}),this.audio.addEventListener("loadedmetadata",()=>{this.audio&&this.setState({...this.state,duration:this.audio.duration,status:"stopped"})}),this.audio.addEventListener("timeupdate",()=>{this.audio&&this.state.status==="playing"&&this.setState({...this.state,currentTime:this.audio.currentTime})}),this.audio.addEventListener("ended",()=>{this.setState({...this.state,status:"stopped",currentTime:0})}),this.audio.addEventListener("error",c=>{this.setState({...this.state,status:"error",error:`Failed to load audio: ${c.message||"Unknown error"}`})}),this.audio.load(),r&&this.state.autoPlayUnlocked&&(this.autoPlayTimer=window.setTimeout(async()=>{try{await this.play()}catch(c){console.error("Auto-play failed:",c)}},Ht))}async play(){if(!this.audio)throw new Error("No audio loaded");const e=Date.now();if(e-this.lastPlayTime<Vt){console.warn("Rate limit: Too many play() calls. Please wait.");return}this.lastPlayTime=e;try{await this.audio.play(),this.setState({...this.state,status:"playing"})}catch(r){throw r.name==="NotAllowedError"&&this.setState({...this.state,status:"error",error:"Auto-play blocked by browser. Please click to enable audio."}),r}}pause(){this.audio&&(this.audio.pause(),this.setState({...this.state,status:"paused",currentTime:this.audio.currentTime}))}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.setState({...this.state,status:"stopped",currentTime:0}))}async replay(){if(!this.audio)throw new Error("No audio loaded");this.audio.currentTime=0,await this.play()}async togglePlayPause(){this.state.status==="playing"?this.pause():(this.state.status==="paused"||this.state.status==="stopped")&&await this.play()}preloadNext(e){e.audioUrl&&(this.preloadedAudio=new Audio(e.audioUrl),this.preloadedAudio.preload="auto",this.setState({...this.state,preloadedNextUrl:e.audioUrl}))}async checkAutoPlayPermission(){return this.state.autoPlayUnlocked}async unlockAutoPlay(){return this.setState({...this.state,autoPlayUnlocked:!0}),!0}getPlaybackState(){return{...this.state}}onStateChange(e){return this.stateListeners.add(e),()=>{this.stateListeners.delete(e)}}dispose(){this.clearAutoPlayTimer(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null),this.preloadedAudio&&(this.preloadedAudio.src="",this.preloadedAudio=null),this.setState({...Fe}),this.stateListeners.clear()}setState(e){this.state=e,this.stateListeners.forEach(s=>{s(e)})}clearAutoPlayTimer(){this.autoPlayTimer!==null&&(window.clearTimeout(this.autoPlayTimer),this.autoPlayTimer=null)}validateAudioUrl(e){return e.length>Jt?(console.warn("Audio URL exceeds maximum length"),!1):e.startsWith("/audio/")||e.includes("/audio/")||e.startsWith("data:audio/")?!0:(console.warn("Audio URL must contain /audio/ or start with data:audio/",e),!1)}}function Kt(){return new Yt}function Zt(){const a=f.useRef(null),[e,s]=f.useState({audioUrl:null,status:"stopped",currentTime:0,duration:0,autoPlayUnlocked:!1,preloadedNextUrl:null,error:null});return f.useEffect(()=>{const j=Kt();a.current=j,j.initialize().catch(u=>{console.error("Failed to initialize audio service:",u)});const C=j.onStateChange(u=>{s(u)});return()=>{j.stop(),C(),j.dispose(),a.current=null}},[]),{playbackState:e,loadAudio:async(j,C,u)=>{if(!a.current)throw new Error("Audio service not initialized");await a.current.loadAudio(j,C,u)},play:async()=>{if(!a.current)throw new Error("Audio service not initialized");await a.current.play()},pause:()=>{a.current?.pause()},stop:()=>{a.current?.stop()},replay:async()=>{if(!a.current)throw new Error("Audio service not initialized");await a.current.replay()},togglePlayPause:async()=>{if(!a.current)throw new Error("Audio service not initialized");await a.current.togglePlayPause()},preloadNext:j=>{a.current?.preloadNext(j)},checkAutoPlayPermission:async()=>a.current?a.current.checkAutoPlayPermission():!1,unlockAutoPlay:async()=>a.current?a.current.unlockAutoPlay():!1}}const ce={version:2,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1};function Oe(a){const e=a;if(typeof e.autoPlayEnabled!="boolean")throw new Error("autoPlayEnabled must be boolean");if(!["non-German only","all languages","none"].includes(e.languageFilter))throw new Error(`Invalid languageFilter value: ${e.languageFilter}`);if(e.perTopicOverrides&&typeof e.perTopicOverrides!="object")throw new Error("perTopicOverrides must be object");if(typeof e.accessibilityMode!="boolean")throw new Error("accessibilityMode must be boolean");if(typeof e.version!="number"||e.version<1)throw new Error("version must be positive integer");return e}const ke="audioSettings",Qt=500;class Xt{saveTimer=null;load(){try{const e=localStorage.getItem(ke);if(!e)return{...ce};const s=JSON.parse(e);return s.version!==ce.version?this.migrate(s):Oe(s)}catch(e){return console.error("Failed to load audio settings, using defaults:",e),{...ce}}}save(e){try{Oe(e),this.saveTimer!==null&&window.clearTimeout(this.saveTimer),typeof globalThis.describe=="function"&&typeof globalThis.it=="function"?localStorage.setItem(ke,JSON.stringify(e)):this.saveTimer=window.setTimeout(()=>{localStorage.setItem(ke,JSON.stringify(e)),this.saveTimer=null},Qt)}catch(s){throw console.error("Failed to save audio settings:",s),s}}update(e){const s=this.load(),r={...s,...e,version:e.version??s.version,perTopicOverrides:{...s.perTopicOverrides,...e.perTopicOverrides??{}}};this.save(r)}reset(){localStorage.removeItem(ke)}exists(){return localStorage.getItem(ke)!==null}migrate(e){const s={version:2,autoPlayEnabled:e.version===1?!0:e.autoPlayEnabled??ce.autoPlayEnabled,languageFilter:e.languageFilter??ce.languageFilter,perTopicOverrides:e.perTopicOverrides??{},accessibilityMode:e.accessibilityMode??ce.accessibilityMode};try{return Oe(s),this.save(s),s}catch(r){return console.error("Migration failed, using defaults:",r),{...ce}}}}function es(){return new Xt}function ts(){const a=f.useRef(null),[e,s]=f.useState(null),[r,l]=f.useState(!1);return f.useEffect(()=>{const p=es();a.current=p;const i=p.load();s(i),l(!0)},[]),{settings:e||{version:1,autoPlayEnabled:!0,languageFilter:"non-German only",perTopicOverrides:{},accessibilityMode:!1},updateSettings:p=>{if(!a.current||!e){console.warn("Audio settings not loaded yet");return}a.current.update(p);const i=a.current.load();s(i)},resetSettings:()=>{if(!a.current){console.warn("Audio settings not loaded yet");return}a.current.reset();const p=a.current.load();s(p)},isLoaded:r}}function ss(a,e){if(!a.hasAudio||!a.audioUrl||!e.autoPlayEnabled)return!1;const s=a.language||"German";switch(e.languageFilter){case"none":return!1;case"all languages":return!0;case"non-German only":return s!=="German";default:return!1}}function ct(a){var e,s,r="";if(typeof a=="string"||typeof a=="number")r+=a;else if(typeof a=="object")if(Array.isArray(a)){var l=a.length;for(e=0;e<l;e++)a[e]&&(s=ct(a[e]))&&(r&&(r+=" "),r+=s)}else for(s in a)a[s]&&(r&&(r+=" "),r+=s);return r}function z(){for(var a,e,s=0,r="",l=arguments.length;s<l;s++)(a=arguments[s])&&(e=ct(a))&&(r&&(r+=" "),r+=e);return r}const is="_pulse_1m38x_1",Y={"audio-button":"_audio-button_1m38x_4","audio-button--disabled":"_audio-button--disabled_1m38x_15","audio-button--small":"_audio-button--small_1m38x_24","audio-button--medium":"_audio-button--medium_1m38x_29","audio-button--large":"_audio-button--large_1m38x_34","audio-button--playing":"_audio-button--playing_1m38x_52","audio-button--active":"_audio-button--active_1m38x_59","audio-button__icon":"_audio-button__icon_1m38x_69","audio-button__icon--playing":"_audio-button__icon--playing_1m38x_73",pulse:is,"audio-button-inline":"_audio-button-inline_1m38x_88"},st=({size:a})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:a,height:a},children:t.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),as=({size:a})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",style:{width:a,height:a},children:t.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),rs=({text:a,audioUrl:e,className:s,disabled:r=!1,size:l="medium"})=>{const[c,o]=f.useState(!1),[p,i]=f.useState(null),h=f.useRef(null),b=!!e,R=async()=>{if(!(r||!b||!e)){i(null);try{h.current||(h.current=new Audio(e),h.current.addEventListener("ended",()=>o(!1)),h.current.addEventListener("error",()=>{i("Audio playback failed"),o(!1)})),h.current.currentTime=0,o(!0),await h.current.play()}catch(u){console.error("Failed to play audio:",u),i("Audio playback failed"),o(!1)}}},j={small:"16px",medium:"20px",large:"24px"},C=r||!b;return t.jsx("span",{onClick:C?void 0:R,className:z(Y["audio-button"],Y[`audio-button--${l}`],C&&Y["audio-button--disabled"],c&&Y["audio-button--playing"],!C&&!c&&Y["audio-button--active"],s),title:b?c?"Spielt ab...":`Aussprache abspielen: ${a}`:"Audio nicht verf√ºgbar","aria-label":`Spanische Aussprache f√ºr ${a} abspielen`,role:"button",tabIndex:C?-1:0,onKeyDown:u=>{!C&&(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),R())},children:c?t.jsx("div",{className:z(Y["audio-button__icon"],Y["audio-button__icon--playing"]),children:t.jsx(st,{size:j[l]})}):!b||p?t.jsx("div",{className:Y["audio-button__icon"],children:t.jsx(as,{size:j[l]})}):t.jsx("div",{className:Y["audio-button__icon"],children:t.jsx(st,{size:j[l]})})})},Ce=f.memo(rs),ns="_card_1cbjp_4",_e={card:ns,"card--shadow":"_card--shadow_1cbjp_11","card--no-shadow":"_card--no-shadow_1cbjp_15","card--border":"_card--border_1cbjp_20","card--no-border":"_card--no-border_1cbjp_24","card--padding-small":"_card--padding-small_1cbjp_29","card--padding-medium":"_card--padding-medium_1cbjp_33","card--padding-large":"_card--padding-large_1cbjp_37"};function le({padding:a="medium",shadow:e=!0,border:s=!0,borderColor:r,backgroundColor:l,children:c,className:o,style:p,...i}){const h={...l&&{backgroundColor:l},...r&&{borderColor:r},...p};return t.jsx("div",{...i,style:h,className:z(_e.card,_e[`card--padding-${a}`],e?_e["card--shadow"]:_e["card--no-shadow"],s?_e["card--border"]:_e["card--no-border"],o),children:c})}const A={primary:{500:"#3b82f6"},success:{100:"#dcfce7",300:"#86efac",500:"#10b981"},error:{100:"#fee2e2",300:"#fca5a5",500:"#ef4444"},warning:{100:"#fef3c7",400:"#fbbf24",500:"#f59e0b"},info:{100:"#f3e8ff",300:"#d8b4fe",500:"#8b5cf6"}},B={feedback:{success:A.success[500],successLight:A.success[100],successBorder:A.success[300],error:A.error[500],errorLight:A.error[100],errorBorder:A.error[300],warning:A.warning[500],warningLight:A.warning[100],warningBorder:A.warning[400],info:A.info[500],infoLight:A.info[100],infoBorder:A.info[300]}},ee={"feedback-content":"_feedback-content_1oyn0_4","feedback-icon":"_feedback-icon_1oyn0_11","feedback-text":"_feedback-text_1oyn0_19","feedback-title":"_feedback-title_1oyn0_24","feedback-message":"_feedback-message_1oyn0_32","feedback-children":"_feedback-children_1oyn0_39","feedback-dismiss":"_feedback-dismiss_1oyn0_45","feedback--success":"_feedback--success_1oyn0_62","feedback--error":"_feedback--error_1oyn0_71","feedback--warning":"_feedback--warning_1oyn0_80","feedback--info":"_feedback--info_1oyn0_89"};function ot({variant:a,title:e,message:s,dismissible:r=!1,onDismiss:l,children:c,className:o,style:p,...i}){const h=fe.useMemo(()=>cs(a),[a]),b=fe.useMemo(()=>os(a),[a]);return t.jsx(le,{...i,padding:"medium",shadow:!1,border:!0,borderColor:h.border,backgroundColor:h.background,style:p,className:z(ee[`feedback--${a}`],o),role:a==="error"||a==="warning"?"alert":"status","aria-live":a==="error"||a==="warning"?"assertive":"polite","aria-atomic":"true",children:t.jsxs("div",{className:ee["feedback-content"],children:[t.jsx("div",{className:ee["feedback-icon"],"aria-hidden":"true",children:b}),t.jsxs("div",{className:ee["feedback-text"],children:[e&&t.jsx("h4",{className:ee["feedback-title"],children:e}),c?t.jsx("div",{className:ee["feedback-children"],children:c}):s&&t.jsx("p",{className:ee["feedback-message"],children:s})]}),r&&l&&t.jsx("button",{onClick:l,className:ee["feedback-dismiss"],"aria-label":`Dismiss ${a} message`,children:t.jsx("span",{"aria-hidden":"true",children:"‚úï"})})]})})}function cs(a){switch(a){case"success":return{background:B.feedback.successLight,border:B.feedback.successBorder,text:B.feedback.success};case"error":return{background:B.feedback.errorLight,border:B.feedback.errorBorder,text:B.feedback.error};case"warning":return{background:B.feedback.warningLight,border:B.feedback.warningBorder,text:B.feedback.warning};case"info":return{background:B.feedback.infoLight,border:B.feedback.infoBorder,text:B.feedback.info};default:return{background:B.feedback.infoLight,border:B.feedback.infoBorder,text:B.feedback.info}}}function os(a){switch(a){case"success":return"‚úì";case"error":return"‚úó";case"warning":return"‚ö†";case"info":return"‚Ñπ";default:return"‚Ñπ"}}const ls="_input_1krva_4",K={"input-wrapper":"_input-wrapper_1krva_4","input-wrapper--full-width":"_input-wrapper--full-width_1krva_8",input:ls,"input--full-width":"_input--full-width_1krva_27","input--error":"_input--error_1krva_40","input--success":"_input--success_1krva_46","input__helper-text--error":"_input__helper-text--error_1krva_72","input__helper-text--success":"_input__helper-text--success_1krva_76"};function it({value:a,onChange:e,error:s=!1,success:r=!1,helperText:l,fullWidth:c=!1,disabled:o=!1,className:p,style:i,id:h,...b}){const R=l?`${h||"input"}-helper`:void 0;return t.jsxs("div",{className:z(K["input-wrapper"],c&&K["input-wrapper--full-width"]),children:[t.jsx("input",{...b,id:h,type:"text",value:a,onChange:e,disabled:o,style:i,className:z(K.input,c&&K["input--full-width"],s&&K["input--error"],r&&K["input--success"],p),"aria-invalid":s?"true":"false","aria-describedby":R}),l&&t.jsx("div",{id:R,className:z(K.input__helper_text,s&&K["input__helper-text--error"],r&&K["input__helper-text--success"]),children:l})]})}const ds="_checkbox_uclkx_4",us="_checkbox__checkmark_uclkx_83",_s="_checkbox__label_uclkx_101",H={"checkbox-container":"_checkbox-container_uclkx_4","checkbox-container--disabled":"_checkbox-container--disabled_uclkx_11","checkbox-wrapper":"_checkbox-wrapper_uclkx_16",checkbox:ds,"checkbox--with-label":"_checkbox--with-label_uclkx_35","checkbox--error":"_checkbox--error_uclkx_55","checkbox--success":"_checkbox--success_uclkx_66",checkbox__checkmark:us,"checkbox__checkmark--visible":"_checkbox__checkmark--visible_uclkx_96",checkbox__label:_s,"checkbox__label--disabled":"_checkbox__label--disabled_uclkx_107"};function ps({checked:a,onChange:e,label:s,error:r=!1,success:l=!1,disabled:c=!1,className:o,style:p,id:i,...h}){const b=fe.useId(),R=i||`checkbox-${b}`;return t.jsxs("label",{htmlFor:R,style:p,className:z(H["checkbox-container"],c&&H["checkbox-container--disabled"],o),children:[t.jsxs("div",{className:H["checkbox-wrapper"],children:[t.jsx("input",{...h,type:"checkbox",id:R,checked:a,onChange:e,disabled:c,className:z(H.checkbox,s&&H["checkbox--with-label"],r&&H["checkbox--error"],l&&H["checkbox--success"]),"aria-checked":a,"aria-invalid":r}),t.jsx("div",{className:z(H.checkbox__checkmark,a&&H["checkbox__checkmark--visible"])})]}),s&&t.jsx("span",{className:z(H.checkbox__label,c&&H["checkbox__label--disabled"]),children:s})]})}const hs="_select_1bjtk_4",Te={select:hs,"select--full-width":"_select--full-width_1bjtk_23","select--error":"_select--error_1bjtk_36","select--success":"_select--success_1bjtk_42"};function ms({value:a,onChange:e,options:s,disabled:r=!1,placeholder:l,error:c=!1,success:o=!1,fullWidth:p=!1,className:i,style:h,id:b}){return t.jsxs("select",{id:b,value:a,onChange:R=>e(R.target.value),disabled:r,style:h,className:z(Te.select,p&&Te["select--full-width"],c&&Te["select--error"],o&&Te["select--success"],i),"aria-invalid":c?"true":"false",children:[l&&t.jsx("option",{value:"",disabled:!0,children:l}),s.map(R=>t.jsx("option",{value:R.value,disabled:R.disabled,children:R.label},R.value))]})}const Z={"slider-container":"_slider-container_1ivuv_4","slider-track":"_slider-track_1ivuv_12","slider-fill":"_slider-fill_1ivuv_22","slider-fill--disabled":"_slider-fill--disabled_1ivuv_32","slider-input":"_slider-input_1ivuv_37","slider-thumb":"_slider-thumb_1ivuv_52","slider-thumb--disabled":"_slider-thumb--disabled_1ivuv_67","slider-value-display":"_slider-value-display_1ivuv_72","slider-value-display__current":"_slider-value-display__current_1ivuv_80"};function gs({value:a,onChange:e,min:s,max:r,step:l=1,disabled:c=!1,unit:o="",showValue:p=!0,className:i,style:h,id:b,"aria-label":R}){const j=(a-s)/(r-s)*100;return t.jsxs("div",{style:h,className:z(Z["slider-container"],i),children:[t.jsxs("div",{className:Z["slider-track"],children:[t.jsx("div",{className:z(Z["slider-fill"],c&&Z["slider-fill--disabled"]),style:{width:`${j}%`}}),t.jsx("div",{className:z(Z["slider-thumb"],c&&Z["slider-thumb--disabled"]),style:{left:`calc(${j}% - 12px)`}}),t.jsx("input",{type:"range",id:b,min:s,max:r,step:l,value:a,onChange:C=>e(Number(C.target.value)),disabled:c,className:Z["slider-input"],"aria-label":R,"aria-valuenow":a,"aria-valuemin":s,"aria-valuemax":r,"aria-valuetext":`${a}${o}`})]}),p&&t.jsxs("div",{className:Z["slider-value-display"],children:[t.jsxs("span",{children:[s,o]}),t.jsxs("span",{className:Z["slider-value-display__current"],children:[a,o]}),t.jsxs("span",{children:[r,o]})]})]})}const n={"practice-session":"_practice-session_i40nv_3","practice-session__header":"_practice-session__header_i40nv_14","practice-session__header-top":"_practice-session__header-top_i40nv_19","practice-session__header-left":"_practice-session__header-left_i40nv_26","practice-session__title":"_practice-session__title_i40nv_32","practice-session__task-counter":"_practice-session__task-counter_i40nv_37","practice-session__task-id":"_practice-session__task-id_i40nv_42","practice-session__cancel-btn":"_practice-session__cancel-btn_i40nv_48","practice-session__progress-bar":"_practice-session__progress-bar_i40nv_58","practice-session__progress-fill":"_practice-session__progress-fill_i40nv_66","practice-session__question-area":"_practice-session__question-area_i40nv_74","practice-session__question-header":"_practice-session__question-header_i40nv_85","practice-session__question-text":"_practice-session__question-text_i40nv_92","practice-session__mc-options":"_practice-session__mc-options_i40nv_101","practice-session__mc-option":"_practice-session__mc-option_i40nv_101","practice-session__mc-option--selected":"_practice-session__mc-option--selected_i40nv_125","practice-session__mc-option--correct":"_practice-session__mc-option--correct_i40nv_130","practice-session__mc-option--incorrect":"_practice-session__mc-option--incorrect_i40nv_135","practice-session__mc-option--disabled":"_practice-session__mc-option--disabled_i40nv_140","practice-session__cloze-container":"_practice-session__cloze-container_i40nv_146","practice-session__cloze-text":"_practice-session__cloze-text_i40nv_151","practice-session__cloze-input":"_practice-session__cloze-input_i40nv_156","practice-session__cloze-feedback":"_practice-session__cloze-feedback_i40nv_162","practice-session__cloze-feedback-title":"_practice-session__cloze-feedback-title_i40nv_169","practice-session__cloze-answer":"_practice-session__cloze-answer_i40nv_176","practice-session__cloze-answer--correct":"_practice-session__cloze-answer--correct_i40nv_181","practice-session__cloze-answer--neutral":"_practice-session__cloze-answer--neutral_i40nv_185","practice-session__cloze-answer-correct":"_practice-session__cloze-answer-correct_i40nv_189","practice-session__cloze-alternatives":"_practice-session__cloze-alternatives_i40nv_193","practice-session__tf-container":"_practice-session__tf-container_i40nv_200","practice-session__tf-statement":"_practice-session__tf-statement_i40nv_208","practice-session__tf-buttons":"_practice-session__tf-buttons_i40nv_214","practice-session__tf-button":"_practice-session__tf-button_i40nv_214","practice-session__tf-button--selected":"_practice-session__tf-button--selected_i40nv_231","practice-session__tf-button--correct":"_practice-session__tf-button--correct_i40nv_236","practice-session__tf-button--incorrect":"_practice-session__tf-button--incorrect_i40nv_241","practice-session__tf-button--disabled":"_practice-session__tf-button--disabled_i40nv_246","practice-session__ordering-container":"_practice-session__ordering-container_i40nv_252","practice-session__ordering-instruction":"_practice-session__ordering-instruction_i40nv_257","practice-session__ordering-items":"_practice-session__ordering-items_i40nv_263","practice-session__ordering-item":"_practice-session__ordering-item_i40nv_263","practice-session__ordering-item--correct":"_practice-session__ordering-item--correct_i40nv_279","practice-session__ordering-item-number":"_practice-session__ordering-item-number_i40nv_284","practice-session__ordering-item-text":"_practice-session__ordering-item-text_i40nv_290","practice-session__ordering-hint":"_practice-session__ordering-hint_i40nv_294","practice-session__ordering-controls":"_practice-session__ordering-controls_i40nv_300","practice-session__ordering-btn":"_practice-session__ordering-btn_i40nv_305","practice-session__ordering-feedback":"_practice-session__ordering-feedback_i40nv_313","practice-session__ordering-feedback-title":"_practice-session__ordering-feedback-title_i40nv_320","practice-session__ordering-feedback-item":"_practice-session__ordering-feedback-item_i40nv_327","practice-session__matching-container":"_practice-session__matching-container_i40nv_335","practice-session__matching-instruction":"_practice-session__matching-instruction_i40nv_340","practice-session__matching-grid":"_practice-session__matching-grid_i40nv_346","practice-session__matching-left-item":"_practice-session__matching-left-item_i40nv_352","practice-session__matching-feedback":"_practice-session__matching-feedback_i40nv_363","practice-session__matching-feedback-title":"_practice-session__matching-feedback-title_i40nv_370","practice-session__matching-feedback-item":"_practice-session__matching-feedback-item_i40nv_377","practice-session__ms-container":"_practice-session__ms-container_i40nv_385","practice-session__ms-instruction":"_practice-session__ms-instruction_i40nv_390","practice-session__ms-options":"_practice-session__ms-options_i40nv_396","practice-session__ms-option":"_practice-session__ms-option_i40nv_396","practice-session__ms-option--selected":"_practice-session__ms-option--selected_i40nv_413","practice-session__ms-option--correct":"_practice-session__ms-option--correct_i40nv_418","practice-session__ms-option--incorrect":"_practice-session__ms-option--incorrect_i40nv_423","practice-session__ms-option-label":"_practice-session__ms-option-label_i40nv_428","practice-session__ms-status-icon":"_practice-session__ms-status-icon_i40nv_433","practice-session__ms-status-icon--correct":"_practice-session__ms-status-icon--correct_i40nv_439","practice-session__ms-status-icon--incorrect":"_practice-session__ms-status-icon--incorrect_i40nv_443","practice-session__slider-container":"_practice-session__slider-container_i40nv_449","practice-session__slider-value-display":"_practice-session__slider-value-display_i40nv_457","practice-session__slider-value":"_practice-session__slider-value_i40nv_457","practice-session__slider-value--correct":"_practice-session__slider-value--correct_i40nv_467","practice-session__slider-value--incorrect":"_practice-session__slider-value--incorrect_i40nv_471","practice-session__slider-wrapper":"_practice-session__slider-wrapper_i40nv_475","practice-session__slider-feedback":"_practice-session__slider-feedback_i40nv_479","practice-session__slider-feedback-text":"_practice-session__slider-feedback-text_i40nv_486","practice-session__slider-correct-value":"_practice-session__slider-correct-value_i40nv_492","practice-session__slider-tolerance":"_practice-session__slider-tolerance_i40nv_497","practice-session__scramble-container":"_practice-session__scramble-container_i40nv_504","practice-session__scramble-display":"_practice-session__scramble-display_i40nv_512","practice-session__scramble-label":"_practice-session__scramble-label_i40nv_519","practice-session__scramble-word":"_practice-session__scramble-word_i40nv_525","practice-session__scramble-length":"_practice-session__scramble-length_i40nv_533","practice-session__scramble-input-label":"_practice-session__scramble-input-label_i40nv_539","practice-session__scramble-input":"_practice-session__scramble-input_i40nv_539","practice-session__scramble-input--correct":"_practice-session__scramble-input--correct_i40nv_558","practice-session__scramble-input--incorrect":"_practice-session__scramble-input--incorrect_i40nv_563","practice-session__scramble-feedback":"_practice-session__scramble-feedback_i40nv_568","practice-session__scramble-feedback-label":"_practice-session__scramble-feedback-label_i40nv_575","practice-session__scramble-feedback-word":"_practice-session__scramble-feedback-word_i40nv_582","practice-session__flashcard-container":"_practice-session__flashcard-container_i40nv_590","practice-session__flashcard":"_practice-session__flashcard_i40nv_590","practice-session__flashcard-lang":"_practice-session__flashcard-lang_i40nv_618","practice-session__flashcard-front":"_practice-session__flashcard-front_i40nv_626","practice-session__flashcard-reveal-btn":"_practice-session__flashcard-reveal-btn_i40nv_639","practice-session__flashcard-divider":"_practice-session__flashcard-divider_i40nv_657","practice-session__flashcard-back":"_practice-session__flashcard-back_i40nv_664","practice-session__flashcard-assessment":"_practice-session__flashcard-assessment_i40nv_677","practice-session__flashcard-btn":"_practice-session__flashcard-btn_i40nv_685","practice-session__flashcard-btn--unknown":"_practice-session__flashcard-btn--unknown_i40nv_699","practice-session__flashcard-btn--known":"_practice-session__flashcard-btn--known_i40nv_710","practice-session__flashcard-icon":"_practice-session__flashcard-icon_i40nv_721","practice-session__flashcard-explanation":"_practice-session__flashcard-explanation_i40nv_725","practice-session__text-input-container":"_practice-session__text-input-container_i40nv_738","practice-session__text-input-wrapper":"_practice-session__text-input-wrapper_i40nv_746","practice-session__text-input":"_practice-session__text-input_i40nv_738","practice-session__text-input-feedback":"_practice-session__text-input-feedback_i40nv_758","practice-session__text-input-hint":"_practice-session__text-input-hint_i40nv_770","practice-session__feedback":"_practice-session__feedback_i40nv_781","practice-session__footer":"_practice-session__footer_i40nv_788","practice-session__actions":"_practice-session__actions_i40nv_795","practice-session__btn-submit":"_practice-session__btn-submit_i40nv_801","practice-session__btn-submit--enabled":"_practice-session__btn-submit--enabled_i40nv_810","practice-session__btn-submit--disabled":"_practice-session__btn-submit--disabled_i40nv_815","practice-session__btn-skip":"_practice-session__btn-skip_i40nv_820","practice-session__btn-next":"_practice-session__btn-next_i40nv_831","practice-session__stats":"_practice-session__stats_i40nv_844","practice-session__stat":"_practice-session__stat_i40nv_844","practice-session__stat-value":"_practice-session__stat-value_i40nv_857","practice-session__stat-value--completed":"_practice-session__stat-value--completed_i40nv_862","practice-session__stat-value--correct":"_practice-session__stat-value--correct_i40nv_866","practice-session__stat-value--accuracy":"_practice-session__stat-value--accuracy_i40nv_870","practice-session__stat-label":"_practice-session__stat-label_i40nv_874","practice-session__loading":"_practice-session__loading_i40nv_881"};function fs({topicId:a,learningPathIds:e,targetCount:s=10,includeReview:r=!0,onComplete:l,onCancel:c}){const[o,p]=f.useState(null),[i,h]=f.useState(null),[b,R]=f.useState(0),[j,C]=f.useState(null),[u,q]=f.useState(!1),[E,de]=f.useState(!1),[Q,ie]=f.useState(Date.now()),[G,ue]=f.useState([]),[ae,be]=f.useState(0),[W,re]=f.useState([]),[x,T]=f.useState(null),[O,ne]=f.useState([]),[V,ye]=f.useState({}),[De,je]=f.useState([]),[m,P]=f.useState(new Set),[M,L]=f.useState(0),[U,ve]=f.useState(""),[We,He]=f.useState(!1),[Le,$e]=f.useState(null),[we,Je]=f.useState(""),{playbackState:xe,loadAudio:lt,togglePlayPause:Ve,replay:Ye,stop:Ke,preloadNext:dt,unlockAutoPlay:ut}=Zt(),{settings:Ae}=ts();f.useEffect(()=>{_t()},[]),f.useEffect(()=>{o&&o.execution.taskIds.length>0&&b===0&&Ze()},[o]),f.useEffect(()=>{o&&o.execution.taskIds.length>0&&b>0&&Ze()},[b]);async function _t(){const _=await new Me(Be(),Ne(),Re()).createSession({topicId:a,learningPathIds:e,targetCount:s,includeReview:r});p(_)}async function Ze(){if(!o||b>=o.execution.taskIds.length)return;const d=o.execution.taskIds[b];if(!d)return;const _=await I.tasks.get(d);if(!_)return;h(_),ie(Date.now());const g=b+1;if(g<o.execution.taskIds.length){const y=o.execution.taskIds[g];y&&I.tasks.get(y).then(w=>{w&&w.audioUrl&&dt(w)}).catch(w=>{console.warn("Failed to preload next task audio:",w)})}if(C(null),T(null),re([]),ne([]),ye({}),je([]),P(new Set),L(0),ve(""),He(!1),$e(null),Je(""),_.type==="multiple-choice"){const y=_.content,w=[...y.options],N=y.correctAnswer,v=w.map((D,X)=>X);for(let D=v.length-1;D>0;D--){const X=Math.floor(Math.random()*(D+1));[v[D],v[X]]=[v[X],v[D]]}const k=v.map(D=>w[D]),$=v.findIndex(D=>D===N);ue(k),be($)}else if(_.type==="cloze-deletion"){const y=_.content;re(new Array(y.blanks.length).fill(""))}else if(_.type==="ordering"){const w=[..._.content.items].sort(()=>Math.random()-.5);ne(w)}else if(_.type==="matching"){const w=_.content.pairs.map((N,v)=>v);for(let N=w.length-1;N>0;N--){const v=Math.floor(Math.random()*(N+1));[w[N],w[v]]=[w[v],w[N]]}je(w),ye({})}else if(_.type==="multiple-select")P(new Set);else if(_.type==="slider"){const y=_.content;L(Math.floor((y.min+y.max)/2))}else _.type==="word-scramble"&&ve("")}async function ze(){if(!i||!o)return;xe.autoPlayUnlocked||ut().catch(v=>console.warn("Failed to unlock auto-play:",v));let d=!1;if(i.type==="multiple-choice"){if(j===null)return;d=j===ae}else if(i.type==="cloze-deletion")d=i.content.blanks.every((k,$)=>{const D=W[$]?.trim().toLowerCase()||"",X=k.correctAnswer.toLowerCase(),Se=k.alternatives?.map(St=>St.toLowerCase())||[];return D===X||Se.includes(D)});else if(i.type==="true-false"){if(x===null)return;const v=i.content;d=x===v.correctAnswer}else if(i.type==="ordering"){const v=i.content;d=O.every((k,$)=>{const D=v.items.indexOf(k);return v.correctOrder[$]===D})}else if(i.type==="matching")d=i.content.pairs.every((k,$)=>V[$]===$);else if(i.type==="multiple-select"){const v=i.content;if(m.size===0)return;d=v.correctAnswers.length===m.size&&v.correctAnswers.every(k=>m.has(k))}else if(i.type==="slider"){const v=i.content,k=v.tolerance||0;d=Math.abs(M-v.correctValue)<=k}else if(i.type==="word-scramble"){if(!U.trim())return;const v=i.content;d=U.trim().toLowerCase()===v.correctWord.toLowerCase()}else if(i.type==="flashcard"){if(Le===null)return;d=Le}else if(i.type==="text-input"){if(!we.trim())return;const v=i.content,k=v.caseSensitive||!1,$=k?we.trim():we.trim().toLowerCase(),D=k?v.correctAnswer:v.correctAnswer.toLowerCase(),X=(v.alternatives||[]).map(Se=>k?Se:Se.toLowerCase());d=$===D||X.includes($)}de(d),q(!0);const _=Math.round((Date.now()-Q)/1e3);await new Me(Be(),Ne(),Re()).recordSessionAnswer(o.id,d,_);const y=new Mt(Re(),Ne()),w=d?4:2;await y.recordAnswer(i.id,d,w);const N=await I.practiceSessions.get(o.id);N&&p(N)}function pt(){o&&(q(!1),C(null),b<o.execution.taskIds.length-1&&R(b+1))}function Ee(){q(!1),C(null),o&&b<o.execution.taskIds.length-1?R(b+1):Qe()}async function Qe(){if(!o)return;await new Me(Be(),Ne(),Re()).completeSession(o.id),await new Promise(_=>setTimeout(_,100)),l()}f.useEffect(()=>{const d=_=>{if(!(_.target instanceof HTMLInputElement||_.target instanceof HTMLTextAreaElement)&&xe.audioUrl)switch(_.key.toLowerCase()){case" ":_.preventDefault(),Ve().catch(console.error);break;case"r":_.preventDefault(),Ye().catch(console.error);break;case"s":_.preventDefault(),Ke();break}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[xe.audioUrl,Ve,Ye,Ke]),f.useEffect(()=>{u&&i&&ss(i,Ae)&&(console.log("üîä Auto-play in feedback:",i.audioUrl),lt(i,Ae,!0).catch(d=>{console.warn("Auto-play in feedback failed:",d)}))},[u,i?.id,Ae.autoPlayEnabled,Ae.languageFilter]),f.useEffect(()=>{if(i?.type==="flashcard"&&!u&&xe.autoPlayUnlocked){const d=i.content;d.frontAudio&&new Audio(`/learning-platform/test/audio/${d.frontAudio}`).play().catch(g=>console.warn("Failed to auto-play frontAudio:",g))}},[i?.id]);function Xe(){if(u)return!1;if(i?.type==="multiple-choice")return j!==null;if(i?.type==="cloze-deletion")return W.every(d=>d.trim().length>0);if(i?.type==="true-false")return x!==null;if(i?.type==="ordering")return O.length>0;if(i?.type==="matching"){const d=i.content;return Object.keys(V).length===d.pairs.length}return i?.type==="multiple-select"?m.size>0:i?.type==="slider"?!0:i?.type==="word-scramble"?U.trim().length>0:i?.type==="flashcard"?Le!==null:i?.type==="text-input"?we.trim().length>0:!1}function ht(){return i?i.type==="multiple-choice"?mt():i.type==="cloze-deletion"?gt():i.type==="true-false"?ft():i.type==="ordering"?bt():i.type==="matching"?yt():i.type==="multiple-select"?vt():i.type==="slider"?wt():i.type==="word-scramble"?xt():i.type==="flashcard"?kt():i.type==="text-input"?jt():null:null}function mt(){return!i||i.type!=="multiple-choice"?null:t.jsx("div",{className:n["practice-session__mc-options"],children:G.map((d,_)=>{const g=[n["practice-session__mc-option"],u&&_===ae&&n["practice-session__mc-option--correct"],u&&_===j&&!E&&n["practice-session__mc-option--incorrect"],!u&&j===_&&n["practice-session__mc-option--selected"],u&&n["practice-session__mc-option--disabled"]].filter(Boolean).join(" ");return t.jsx("button",{onClick:()=>!u&&C(_),disabled:u,className:g,children:t.jsx("span",{children:d})},_)})})}function gt(){if(!i||i.type!=="cloze-deletion")return null;const d=i.content,_=d.text.split(/\{\{blank\}\}/g);return t.jsxs("div",{className:n["practice-session__cloze-container"],children:[t.jsx("div",{className:n["practice-session__cloze-text"],children:_.map((g,y)=>t.jsxs("span",{children:[g,y<d.blanks.length&&(()=>{const w=W[y]?.trim().toLowerCase()||"",N=w===d.blanks[y].correctAnswer.toLowerCase()||d.blanks[y].alternatives?.map(k=>k.toLowerCase()).includes(w),v=W[y]?.trim()!=="";return t.jsx(it,{value:W[y]||"",onChange:k=>{const $=[...W];$[y]=k.target.value,re($)},disabled:u,error:!!(u&&v&&!N),success:!!(u&&N),className:n["practice-session__cloze-input"]})})()]},y))}),u&&t.jsxs("div",{className:n["practice-session__cloze-feedback"],children:[t.jsx("div",{className:n["practice-session__cloze-feedback-title"],children:"Richtige Antworten:"}),d.blanks.map((g,y)=>{const w=W[y]?.trim().toLowerCase()||"",v=w===g.correctAnswer.toLowerCase()||g.alternatives?.map(k=>k.toLowerCase()).includes(w)?n["practice-session__cloze-answer--correct"]:n["practice-session__cloze-answer--neutral"];return t.jsxs("div",{className:`${n["practice-session__cloze-answer"]} ${v}`,children:["L√ºcke ",y+1,": ",t.jsx("strong",{className:n["practice-session__cloze-answer-correct"],children:g.correctAnswer}),g.alternatives&&g.alternatives.length>0&&t.jsxs("span",{className:n["practice-session__cloze-alternatives"],children:[" ","(auch richtig: ",g.alternatives.join(", "),")"]})]},y)})]})]})}function ft(){if(!i||i.type!=="true-false")return null;const d=i.content;return t.jsxs("div",{className:n["practice-session__tf-container"],children:[t.jsx("div",{className:n["practice-session__tf-statement"],children:d.statement}),t.jsx("div",{className:n["practice-session__tf-buttons"],children:[!0,!1].map(_=>{const g=[n["practice-session__tf-button"],u&&_===d.correctAnswer&&n["practice-session__tf-button--correct"],u&&_===x&&!E&&n["practice-session__tf-button--incorrect"],!u&&x===_&&n["practice-session__tf-button--selected"],u&&n["practice-session__tf-button--disabled"]].filter(Boolean).join(" ");return t.jsx("button",{onClick:()=>!u&&T(_),disabled:u,className:g,children:_?"Richtig":"Falsch"},_.toString())})})]})}function bt(){if(!i||i.type!=="ordering")return null;const d=i.content;return t.jsxs("div",{className:n["practice-session__ordering-container"],children:[t.jsx("div",{className:n["practice-session__ordering-instruction"],children:"Ordne die Elemente in die richtige Reihenfolge"}),t.jsx("div",{className:n["practice-session__ordering-items"],children:O.map((_,g)=>{const y=d.items.indexOf(_),w=u&&d.correctOrder[g]===y,N=u?d.correctOrder.indexOf(y):-1,v=[n["practice-session__ordering-item"],u&&w&&n["practice-session__ordering-item--correct"]].filter(Boolean).join(" ");return t.jsxs("div",{className:v,children:[t.jsxs("div",{className:n["practice-session__ordering-item-number"],children:[g+1,"."]}),t.jsxs("div",{className:n["practice-session__ordering-item-text"],children:[_,u&&!w&&t.jsxs("span",{className:n["practice-session__ordering-hint"],children:["‚Üí Position ",N+1]})]}),!u&&t.jsxs("div",{className:n["practice-session__ordering-controls"],children:[g>0&&t.jsx("button",{onClick:()=>{const k=[...O];[k[g],k[g-1]]=[k[g-1],k[g]],ne(k)},className:n["practice-session__ordering-btn"],children:"‚Üë"}),g<O.length-1&&t.jsx("button",{onClick:()=>{const k=[...O];[k[g],k[g+1]]=[k[g+1],k[g]],ne(k)},className:n["practice-session__ordering-btn"],children:"‚Üì"})]})]},g)})}),u&&!E&&t.jsxs("div",{className:n["practice-session__ordering-feedback"],children:[t.jsx("div",{className:n["practice-session__ordering-feedback-title"],children:"Richtige Reihenfolge:"}),d.correctOrder.map((_,g)=>t.jsxs("div",{className:n["practice-session__ordering-feedback-item"],children:[g+1,". ",t.jsx("strong",{children:d.items[_]})]},g))]})]})}function yt(){if(!i||i.type!=="matching")return null;const d=i.content;return t.jsxs("div",{className:n["practice-session__matching-container"],children:[t.jsx("div",{className:n["practice-session__matching-instruction"],children:"Ordne die passenden Paare zu"}),t.jsx("div",{className:n["practice-session__matching-grid"],children:d.pairs.map((_,g)=>{const y=u&&V[g]===g,w=V[g]!==void 0&&V[g]!==null;return t.jsxs(fe.Fragment,{children:[t.jsx("div",{className:n["practice-session__matching-left-item"],children:t.jsx("span",{children:_.left})}),t.jsx(ms,{value:V[g]?.toString()??"",onChange:N=>{const v=parseInt(N);ye({...V,[g]:v})},options:De.map(N=>({value:N.toString(),label:d.pairs[N].right})),disabled:u,placeholder:"W√§hle...",error:u&&w&&!y,success:u&&y,fullWidth:!0})]},g)})}),u&&!E&&t.jsxs("div",{className:n["practice-session__matching-feedback"],children:[t.jsx("div",{className:n["practice-session__matching-feedback-title"],children:"Richtige Zuordnungen:"}),d.pairs.map((_,g)=>t.jsxs("div",{className:n["practice-session__matching-feedback-item"],children:[t.jsx("strong",{children:_.left})," ‚Üí ",t.jsx("strong",{children:_.right})]},g))]})]})}function vt(){if(!i||i.type!=="multiple-select")return null;const d=i.content,_=g=>{if(u)return;const y=new Set(m);y.has(g)?y.delete(g):y.add(g),P(y)};return t.jsxs("div",{className:n["practice-session__ms-container"],children:[t.jsx("div",{className:n["practice-session__ms-instruction"],children:"W√§hle alle zutreffenden Antworten"}),t.jsx("div",{className:n["practice-session__ms-options"],children:d.options.map((g,y)=>{const w=m.has(y),N=d.correctAnswers.includes(y);let v="";u&&(N?v=w?"‚úì":"‚óã":w&&!N&&(v="‚úó"));const k=[n["practice-session__ms-option"],u&&N&&n["practice-session__ms-option--correct"],u&&w&&!N&&n["practice-session__ms-option--incorrect"],!u&&w&&n["practice-session__ms-option--selected"]].filter(Boolean).join(" "),$=N?n["practice-session__ms-status-icon--correct"]:n["practice-session__ms-status-icon--incorrect"];return t.jsxs("div",{className:k,children:[t.jsx(ps,{checked:w,onChange:()=>_(y),disabled:u,label:t.jsx("span",{className:n["practice-session__ms-option-label"],children:g}),error:u&&w&&!N,success:u&&N&&w,style:{flex:1}}),u&&v&&t.jsx("span",{className:`${n["practice-session__ms-status-icon"]} ${$}`,children:v})]},y)})})]})}function wt(){if(!i||i.type!=="slider")return null;const d=i.content,_=d.step||1,g=d.tolerance||0,y=Math.abs(M-d.correctValue)<=g,w=u?y?n["practice-session__slider-value--correct"]:n["practice-session__slider-value--incorrect"]:"";return t.jsxs("div",{className:n["practice-session__slider-container"],children:[t.jsx("div",{className:n["practice-session__slider-value-display"],children:t.jsxs("div",{className:`${n["practice-session__slider-value"]} ${w}`,children:[M,d.unit||""]})}),t.jsx("div",{className:n["practice-session__slider-wrapper"],children:t.jsx(gs,{value:M,onChange:L,min:d.min,max:d.max,step:_,disabled:u,unit:d.unit||"",showValue:!1})}),u&&t.jsx("div",{className:n["practice-session__slider-feedback"],children:t.jsxs("div",{className:n["practice-session__slider-feedback-text"],children:["Richtige Antwort: ",t.jsxs("strong",{className:n["practice-session__slider-correct-value"],children:[d.correctValue,d.unit||""]}),g>0&&t.jsxs("span",{className:n["practice-session__slider-tolerance"],children:[" ","(¬±",g,")"]})]})})]})}function xt(){if(!i||i.type!=="word-scramble")return null;const d=i.content,_=U.trim().toLowerCase()===d.correctWord.toLowerCase(),g=U.trim()!=="",y=u?_?n["practice-session__scramble-input--correct"]:g?n["practice-session__scramble-input--incorrect"]:"":"";return t.jsxs("div",{className:n["practice-session__scramble-container"],children:[t.jsxs("div",{className:n["practice-session__scramble-display"],children:[t.jsx("div",{className:n["practice-session__scramble-label"],children:"Buchstabensalat:"}),t.jsx("div",{className:n["practice-session__scramble-word"],children:d.scrambledWord}),d.showLength&&t.jsxs("div",{className:n["practice-session__scramble-length"],children:["(",d.correctWord.length," Buchstaben)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:n["practice-session__scramble-input-label"],children:"Deine L√∂sung:"}),t.jsx("input",{type:"text",value:U,onChange:w=>ve(w.target.value),disabled:u,placeholder:"Entschl√ºssle das Wort...",className:`${n["practice-session__scramble-input"]} ${y}`})]}),u&&!E&&t.jsxs("div",{className:n["practice-session__scramble-feedback"],children:[t.jsx("div",{className:n["practice-session__scramble-feedback-label"],children:"Richtige L√∂sung:"}),t.jsx("div",{className:n["practice-session__scramble-feedback-word"],children:d.correctWord})]})]})}function kt(){if(!i||i.type!=="flashcard")return null;const d=i.content;return t.jsxs("div",{className:n["practice-session__flashcard-container"],children:[t.jsxs("div",{className:n["practice-session__flashcard"],children:[t.jsx("div",{className:n["practice-session__flashcard-lang"],children:d.frontLanguage==="de"?"Deutsch":d.frontLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:n["practice-session__flashcard-front"],children:[t.jsx("div",{children:d.front}),d.frontAudio&&t.jsx(Ce,{text:d.front,audioUrl:`/learning-platform/test/audio/${d.frontAudio}`,size:"large"})]}),We?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:n["practice-session__flashcard-divider"]}),t.jsx("div",{className:n["practice-session__flashcard-lang"],children:d.backLanguage==="de"?"Deutsch":d.backLanguage==="es"?"Espa√±ol":"English"}),t.jsxs("div",{className:n["practice-session__flashcard-back"],children:[t.jsx("div",{children:d.back}),d.backAudio&&t.jsx(Ce,{text:d.back,audioUrl:`/learning-platform/test/audio/${d.backAudio}`,size:"large"})]})]}):t.jsx("button",{onClick:async()=>{if(He(!0),d.backAudio&&xe.autoPlayUnlocked)try{await new Audio(`/learning-platform/test/audio/${d.backAudio}`).play()}catch(_){console.warn("Failed to auto-play on reveal:",_)}},disabled:u,className:n["practice-session__flashcard-reveal-btn"],children:"Ergebnis anzeigen"})]}),We&&!u&&t.jsxs("div",{className:n["practice-session__flashcard-assessment"],children:[t.jsxs("button",{onClick:()=>{$e(!1),ze(),setTimeout(()=>{Ee()},300)},className:`${n["practice-session__flashcard-btn"]} ${n["practice-session__flashcard-btn--unknown"]}`,children:[t.jsx("span",{className:n["practice-session__flashcard-icon"],children:"‚úó"}),t.jsx("span",{children:"Nicht gewusst"})]}),t.jsxs("button",{onClick:()=>{$e(!0),ze(),setTimeout(()=>{Ee()},300)},className:`${n["practice-session__flashcard-btn"]} ${n["practice-session__flashcard-btn--known"]}`,children:[t.jsx("span",{className:n["practice-session__flashcard-icon"],children:"‚úì"}),t.jsx("span",{children:"Gewusst"})]})]}),u&&d.explanation&&t.jsxs("div",{className:n["practice-session__flashcard-explanation"],children:[t.jsx("strong",{children:"Hinweis:"})," ",d.explanation]})]})}function jt(){if(!i||i.type!=="text-input")return null;const d=i.content;return t.jsxs("div",{className:n["practice-session__text-input-container"],children:[t.jsxs("div",{className:n["practice-session__text-input-wrapper"],children:[t.jsx(it,{value:we,onChange:_=>Je(_.target.value),disabled:u,placeholder:"Deine Antwort...",error:u&&!E,success:u&&E,fullWidth:!0,className:n["practice-session__text-input"]}),u&&!E&&t.jsxs("div",{className:n["practice-session__text-input-feedback"],children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Richtige Antwort:"})," ",d.correctAnswer]}),i.audioUrl&&t.jsx(Ce,{text:d.correctAnswer,audioUrl:i.audioUrl,size:"small"})]})]}),d.hint&&!u&&t.jsxs("div",{className:n["practice-session__text-input-hint"],children:["üí° ",t.jsx("strong",{children:"Tipp:"})," ",d.hint]})]})}if(!o||!i)return t.jsx("div",{className:n["practice-session__loading"],children:t.jsx("p",{children:"Wird geladen..."})});const At=(b+1)/o.execution.taskIds.length*100;return t.jsxs("div",{className:n["practice-session"],children:[t.jsxs("div",{className:n["practice-session__header"],children:[t.jsxs("div",{className:n["practice-session__header-top"],children:[t.jsxs("div",{className:n["practice-session__header-left"],children:[t.jsx("h2",{className:n["practice-session__title"],children:"√úbungssitzung"}),t.jsxs("span",{className:n["practice-session__task-counter"],children:[b+1,"/",o.execution.taskIds.length]}),t.jsxs("span",{className:n["practice-session__task-id"],children:["ID: ",i.id]})]}),t.jsx("button",{onClick:c,className:n["practice-session__cancel-btn"],children:"Abbrechen"})]}),t.jsx("div",{className:n["practice-session__progress-bar"],children:t.jsx("div",{className:n["practice-session__progress-fill"],style:{width:`${At}%`}})})]}),t.jsxs("div",{className:n["practice-session__question-area"],children:[(i.type==="multiple-choice"||i.type==="ordering"||i.type==="matching"||i.type==="multiple-select"||i.type==="slider"||i.type==="word-scramble"||i.type==="text-input")&&t.jsx("div",{className:n["practice-session__question-header"],children:t.jsx("h3",{className:n["practice-session__question-text"],children:i.content.question})}),ht()]}),u&&t.jsx("div",{className:n["practice-session__feedback"],children:t.jsxs(ot,{variant:E?"success":"error",title:E?"Richtig!":"Nicht ganz richtig",children:[i.content.explanation&&t.jsx("p",{style:{margin:0},children:i.content.explanation}),i.audioUrl&&i.type==="multiple-choice"&&t.jsxs("div",{style:{marginTop:"0.75rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("span",{style:{fontSize:"0.875rem",color:"var(--color-text-secondary)"},children:"Aussprache:"}),t.jsx(Ce,{text:i.content.options[i.content.correctAnswer],audioUrl:i.audioUrl,size:"small"})]})]})}),t.jsxs("div",{className:n["practice-session__footer"],children:[t.jsx("div",{className:n["practice-session__actions"],children:u?i?.type!=="flashcard"&&t.jsx("button",{onClick:Ee,className:n["practice-session__btn-next"],children:b<o.execution.taskIds.length-1?"N√§chste Aufgabe ‚Üí":"Sitzung beenden"}):t.jsxs(t.Fragment,{children:[i?.type!=="flashcard"&&t.jsx("button",{onClick:ze,disabled:!Xe(),className:Xe()?`${n["practice-session__btn-submit"]} ${n["practice-session__btn-submit--enabled"]}`:`${n["practice-session__btn-submit"]} ${n["practice-session__btn-submit--disabled"]}`,children:"Antwort √ºberpr√ºfen"}),t.jsx("button",{onClick:b<o.execution.taskIds.length-1?pt:Qe,className:n["practice-session__btn-skip"],children:b<o.execution.taskIds.length-1?"√úberspringen ‚Üí":"Sitzung beenden"})]})}),t.jsxs("div",{className:n["practice-session__stats"],children:[t.jsxs("div",{className:n["practice-session__stat"],children:[t.jsx("div",{className:`${n["practice-session__stat-value"]} ${n["practice-session__stat-value--completed"]}`,children:o.execution.completedCount}),t.jsx("div",{className:n["practice-session__stat-label"],children:"beantwortet"})]}),t.jsxs("div",{className:n["practice-session__stat"],children:[t.jsx("div",{className:`${n["practice-session__stat-value"]} ${n["practice-session__stat-value--correct"]}`,children:o.execution.correctCount}),t.jsx("div",{className:n["practice-session__stat-label"],children:"richtig"})]}),t.jsxs("div",{className:n["practice-session__stat"],children:[t.jsxs("div",{className:`${n["practice-session__stat-value"]} ${n["practice-session__stat-value--accuracy"]}`,children:[o.execution.completedCount>0?Math.round(o.execution.correctCount/o.execution.completedCount*100):0,"%"]}),t.jsx("div",{className:n["practice-session__stat-label"],children:"genau"})]})]})]})]})}const pe={"stat-card__container":"_stat-card__container_jhf3g_4","stat-card__header":"_stat-card__header_jhf3g_11","stat-card__title":"_stat-card__title_jhf3g_18","stat-card__icon":"_stat-card__icon_jhf3g_28","stat-card__value":"_stat-card__value_jhf3g_35","stat-card__subtitle":"_stat-card__subtitle_jhf3g_43"};function se({title:a,value:e,subtitle:s,color:r=A.primary[500],icon:l,className:c,style:o,...p}){return t.jsx(le,{...p,padding:"medium",shadow:!0,border:!0,style:{borderLeft:`4px solid ${r}`,...o},className:c,children:t.jsxs("div",{className:pe["stat-card__container"],children:[t.jsxs("div",{className:pe["stat-card__header"],children:[t.jsx("h3",{className:pe["stat-card__title"],children:a}),l&&t.jsx("div",{className:pe["stat-card__icon"],style:{color:r},children:l})]}),t.jsx("div",{className:pe["stat-card__value"],children:e}),s&&t.jsx("div",{className:pe["stat-card__subtitle"],children:s})]})})}const bs="_button_1pgvq_4",ys="_button__icon_1pgvq_115",vs="_button__spinner_1pgvq_130",ws="_spin_1pgvq_1",te={button:bs,"button--loading":"_button--loading_1pgvq_21","button--full-width":"_button--full-width_1pgvq_27","button--primary":"_button--primary_1pgvq_32","button--secondary":"_button--secondary_1pgvq_47","button--ghost":"_button--ghost_1pgvq_62","button--danger":"_button--danger_1pgvq_79","button--small":"_button--small_1pgvq_94","button--medium":"_button--medium_1pgvq_101","button--large":"_button--large_1pgvq_108",button__icon:ys,button__spinner:vs,spin:ws};function Ie({variant:a="primary",size:e="medium",loading:s=!1,fullWidth:r=!1,disabled:l=!1,startIcon:c,endIcon:o,children:p,className:i,...h}){return t.jsx("button",{...h,disabled:l||s,className:z(te.button,te[`button--${a}`],te[`button--${e}`],s&&te["button--loading"],r&&te["button--full-width"],i),children:s?t.jsxs(t.Fragment,{children:[t.jsx(xs,{size:e}),p]}):t.jsxs(t.Fragment,{children:[c&&t.jsx("span",{className:te.button__icon,children:c}),p,o&&t.jsx("span",{className:te.button__icon,children:o})]})})}function xs({size:a}){const e=a==="small"?"12px":a==="large"?"18px":"16px";return t.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:te.button__spinner,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:"31.4 31.4",opacity:"0.25"}),t.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}const F={"session-results":"_session-results_p4d1d_4","session-results__header":"_session-results__header_p4d1d_12","session-results__emoji":"_session-results__emoji_p4d1d_16","session-results__title":"_session-results__title_p4d1d_21","session-results__rating":"_session-results__rating_p4d1d_25","session-results__stats":"_session-results__stats_p4d1d_32","session-results__time-card":"_session-results__time-card_p4d1d_40","session-results__time-text":"_session-results__time-text_p4d1d_45","session-results__progress-card":"_session-results__progress-card_p4d1d_51","session-results__progress-title":"_session-results__progress-title_p4d1d_55","session-results__progress-text":"_session-results__progress-text_p4d1d_59","session-results__sr-card":"_session-results__sr-card_p4d1d_67","session-results__sr-title":"_session-results__sr-title_p4d1d_71","session-results__sr-text":"_session-results__sr-text_p4d1d_75","session-results__actions":"_session-results__actions_p4d1d_82"};function ks({session:a,onClose:e,onStartNew:s}){const r=a.results.accuracy,l=Math.round(a.results.averageTime);let c="",o="";r>=90?(c="Ausgezeichnet!",o=A.success[500]):r>=75?(c="Sehr gut!",o=A.primary[500]):r>=60?(c="Gut gemacht!",o=A.warning[500]):(c="Weiter √ºben!",o=A.error[500]);function p(i){const h=Math.floor(i/60),b=i%60;return h>0?`${h}:${b.toString().padStart(2,"0")} min`:`${b} sek`}return t.jsxs("div",{className:F["session-results"],children:[t.jsxs("div",{className:F["session-results__header"],children:[t.jsx("div",{className:F["session-results__emoji"],children:"üéâ"}),t.jsx("h1",{className:F["session-results__title"],children:"Sitzung abgeschlossen!"}),t.jsx("p",{className:F["session-results__rating"],style:{color:o},children:c})]}),t.jsxs("div",{className:F["session-results__stats"],children:[t.jsx(se,{title:"Aufgaben bearbeitet",value:a.execution.completedCount,color:A.primary[500]}),t.jsx(se,{title:"Richtige Antworten",value:a.execution.correctCount,color:A.success[500]}),t.jsx(se,{title:"Genauigkeit",value:`${Math.round(r)}%`,color:o}),t.jsx(se,{title:"√ò Zeit pro Aufgabe",value:p(l),color:A.warning[500]})]}),t.jsx(le,{padding:"medium",className:F["session-results__time-card"],children:t.jsxs("p",{className:F["session-results__time-text"],children:[t.jsx("strong",{children:"Gesamtzeit:"})," ",p(a.execution.totalTimeSpent)]})}),t.jsxs(le,{padding:"large",className:F["session-results__progress-card"],children:[t.jsx("h3",{className:F["session-results__progress-title"],children:"üìà Dein Fortschritt"}),t.jsxs("p",{className:F["session-results__progress-text"],children:[r>=90&&"Hervorragende Leistung! Du beherrschst dieses Thema sehr gut.",r>=75&&r<90&&"Sehr gute Arbeit! Du machst gro√üe Fortschritte.",r>=60&&r<75&&"Gute Arbeit! Weiter so, du verbesserst dich stetig.",r<60&&"Bleib dran! √úbung macht den Meister. Die n√§chste Sitzung wird noch besser!"]})]}),t.jsxs(ot,{variant:"success",className:F["session-results__sr-card"],children:[t.jsx("h4",{className:F["session-results__sr-title"],children:"üß† Spaced Repetition aktiviert"}),t.jsx("p",{className:F["session-results__sr-text"],children:"Deine Antworten wurden gespeichert. Aufgaben, die du nicht sofort beherrscht hast, werden dir in optimalen Abst√§nden wieder vorgelegt, um dein Langzeitged√§chtnis zu trainieren."})]}),t.jsxs("div",{className:F["session-results__actions"],children:[t.jsx(Ie,{onClick:s,variant:"primary",children:"Neue Sitzung starten"}),t.jsx(Ie,{onClick:e,variant:"secondary",children:"Zur√ºck zur √úbersicht"})]})]})}const he={"mastery-bar":"_mastery-bar_csvhg_4","mastery-bar__header":"_mastery-bar__header_csvhg_9","mastery-bar__label":"_mastery-bar__label_csvhg_16","mastery-bar__count":"_mastery-bar__count_csvhg_22","mastery-bar__track":"_mastery-bar__track_csvhg_28","mastery-bar__fill":"_mastery-bar__fill_csvhg_36"};function Ue({label:a,count:e,color:s,max:r}){const l=r&&r>0?e/r*100:e>0?100:0;return t.jsxs("div",{className:he["mastery-bar"],children:[t.jsxs("div",{className:he["mastery-bar__header"],children:[t.jsx("span",{className:he["mastery-bar__label"],children:a}),t.jsx("span",{className:he["mastery-bar__count"],children:e})]}),t.jsx("div",{className:he["mastery-bar__track"],children:t.jsx("div",{className:he["mastery-bar__fill"],style:{background:s,width:`${l}%`}})})]})}const js="_dashboard_1oze0_4",As="_dashboard__empty_1oze0_12",Ss="_dashboard__header_1oze0_22",Ns="_dashboard__title_1oze0_26",Rs="_dashboard__subtitle_1oze0_30",Cs="_dashboard__metrics_1oze0_36",S={dashboard:js,dashboard__empty:As,"dashboard__back-button":"_dashboard__back-button_1oze0_17",dashboard__header:Ss,dashboard__title:Ns,dashboard__subtitle:Rs,dashboard__metrics:Cs,"dashboard__mastery-card":"_dashboard__mastery-card_1oze0_44","dashboard__mastery-title":"_dashboard__mastery-title_1oze0_48","dashboard__mastery-bars":"_dashboard__mastery-bars_1oze0_52","dashboard__topic-card":"_dashboard__topic-card_1oze0_59","dashboard__topic-title":"_dashboard__topic-title_1oze0_63","dashboard__topic-grid":"_dashboard__topic-grid_1oze0_67","dashboard__topic-item":"_dashboard__topic-item_1oze0_75","dashboard__topic-header":"_dashboard__topic-header_1oze0_79","dashboard__topic-name":"_dashboard__topic-name_1oze0_85","dashboard__topic-meta":"_dashboard__topic-meta_1oze0_89","dashboard__topic-bar-container":"_dashboard__topic-bar-container_1oze0_94","dashboard__topic-bar-fill":"_dashboard__topic-bar-fill_1oze0_101","dashboard__topic-stats":"_dashboard__topic-stats_1oze0_106","dashboard__sessions-title":"_dashboard__sessions-title_1oze0_113","dashboard__sessions-list":"_dashboard__sessions-list_1oze0_117","dashboard__session-item":"_dashboard__session-item_1oze0_125","dashboard__session-left":"_dashboard__session-left_1oze0_134","dashboard__session-topic":"_dashboard__session-topic_1oze0_138","dashboard__session-date":"_dashboard__session-date_1oze0_142","dashboard__session-right":"_dashboard__session-right_1oze0_147","dashboard__session-accuracy":"_dashboard__session-accuracy_1oze0_151","dashboard__session-stats":"_dashboard__session-stats_1oze0_155"};function Ts({onClose:a}){const[e,s]=f.useState(null),[r,l]=f.useState(!0);f.useEffect(()=>{c()},[]);async function c(){try{const i=await I.practiceSessions.toArray(),h=i.filter(x=>x.execution.status==="completed"),b=await I.topics.toArray(),R=new Map(b.map(x=>[x.id,x])),j=await I.spacedRepetition.toArray(),C=h.reduce((x,T)=>x+(T.execution?.completedCount||0),0),u=h.reduce((x,T)=>x+(T.execution?.correctCount||0),0),q=C>0?u/C*100:0,E=h.reduce((x,T)=>T.execution.startedAt&&T.execution.completedAt?x+(new Date(T.execution.completedAt).getTime()-new Date(T.execution.startedAt).getTime())/1e3:x,0),de=h.length>0?E/h.length:0,Q=new Map;for(const x of h){const T=x.configuration.topicId;Q.has(T)||Q.set(T,{sessions:0,correct:0,total:0});const O=Q.get(T);O.sessions++,O.correct+=x.execution?.correctCount||0,O.total+=x.execution?.completedCount||0}const ie=Array.from(Q.entries()).map(([x,T])=>({topicId:x,topicName:R.get(x)?.title||x,sessionsCompleted:T.sessions,accuracy:T.total>0?T.correct/T.total*100:0,tasksReviewed:T.total})),G=new Date,ue=j.filter(x=>x.algorithm.efactor>=2.5).length,ae=j.filter(x=>x.algorithm.efactor<2.5&&x.algorithm.repetition>0).length,be=j.filter(x=>x.algorithm.repetition===0).length,W=j.filter(x=>new Date(x.schedule.nextReview)<=G).length,re=h.sort((x,T)=>{const O=x.execution.completedAt?new Date(x.execution.completedAt).getTime():0;return(T.execution.completedAt?new Date(T.execution.completedAt).getTime():0)-O}).slice(0,5);s({totalSessions:i.length,completedSessions:h.length,totalQuestions:C,correctAnswers:u,accuracyRate:q,averageSessionTime:de,currentStreak:0,totalStudyTime:E,topicProgress:ie,recentSessions:re,upcomingReviews:W,masteryLevels:{mastered:ue,learning:ae,new:be}})}catch(i){console.error("Failed to load dashboard stats:",i)}finally{l(!1)}}function o(i){const h=Math.floor(i/3600),b=Math.floor(i%3600/60);return h>0?`${h}h ${b}m`:`${b}m`}function p(i){return(typeof i=="string"?new Date(i):i).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}return r?t.jsxs("div",{className:S.dashboard__empty,style:{textAlign:"center"},children:[t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Lade Statistiken..."})]}):e?t.jsxs("div",{className:S.dashboard,children:[t.jsxs("div",{className:S.dashboard__header,children:[t.jsx(Ie,{variant:"secondary",onClick:a,className:S["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{className:S.dashboard__title,children:"üìä Lern-Dashboard"}),t.jsx("p",{className:S.dashboard__subtitle,children:"Deine Fortschritte und Statistiken im √úberblick"})]}),t.jsxs("div",{className:S.dashboard__metrics,children:[t.jsx(se,{title:"Gesamt Sitzungen",value:e.completedSessions.toString(),subtitle:`von ${e.totalSessions} gestartet`,color:A.primary[500]}),t.jsx(se,{title:"Genauigkeit",value:`${Math.round(e.accuracyRate)}%`,subtitle:`${e.correctAnswers}/${e.totalQuestions} richtig`,color:A.success[500]}),t.jsx(se,{title:"Lernzeit",value:o(e.totalStudyTime),subtitle:`√ò ${o(e.averageSessionTime)} pro Sitzung`,color:A.warning[500]}),t.jsx(se,{title:"Anstehende Wiederholungen",value:e.upcomingReviews.toString(),subtitle:"bereit zum √úben",color:A.info[500]})]}),t.jsxs(le,{padding:"medium",className:S["dashboard__mastery-card"],children:[t.jsx("h2",{className:S["dashboard__mastery-title"],children:"üéØ Beherrschungsniveau"}),t.jsxs("div",{className:S["dashboard__mastery-bars"],children:[t.jsx(Ue,{label:"Gemeistert",count:e.masteryLevels.mastered,color:A.success[500]}),t.jsx(Ue,{label:"In Arbeit",count:e.masteryLevels.learning,color:A.warning[500]}),t.jsx(Ue,{label:"Neu",count:e.masteryLevels.new,color:A.primary[500]})]})]}),e.topicProgress.length>0&&t.jsxs(le,{padding:"medium",className:S["dashboard__topic-card"],children:[t.jsx("h2",{className:S["dashboard__topic-title"],children:"üìö Fortschritt nach Thema"}),t.jsx("div",{className:S["dashboard__topic-grid"],children:e.topicProgress.map(i=>t.jsxs("div",{className:S["dashboard__topic-item"],children:[t.jsxs("div",{className:S["dashboard__topic-header"],children:[t.jsx("span",{className:S["dashboard__topic-name"],children:i.topicName}),t.jsxs("span",{className:S["dashboard__topic-meta"],children:[i.sessionsCompleted," Sitzungen ‚Ä¢ ",Math.round(i.accuracy),"% genau"]})]}),t.jsx("div",{className:S["dashboard__topic-bar-container"],children:t.jsx("div",{className:S["dashboard__topic-bar-fill"],style:{background:i.accuracy>=75?A.success[500]:i.accuracy>=50?A.warning[500]:A.error[500],width:`${i.accuracy}%`}})}),t.jsxs("div",{className:S["dashboard__topic-stats"],children:[i.tasksReviewed," Aufgaben bearbeitet"]})]},i.topicId))})]}),e.recentSessions.length>0&&t.jsxs(le,{padding:"medium",children:[t.jsx("h2",{className:S["dashboard__sessions-title"],children:"üïê Letzte Sitzungen"}),t.jsx("div",{className:S["dashboard__sessions-list"],children:e.recentSessions.map(i=>t.jsxs("div",{className:S["dashboard__session-item"],children:[t.jsxs("div",{className:S["dashboard__session-left"],children:[t.jsx("div",{className:S["dashboard__session-topic"],children:i.configuration.topicId}),t.jsx("div",{className:S["dashboard__session-date"],children:i.execution.completedAt&&p(i.execution.completedAt)})]}),t.jsxs("div",{className:S["dashboard__session-right"],children:[t.jsxs("div",{className:S["dashboard__session-accuracy"],style:{color:i.results.accuracy>=75?A.success[500]:A.warning[500]},children:[Math.round(i.results.accuracy),"%"]}),t.jsxs("div",{className:S["dashboard__session-stats"],children:[i.execution.correctCount,"/",i.execution.completedCount]})]})]},i.id))})]})]}):t.jsxs("div",{className:S.dashboard__empty,children:[t.jsx(Ie,{variant:"secondary",onClick:a,className:S["dashboard__back-button"],children:"‚Üê Zur√ºck"}),t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Keine Daten verf√ºgbar."})]})}const Is=({topic:a,onSelect:e,className:s,disabled:r=!1,"data-testid":l})=>{const[c,o]=fe.useState(!1),p={padding:"2rem",background:a.color||"#dbeafe",borderRadius:"12px",cursor:r?"not-allowed":"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"2px solid transparent",borderColor:c?"#3b82f6":"transparent",transform:c&&!r?"translateY(-4px)":"translateY(0)",boxShadow:c&&!r?"0 10px 25px rgba(0,0,0,0.1)":"none",opacity:r?.5:1},i=`Thema ${a.name} √∂ffnen - ${a.description}`;return t.jsxs("button",{type:"button",onClick:()=>e(a.id),className:s,"data-testid":l,style:p,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),disabled:r,"aria-label":i,children:[a.icon&&t.jsx("span",{"aria-hidden":"true",style:{fontSize:"48px",display:"block",marginBottom:"16px"},children:a.icon}),t.jsx("h3",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px"},children:a.name}),t.jsx("p",{style:{fontSize:"14px",color:"#666",lineHeight:1.5,margin:0},children:a.description})]})};function Ps(){const[a,e]=f.useState([]),[s,r]=f.useState(null),[l,c]=f.useState([]),[o,p]=f.useState({}),[i,h]=f.useState(null),[b,R]=f.useState(!0),[j,C]=f.useState(!1),[u,q]=f.useState(null),[E,de]=f.useState(!1),[Q,ie]=f.useState(!1),[G,ue]=f.useState({targetCount:10,includeReview:!0}),ae=f.useRef(!1);f.useEffect(()=>{ae.current||(ae.current=!0,be())},[]);async function be(){try{const m="2",P=localStorage.getItem("dbVersion"),M=await I.topics.count(),L=await I.tasks.count();console.log(`Database status: ${M} topics, ${L} tasks, version: ${P}`),M===0||L===0||P!==m?(console.log(P!==m?`Database version mismatch (${P} -> ${m}), re-seeding...`:"Database empty or incomplete, seeding..."),await tt(I),localStorage.setItem("dbVersion",m)):console.log("Database already seeded, skipping seed");const U=await I.topics.toArray();e(U),R(!1)}catch(m){console.error("Failed to initialize app:",m),console.error("Error details:",{name:m?.name,message:m?.message,failures:m?.failures,stack:m?.stack}),R(!1)}}async function W(m){r(m);const P=await I.learningPaths.where("topicId").equals(m.id).toArray();console.log(`Loading learning paths for topic ${m.id}:`,P),P.sort((L,U)=>new Date(U.createdAt).getTime()-new Date(L.createdAt).getTime());const M={};for(const L of P){const U=await I.tasks.where("learningPathId").equals(L.id).toArray();M[L.id]=U.length,console.log(`Learning path "${L.title}" (${L.id}): ${U.length} tasks in DB, taskIds array length: ${L.taskIds?.length||0}`),console.log("Task IDs:",U.map(ve=>ve.id))}p(M),c(P)}function re(m){h(m),ie(!0)}function x(){ie(!1),C(!0)}function T(){ie(!1),h(null)}async function O(){if(C(!1),i&&s){const m=await I.practiceSessions.where("execution.status").equals("completed").reverse().limit(1).toArray();m.length>0&&m[0]&&q(m[0])}}function ne(){C(!1),h(null)}function V(){q(null)}function ye(){q(null),i&&C(!0)}if(b)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center"},children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{children:"Wird geladen..."})]});if(E)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(Ts,{onClose:()=>de(!1)})});if(u)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ks,{session:u,onClose:V,onStartNew:ye})});if(Q&&i&&s)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("button",{onClick:T,style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Sitzung konfigurieren"}),t.jsx("p",{style:{color:"#6b7280",marginBottom:"2rem"},children:i.title}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.5rem"},children:"Anzahl der Fragen"}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[5,10,15,20].map(m=>t.jsx("button",{onClick:()=>ue({...G,targetCount:m}),style:{padding:"0.75rem 1.5rem",background:G.targetCount===m?"#3b82f6":"#f3f4f6",color:G.targetCount===m?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:m},m))})]}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:G.includeReview,onChange:m=>ue({...G,includeReview:m.target.checked}),style:{marginRight:"0.5rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),t.jsx("span",{children:"Wiederholungsfragen einbeziehen"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.5rem",marginLeft:"1.75rem"},children:"Fragen, die du bereits beantwortet hast und die zur Wiederholung f√§llig sind"})]}),t.jsx("button",{onClick:x,style:{padding:"1rem 2rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"500",width:"100%"},children:"Sitzung starten ‚Üí"})]});if(j&&i&&s)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(fs,{topicId:s.id,learningPathIds:[i.id],targetCount:G.targetCount,includeReview:G.includeReview,onComplete:O,onCancel:ne})});if(s)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsx("button",{onClick:()=>r(null),style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck zu Themen"}),t.jsxs("h1",{children:["üìö ",s.title]}),t.jsx("h2",{style:{marginTop:"2rem",marginBottom:"1rem"},children:"Lernpfade"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1rem"},children:l.map(m=>t.jsxs("div",{style:{padding:"1.5rem",background:"#ffffff",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:P=>{P.currentTarget.style.borderColor="#3b82f6",P.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:P=>{P.currentTarget.style.borderColor="#e5e7eb",P.currentTarget.style.transform="translateY(0)"},children:[t.jsx("h3",{style:{marginBottom:"0.5rem"},children:m.title}),t.jsx("p",{style:{fontSize:"0.9rem",color:"#6b7280",marginBottom:"1rem"},children:m.description}),t.jsxs("div",{style:{fontSize:"0.85rem",color:"#9ca3af"},children:[t.jsx("span",{style:{marginRight:"1rem"},children:m.difficulty==="easy"?"üü¢ Leicht":m.difficulty==="medium"?"üü° Mittel":"üî¥ Schwer"}),t.jsxs("span",{children:[o[m.id]||m.taskIds?.length||0," Aufgaben"]})]}),t.jsx("button",{onClick:()=>re(m),style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Lernpfad starten ‚Üí"})]},m.id))})]});async function De(){if(confirm("Datenbank neu laden? Dies wird alle Lernpfade aktualisieren, aber dein Fortschritt bleibt erhalten."))try{await I.topics.clear(),await I.learningPaths.clear(),await I.tasks.clear(),await tt(I);const m=await I.topics.toArray();e(m),alert("‚úÖ Datenbank erfolgreich aktualisiert!")}catch(m){console.error("Reseed failed:",m),alert("‚ùå Fehler beim Aktualisieren der Datenbank")}}function je(m){const P=m.id==="test"?"üéØ":m.id==="mathematik"?"üî¢":"üß¨",M=m.id==="test"?"#fef3c7":m.id==="mathematik"?"#dbeafe":"#dcfce7";return{id:m.id,name:m.title,description:`${m.learningPathIds.length} Lernpfade`,icon:P,color:M}}return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{style:{fontSize:"1.1rem",color:"#6b7280",marginTop:"0.5rem"},children:"Erweitere dein Wissen, eine Frage nach der anderen"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx("button",{onClick:De,style:{padding:"0.75rem 1.5rem",background:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üîÑ DB Aktualisieren"}),t.jsx("button",{onClick:()=>de(!0),style:{padding:"0.75rem 1.5rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Dashboard"})]})]}),t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Themen ausw√§hlen"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1.5rem"},children:a.map(m=>t.jsx(Is,{topic:je(m),onSelect:P=>{const M=a.find(L=>L.id===P);M&&W(M)},"data-testid":`topic-card-${m.id}`},m.id))})]})}qe.createRoot(document.getElementById("root")).render(t.jsx(fe.StrictMode,{children:t.jsx(Ps,{})}));
//# sourceMappingURL=index-BM_6wtDW.js.map
