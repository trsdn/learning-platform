import{r as y,a as He,R as we}from"./react-DnQQq7lD.js";import{D as qe}from"./storage-7oeF2ZJA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(l){if(l.ep)return;l.ep=!0;const i=s(l);fetch(l.href,i)}})();var ve={exports:{}},ne={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ge=y,Je=Symbol.for("react.element"),Ue=Symbol.for("react.fragment"),Ve=Object.prototype.hasOwnProperty,Ze=Ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ye={key:!0,ref:!0,__self:!0,__source:!0};function Se(u,e,s){var n,l={},i=null,a=null;s!==void 0&&(i=""+s),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Ve.call(e,n)&&!Ye.hasOwnProperty(n)&&(l[n]=e[n]);if(u&&u.defaultProps)for(n in e=u.defaultProps,e)l[n]===void 0&&(l[n]=e[n]);return{$$typeof:Je,type:u,key:i,ref:a,props:l,_owner:Ze.current}}ne.Fragment=Ue;ne.jsx=Se;ne.jsxs=Se;ve.exports=ne;var t=ve.exports,ge={},xe=He;ge.createRoot=xe.createRoot,ge.hydrateRoot=xe.hydrateRoot;class Ke extends qe{topics;learningPaths;tasks;answerHistory;userProgress;practiceSessions;spacedRepetition;constructor(){super("LearningPlatformDB"),this.version(1).stores({topics:"id, title, isActive, createdAt",learningPaths:"id, topicId, difficulty, isActive, createdAt",tasks:"id, learningPathId, type, *metadata.tags, metadata.difficulty, createdAt",answerHistory:"id, taskId, sessionId, timestamp, isCorrect",userProgress:"id, topicId, learningPathId, *milestones.lastActivity",practiceSessions:"id, execution.status, execution.startedAt, execution.completedAt, createdAt",spacedRepetition:"id, taskId, schedule.nextReview, algorithm.interval, createdAt"})}}const R=new Ke;async function Qe(){const u=new Map,e=[],s=[],n={mathematik:["algebra-basics.json","geometry-basics.json","advanced-tasks.json","brueche-grundlagen.json"],biologie:["zellbiologie.json","genetik-basics.json"],spanisch:["spanisch-grundlagen.json","begruessung-vorstellung.json","familie-persoenliches.json","zahlen-farben-tiere.json","vokabeltest-karteikarten.json"],test:["all-task-types.json"]};for(const[l,i]of Object.entries(n)){if(!u.has(l)){const a=Xe(l);u.set(l,a)}for(const a of i)try{const r=`/learning-paths/${l}/${a}`,f=await fetch(r);if(!f.ok){console.warn(`Failed to load ${r}: ${f.status}`);continue}const v=await f.json(),W=v.tasks.map(p=>p.id),C={...v.learningPath,taskIds:W,createdAt:v.learningPath.createdAt?new Date(v.learningPath.createdAt):new Date("2024-01-01"),updatedAt:v.learningPath.createdAt?new Date(v.learningPath.createdAt):new Date("2024-01-01")};e.push(C);const T=u.get(l);T.learningPathIds.includes(C.id)||T.learningPathIds.push(C.id);for(const p of v.tasks){const L={...p,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")};s.push(L)}}catch(b){console.error(`Failed to load learning path ${l}/${a}:`,b)}}return{topics:Array.from(u.values()),learningPaths:e,tasks:s}}function Xe(u){const s={test:{id:"test",title:"Test & Demo",description:"Demonstriert alle Aufgabentypen der Plattform",metadata:{estimatedHours:1,difficultyLevel:"beginner",prerequisites:[]}},mathematik:{id:"mathematik",title:"Mathematik",description:"Grundlagen der Mathematik: Algebra, Geometrie und mehr",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},biologie:{id:"biologie",title:"Biologie",description:"Einf√ºhrung in die Biologie: Zellen, Genetik und √ñkosysteme",metadata:{estimatedHours:35,difficultyLevel:"beginner",prerequisites:[]}},spanisch:{id:"spanisch",title:"Spanisch",description:"Lerne Spanisch: Vokabeln, Grammatik und Konversation",metadata:{estimatedHours:50,difficultyLevel:"beginner",prerequisites:[]}},chemie:{id:"chemie",title:"Chemie",description:"Grundlagen der Chemie: Atome, Molek√ºle und Reaktionen",metadata:{estimatedHours:40,difficultyLevel:"intermediate",prerequisites:[]}},physik:{id:"physik",title:"Physik",description:"Einf√ºhrung in die Physik: Kr√§fte, Energie und Bewegung",metadata:{estimatedHours:45,difficultyLevel:"intermediate",prerequisites:[]}}}[u]||{id:u,title:u.charAt(0).toUpperCase()+u.slice(1),description:`Lernmaterialien f√ºr ${u}`,metadata:{estimatedHours:30,difficultyLevel:"beginner",prerequisites:[]}};return{id:s.id,title:s.title,description:s.description,learningPathIds:[],isActive:!0,metadata:s.metadata,createdAt:new Date("2024-01-01"),updatedAt:new Date("2024-01-01")}}async function be(u){console.log("üóëÔ∏è Clearing existing database...");const e=await u.topics.count(),s=await u.learningPaths.count(),n=await u.tasks.count();console.log(`Before clear: ${e} topics, ${s} paths, ${n} tasks`),await u.topics.clear(),await u.learningPaths.clear(),await u.tasks.clear();const l=await u.tasks.count();console.log(`After clear: ${l} tasks remaining`),console.log("üìÇ Loading learning paths from JSON files...");const i=await Qe();if(i.topics.length===0)throw new Error("No learning paths found in JSON files!");console.log(`Saving to database: ${i.topics.length} topics, ${i.learningPaths.length} learning paths, ${i.tasks.length} tasks`),console.log("Topics:",i.topics.map(f=>f.id)),console.log("Learning paths:",i.learningPaths.map(f=>`${f.id} (${f.taskIds?.length||0} taskIds)`)),console.log("Tasks:",i.tasks.map(f=>`${f.id} (learningPathId: ${f.learningPathId})`));try{await u.topics.bulkAdd(i.topics),console.log("‚úì Topics saved")}catch{console.log("‚ö†Ô∏è Topics exist, using bulkPut to update..."),await u.topics.bulkPut(i.topics),console.log("‚úì Topics updated")}try{await u.learningPaths.bulkAdd(i.learningPaths),console.log("‚úì Learning paths saved")}catch{console.log("‚ö†Ô∏è Learning paths exist, using bulkPut to update..."),await u.learningPaths.bulkPut(i.learningPaths),console.log("‚úì Learning paths updated")}try{await u.tasks.bulkAdd(i.tasks),console.log("‚úì Tasks saved")}catch(f){console.error("‚ùå Error saving tasks with bulkAdd:",f.message),console.log("‚ö†Ô∏è Some tasks already exist, using bulkPut to update...");try{await u.tasks.bulkPut(i.tasks),console.log("‚úì Tasks updated with bulkPut")}catch(v){console.error("‚ùå Error with bulkPut:",v.message)}}console.log(`‚úÖ Loaded from JSON: ${i.topics.length} topics, ${i.learningPaths.length} learning paths, ${i.tasks.length} tasks`);const a=await u.topics.count(),b=await u.learningPaths.count(),r=await u.tasks.count();console.log(`‚úÖ Verified in DB: ${a} topics, ${b} learning paths, ${r} tasks`)}class ke extends Error{constructor(e,s,n){super(e),this.code=s,this.context=n,this.name="LearningPlatformError"}}class V extends ke{constructor(e,s){super(e,"VALIDATION_ERROR",s),this.name="ValidationError"}}class K extends ke{constructor(e,s){super(`${e} with id ${s} not found`,"NOT_FOUND",{resource:e,id:s}),this.name="NotFoundError"}}class ${id;configuration;execution;results;createdAt;updatedAt;constructor(e){$.validate(e),this.id=e.id,this.configuration={...e.configuration,learningPathIds:[...e.configuration.learningPathIds]},this.execution={taskIds:[...e.execution.taskIds],completedCount:e.execution.completedCount,correctCount:e.execution.correctCount,status:e.execution.status,totalTimeSpent:e.execution.totalTimeSpent},e.execution.startedAt&&(this.execution.startedAt=new Date(e.execution.startedAt)),e.execution.completedAt&&(this.execution.completedAt=new Date(e.execution.completedAt)),this.results={...e.results,difficultyDistribution:{...e.results.difficultyDistribution},improvementAreas:[...e.results.improvementAreas]},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.configuration?.targetCount!==void 0&&(e.configuration.targetCount<5||e.configuration.targetCount>50))throw new V("Target count must be between 5 and 50",{field:"targetCount",value:e.configuration.targetCount});if(e.execution?.status!==void 0){const s=["planned","active","paused","completed","abandoned"];if(!s.includes(e.execution.status))throw new V("Invalid session status",{field:"status",value:e.execution.status,validValues:s})}}static create(e,s,n,l,i){const a={topicId:s,learningPathIds:n,targetCount:i.targetCount,includeReview:i.includeReview};return i.difficultyFilter&&(a.difficultyFilter=i.difficultyFilter),new $({id:e,configuration:a,execution:{taskIds:l,completedCount:0,correctCount:0,status:"planned",totalTimeSpent:0},results:{accuracy:0,averageTime:0,difficultyDistribution:{},improvementAreas:[]}})}start(){if(this.execution.status!=="planned"&&this.execution.status!=="paused")throw new Error("Can only start planned or paused sessions");this.execution.status="active",this.execution.startedAt||(this.execution.startedAt=new Date),this.updatedAt=new Date}pause(){if(this.execution.status!=="active")throw new Error("Can only pause active sessions");this.execution.status="paused",this.updatedAt=new Date}resume(){if(this.execution.status!=="paused")throw new Error("Can only resume paused sessions");this.execution.status="active",this.updatedAt=new Date}recordAnswer(e,s){if(this.execution.status!=="active")throw new Error("Session must be active to record answers");this.execution.completedCount++,e&&this.execution.correctCount++,this.execution.totalTimeSpent+=s,this.updateResults(),this.updatedAt=new Date}complete(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="completed",this.execution.completedAt=new Date,this.updateResults(),this.updatedAt=new Date}abandon(){if(this.execution.status==="completed"||this.execution.status==="abandoned")throw new Error("Session already finalized");this.execution.status="abandoned",this.updatedAt=new Date}updateResults(){this.execution.completedCount>0&&(this.results.accuracy=this.execution.correctCount/this.execution.completedCount*100),this.execution.completedCount>0&&(this.results.averageTime=this.execution.totalTimeSpent/this.execution.completedCount)}getProgress(){return this.execution.completedCount/this.configuration.targetCount*100}isComplete(){return this.execution.completedCount>=this.configuration.targetCount}getRemainingCount(){return Math.max(0,this.configuration.targetCount-this.execution.completedCount)}toJSON(){const e={id:this.id,configuration:{...this.configuration,learningPathIds:[...this.configuration.learningPathIds]},execution:{...this.execution,taskIds:[...this.execution.taskIds]},results:{...this.results,difficultyDistribution:{...this.results.difficultyDistribution},improvementAreas:[...this.results.improvementAreas]},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.configuration.difficultyFilter&&(e.configuration.difficultyFilter=this.configuration.difficultyFilter),this.execution.startedAt&&(e.execution.startedAt=this.execution.startedAt),this.execution.completedAt&&(e.execution.completedAt=this.execution.completedAt),e}static fromJSON(e){return new $(e)}}class ue{constructor(e,s,n){this.sessionRepository=e,this.taskRepository=s,this.spacedRepRepository=n}async createSession(e){const s=await this.selectTasksForSession(e),n=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={targetCount:e.targetCount,includeReview:e.includeReview};e.difficultyFilter&&(l.difficultyFilter=e.difficultyFilter);const i=$.create(n,e.topicId,e.learningPathIds,s,l);return await this.sessionRepository.create(i.toJSON())}async getSession(e){return await this.sessionRepository.getById(e)}async updateSession(e,s){await this.sessionRepository.update(e,s)}async completeSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new K("PracticeSession",e);const n=$.fromJSON(s);return n.complete(),await this.sessionRepository.update(e,n.toJSON())}async pauseSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new K("PracticeSession",e);const n=$.fromJSON(s);n.pause(),await this.sessionRepository.update(e,n.toJSON())}async resumeSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new K("PracticeSession",e);const n=$.fromJSON(s);n.resume(),await this.sessionRepository.update(e,n.toJSON())}async abandonSession(e){const s=await this.sessionRepository.getById(e);if(!s)throw new K("PracticeSession",e);const n=$.fromJSON(s);n.abandon(),await this.sessionRepository.update(e,n.toJSON())}async getActiveSessions(e){return await this.sessionRepository.getActive(e)}async getRecentSessions(e,s){return await this.sessionRepository.getRecent(e,s)}async recordSessionAnswer(e,s,n){const l=await this.sessionRepository.getById(e);if(!l)throw new K("PracticeSession",e);const i=$.fromJSON(l);i.execution.status==="planned"&&i.start(),i.recordAnswer(s,n),i.isComplete()&&i.complete(),await this.sessionRepository.update(e,i.toJSON())}async selectTasksForSession(e){const s=[];let n=e.targetCount;if(console.log(`Selecting tasks: targetCount=${e.targetCount}, learningPaths=${e.learningPathIds.join(",")}`),e.includeReview&&n>0){const l=await this.spacedRepRepository.getDue(new Date),i=l.slice(0,Math.min(l.length,Math.ceil(e.targetCount*.3))).map(a=>a.taskId);console.log(`Review tasks found: ${i.length}`),s.push(...i),n-=i.length}if(n>0){const l={learningPathIds:e.learningPathIds,excludeIds:s};e.difficultyFilter&&(l.difficulty=e.difficultyFilter),console.log(`Requesting ${n} new tasks with filters:`,l);const i=await this.taskRepository.getRandomTasks(n,l);console.log(`Got ${i.length} tasks:`,i.map(a=>a.id)),s.push(...i.map(a=>a.id))}return console.log(`Total selected tasks: ${s.length}`),s}}class Q{id;taskId;algorithm;schedule;performance;metadata;createdAt;updatedAt;constructor(e){Q.validate(e),this.id=e.id,this.taskId=e.taskId,this.algorithm={...e.algorithm},this.schedule={...e.schedule,nextReview:new Date(e.schedule.nextReview)},e.schedule.lastReviewed&&(this.schedule.lastReviewed=new Date(e.schedule.lastReviewed)),this.performance={...e.performance},this.metadata={...e.metadata,introduced:new Date(e.metadata.introduced)},this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date}static validate(e){if(e.algorithm?.efactor!==void 0&&(e.algorithm.efactor<1.3||e.algorithm.efactor>2.5))throw new V("Efactor must be between 1.3 and 2.5",{field:"efactor",value:e.algorithm.efactor});if(e.algorithm?.interval!==void 0&&(e.algorithm.interval<0||e.algorithm.interval>365))throw new V("Interval must be between 0 and 365 days",{field:"interval",value:e.algorithm.interval});if(e.performance?.lastGrade!==void 0&&(e.performance.lastGrade<0||e.performance.lastGrade>5))throw new V("Grade must be between 0 and 5",{field:"lastGrade",value:e.performance.lastGrade});if(e.performance?.averageAccuracy!==void 0&&(e.performance.averageAccuracy<0||e.performance.averageAccuracy>100))throw new V("Average accuracy must be between 0 and 100",{field:"averageAccuracy",value:e.performance.averageAccuracy})}static createNew(e,s){return new Q({id:s,taskId:e,algorithm:{interval:1,repetition:0,efactor:2.5},schedule:{nextReview:new Date(Date.now()+24*60*60*1e3),totalReviews:0,consecutiveCorrect:0},performance:{averageAccuracy:0,averageTime:0,difficultyRating:3,lastGrade:0},metadata:{introduced:new Date,graduated:!1,lapseCount:0}})}recordAnswer(e,s){if(e<0||e>5)throw new V("Grade must be between 0 and 5",{field:"grade",value:e});if(this.performance.lastGrade=e,this.updateAverageAccuracy(e>=3),this.updateAverageTime(s),this.schedule.totalReviews++,this.schedule.lastReviewed=new Date,e<3)this.algorithm.repetition=0,this.algorithm.interval=1,this.schedule.consecutiveCorrect=0,this.metadata.lapseCount++,this.metadata.graduated=!1;else{this.schedule.consecutiveCorrect++;const n=.1-(5-e)*(.08+(5-e)*.02);this.algorithm.efactor=Math.max(1.3,this.algorithm.efactor+n),this.algorithm.efactor=Math.min(2.5,this.algorithm.efactor),this.algorithm.repetition===0?this.algorithm.interval=1:this.algorithm.repetition===1?this.algorithm.interval=6:this.algorithm.interval=Math.round(this.algorithm.interval*this.algorithm.efactor),this.algorithm.interval=Math.min(365,this.algorithm.interval),this.algorithm.repetition++,this.algorithm.repetition>=2&&(this.metadata.graduated=!0)}this.schedule.nextReview=new Date(Date.now()+this.algorithm.interval*24*60*60*1e3),this.updatedAt=new Date}updateAverageAccuracy(e){const s=this.schedule.totalReviews,l=this.performance.averageAccuracy/100*(s-1)+(e?1:0);this.performance.averageAccuracy=l/s*100}updateAverageTime(e){const s=this.schedule.totalReviews,l=this.performance.averageTime*(s-1)+e;this.performance.averageTime=l/s}isDue(){return this.schedule.nextReview.getTime()<=Date.now()}daysUntilReview(){const e=this.schedule.nextReview.getTime()-Date.now();return Math.ceil(e/(24*60*60*1e3))}toJSON(){const e={id:this.id,taskId:this.taskId,algorithm:{...this.algorithm},schedule:{nextReview:this.schedule.nextReview,totalReviews:this.schedule.totalReviews,consecutiveCorrect:this.schedule.consecutiveCorrect},performance:{...this.performance},metadata:{introduced:this.metadata.introduced,graduated:this.metadata.graduated,lapseCount:this.metadata.lapseCount},createdAt:this.createdAt,updatedAt:this.updatedAt};return this.schedule.lastReviewed&&(e.schedule.lastReviewed=this.schedule.lastReviewed),e}static fromJSON(e){return new Q(e)}}class et{constructor(e,s){this.spacedRepRepository=e,this.taskRepository=s}async getNextTasks(e,s){const i=(await this.spacedRepRepository.getDue(new Date)).sort((b,r)=>r.metadata.lapseCount!==b.metadata.lapseCount?r.metadata.lapseCount-b.metadata.lapseCount:b.schedule.nextReview.getTime()-r.schedule.nextReview.getTime()).slice(0,s),a=[];for(const b of i){const r=await this.taskRepository.getById(b.taskId);r&&a.push(r)}return a}async recordAnswer(e,s,n){if(n<0||n>5)throw new Error("Grade must be between 0 and 5");let l=await this.spacedRepRepository.getByTaskId(e);if(!l){const a=Q.createNew(e,`sr-${e}-${Date.now()}`);l=await this.spacedRepRepository.create(a.toJSON())}const i=Q.fromJSON(l);i.recordAnswer(n,0),await this.spacedRepRepository.update(l.id,i.toJSON())}async getRepetitionData(e){return await this.spacedRepRepository.getByTaskId(e)}async getTasksDue(e){const s=await this.spacedRepRepository.getDue(new Date),n=[];for(const l of s){const i=await this.taskRepository.getById(l.taskId);i&&n.push(i)}return n}async getReviewSchedule(e,s){const n=[],l=new Date;for(let i=0;i<s;i++){const a=new Date(l);a.setDate(a.getDate()+i),a.setHours(23,59,59,999);const b=await this.spacedRepRepository.getByNextReviewDate(a);let r=0;for(const f of b)r+=f.performance.averageTime||3e4;n.push({date:a,taskCount:b.length,estimatedTime:Math.round(r/1e3)})}return n}async rescheduleTask(e,s){const n=await this.spacedRepRepository.getByTaskId(e);if(!n)throw new K("SpacedRepetitionItem",e);await this.spacedRepRepository.updateSchedule(n.id,{...n.schedule,nextReview:s})}async getStatistics(e){const s=await this.spacedRepRepository.getAll(),n=await this.spacedRepRepository.getDue(new Date),l=s.filter(b=>b.metadata.graduated).length,i=s.reduce((b,r)=>b+r.algorithm.interval,0),a=s.reduce((b,r)=>b+r.performance.averageAccuracy,0);return{totalItems:s.length,dueToday:n.length,graduated:l,averageInterval:s.length>0?i/s.length:0,averageAccuracy:s.length>0?a/s.length:0}}}class tt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async search(e){const s=e.toLowerCase();return await this.table.filter(n=>n.title.toLowerCase().includes(s)).toArray()}async getByTitle(e){return null}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class st{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return await this.table.where("topicId").equals(e).toArray()}async getByDifficulty(e){return await this.table.where("difficulty").equals(e).toArray()}async getActive(){return await this.table.where("isActive").equals(1).toArray()}async searchByTitle(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class rt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByLearningPathId(e){return await this.table.where("learningPathId").equals(e).toArray()}async getRandomTasks(e,s){console.log(`[TaskRepository] getRandomTasks called: count=${e}, filters=`,s);let n;if(s?.learningPathIds?(n=await this.table.where("learningPathId").anyOf(s.learningPathIds).toArray(),console.log(`[TaskRepository] Found ${n.length} tasks for learning paths:`,s.learningPathIds),console.log("[TaskRepository] Task IDs:",n.map(a=>a.id))):(n=await this.table.toArray(),console.log(`[TaskRepository] Found ${n.length} tasks (no filter)`)),s?.excludeIds){const a=n.length;n=n.filter(b=>!s.excludeIds.includes(b.id)),console.log(`[TaskRepository] After excluding IDs: ${a} -> ${n.length} tasks`)}const l=n.sort(()=>Math.random()-.5),i=[];if(l.length===0)return console.log("[TaskRepository] No tasks available!"),i;for(let a=0;a<e;a++){const b=l[a%l.length];b&&i.push(b)}return console.log(`[TaskRepository] Returning ${i.length} tasks (${l.length} unique, repeated to reach ${e})`),i}async getByLearningPathIds(e){return[]}async getByType(e){return[]}async getByDifficulty(e){return[]}async getByTags(e){return[]}async search(e){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class nt{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return await this.table.where("taskId").equals(e).toArray()}async getBySessionId(e){return await this.table.where("sessionId").equals(e).toArray()}async getByUserId(e,s){return[]}async getByDateRange(e,s){return[]}async getCorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(s=>s.isCorrect).toArray()}async getIncorrectAnswers(e){return await this.table.where("taskId").equals(e).filter(s=>!s.isCorrect).toArray()}async getAccuracyForPeriod(e,s,n){return 0}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class it{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTopicId(e){return(await this.table.where("topicId").equals(e).toArray())[0]||null}async getByLearningPathId(e){return(await this.table.where("learningPathId").equals(e).toArray())[0]||null}async getByUserId(e){return[]}async updateStatistics(e,s){}async incrementTaskCount(e,s){}async updateStreak(e,s){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class at{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getActive(e){return await this.table.where("execution.status").anyOf(["planned","active","paused"]).toArray()}async getRecent(e,s){return await this.table.orderBy("createdAt").reverse().limit(s).toArray()}async getByStatus(e){return await this.table.where("execution.status").equals(e).toArray()}async getByUserId(e){return[]}async getByDateRange(e,s){return[]}async updateStatus(e,s){}async incrementProgress(e,s,n){}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class ot{constructor(e){this.table=e}async create(e){return await this.table.add(e),e}async getById(e){return await this.table.get(e)||null}async getAll(){return await this.table.toArray()}async update(e,s){return await this.table.update(e,s),await this.table.get(e)}async delete(e){await this.table.delete(e)}async getByTaskId(e){return(await this.table.where("taskId").equals(e).toArray())[0]||null}async getDue(e){return await this.table.where("schedule.nextReview").belowOrEqual(e).toArray()}async getByNextReviewDate(e){return[]}async updateAlgorithmData(e,s){}async updateSchedule(e,s){}async updatePerformance(e,s){}async getReviewCalendar(e,s){return[]}async createMany(e){return[]}async updateMany(e){}async deleteMany(e){}async count(){return await this.table.count()}async exists(e){return!!await this.table.get(e)}}class fe{static topicRepo;static learningPathRepo;static taskRepo;static answerHistoryRepo;static userProgressRepo;static practiceSessionRepo;static spacedRepetitionRepo;static getTopicRepository(){return this.topicRepo||(this.topicRepo=new tt(R.topics)),this.topicRepo}static getLearningPathRepository(){return this.learningPathRepo||(this.learningPathRepo=new st(R.learningPaths)),this.learningPathRepo}static getTaskRepository(){return this.taskRepo||(this.taskRepo=new rt(R.tasks)),this.taskRepo}static getAnswerHistoryRepository(){return this.answerHistoryRepo||(this.answerHistoryRepo=new nt(R.answerHistory)),this.answerHistoryRepo}static getUserProgressRepository(){return this.userProgressRepo||(this.userProgressRepo=new it(R.userProgress)),this.userProgressRepo}static getPracticeSessionRepository(){return this.practiceSessionRepo||(this.practiceSessionRepo=new at(R.practiceSessions)),this.practiceSessionRepo}static getSpacedRepetitionRepository(){return this.spacedRepetitionRepo||(this.spacedRepetitionRepo=new ot(R.spacedRepetition)),this.spacedRepetitionRepo}static reset(){this.topicRepo=null,this.learningPathRepo=null,this.taskRepo=null,this.answerHistoryRepo=null,this.userProgressRepo=null,this.practiceSessionRepo=null,this.spacedRepetitionRepo=null}}const te=()=>fe.getTaskRepository(),he=()=>fe.getPracticeSessionRepository(),se=()=>fe.getSpacedRepetitionRepository();function lt({topicId:u,learningPathIds:e,targetCount:s=10,includeReview:n=!0,onComplete:l,onCancel:i}){const[a,b]=y.useState(null),[r,f]=y.useState(null),[v,W]=y.useState(0),[C,T]=y.useState(null),[p,L]=y.useState(!1),[P,Z]=y.useState(!1),[N,q]=y.useState(Date.now()),[_,Y]=y.useState([]),[G,X]=y.useState(0),[D,J]=y.useState([]),[m,j]=y.useState(null),[z,U]=y.useState([]),[F,ee]=y.useState({}),[ie,g]=y.useState([]),[k,H]=y.useState(new Set),[B,O]=y.useState(0),[M,ae]=y.useState(""),[me,ye]=y.useState(!1),[oe,le]=y.useState(null);y.useEffect(()=>{je()},[]),y.useEffect(()=>{a&&a.execution.taskIds.length>0&&Re()},[a,v]);async function je(){const c=await new ue(he(),te(),se()).createSession({topicId:u,learningPathIds:e,targetCount:s,includeReview:n});b(c)}async function Re(){if(!a||v>=a.execution.taskIds.length)return;const o=a.execution.taskIds[v];if(!o)return;const c=await R.tasks.get(o);if(c)if(f(c),q(Date.now()),T(null),j(null),J([]),U([]),ee({}),g([]),H(new Set),O(0),ae(""),ye(!1),le(null),c.type==="multiple-choice"){const d=c.content,h=[...d.options],S=d.correctAnswer,w=h.map((A,E)=>E);for(let A=w.length-1;A>0;A--){const E=Math.floor(Math.random()*(A+1));[w[A],w[E]]=[w[E],w[A]]}const x=w.map(A=>h[A]),I=w.indexOf(S);Y(x),X(I)}else if(c.type==="cloze-deletion"){const d=c.content;J(new Array(d.blanks.length).fill(""))}else if(c.type==="ordering"){const h=[...c.content.items].sort(()=>Math.random()-.5);U(h)}else if(c.type==="matching"){const h=c.content.pairs.map((S,w)=>w);for(let S=h.length-1;S>0;S--){const w=Math.floor(Math.random()*(S+1));[h[S],h[w]]=[h[w],h[S]]}g(h),ee({})}else if(c.type==="multiple-select")H(new Set);else if(c.type==="slider"){const d=c.content;O(Math.floor((d.min+d.max)/2))}else c.type==="word-scramble"&&ae("")}async function ce(){if(!r||!a)return;let o=!1;if(r.type==="multiple-choice"){if(C===null)return;o=C===G}else if(r.type==="cloze-deletion")o=r.content.blanks.every((I,A)=>{const E=D[A]?.trim().toLowerCase()||"",Oe=I.correctAnswer.toLowerCase(),Ee=I.alternatives?.map(Ne=>Ne.toLowerCase())||[];return E===Oe||Ee.includes(E)});else if(r.type==="true-false"){if(m===null)return;const x=r.content;o=m===x.correctAnswer}else if(r.type==="ordering"){const x=r.content;o=z.every((I,A)=>{const E=x.items.indexOf(I);return x.correctOrder[A]===E})}else if(r.type==="matching")o=r.content.pairs.every((I,A)=>F[A]===A);else if(r.type==="multiple-select"){const x=r.content;if(k.size===0)return;o=x.correctAnswers.length===k.size&&x.correctAnswers.every(I=>k.has(I))}else if(r.type==="slider"){const x=r.content,I=x.tolerance||0;o=Math.abs(B-x.correctValue)<=I}else if(r.type==="word-scramble"){if(!M.trim())return;const x=r.content;o=M.trim().toLowerCase()===x.correctWord.toLowerCase()}else if(r.type==="flashcard"){if(oe===null)return;o=oe}Z(o),L(!0);const c=Math.round((Date.now()-N)/1e3);await new ue(he(),te(),se()).recordSessionAnswer(a.id,o,c);const h=new et(se(),te()),S=o?4:2;await h.recordAnswer(r.id,o,S);const w=await R.practiceSessions.get(a.id);w&&b(w)}function Ae(){a&&(L(!1),T(null),v<a.execution.taskIds.length-1&&W(v+1))}function Ce(){L(!1),T(null),a&&v<a.execution.taskIds.length-1?W(v+1):Te()}async function Te(){if(!a)return;await new ue(he(),te(),se()).completeSession(a.id),await new Promise(c=>setTimeout(c,100)),l()}function de(){if(p)return!1;if(r?.type==="multiple-choice")return C!==null;if(r?.type==="cloze-deletion")return D.every(o=>o.trim().length>0);if(r?.type==="true-false")return m!==null;if(r?.type==="ordering")return z.length>0;if(r?.type==="matching"){const o=r.content;return Object.keys(F).length===o.pairs.length}return r?.type==="multiple-select"?k.size>0:r?.type==="slider"?!0:r?.type==="word-scramble"?M.trim().length>0:r?.type==="flashcard"?oe!==null:!1}function Ie(){return r?r.type==="multiple-choice"?De():r.type==="cloze-deletion"?ze():r.type==="true-false"?Pe():r.type==="ordering"?Be():r.type==="matching"?Le():r.type==="multiple-select"?_e():r.type==="slider"?Me():r.type==="word-scramble"?$e():r.type==="flashcard"?We():null:null}function De(){return!r||r.type!=="multiple-choice"?null:t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",flex:1,minHeight:0},children:_.map((o,c)=>{let d="#ffffff",h="#d1d5db";return p?c===G?(d="#dcfce7",h="#86efac"):c===C&&!P&&(d="#fee2e2",h="#fca5a5"):C===c&&(d="#dbeafe",h="#3b82f6"),t.jsx("button",{onClick:()=>!p&&T(c),disabled:p,style:{padding:"0.875rem",background:d,border:`2px solid ${h}`,borderRadius:"6px",cursor:p?"default":"pointer",textAlign:"left",fontSize:"0.95rem",transition:"all 0.2s"},children:o},c)})})}function ze(){if(!r||r.type!=="cloze-deletion")return null;const o=r.content,c=o.text.split(/\{\{blank\}\}/g);return t.jsxs("div",{style:{flex:1,minHeight:0},children:[t.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.8"},children:c.map((d,h)=>t.jsxs("span",{children:[d,h<o.blanks.length&&t.jsx("input",{type:"text",value:D[h]||"",onChange:S=>{const w=[...D];w[h]=S.target.value,J(w)},disabled:p,style:{padding:"0.25rem 0.5rem",border:p?D[h]?.trim().toLowerCase()===o.blanks[h].correctAnswer.toLowerCase()||o.blanks[h].alternatives?.map(S=>S.toLowerCase()).includes(D[h]?.trim().toLowerCase()||"")?"2px solid #86efac":D[h]?.trim()?"2px solid #fca5a5":"2px solid #d1d5db":"2px solid #d1d5db",borderRadius:"4px",fontSize:"0.95rem",minWidth:"100px",backgroundColor:p?D[h]?.trim().toLowerCase()===o.blanks[h].correctAnswer.toLowerCase()||o.blanks[h].alternatives?.map(S=>S.toLowerCase()).includes(D[h]?.trim().toLowerCase()||"")?"#dcfce7":D[h]?.trim()?"#fee2e2":"#ffffff":"#ffffff"}})]},h))}),p&&t.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#f9fafb",borderRadius:"6px"},children:[t.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},children:"Richtige Antworten:"}),o.blanks.map((d,h)=>{const S=D[h]?.trim().toLowerCase()||"",w=S===d.correctAnswer.toLowerCase()||d.alternatives?.map(x=>x.toLowerCase()).includes(S);return t.jsxs("div",{style:{fontSize:"0.875rem",marginTop:"0.25rem",color:w?"#10b981":"#374151"},children:["L√ºcke ",h+1,": ",t.jsx("strong",{style:{color:"#10b981"},children:d.correctAnswer}),d.alternatives&&d.alternatives.length>0&&t.jsxs("span",{style:{color:"#6b7280",fontSize:"0.8rem"},children:[" ","(auch richtig: ",d.alternatives.join(", "),")"]})]},h)})]})]})}function Pe(){if(!r||r.type!=="true-false")return null;const o=r.content;return t.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("div",{style:{fontSize:"1rem",lineHeight:"1.6",flex:1},children:o.statement}),t.jsx("div",{style:{display:"flex",gap:"1rem"},children:[!0,!1].map(c=>{let d="#ffffff",h="#d1d5db";return p?c===o.correctAnswer?(d="#dcfce7",h="#86efac"):c===m&&!P&&(d="#fee2e2",h="#fca5a5"):m===c&&(d="#dbeafe",h="#3b82f6"),t.jsx("button",{onClick:()=>!p&&j(c),disabled:p,style:{flex:1,padding:"1rem",background:d,border:`2px solid ${h}`,borderRadius:"6px",cursor:p?"default":"pointer",fontSize:"1rem",fontWeight:"500",transition:"all 0.2s"},children:c?"Richtig":"Falsch"},c.toString())})})]})}function Be(){if(!r||r.type!=="ordering")return null;const o=r.content;return t.jsxs("div",{style:{flex:1,minHeight:0},children:[t.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",color:"#6b7280"},children:"Ordne die Elemente in die richtige Reihenfolge"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:z.map((c,d)=>{const h=o.items.indexOf(c),S=p&&o.correctOrder[d]===h,w=p?o.correctOrder.indexOf(h):-1;return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem",background:p&&S?"#dcfce7":"#ffffff",border:p&&S?"2px solid #86efac":"2px solid #d1d5db",borderRadius:"6px"},children:[t.jsxs("div",{style:{fontWeight:"500",color:"#6b7280",minWidth:"24px"},children:[d+1,"."]}),t.jsxs("div",{style:{flex:1},children:[c,p&&!S&&t.jsxs("span",{style:{fontSize:"0.8rem",color:"#ef4444",marginLeft:"0.5rem"},children:["‚Üí Position ",w+1]})]}),!p&&t.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d>0&&t.jsx("button",{onClick:()=>{const x=[...z];[x[d],x[d-1]]=[x[d-1],x[d]],U(x)},style:{padding:"0.25rem 0.5rem",background:"#f3f4f6",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚Üë"}),d<z.length-1&&t.jsx("button",{onClick:()=>{const x=[...z];[x[d],x[d+1]]=[x[d+1],x[d]],U(x)},style:{padding:"0.25rem 0.5rem",background:"#f3f4f6",border:"none",borderRadius:"4px",cursor:"pointer"},children:"‚Üì"})]})]},d)})}),p&&!P&&t.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#f9fafb",borderRadius:"6px"},children:[t.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},children:"Richtige Reihenfolge:"}),o.correctOrder.map((c,d)=>t.jsxs("div",{style:{fontSize:"0.875rem",marginTop:"0.25rem",color:"#10b981"},children:[d+1,". ",t.jsx("strong",{children:o.items[c]})]},d))]})]})}function Le(){if(!r||r.type!=="matching")return null;const o=r.content;return t.jsxs("div",{style:{flex:1,minHeight:0},children:[t.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",color:"#6b7280"},children:"Ordne die passenden Paare zu"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:o.pairs.map((c,d)=>{const h=p&&F[d]===d,S=F[d]!==void 0&&F[d]!==null;return t.jsxs(we.Fragment,{children:[t.jsx("div",{style:{padding:"0.75rem",background:"#f9fafb",border:"2px solid #d1d5db",borderRadius:"6px"},children:c.left}),t.jsxs("select",{value:F[d]??"",onChange:w=>{const x=parseInt(w.target.value);ee({...F,[d]:x})},disabled:p,style:{padding:"0.75rem",border:p?h?"2px solid #86efac":S?"2px solid #fca5a5":"2px solid #d1d5db":"2px solid #d1d5db",borderRadius:"6px",backgroundColor:p?h?"#dcfce7":S?"#fee2e2":"#ffffff":"#ffffff"},children:[t.jsx("option",{value:"",children:"W√§hle..."}),ie.map(w=>t.jsx("option",{value:w,children:o.pairs[w].right},w))]})]},d)})}),p&&!P&&t.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#f9fafb",borderRadius:"6px"},children:[t.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},children:"Richtige Zuordnungen:"}),o.pairs.map((c,d)=>t.jsxs("div",{style:{fontSize:"0.875rem",marginTop:"0.25rem",color:"#10b981"},children:[t.jsx("strong",{children:c.left})," ‚Üí ",t.jsx("strong",{children:c.right})]},d))]})]})}function _e(){if(!r||r.type!=="multiple-select")return null;const o=r.content,c=d=>{if(p)return;const h=new Set(k);h.has(d)?h.delete(d):h.add(d),H(h)};return t.jsxs("div",{style:{flex:1,minHeight:0},children:[t.jsx("div",{style:{marginBottom:"0.75rem",fontSize:"0.875rem",color:"#6b7280"},children:"W√§hle alle zutreffenden Antworten"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:o.options.map((d,h)=>{const S=k.has(h),w=o.correctAnswers.includes(h);let x="#ffffff",I="#d1d5db",A="";return p?w?(x="#dcfce7",I="#86efac",A=S?"‚úì":"‚óã"):S&&!w&&(x="#fee2e2",I="#fca5a5",A="‚úó"):S&&(x="#dbeafe",I="#3b82f6"),t.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"0.875rem",background:x,border:`2px solid ${I}`,borderRadius:"6px",cursor:p?"default":"pointer",transition:"all 0.2s",position:"relative"},children:[t.jsx("input",{type:"checkbox",checked:S,onChange:()=>c(h),disabled:p,style:{marginRight:"0.75rem",width:"1.25rem",height:"1.25rem",cursor:p?"default":"pointer"}}),t.jsx("span",{style:{fontSize:"0.95rem",flex:1},children:d}),p&&A&&t.jsx("span",{style:{fontSize:"1.25rem",fontWeight:"bold",marginLeft:"0.5rem",color:w?"#10b981":"#ef4444"},children:A})]},h)})})]})}function Me(){if(!r||r.type!=="slider")return null;const o=r.content,c=o.step||1,d=o.tolerance||0;return t.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:"1.5rem"},children:[t.jsx("div",{style:{textAlign:"center"},children:t.jsxs("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:p?Math.abs(B-o.correctValue)<=d?"#10b981":"#ef4444":"#3b82f6"},children:[B,o.unit||""]})}),t.jsxs("div",{style:{padding:"0 1rem"},children:[t.jsx("input",{type:"range",min:o.min,max:o.max,step:c,value:B,onChange:h=>O(Number(h.target.value)),disabled:p,style:{width:"100%",height:"8px",borderRadius:"4px",outline:"none",cursor:p?"default":"pointer"}}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.875rem",color:"#6b7280"},children:[t.jsxs("span",{children:[o.min,o.unit||""]}),t.jsxs("span",{children:[o.max,o.unit||""]})]})]}),p&&t.jsx("div",{style:{padding:"1rem",background:"#f9fafb",borderRadius:"6px",textAlign:"center"},children:t.jsxs("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:["Richtige Antwort: ",t.jsxs("strong",{style:{color:"#10b981",fontSize:"1.1rem"},children:[o.correctValue,o.unit||""]}),d>0&&t.jsxs("span",{style:{fontSize:"0.8rem",color:"#6b7280"},children:[" ","(¬±",d,")"]})]})})]})}function $e(){if(!r||r.type!=="word-scramble")return null;const o=r.content;return t.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:"1.5rem"},children:[t.jsxs("div",{style:{padding:"1.5rem",background:"#f9fafb",borderRadius:"8px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"Buchstabensalat:"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",letterSpacing:"0.5rem",color:"#3b82f6",fontFamily:"monospace"},children:o.scrambledWord}),o.showLength&&t.jsxs("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.5rem"},children:["(",o.correctWord.length," Buchstaben)"]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},children:"Deine L√∂sung:"}),t.jsx("input",{type:"text",value:M,onChange:c=>ae(c.target.value),disabled:p,placeholder:"Entschl√ºssle das Wort...",style:{width:"100%",padding:"0.875rem",fontSize:"1.1rem",border:p?M.trim().toLowerCase()===o.correctWord.toLowerCase()?"2px solid #86efac":M.trim()?"2px solid #fca5a5":"2px solid #d1d5db":"2px solid #d1d5db",borderRadius:"6px",backgroundColor:p?M.trim().toLowerCase()===o.correctWord.toLowerCase()?"#dcfce7":M.trim()?"#fee2e2":"#ffffff":"#ffffff",textAlign:"center",fontWeight:"500"}})]}),p&&!P&&t.jsxs("div",{style:{padding:"1rem",background:"#f9fafb",borderRadius:"6px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem",color:"#374151"},children:"Richtige L√∂sung:"}),t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#10b981"},children:o.correctWord})]})]})}function We(){if(!r||r.type!=="flashcard")return null;const o=r.content;return t.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"2rem",padding:"2rem"},children:[t.jsxs("div",{style:{width:"100%",maxWidth:"500px",minHeight:"300px",background:"white",border:"3px solid #e5e7eb",borderRadius:"16px",padding:"3rem",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"1.5rem",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",transition:"all 0.3s ease"},children:[t.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:o.frontLanguage==="de"?"Deutsch":o.frontLanguage==="es"?"Espa√±ol":"English"}),t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#1f2937",textAlign:"center",minHeight:"80px",display:"flex",alignItems:"center"},children:o.front}),me?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{width:"100%",height:"2px",background:"#e5e7eb",margin:"0.5rem 0"}}),t.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:o.backLanguage==="de"?"Deutsch":o.backLanguage==="es"?"Espa√±ol":"English"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#10b981",textAlign:"center",minHeight:"60px",display:"flex",alignItems:"center"},children:o.back})]}):t.jsx("button",{onClick:()=>ye(!0),disabled:p,style:{padding:"1rem 2.5rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.125rem",fontWeight:"500",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(59, 130, 246, 0.3)"},onMouseEnter:c=>{c.currentTarget.style.background="#2563eb",c.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:c=>{c.currentTarget.style.background="#3b82f6",c.currentTarget.style.transform="translateY(0)"},children:"Ergebnis anzeigen"})]}),me&&!p&&t.jsxs("div",{style:{display:"flex",gap:"1.5rem",justifyContent:"center",width:"100%",maxWidth:"500px"},children:[t.jsxs("button",{onClick:()=>{le(!1),ce()},style:{flex:1,padding:"1.25rem",background:"#fee2e2",color:"#dc2626",border:"2px solid #fca5a5",borderRadius:"12px",cursor:"pointer",fontSize:"1.125rem",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",transition:"all 0.2s"},onMouseEnter:c=>{c.currentTarget.style.background="#fecaca",c.currentTarget.style.transform="scale(1.02)"},onMouseLeave:c=>{c.currentTarget.style.background="#fee2e2",c.currentTarget.style.transform="scale(1)"},children:[t.jsx("span",{style:{fontSize:"1.75rem"},children:"‚úó"}),t.jsx("span",{children:"Nicht gewusst"})]}),t.jsxs("button",{onClick:()=>{le(!0),ce()},style:{flex:1,padding:"1.25rem",background:"#dcfce7",color:"#16a34a",border:"2px solid #86efac",borderRadius:"12px",cursor:"pointer",fontSize:"1.125rem",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",transition:"all 0.2s"},onMouseEnter:c=>{c.currentTarget.style.background="#bbf7d0",c.currentTarget.style.transform="scale(1.02)"},onMouseLeave:c=>{c.currentTarget.style.background="#dcfce7",c.currentTarget.style.transform="scale(1)"},children:[t.jsx("span",{style:{fontSize:"1.75rem"},children:"‚úì"}),t.jsx("span",{children:"Gewusst"})]})]}),p&&o.explanation&&t.jsxs("div",{style:{width:"100%",maxWidth:"500px",padding:"1rem",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.95rem",color:"#4b5563",lineHeight:"1.6"},children:[t.jsx("strong",{children:"Hinweis:"})," ",o.explanation]})]})}if(!a||!r)return t.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:t.jsx("p",{children:"Wird geladen..."})});const Fe=(v+1)/a.execution.taskIds.length*100;return t.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",padding:"1rem",maxWidth:"900px",margin:"0 auto"},children:[t.jsxs("div",{style:{marginBottom:"1rem",flexShrink:0},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[t.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:"√úbungssitzung"}),t.jsxs("span",{style:{fontSize:"0.875rem",color:"#6b7280"},children:[v+1,"/",a.execution.taskIds.length]}),t.jsxs("span",{style:{fontSize:"0.75rem",color:"#9ca3af",fontFamily:"monospace"},children:["ID: ",r.id]})]}),t.jsx("button",{onClick:i,style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.875rem"},children:"Abbrechen"})]}),t.jsx("div",{style:{width:"100%",height:"6px",background:"#e5e7eb",borderRadius:"3px",overflow:"hidden"},children:t.jsx("div",{style:{width:`${Fe}%`,height:"100%",background:"#3b82f6",transition:"width 0.3s ease"}})})]}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"#f9fafb",padding:"1.5rem",borderRadius:"8px",marginBottom:"1rem",minHeight:0},children:[(r.type==="multiple-choice"||r.type==="ordering"||r.type==="matching"||r.type==="multiple-select"||r.type==="slider"||r.type==="word-scramble")&&t.jsx("h3",{style:{marginBottom:"1rem",fontSize:"1.1rem",lineHeight:"1.4"},children:r.content.question}),Ie()]}),p&&t.jsxs("div",{style:{background:P?"#dcfce7":"#fee2e2",border:`2px solid ${P?"#86efac":"#fca5a5"}`,padding:"1rem",borderRadius:"6px",marginBottom:"1rem",flexShrink:0},children:[t.jsx("h4",{style:{marginBottom:"0.5rem",fontSize:"1rem"},children:P?"‚úÖ Richtig!":"‚ùå Nicht ganz richtig"}),r.content.explanation&&t.jsx("p",{style:{margin:0,fontSize:"0.875rem"},children:r.content.explanation})]}),t.jsxs("div",{style:{flexShrink:0,display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"1rem"},children:p?t.jsx("button",{onClick:Ce,style:{padding:"0.875rem 2rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:v<a.execution.taskIds.length-1?"N√§chste Aufgabe ‚Üí":"Sitzung beenden"}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:ce,disabled:!de(),style:{padding:"0.875rem 2rem",background:de()?"#3b82f6":"#9ca3af",color:"white",border:"none",borderRadius:"8px",cursor:de()?"pointer":"not-allowed",fontSize:"1rem",fontWeight:"500"},children:"Antwort √ºberpr√ºfen"}),v<a.execution.taskIds.length-1&&t.jsx("button",{onClick:Ae,style:{padding:"0.875rem 2rem",background:"#f3f4f6",color:"#6b7280",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"√úberspringen ‚Üí"})]})}),t.jsxs("div",{style:{padding:"0.75rem 1rem",background:"#f9fafb",borderRadius:"6px",display:"flex",justifyContent:"space-around",gap:"1rem"},children:[t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"#3b82f6"},children:a.execution.completedCount}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"beantwortet"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"#10b981"},children:a.execution.correctCount}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"richtig"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"#f59e0b"},children:[a.execution.completedCount>0?Math.round(a.execution.correctCount/a.execution.completedCount*100):0,"%"]}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"genau"})]})]})]})]})}function ct({session:u,onClose:e,onStartNew:s}){const n=u.results.accuracy,l=Math.round(u.results.averageTime);let i="",a="";n>=90?(i="Ausgezeichnet!",a="#10b981"):n>=75?(i="Sehr gut!",a="#3b82f6"):n>=60?(i="Gut gemacht!",a="#f59e0b"):(i="Weiter √ºben!",a="#ef4444");function b(r){const f=Math.floor(r/60),v=r%60;return f>0?`${f}:${v.toString().padStart(2,"0")} min`:`${v} sek`}return t.jsxs("div",{style:{padding:"2rem",maxWidth:"600px",margin:"0 auto",textAlign:"center"},children:[t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üéâ"}),t.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Sitzung abgeschlossen!"}),t.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold",color:a,margin:0},children:i})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"2rem"},children:[t.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"12px",border:"2px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#3b82f6"},children:u.execution.completedCount}),t.jsx("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:"Aufgaben bearbeitet"})]}),t.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"12px",border:"2px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#10b981"},children:u.execution.correctCount}),t.jsx("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:"Richtige Antworten"})]}),t.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"12px",border:"2px solid #e5e7eb"},children:[t.jsxs("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:a},children:[Math.round(n),"%"]}),t.jsx("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:"Genauigkeit"})]}),t.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"12px",border:"2px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#f59e0b"},children:b(l)}),t.jsx("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:"√ò Zeit pro Aufgabe"})]})]}),t.jsx("div",{style:{background:"#dbeafe",padding:"1rem",borderRadius:"8px",marginBottom:"2rem"},children:t.jsxs("p",{style:{margin:0,fontSize:"0.95rem"},children:[t.jsx("strong",{children:"Gesamtzeit:"})," ",b(u.execution.totalTimeSpent)]})}),t.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"8px",marginBottom:"2rem"},children:[t.jsx("h3",{style:{marginBottom:"0.5rem"},children:"üìà Dein Fortschritt"}),t.jsxs("p",{style:{margin:0,fontSize:"0.95rem",color:"#6b7280",lineHeight:"1.6"},children:[n>=90&&"Hervorragende Leistung! Du beherrschst dieses Thema sehr gut.",n>=75&&n<90&&"Sehr gute Arbeit! Du machst gro√üe Fortschritte.",n>=60&&n<75&&"Gute Arbeit! Weiter so, du verbesserst dich stetig.",n<60&&"Bleib dran! √úbung macht den Meister. Die n√§chste Sitzung wird noch besser!"]})]}),t.jsxs("div",{style:{background:"#dcfce7",border:"2px solid #86efac",padding:"1.5rem",borderRadius:"8px",marginBottom:"2rem"},children:[t.jsx("h4",{style:{marginBottom:"0.5rem"},children:"üß† Spaced Repetition aktiviert"}),t.jsx("p",{style:{margin:0,fontSize:"0.9rem",lineHeight:"1.5"},children:"Deine Antworten wurden gespeichert. Aufgaben, die du nicht sofort beherrscht hast, werden dir in optimalen Abst√§nden wieder vorgelegt, um dein Langzeitged√§chtnis zu trainieren."})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[t.jsx("button",{onClick:s,style:{padding:"1rem 2rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"Neue Sitzung starten"}),t.jsx("button",{onClick:e,style:{padding:"1rem 2rem",background:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"Zur√ºck zur √úbersicht"})]})]})}function dt({onClose:u}){const[e,s]=y.useState(null),[n,l]=y.useState(!0);y.useEffect(()=>{i()},[]);async function i(){try{const r=await R.practiceSessions.toArray(),f=r.filter(m=>m.execution.status==="completed"),v=await R.topics.toArray(),W=new Map(v.map(m=>[m.id,m])),C=await R.spacedRepetition.toArray(),T=f.reduce((m,j)=>m+(j.execution?.completedCount||0),0),p=f.reduce((m,j)=>m+(j.execution?.correctCount||0),0),L=T>0?p/T*100:0,P=f.reduce((m,j)=>j.execution.startedAt&&j.execution.completedAt?m+(new Date(j.execution.completedAt).getTime()-new Date(j.execution.startedAt).getTime())/1e3:m,0),Z=f.length>0?P/f.length:0,N=new Map;for(const m of f){const j=m.configuration.topicId;N.has(j)||N.set(j,{sessions:0,correct:0,total:0});const z=N.get(j);z.sessions++,z.correct+=m.execution?.correctCount||0,z.total+=m.execution?.completedCount||0}const q=Array.from(N.entries()).map(([m,j])=>({topicId:m,topicName:W.get(m)?.title||m,sessionsCompleted:j.sessions,accuracy:j.total>0?j.correct/j.total*100:0,tasksReviewed:j.total})),_=new Date,Y=C.filter(m=>m.algorithm.efactor>=2.5).length,G=C.filter(m=>m.algorithm.efactor<2.5&&m.algorithm.repetition>0).length,X=C.filter(m=>m.algorithm.repetition===0).length,D=C.filter(m=>new Date(m.schedule.nextReview)<=_).length,J=f.sort((m,j)=>{const z=m.execution.completedAt?new Date(m.execution.completedAt).getTime():0;return(j.execution.completedAt?new Date(j.execution.completedAt).getTime():0)-z}).slice(0,5);s({totalSessions:r.length,completedSessions:f.length,totalQuestions:T,correctAnswers:p,accuracyRate:L,averageSessionTime:Z,currentStreak:0,totalStudyTime:P,topicProgress:q,recentSessions:J,upcomingReviews:D,masteryLevels:{mastered:Y,learning:G,new:X}})}catch(r){console.error("Failed to load dashboard stats:",r)}finally{l(!1)}}function a(r){const f=Math.floor(r/3600),v=Math.floor(r%3600/60);return f>0?`${f}h ${v}m`:`${v}m`}function b(r){return(typeof r=="string"?new Date(r):r).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}return n?t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center"},children:[t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Lade Statistiken..."})]}):e?t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"1200px",margin:"0 auto"},children:[t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("button",{onClick:u,style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{style:{margin:0},children:"üìä Lern-Dashboard"}),t.jsx("p",{style:{color:"#6b7280",marginTop:"0.5rem"},children:"Deine Fortschritte und Statistiken im √úberblick"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[t.jsx(re,{title:"Gesamt Sitzungen",value:e.completedSessions.toString(),subtitle:`von ${e.totalSessions} gestartet`,color:"#3b82f6"}),t.jsx(re,{title:"Genauigkeit",value:`${Math.round(e.accuracyRate)}%`,subtitle:`${e.correctAnswers}/${e.totalQuestions} richtig`,color:"#10b981"}),t.jsx(re,{title:"Lernzeit",value:a(e.totalStudyTime),subtitle:`√ò ${a(e.averageSessionTime)} pro Sitzung`,color:"#f59e0b"}),t.jsx(re,{title:"Anstehende Wiederholungen",value:e.upcomingReviews.toString(),subtitle:"bereit zum √úben",color:"#8b5cf6"})]}),t.jsxs("div",{style:{marginBottom:"2rem",background:"white",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[t.jsx("h2",{style:{marginTop:0},children:"üéØ Beherrschungsniveau"}),t.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[t.jsx(pe,{label:"Gemeistert",count:e.masteryLevels.mastered,color:"#10b981"}),t.jsx(pe,{label:"In Arbeit",count:e.masteryLevels.learning,color:"#f59e0b"}),t.jsx(pe,{label:"Neu",count:e.masteryLevels.new,color:"#6b7280"})]})]}),e.topicProgress.length>0&&t.jsxs("div",{style:{marginBottom:"2rem",background:"white",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[t.jsx("h2",{style:{marginTop:0},children:"üìö Fortschritt nach Thema"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginTop:"1rem"},children:e.topicProgress.map(r=>t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("span",{style:{fontWeight:"500"},children:r.topicName}),t.jsxs("span",{style:{color:"#6b7280",fontSize:"0.875rem"},children:[r.sessionsCompleted," Sitzungen ‚Ä¢ ",Math.round(r.accuracy),"% genau"]})]}),t.jsx("div",{style:{background:"#f3f4f6",height:"8px",borderRadius:"4px",overflow:"hidden"},children:t.jsx("div",{style:{background:r.accuracy>=75?"#10b981":r.accuracy>=50?"#f59e0b":"#ef4444",height:"100%",width:`${r.accuracy}%`,transition:"width 0.3s ease"}})}),t.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:[r.tasksReviewed," Aufgaben bearbeitet"]})]},r.topicId))})]}),e.recentSessions.length>0&&t.jsxs("div",{style:{background:"white",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[t.jsx("h2",{style:{marginTop:0},children:"üïê Letzte Sitzungen"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"1rem"},children:e.recentSessions.map(r=>t.jsxs("div",{style:{padding:"1rem",background:"#f9fafb",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"500"},children:r.configuration.topicId}),t.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:r.execution.completedAt&&b(r.execution.completedAt)})]}),t.jsxs("div",{style:{textAlign:"right"},children:[t.jsxs("div",{style:{fontWeight:"500",color:r.results.accuracy>=75?"#10b981":"#f59e0b"},children:[Math.round(r.results.accuracy),"%"]}),t.jsxs("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:[r.execution.correctCount,"/",r.execution.completedCount]})]})]},r.id))})]})]}):t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsx("button",{onClick:u,style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{children:"üìä Dashboard"}),t.jsx("p",{children:"Keine Daten verf√ºgbar."})]})}function re({title:u,value:e,subtitle:s,color:n}){return t.jsxs("div",{style:{background:"white",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:u}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:n},children:e}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},children:s})]})}function pe({label:u,count:e,color:s}){return t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("span",{style:{fontSize:"0.875rem",fontWeight:"500"},children:u}),t.jsx("span",{style:{fontSize:"0.875rem",color:"#6b7280"},children:e})]}),t.jsx("div",{style:{background:"#f3f4f6",height:"8px",borderRadius:"4px",overflow:"hidden"},children:t.jsx("div",{style:{background:s,height:"100%",width:e>0?"100%":"0%",transition:"width 0.3s ease"}})})]})}function ut(){const[u,e]=y.useState([]),[s,n]=y.useState(null),[l,i]=y.useState([]),[a,b]=y.useState({}),[r,f]=y.useState(null),[v,W]=y.useState(!0),[C,T]=y.useState(!1),[p,L]=y.useState(null),[P,Z]=y.useState(!1),[N,q]=y.useState(!1),[_,Y]=y.useState({targetCount:10,includeReview:!0}),G=y.useRef(!1);y.useEffect(()=>{G.current||(G.current=!0,X())},[]);async function X(){try{const g=await R.topics.count(),k=await R.tasks.count();console.log(`Database status: ${g} topics, ${k} tasks`),g===0||k===0?(console.log("Database empty or incomplete, seeding..."),await be(R)):console.log("Database already seeded, skipping seed");const H=await R.topics.toArray();e(H),W(!1)}catch(g){console.error("Failed to initialize app:",g),console.error("Error details:",{name:g?.name,message:g?.message,failures:g?.failures,stack:g?.stack}),W(!1)}}async function D(g){n(g);const k=await R.learningPaths.where("topicId").equals(g.id).toArray();console.log(`Loading learning paths for topic ${g.id}:`,k),k.sort((B,O)=>new Date(O.createdAt).getTime()-new Date(B.createdAt).getTime());const H={};for(const B of k){const O=await R.tasks.where("learningPathId").equals(B.id).toArray();H[B.id]=O.length,console.log(`Learning path "${B.title}" (${B.id}): ${O.length} tasks in DB, taskIds array length: ${B.taskIds?.length||0}`),console.log("Task IDs:",O.map(M=>M.id))}b(H),i(k)}function J(g){f(g),q(!0)}function m(){q(!1),T(!0)}function j(){q(!1),f(null)}async function z(){if(T(!1),r&&s){const g=await R.practiceSessions.where("execution.status").equals("completed").reverse().limit(1).toArray();g.length>0&&g[0]&&L(g[0])}}function U(){T(!1),f(null)}function F(){L(null)}function ee(){L(null),r&&T(!0)}if(v)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",textAlign:"center"},children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{children:"Wird geladen..."})]});if(P)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(dt,{onClose:()=>Z(!1)})});if(p)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(ct,{session:p,onClose:F,onStartNew:ee})});if(N&&r&&s)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif",maxWidth:"600px",margin:"0 auto"},children:[t.jsx("button",{onClick:j,style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck"}),t.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Sitzung konfigurieren"}),t.jsx("p",{style:{color:"#6b7280",marginBottom:"2rem"},children:r.title}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.5rem"},children:"Anzahl der Fragen"}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[5,10,15,20].map(g=>t.jsx("button",{onClick:()=>Y({..._,targetCount:g}),style:{padding:"0.75rem 1.5rem",background:_.targetCount===g?"#3b82f6":"#f3f4f6",color:_.targetCount===g?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:g},g))})]}),t.jsxs("div",{style:{marginBottom:"2rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:_.includeReview,onChange:g=>Y({..._,includeReview:g.target.checked}),style:{marginRight:"0.5rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),t.jsx("span",{children:"Wiederholungsfragen einbeziehen"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.5rem",marginLeft:"1.75rem"},children:"Fragen, die du bereits beantwortet hast und die zur Wiederholung f√§llig sind"})]}),t.jsx("button",{onClick:m,style:{padding:"1rem 2rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"500",width:"100%"},children:"Sitzung starten ‚Üí"})]});if(C&&r&&s)return t.jsx("div",{style:{fontFamily:"system-ui, sans-serif"},children:t.jsx(lt,{topicId:s.id,learningPathIds:[r.id],targetCount:_.targetCount,includeReview:_.includeReview,onComplete:z,onCancel:U})});if(s)return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsx("button",{onClick:()=>n(null),style:{padding:"0.5rem 1rem",background:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"1rem"},children:"‚Üê Zur√ºck zu Themen"}),t.jsxs("h1",{children:["üìö ",s.title]}),t.jsx("h2",{style:{marginTop:"2rem",marginBottom:"1rem"},children:"Lernpfade"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1rem"},children:l.map(g=>t.jsxs("div",{style:{padding:"1.5rem",background:"#ffffff",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:k=>{k.currentTarget.style.borderColor="#3b82f6",k.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:k=>{k.currentTarget.style.borderColor="#e5e7eb",k.currentTarget.style.transform="translateY(0)"},children:[t.jsx("h3",{style:{marginBottom:"0.5rem"},children:g.title}),t.jsx("p",{style:{fontSize:"0.9rem",color:"#6b7280",marginBottom:"1rem"},children:g.description}),t.jsxs("div",{style:{fontSize:"0.85rem",color:"#9ca3af"},children:[t.jsx("span",{style:{marginRight:"1rem"},children:g.difficulty==="easy"?"üü¢ Leicht":g.difficulty==="medium"?"üü° Mittel":"üî¥ Schwer"}),t.jsxs("span",{children:[a[g.id]||g.taskIds?.length||0," Aufgaben"]})]}),t.jsx("button",{onClick:()=>J(g),style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%"},children:"Lernpfad starten ‚Üí"})]},g.id))})]});async function ie(){if(confirm("Datenbank neu laden? Dies wird alle Lernpfade aktualisieren, aber dein Fortschritt bleibt erhalten."))try{await R.topics.clear(),await R.learningPaths.clear(),await R.tasks.clear(),await be(R);const g=await R.topics.toArray();e(g),alert("‚úÖ Datenbank erfolgreich aktualisiert!")}catch(g){console.error("Reseed failed:",g),alert("‚ùå Fehler beim Aktualisieren der Datenbank")}}return t.jsxs("div",{style:{padding:"2rem",fontFamily:"system-ui, sans-serif"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsx("h1",{children:"üß† MindForge Academy"}),t.jsx("p",{style:{fontSize:"1.1rem",color:"#6b7280",marginTop:"0.5rem"},children:"Level up your brain, one question at a time"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.jsx("button",{onClick:ie,style:{padding:"0.75rem 1.5rem",background:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üîÑ DB Aktualisieren"}),t.jsx("button",{onClick:()=>Z(!0),style:{padding:"0.75rem 1.5rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Dashboard"})]})]}),t.jsx("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Themen ausw√§hlen"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1.5rem"},children:u.map(g=>t.jsxs("div",{onClick:()=>D(g),style:{padding:"2rem",background:g.id==="test"?"#fef3c7":g.id==="mathematik"?"#dbeafe":"#dcfce7",borderRadius:"12px",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"2px solid transparent"},onMouseEnter:k=>{k.currentTarget.style.transform="translateY(-4px)",k.currentTarget.style.boxShadow="0 10px 25px rgba(0,0,0,0.1)",k.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:k=>{k.currentTarget.style.transform="translateY(0)",k.currentTarget.style.boxShadow="none",k.currentTarget.style.borderColor="transparent"},children:[t.jsxs("h2",{style:{marginBottom:"0.5rem"},children:[g.id==="test"?"üéØ":g.id==="mathematik"?"üî¢":"üß¨"," ",g.title]}),t.jsxs("div",{style:{fontSize:"0.85rem",opacity:.7},children:[g.learningPathIds.length," Lernpfade"]})]},g.id))})]})}ge.createRoot(document.getElementById("root")).render(t.jsx(we.StrictMode,{children:t.jsx(ut,{})}));
//# sourceMappingURL=index--kf2e92-.js.map
